<!DOCTYPE html><html lang="zh-CN" class="scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/93e7e61feee30498.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/0e452e629ebb050b.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/3ce91b1129a4136b.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/0f707cd0b07b2440.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-923cf83cc9ba3e66.js"/><script src="/_next/static/chunks/bd6e9829-0e01a6de38f0c7e9.js" async=""></script><script src="/_next/static/chunks/110-689e9b73e802d11d.js" async=""></script><script src="/_next/static/chunks/main-app-60123fd33e5f6153.js" async=""></script><script src="/_next/static/chunks/3f731c04-273ad2ee657c8337.js" async=""></script><script src="/_next/static/chunks/234-c6103b572ad887ac.js" async=""></script><script src="/_next/static/chunks/762-aa64ad1bdd524123.js" async=""></script><script src="/_next/static/chunks/207-36fddfdfb38db117.js" async=""></script><script src="/_next/static/chunks/198-cc20d3cf253a42cd.js" async=""></script><script src="/_next/static/chunks/app/layout-b2e88dde541033dc.js" async=""></script><script src="/_next/static/chunks/app/page-a1c4c6e71e886172.js" async=""></script><script src="/_next/static/chunks/c99dd624-c70eb7fd833cb238.js" async=""></script><script src="/_next/static/chunks/b767c4c5-8c8b588264c8b54b.js" async=""></script><script src="/_next/static/chunks/1b3e99d6-bd6014aeea18f102.js" async=""></script><script src="/_next/static/chunks/798-4c46c2b09214eda1.js" async=""></script><script src="/_next/static/chunks/63-a077f07cff7971c5.js" async=""></script><script src="/_next/static/chunks/app/articles/%5B%5B...params%5D%5D/page-b83f93f581d95258.js" async=""></script><link rel="preload" href="https://services.ddadaal.me/monitor/script.js" as="script"/><title>Node是并发性能的绊脚石吗？测试Express服务器的基准并发能力 - ddadaal.me</title><meta name="description" content="ddadaal&#x27;s personal website"/><link rel="manifest" href="/site.webmanifest"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><link rel="icon" href="/icon.svg?35be8e76be1c3618" type="image/svg+xml" sizes="any"/><link rel="apple-touch-icon" href="/apple-icon.png?5334a64f42000bb0" type="image/png" sizes="180x180"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="w-full"><div hidden=""><!--$--><!--/$--></div><div class="flex items-center sticky z-50 w-full h-13 transition -top-[1px] bg-base-200 text-base-content"><div class="flex w-full justify-between items-center max-w-7xl mx-auto px-4"><a class="flex items-center justify-center space-x-1" href="/"><img alt="logo" loading="lazy" width="42" height="42" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/logo.8f2bd5ec.svg"/><h1 class="text-sm font-bold">ddadaal.me</h1></a><div class="flex items-center gap-1"><div class="hidden lg:flex"><ul class="menu menu-horizontal"><li><a class="" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg>主页</a></li><li><a class="active" href="/articles"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg>文章</a></li><li><a class="" href="/sparks"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M478.21 334.093L336 256l142.21-78.093c11.795-6.477 15.961-21.384 9.232-33.037l-19.48-33.741c-6.728-11.653-21.72-15.499-33.227-8.523L296 186.718l3.475-162.204C299.763 11.061 288.937 0 275.48 0h-38.96c-13.456 0-24.283 11.061-23.994 24.514L216 186.718 77.265 102.607c-11.506-6.976-26.499-3.13-33.227 8.523l-19.48 33.741c-6.728 11.653-2.562 26.56 9.233 33.037L176 256 33.79 334.093c-11.795 6.477-15.961 21.384-9.232 33.037l19.48 33.741c6.728 11.653 21.721 15.499 33.227 8.523L216 325.282l-3.475 162.204C212.237 500.939 223.064 512 236.52 512h38.961c13.456 0 24.283-11.061 23.995-24.514L296 325.282l138.735 84.111c11.506 6.976 26.499 3.13 33.227-8.523l19.48-33.741c6.728-11.653 2.563-26.559-9.232-33.036z"></path></svg>想法</a></li><li><details><summary class=""><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"></path></svg>简历</summary><ul class="shadow bg-base-200 text-base-content min-w-max"><li><a class="" href="/resume/cn">🇨🇳 <!-- -->简体中文</a></li><li><a class="" href="/resume/en">🇺🇸 <!-- -->English</a></li></ul></details></li><li><details><summary class=""><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></svg>关于</summary><ul class="shadow bg-base-200 text-base-content min-w-max"><li><a class="" href="/about/odyssey"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg>一个个人博客的史诗</a></li><li><a class="" href="/about/project"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></svg>关于网站</a></li><li><a class="" href="/about/me"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M96 0c35.346 0 64 28.654 64 64s-28.654 64-64 64-64-28.654-64-64S60.654 0 96 0m48 144h-11.36c-22.711 10.443-49.59 10.894-73.28 0H48c-26.51 0-48 21.49-48 48v136c0 13.255 10.745 24 24 24h16v136c0 13.255 10.745 24 24 24h64c13.255 0 24-10.745 24-24V352h16c13.255 0 24-10.745 24-24V192c0-26.51-21.49-48-48-48z"></path></svg>关于我</a></li></ul></details></li></ul></div><div class="dropdown dropdown-end"><label tabindex="0" class="btn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"></path></svg><span class="hidden sm:block">自动</span></label><ul tabindex="0" class="dropdown-content menu p-2 bg-base-200 text-base-content shadow rounded-box min-w-max"><li><a class="justify-between">自动</a></li><li><a class="justify-between">明亮</a></li><li><a class="justify-between">暗色</a></li><li><a class="justify-between">杯子蛋糕</a></li><li><a class="justify-between">大黄蜂</a></li><li><a class="justify-between">白色商务</a></li><li><a class="justify-between">黑色商务</a></li><li><a class="justify-between">金色奢华</a></li><li><a class="justify-between">夏日柠檬</a></li><li><a class="justify-between">绿野仙踪</a></li><li><a class="justify-between">复古</a></li><li><a class="justify-between">粉色浪漫</a></li><li><a class="justify-between">赛博朋克</a></li></ul></div><div class="dropdown dropdown-end"><label tabindex="0" class="btn">🇨🇳 <span class="hidden sm:block">简体中文</span></label><ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-200 rounded-box min-w-max text-base-content"><li><a class="justify-between">🇨🇳 <!-- -->简体中文</a></li><li><a class="justify-between">🇺🇸 <!-- -->English</a></li></ul></div><div class="dropdown dropdown-end lg:hidden"><label tabindex="0" class="btn btn-ghost"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"></path></svg></label><ul tabindex="0" class="menu menu-compact dropdown-content min-w-max mt-3 p-2 shadow rounded-box bg-base-200 text-base-content"><li><a class="" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg>主页</a></li><li><a class="active" href="/articles"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg>文章</a></li><li><a class="" href="/sparks"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M478.21 334.093L336 256l142.21-78.093c11.795-6.477 15.961-21.384 9.232-33.037l-19.48-33.741c-6.728-11.653-21.72-15.499-33.227-8.523L296 186.718l3.475-162.204C299.763 11.061 288.937 0 275.48 0h-38.96c-13.456 0-24.283 11.061-23.994 24.514L216 186.718 77.265 102.607c-11.506-6.976-26.499-3.13-33.227 8.523l-19.48 33.741c-6.728 11.653-2.562 26.56 9.233 33.037L176 256 33.79 334.093c-11.795 6.477-15.961 21.384-9.232 33.037l19.48 33.741c6.728 11.653 21.721 15.499 33.227 8.523L216 325.282l-3.475 162.204C212.237 500.939 223.064 512 236.52 512h38.961c13.456 0 24.283-11.061 23.995-24.514L296 325.282l138.735 84.111c11.506 6.976 26.499 3.13 33.227-8.523l19.48-33.741c6.728-11.653 2.563-26.559-9.232-33.036z"></path></svg>想法</a></li><li><a><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"></path></svg>简历</a><ul><li><a class="" href="/resume/cn">🇨🇳 <!-- -->简体中文</a></li><li><a class="" href="/resume/en">🇺🇸 <!-- -->English</a></li></ul></li><li><a><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></svg>关于</a><ul><li><a class="" href="/about/odyssey"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg>一个个人博客的史诗</a></li><li><a class="" href="/about/project"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></svg>关于网站</a></li><li><a class="" href="/about/me"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M96 0c35.346 0 64 28.654 64 64s-28.654 64-64 64-64-28.654-64-64S60.654 0 96 0m48 144h-11.36c-22.711 10.443-49.59 10.894-73.28 0H48c-26.51 0-48 21.49-48 48v136c0 13.255 10.745 24 24 24h16v136c0 13.255 10.745 24 24 24h64c13.255 0 24-10.745 24-24V352h16c13.255 0 24-10.745 24-24V192c0-26.51-21.49-48-48-48z"></path></svg>关于我</a></li></ul></li></ul></div></div></div></div><div><article><div class="bg-neutral px-4 py-8"><div class="max-w-7xl mx-auto min-h-[256px] flex justify-center text-center text-neutral-content"><div class="flex flex-col justify-center animate-slide-up"><h1 class="text-4xl my-2">Node是并发性能的绊脚石吗？测试Express服务器的基准并发能力</h1><div class="flex flex-wrap gap-3 my-2 text-sm justify-center"><div class="flex flex-wrap gap-1 items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg><a class="badge badge-accent mx-0.5 text-accent-content" href="/articles/search?query=web">web</a><a class="badge badge-accent mx-0.5 text-accent-content" href="/articles/search?query=project">我的项目</a><a class="badge badge-accent mx-0.5 text-accent-content" href="/articles/search?query=node.js">node.js</a><a class="badge badge-accent mx-0.5 text-accent-content" href="/articles/search?query=performance">performance</a><a class="badge badge-accent mx-0.5 text-accent-content" href="/articles/search?query=concurrency">concurrency</a></div><div class="flex items-center" title="发表时间"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"></path></svg><span class="mx-0.5">2025-03-08 08:47:00 UTC+8</span></div><div class="flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm57.1 120H305c7.7 0 13.4 7.1 11.7 14.7l-38 168c-1.2 5.5-6.1 9.3-11.7 9.3h-38c-5.5 0-10.3-3.8-11.6-9.1-25.8-103.5-20.8-81.2-25.6-110.5h-.5c-1.1 14.3-2.4 17.4-25.6 110.5-1.3 5.3-6.1 9.1-11.6 9.1H117c-5.6 0-10.5-3.9-11.7-9.4l-37.8-168c-1.7-7.5 4-14.6 11.7-14.6h24.5c5.7 0 10.7 4 11.8 9.7 15.6 78 20.1 109.5 21 122.2 1.6-10.2 7.3-32.7 29.4-122.7 1.3-5.4 6.1-9.1 11.7-9.1h29.1c5.6 0 10.4 3.8 11.7 9.2 24 100.4 28.8 124 29.6 129.4-.2-11.2-2.6-17.8 21.6-129.2 1-5.6 5.9-9.5 11.5-9.5zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"></path></svg><span class="mx-0.5">3565<!-- --> 字</span></div><div class="flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></svg><span class="mx-0.5">18<!-- --> 分钟阅读</span></div><div class="flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></svg><span class="mx-0.5 space-x-1"><a class="link link-hover" href="/articles/node-express-concurrency-baseline/cn">简体中文</a></span></div></div></div></div></div><div class="animate-slide-up"><div class="max-w-7xl mx-auto p-4"><div class="flex flex-row space-x-4"><div class="prose max-w-full lg:w-[75%]"><div class="card card-l my-2 shadow"><div class="card-body"><h1 id="summary" class="mb-3"><a href="#summary" class="mr-1 card-title"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>✨AI全文摘要</h1><div><div role="tablist" class="tabs-boxed"><a role="tab" class="tab no-underline tab-active">deepseek-r1</a><a role="tab" class="tab no-underline">DeepSeek R1 8B</a><a role="tab" class="tab no-underline">Llama3 Chinese 8B Instruct</a><div role="tabpanel" class="p-3"><div class="prose max-h-80 overflow-auto max-w-full prose-p:m-0 prose-li:m-0 prose-ul:m-0 prose-ol:m-0"><p>作者在Node.js请求转发服务中发现高并发时出现性能瓶颈，6%请求出错且CPU单核满载。通过压力测试发现Express代理服务在2000并发时错误率上升，主因Node.js单线程模型无法利用多核资源。对比测试显示Go语言利用多核优势，错误率显著低于Node.js。解决方案建议优化代码逻辑、减少日志输出或采用多进程负载均衡。实验表明Node.js纯网络IO场景下单核性能受限，生产环境需考虑横向扩展或改用多线程语言。</p></div><p class="text-sm justify-end flex m-2 italic">由<a target="_blank" href="https://ai.azure.com">Azure AI</a>部署的deepseek-r1模型推理</p></div></div></div></div></div><h1 id="问题发现"><a href="#问题发现" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>问题发现</h1>
<p>最近在一个项目中，我遇到了一个使用Node.js编写的请求转发服务的性能瓶颈问题。这个服务的主要工作看似非常简单：获取用户的请求，将请求体(body)转发到后端的服务器，然后将服务器的响应原样返回给客户端。</p>
<p>然而，在进行压力测试时，我们发现当并发请求达到约2000时，系统表现出了明显的性能问题：</p>
<ol>
<li>大约6%的请求出现错误</li>
<li>服务器资源利用率极不平衡 - 只有一个CPU核心达到了100%利用率，而其他核心几乎处于闲置状态</li>
</ol>
<p>大家都说Node.js的IO性能并不算差。这个现象引发了我的思考： <strong>是什么限制了Node.js在这种场景下的性能表现？</strong> 一个看似简单的请求转发工作，为何无法充分利用多核资源？</p>
<p>带着这些疑问，我决定对Node.js代理服务的基准性能进行一次深入研究。我想了解在没有任何特殊优化的情况下，一个标准的Express服务究竟能够处理多少并发请求。这将帮助我确定问题是否出在Node.js本身的并发处理能力上，并在之后遇到类似性能问题或技术选项的时候，对Node本身所能达到的极限能力有个心理预期。</p>
<h1 id="实验设计"><a href="#实验设计" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>实验设计</h1>
<p>为了进行这项研究，我采取了以下步骤：</p>
<ol>
<li>
<p>编写两个简单的项目：</p>
<ul>
<li>一个模拟AI后端服务的Express服务器</li>
<li>一个标准的Express代理服务，负责转发请求到模拟的AI后端</li>
</ul>
</li>
<li>
<p>使用wrk作为性能测试工具，这是一个常用的HTTP基准测试工具，能够产生大量并发连接来测试服务器性能</p>
</li>
<li>
<p>在相同硬件条件下，测试不同并发级别下的性能表现，包括：</p>
<ul>
<li>请求成功率、超时率</li>
<li>响应时间</li>
<li>各个核心的CPU利用率</li>
</ul>
</li>
</ol>
<h1 id="实验实现"><a href="#实验实现" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>实验实现</h1>
<h2 id="模拟后端服务"><a href="#模拟后端服务" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>模拟后端服务</h2>
<p>这个项目是一个简单的Express服务器，它接收POST请求，并返回一个模拟的AI响应。</p>
<p>为了模拟真实响应，这个服务器返回结果前可能会延迟一段时间。我同样会测试延迟不同的时间会对代理服务的性能表现的影响。</p>
<h2 id="代理服务"><a href="#代理服务" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>代理服务</h2>
<p>代理服务同样使用Express实现，它的核心功能是：</p>
<ol>
<li>接收来自客户端的请求</li>
<li>提取请求中的payload</li>
<li>将payload转发到后端AI服务</li>
<li>等待后端响应</li>
<li>将后端响应传回给客户端</li>
</ol>
<p>这个服务保持了最小化的实现，没有添加额外的错误处理、负载均衡或缓存等优化措施，以便我能够测试Node.js的基准性能。</p>
<h1 id="测试结果与分析"><a href="#测试结果与分析" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>测试结果与分析</h1>
<p>测试运行于WSL2，CPU为5900X 12C24T @ 4.5 Ghz，Node版本22.14.0。</p>
<h2 id="后端服务直接返回"><a href="#后端服务直接返回" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>后端服务直接返回</h2>
<p>使用6个线程和不同的连接数，超时时间设置为5s，使用wrk对两个服务分别进行压力测试。其中，运行在<code>5001</code>端口的是模拟后端服务，<code>5000</code>是代理服务。</p>

































































































































































































































































<table><thead><tr><th>Server</th><th>Connections</th><th>Requests/sec</th><th>Avg Latency</th><th>Max Latency</th><th>Total Requests</th><th>Timeouts</th><th>Timeout %</th><th>Total Errors</th><th>Error %</th></tr></thead><tbody><tr><td>5001</td><td>50</td><td>9776.19</td><td>6.03ms</td><td>291.00ms</td><td>97839</td><td>0</td><td>0.00%</td><td>0</td><td>0.00%</td></tr><tr><td>5001</td><td>100</td><td>9294.12</td><td>12.84ms</td><td>537.33ms</td><td>93006</td><td>0</td><td>0.00%</td><td>0</td><td>0.00%</td></tr><tr><td>5001</td><td>150</td><td>9322.45</td><td>31.57ms</td><td>1.31s</td><td>93276</td><td>0</td><td>0.00%</td><td>0</td><td>0.00%</td></tr><tr><td>5001</td><td>200</td><td>8688.89</td><td>63.29ms</td><td>2.14s</td><td>86951</td><td>0</td><td>0.00%</td><td>0</td><td>0.00%</td></tr><tr><td>5001</td><td>500</td><td>8769.33</td><td>163.54ms</td><td>4.99s</td><td>87741</td><td>121</td><td>0.14%</td><td>121</td><td>0.14%</td></tr><tr><td>5001</td><td>1000</td><td>8200.58</td><td>98.60ms</td><td>4.96s</td><td>82284</td><td>67</td><td>0.08%</td><td>67</td><td>0.08%</td></tr><tr><td>5001</td><td>2000</td><td>8808.86</td><td>102.43ms</td><td>4.95s</td><td>88480</td><td>54</td><td>0.06%</td><td>54</td><td>0.06%</td></tr><tr><td>5001</td><td>5000</td><td>7769.21</td><td>248.05ms</td><td>314.09ms</td><td>78333</td><td>25</td><td>0.03%</td><td>1134</td><td>1.45%</td></tr><tr><td>5001</td><td>10000</td><td>7531.77</td><td>453.61ms</td><td>592.39ms</td><td>76076</td><td>13</td><td>0.02%</td><td>6176</td><td>8.12%</td></tr><tr><td>5001</td><td>20000</td><td>6601.98</td><td>414.19ms</td><td>582.31ms</td><td>66423</td><td>15</td><td>0.02%</td><td>15917</td><td>23.96%</td></tr><tr><td>5000</td><td>50</td><td>2673.49</td><td>74.76ms</td><td>2.34s</td><td>26763</td><td>0</td><td>0.00%</td><td>0</td><td>0.00%</td></tr><tr><td>5000</td><td>100</td><td>2884.08</td><td>40.05ms</td><td>909.96ms</td><td>28860</td><td>0</td><td>0.00%</td><td>0</td><td>0.00%</td></tr><tr><td>5000</td><td>150</td><td>2729.84</td><td>94.20ms</td><td>2.16s</td><td>27322</td><td>0</td><td>0.00%</td><td>0</td><td>0.00%</td></tr><tr><td>5000</td><td>200</td><td>2586.36</td><td>176.31ms</td><td>3.61s</td><td>25887</td><td>0</td><td>0.00%</td><td>0</td><td>0.00%</td></tr><tr><td>5000</td><td>500</td><td>2375.25</td><td>192.97ms</td><td>4.96s</td><td>23767</td><td>70</td><td>0.29%</td><td>70</td><td>0.29%</td></tr><tr><td>5000</td><td>1000</td><td>2454.10</td><td>139.51ms</td><td>5.00s</td><td>24629</td><td>90</td><td>0.37%</td><td>90</td><td>0.37%</td></tr><tr><td>5000</td><td>2000</td><td>2449.30</td><td>326.00ms</td><td>4.85s</td><td>24597</td><td>33</td><td>0.13%</td><td>33</td><td>0.13%</td></tr><tr><td>5000</td><td>5000</td><td>1786.15</td><td>326.11ms</td><td>5.00s</td><td>18038</td><td>476</td><td>2.64%</td><td>1768</td><td>9.80%</td></tr><tr><td>5000</td><td>10000</td><td>2016.64</td><td>78.55ms</td><td>3.78s</td><td>20313</td><td>10</td><td>0.05%</td><td>6306</td><td>31.04%</td></tr><tr><td>5000</td><td>20000</td><td>1398.34</td><td>3.40ms</td><td>639.14ms</td><td>14072</td><td>0</td><td>0.00%</td><td>16275</td><td>115.66%</td></tr></tbody></table>
<p>数据比较多，值得关注的结论如下：</p>
<p>对于后端服务：</p>
<ul>
<li>200-500连接数开始已经出现了5s内无法完成的超时请求</li>
<li>2000-5000连接数开始出现并非超时的错误，说明此时node本身已经无法接受更多请求</li>
<li>连接数打到5000后，错误率开始指数上升</li>
</ul>
<p>对于代理服务：</p>
<ul>
<li>几乎所有指标都大幅差于后端服务，在50连接时请求数就已经只有后端服务的1/3</li>
<li>2000连接数开始错误率即开始指数上升</li>
<li>把平均延迟和后台服务的平均延迟作差，可以发现代理本身逻辑执行在1.5-2s附近</li>
</ul>
<h2 id="cpu使用"><a href="#cpu使用" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>CPU使用</h2>
<p>在所有实验中，我还记录了CPU各个核心的使用率，下面是测试后端、2000个连接数时其中一秒的CPU使用率，可以看到，只有一个核心（2）很忙，其他核心没有被充分利用。其他所有数据都具有类似的情况。</p>
<pre><code>10:51:38 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
10:51:39 AM  all    5.93    0.00    1.52    0.00    0.00    4.97    0.00    0.00    0.00   87.58
10:51:39 AM    0    1.75    0.00    0.88    0.00    0.00   11.40    0.00    0.00    0.00   85.96
10:51:39 AM    1    0.00    0.00    1.00    0.00    0.00    1.00    0.00    0.00    0.00   98.00
10:51:39 AM    2   84.00    0.00    6.00    0.00    0.00    0.00    0.00    0.00    0.00   10.00
10:51:39 AM    3    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
10:51:39 AM    4   11.00    0.00    3.00    0.00    0.00    0.00    0.00    0.00    0.00   86.00
10:51:39 AM    5   18.18    0.00    3.03    0.00    0.00    0.00    0.00    0.00    0.00   78.79
10:51:39 AM    6    1.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00   98.00
10:51:39 AM    7    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
10:51:39 AM    8    4.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00   95.00
10:51:39 AM    9    2.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   98.00
10:51:39 AM   10    2.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   98.00
10:51:39 AM   11    0.00    0.00    1.98    0.00    0.00    0.00    0.00    0.00    0.00   98.02
10:51:39 AM   12    3.96    0.00    4.95    0.00    0.00    0.00    0.00    0.00    0.00   91.09
10:51:39 AM   13    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
10:51:39 AM   14    4.50    0.00    3.60    0.00    0.00   10.81    0.00    0.00    0.00   81.08
10:51:39 AM   15    0.00    0.00    0.00    0.00    0.00    2.04    0.00    0.00    0.00   97.96
10:51:39 AM   16    2.65    0.00    0.88    0.00    0.00   15.93    0.00    0.00    0.00   80.53
10:51:39 AM   17    0.92    0.00    1.83    0.00    0.00   12.84    0.00    0.00    0.00   84.40
10:51:39 AM   18    2.44    0.00    4.07    0.00    0.00   19.51    0.00    0.00    0.00   73.98
10:51:39 AM   19    0.00    0.00    2.75    0.00    0.00   13.76    0.00    0.00    0.00   83.49
10:51:39 AM   20    4.63    0.00    0.00    0.00    0.00   11.11    0.00    0.00    0.00   84.26
10:51:39 AM   21    2.73    0.00    0.00    0.00    0.00   11.82    0.00    0.00    0.00   85.45
10:51:39 AM   22    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
10:51:39 AM   23    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
</code></pre>
<h2 id="较慢的后端服务打日志的差别"><a href="#较慢的后端服务打日志的差别" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>较慢的后端服务、打日志的差别</h2>
<p>在上述实验中，后端服务收到请求就直接返回。但是实际上后端服务可能需要一定时间处理。打印日志也是Node服务常见的实践。这两个场景到底对资源消耗有多大呢？</p>
<p>为了更直观地对比不同场景下的性能表现，多设计两个场景</p>
<ol>
<li>后端等到500ms后才返回结果</li>
<li>后端、代理端每收到请求和响应就将请求和响应的URL打印出来（<code>console.log</code>）</li>
</ol>
<p>我整理了以下对比表格，重点关注平均延迟（Avg Latency）、超时率（Timeout %）和错误率（Error %）这三个关键指标：</p>














































































































































































<table><thead><tr><th>连接数</th><th>服务器</th><th>直接返回-延迟</th><th>延迟-延迟</th><th>输出日志-延迟</th><th>直接返回-超时率</th><th>延迟-超时率</th><th>输出日志-超时率</th><th>直接返回-错误率</th><th>延迟-错误率</th><th>输出日志-错误率</th></tr></thead><tbody><tr><td>50</td><td>后端</td><td>6.03ms</td><td>503.92ms</td><td>9.17ms</td><td>0.00%</td><td>0.00%</td><td>0.00%</td><td>0.00%</td><td>0.00%</td><td>0.00%</td></tr><tr><td>500</td><td>后端</td><td>163.54ms</td><td>506.11ms</td><td>132.43ms</td><td>0.14%</td><td>0.00%</td><td>0.13%</td><td>0.14%</td><td>0.00%</td><td>0.13%</td></tr><tr><td>2000</td><td>后端</td><td>102.43ms</td><td>533.43ms</td><td>105.53ms</td><td>0.06%</td><td>0.00%</td><td>0.08%</td><td>0.06%</td><td>0.00%</td><td>0.15%</td></tr><tr><td>5000</td><td>后端</td><td>248.05ms</td><td>529.92ms</td><td>358.23ms</td><td>0.03%</td><td>0.00%</td><td>0.05%</td><td>1.45%</td><td>7.73%</td><td>2.23%</td></tr><tr><td>10000</td><td>后端</td><td>453.61ms</td><td>607.15ms</td><td>641.06ms</td><td>0.02%</td><td>0.00%</td><td>0.00%</td><td>8.12%</td><td>9.89%</td><td>12.64%</td></tr><tr><td>20000</td><td>后端</td><td>414.19ms</td><td>610.10ms</td><td>375.80ms</td><td>0.02%</td><td>0.00%</td><td>0.00%</td><td>23.96%</td><td>30.43%</td><td>35.20%</td></tr><tr><td>50</td><td>代理</td><td>74.76ms</td><td>519.05ms</td><td>54.27ms</td><td>0.00%</td><td>0.00%</td><td>0.00%</td><td>0.00%</td><td>0.00%</td><td>0.00%</td></tr><tr><td>500</td><td>代理</td><td>192.97ms</td><td>717.28ms</td><td>208.93ms</td><td>0.29%</td><td>0.00%</td><td>0.29%</td><td>0.29%</td><td>0.00%</td><td>0.29%</td></tr><tr><td>2000</td><td>代理</td><td>326.00ms</td><td>726.51ms</td><td>417.52ms</td><td>0.13%</td><td>2.03%</td><td>0.21%</td><td>0.13%</td><td>2.03%</td><td>0.21%</td></tr><tr><td>5000</td><td>代理</td><td>326.11ms</td><td>892.77ms</td><td>434.87ms</td><td>2.64%</td><td>1.35%</td><td>2.87%</td><td>9.80%</td><td>13.92%</td><td>10.33%</td></tr><tr><td>10000</td><td>代理</td><td>78.55ms</td><td>788.52ms</td><td>89.68ms</td><td>0.05%</td><td>2.90%</td><td>0.01%</td><td>31.04%</td><td>36.76%</td><td>36.39%</td></tr><tr><td>20000</td><td>代理</td><td>3.40ms</td><td>777.70ms</td><td>94.90ms</td><td>0.00%</td><td>0.00%</td><td>0.00%</td><td>115.66%</td><td>232.21%</td><td>107.78%</td></tr></tbody></table>
<p>从这个对比表格中，我们可以得出几个重要观察：</p>
<ol>
<li>
<p><strong>延迟500ms的影响</strong>：当后端服务增加500ms延迟后，整体延迟有增加，连接数越多，平均延迟增加越少，但是增加的延迟仍然会使得错误率增加</p>
</li>
<li>
<p><strong>超时情况分析</strong>：在大多数连接数下，超时率都相对较低；但在代理服务的中等连接数(2000-5000)场景下，超时率明显上升，特别是在延迟返回的测试中，显示出代理服务在处理较长延迟请求时的瓶颈</p>
</li>
<li>
<p><strong>日志输出的影响</strong>：与直接返回相比，增加日志输出确实会增加延迟，但影响不是特别显著。在低并发情况下（50-500连接），日志对后端服务的影响较小；但在高并发时（10000+连接），日志输出会明显增加系统负担</p>
</li>
<li>
<p><strong>错误率增长点</strong>：无论哪种场景，代理服务的错误率普遍高于后端服务，且在5000连接数左右开始出现明显的错误率上升</p>
</li>
<li>
<p><strong>极端高并发下的异常</strong>：在20000连接的极端情况下，所有配置都表现出较高的错误率，但代理服务的延迟反而下降，这可能是因为大量请求被直接拒绝，导致成功请求的平均延迟降低</p>
</li>
</ol>
<h1 id="go"><a href="#go" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>Go</h1>
<p>为了对比，我又准备了用Go使用标准库<code>net/http</code>编写的相同功能的两个程序，并在后端500ms延迟、不打log的情况下，测出go的成绩如下（未列出的连接数并未发生错误）：</p>

























































































<table><thead><tr><th>Server</th><th>Connections</th><th>Requests/sec</th><th>Avg Latency</th><th>Max Latency</th><th>Total Requests</th><th>Timeouts</th><th>Timeout %</th><th>Total Errors</th><th>Error %</th></tr></thead><tbody><tr><td>5001</td><td>5000</td><td>7310.92</td><td>501.39ms</td><td>516.91ms</td><td>73728</td><td>0</td><td>0.00%</td><td>902</td><td>1.22%</td></tr><tr><td>5001</td><td>10000</td><td>7060.75</td><td>501.72ms</td><td>517.20ms</td><td>71154</td><td>0</td><td>0.00%</td><td>5900</td><td>8.29%</td></tr><tr><td>5001</td><td>20000</td><td>6493.01</td><td>501.33ms</td><td>512.36ms</td><td>65536</td><td>0</td><td>0.00%</td><td>15902</td><td>24.26%</td></tr><tr><td>5000</td><td>5000</td><td>5910.59</td><td>636.54ms</td><td>3.46s</td><td>59611</td><td>0</td><td>0.00%</td><td>903</td><td>1.51%</td></tr><tr><td>5000</td><td>10000</td><td>5441.54</td><td>657.59ms</td><td>1.25s</td><td>54953</td><td>0</td><td>0.00%</td><td>5900</td><td>10.74%</td></tr><tr><td>5000</td><td>20000</td><td>4857.47</td><td>663.12ms</td><td>2.11s</td><td>48912</td><td>0</td><td>0.00%</td><td>15902</td><td>32.51%</td></tr></tbody></table>
<p>二者的差距还是在预期的，go从来没有发生过超时，整体延迟、错误率数据也比node好很多。如在5000个连接下，代理程序出现1.51%的错误，node版本出现9.08%的错误，差距在6倍左右。但是需要注意的是，go可以利用全部CPU核心，而node的js线程只能利用一个核心，如果启动多个node并进行负载均衡，最终结果不一定有很大的差别。</p>
<h1 id="结论"><a href="#结论" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>结论</h1>
<p>通过这些简单数据，我们发现</p>
<ul>
<li>Node本身的单线程模型无法利用所有CPU的能力，即使在纯网络IO任务中也可能成为性能瓶颈</li>
<li>在这次实验中，express在<strong>2000</strong>连接数是个门槛，在此之上，超时率、错误率会迅速增加
<ul>
<li>并且，我的测试机器是消费级CPU，而一般服务器CPU并不能达到如此的单核性能，所以在生产环境中的性能表现会更差</li>
</ul>
</li>
</ul>
<p>要想解决这个问题，在代码中做出一定的优化，例如减少日志打印、简化Node中的逻辑等，也会有一定的效果。如果优化代码的效果不佳，唯一的办法是运行多个node进程，可以考虑的方法主要是启动多个node服务并增加负载均衡，或者使用node cluster让node可以启动多个worker process。</p>
<p>本实验中的代码和结果均在 <a href="https://github.com/ddadaal/node-express-concurrency-baseline-test">https://github.com/ddadaal/node-express-concurrency-baseline-test</a> 中可用。</p>
<h1 id="acknowledgements"><a href="#acknowledgements" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>Acknowledgements</h1>
<p>整个测试项目、测试脚本甚至本篇文章基本都是直接使用Copilot + Claude 3.7 Sonnet模型生成的，不得不说，让AI生成大框架、自己再来完善细节的做法确实能提高不少效率。这种实验的大多数工作实际上是框架代码，代码本身逻辑简单，但是需要使用大量API、编写繁琐的测试逻辑、数据分析以及做表，手写非常耗费精力，让AI来做这些繁琐的工作实在是再合适不过了。写文章也可以让AI帮忙做，我之前写篇文章至少需要花一整天，这一次居然一个上午就搞定了。</p>
<p>哦，上面这一句话不是AI写的😀</p></div><div class="hidden lg:block lg:w-[25%]"><div class="px-1 sticky top-24 max-h-[60vh] overflow-auto"><div class="flex space-x-1 items-center py-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"></path></svg><span>目录</span></div><ul class="pl-2 border-l border-neutral"><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="summary" href="#summary"><span class="font-bold">✨AI全文摘要</span></a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="问题发现" href="#问题发现">问题发现</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="实验设计" href="#实验设计">实验设计</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="实验实现" href="#实验实现">实验实现</a><ul class="pl-2 border-l border-neutral"><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="模拟后端服务" href="#模拟后端服务">模拟后端服务</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="代理服务" href="#代理服务">代理服务</a></li></ul></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="测试结果与分析" href="#测试结果与分析">测试结果与分析</a><ul class="pl-2 border-l border-neutral"><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="后端服务直接返回" href="#后端服务直接返回">后端服务直接返回</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="cpu使用" href="#cpu使用">CPU使用</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="较慢的后端服务打日志的差别" href="#较慢的后端服务打日志的差别">较慢的后端服务、打日志的差别</a></li></ul></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="go" href="#go">Go</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="结论" href="#结论">结论</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="acknowledgements" href="#acknowledgements">Acknowledgements</a></li></ul></div></div></div></div><div class="max-w-7xl mx-auto p-4"></div><div class="max-w-7xl mx-auto p-4"><div><h2 class="text-2xl font-bold mb-2 flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"></path></svg><span class="mx-2"> 评论</span></h2></div></div></div></article><!--$--><!--/$--></div><footer class="bg-base-200 text-base-content"><div class="footer sm:footer-horizontal py-6 max-w-7xl mx-auto px-4"><div class="space-y-1"><p>👨🏼‍💻 <!-- -->本网站由<a class="link link-hover" href="/about/me/cn">ddadaal</a>自豪地编写</p><p>📝<!-- -->本站文章在<a rel="licene noreferrer" target="_blank" class="link" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>协议下授权</p><div class="tooltip" data-tip="2018-11-17 06:51:00 UTC+0"><p>📅<!-- --> <!-- -->博客已经运行 <span class="countdown"><span style="--value:6"></span></span> 年 <span class="countdown"><span style="--value:9"></span></span> 月 <span class="countdown"><span style="--value:25"></span></span> 天 <span class="countdown"><span style="--value:9"></span></span> 时 <span class="countdown"><span style="--value:17"></span></span> 分 <span class="countdown"><span style="--value:23"></span></span> 秒</p></div><p>⏲️<!-- --> <!-- -->最后更新<!-- -->:  <!-- -->2025-08-07 16:08:23 UTC+0</p><div><p>📲<!-- --> <!-- -->联系我</p><div class="flex py-2 gap-2"><span><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=540232834&amp;site=qq&amp;menu=yes" title="QQ: 540232834" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"></path></svg></a></span><span><a href="mailto://ddadaal.me@outlook.com" title="E-mail: ddadaal@outlook.com" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M160 448c-25.6 0-51.2-22.4-64-32-64-44.8-83.2-60.8-96-70.4V480c0 17.67 14.33 32 32 32h256c17.67 0 32-14.33 32-32V345.6c-12.8 9.6-32 25.6-96 70.4-12.8 9.6-38.4 32-64 32zm128-192H32c-17.67 0-32 14.33-32 32v16c25.6 19.2 22.4 19.2 115.2 86.4 9.6 6.4 28.8 25.6 44.8 25.6s35.2-19.2 44.8-22.4c92.8-67.2 89.6-67.2 115.2-86.4V288c0-17.67-14.33-32-32-32zm256-96H224c-17.67 0-32 14.33-32 32v32h96c33.21 0 60.59 25.42 63.71 57.82l.29-.22V416h192c17.67 0 32-14.33 32-32V192c0-17.67-14.33-32-32-32zm-32 128h-64v-64h64v64zm-352-96c0-35.29 28.71-64 64-64h224V32c0-17.67-14.33-32-32-32H96C78.33 0 64 14.33 64 32v192h96v-32z"></path></svg></a></span><span><a href="https://www.linkedin.com/in/chenjunda/" title="LinkedIn: 陈俊达" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></span><span><a href="https://github.com/ddadaal" title="GitHub: ddadaal" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></span><span><a href="https://steamcommunity.com/profiles/76561198104889782" title="Steam: Victor Crubs" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M496 256c0 137-111.2 248-248.4 248-113.8 0-209.6-76.3-239-180.4l95.2 39.3c6.4 32.1 34.9 56.4 68.9 56.4 39.2 0 71.9-32.4 70.2-73.5l84.5-60.2c52.1 1.3 95.8-40.9 95.8-93.5 0-51.6-42-93.5-93.7-93.5s-93.7 42-93.7 93.5v1.2L176.6 279c-15.5-.9-30.7 3.4-43.5 12.1L0 236.1C10.2 108.4 117.1 8 247.6 8 384.8 8 496 119 496 256zM155.7 384.3l-30.5-12.6a52.79 52.79 0 0 0 27.2 25.8c26.9 11.2 57.8-1.6 69-28.4 5.4-13 5.5-27.3.1-40.3-5.4-13-15.5-23.2-28.5-28.6-12.9-5.4-26.7-5.2-38.9-.6l31.5 13c19.8 8.2 29.2 30.9 20.9 50.7-8.3 19.9-31 29.2-50.8 21zm173.8-129.9c-34.4 0-62.4-28-62.4-62.3s28-62.3 62.4-62.3 62.4 28 62.4 62.3-27.9 62.3-62.4 62.3zm.1-15.6c25.9 0 46.9-21 46.9-46.8 0-25.9-21-46.8-46.9-46.8s-46.9 21-46.9 46.8c.1 25.8 21.1 46.8 46.9 46.8z"></path></svg></a></span><span><a href="https://zhihu.com/people/VicCrubs" title="知乎：陈俊达" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z"></path></svg></a></span><span><a href="https://www.douban.com/people/183064260/" title="豆瓣: ddadaal" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M.51 3.06h22.98V.755H.51V3.06Zm20.976 2.537v9.608h-2.137l-1.669 5.76H24v2.28H0v-2.28h6.32l-1.67-5.76H2.515V5.597h18.972Zm-5.066 9.608H7.58l1.67 5.76h5.501l1.67-5.76ZM18.367 7.9H5.634v5.025h12.733V7.9Z"></path></svg></a></span></div></div><p class="text-center">©<!-- --> <!-- -->2025<!-- --> <!-- -->|<!-- --> <!-- -->用 ❤ 制作</p></div><div><span class="footer-title">🚀<!-- --> <!-- -->强力驱动</span><a class="link link-hover" target="_blank" href="https://reactjs.org/" rel="noreferrer">React</a><a class="link link-hover" target="_blank" href="https://nextjs.org/" rel="noreferrer">Next.js</a><a class="link link-hover" target="_blank" href="https://pages.github.com/" rel="noreferrer">GitHub Pages</a><a class="link link-hover" target="_blank" href="https://www.typescriptlang.org/" rel="noreferrer">TypeScript</a></div><div><span class="footer-title">🎨<!-- --> <!-- -->描绘主题</span><a class="link link-hover" target="_blank" href="https://daisyui.com/" rel="noreferrer">daisyui</a><a class="link link-hover" target="_blank" href="https://tailwindcss.com/" rel="noreferrer">tailwind</a></div><div><span class="footer-title">🎓<!-- --> <!-- -->联系我</span><a class="link link-hover" target="_blank" href="https://idealclover.top" rel="noreferrer">idealclover - 翠翠酱的个人网站</a><a class="link link-hover" target="_blank" href="https://sephidator.xyz" rel="noreferrer">Sephidator - Sephidator的个人博客</a><a class="link link-hover" target="_blank" href="https://iznauy.github.io/" rel="noreferrer">iznauy - 个人博客</a><a class="link link-hover" target="_blank" href="https://aironoria.github.io" rel="noreferrer">Aironoria - 陈俊宇的个人博客</a><a class="link link-hover" target="_blank" href="https://jbesu.com/" rel="noreferrer">forewing - 个人主页</a><a class="link link-hover" target="_blank" href="https://weiser.fun" rel="noreferrer">Weiser - 个人主页</a></div></div></footer><button class="fixed animate-slide-up bottom-8 right-8 z-50 p-3 rounded-full bg-base-300 text-base-content shadow" title="To top"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="w-6 h-6" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></svg></button><script src="/_next/static/chunks/webpack-923cf83cc9ba3e66.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n3:I[8387,[],\"\"]\n4:I[1007,[],\"\"]\n6:I[3809,[],\"OutletBoundary\"]\n9:I[751,[],\"AsyncMetadataOutlet\"]\nb:I[3809,[],\"ViewportBoundary\"]\nd:I[3809,[],\"MetadataBoundary\"]\nf:I[1254,[],\"\"]\n:HL[\"/_next/static/css/93e7e61feee30498.css\",\"style\"]\n:HL[\"/_next/static/css/0e452e629ebb050b.css\",\"style\"]\n:HL[\"/_next/static/css/3ce91b1129a4136b.css\",\"style\"]\n:HL[\"/_next/static/css/0f707cd0b07b2440.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"u4ZIPsh96Hq0x3_OYr3y1\",\"p\":\"\",\"c\":[\"\",\"articles\",\"node-express-concurrency-baseline\",\"cn\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"articles\",{\"children\":[[\"params\",\"node-express-concurrency-baseline/cn\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/93e7e61feee30498.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],\"$L2\"]}],{\"children\":[\"articles\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"params\",\"node-express-concurrency-baseline/cn\",\"oc\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0e452e629ebb050b.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3ce91b1129a4136b.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0f707cd0b07b2440.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L6\",null,{\"children\":[\"$L7\",\"$L8\",[\"$\",\"$L9\",null,{\"promise\":\"$@a\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"u-lEb_h0bnt1P0kO2e_VZv\",{\"children\":[[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],null]}],[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"10:\"$Sreact.suspense\"\n11:I[751,[],\"AsyncMetadata\"]\ne:[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$10\",null,{\"fallback\":null,\"children\":[\"$\",\"$L11\",null,{\"promise\":\"$@12\"}]}]}]\n8:null\n"])</script><script>self.__next_f.push([1,"13:I[3567,[\"458\",\"static/chunks/3f731c04-273ad2ee657c8337.js\",\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"198\",\"static/chunks/198-cc20d3cf253a42cd.js\",\"177\",\"static/chunks/app/layout-b2e88dde541033dc.js\"],\"RootLayout\"]\n14:I[9787,[\"458\",\"static/chunks/3f731c04-273ad2ee657c8337.js\",\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"198\",\"static/chunks/198-cc20d3cf253a42cd.js\",\"177\",\"static/chunks/app/layout-b2e88dde541033dc.js\"],\"\"]\n15:I[9584,[\"458\",\"static/chunks/3f731c04-273ad2ee657c8337.js\",\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"198\",\"static/chunks/198-cc20d3cf253a42cd.js\",\"177\",\"static/chunks/app/layout-b2e88dde541033dc.js\"],\"Header\"]\n16:I[8832,[\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"974\",\"static/chunks/app/page-a1c4c6e71e886172.js\"],\"Localized\"]\n17:I[6562,[\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"974\",\"static/chunks/app/page-a1c4c6e71e886172.js\"],\"LocalizedArticleLink\"]\n18:I[7508,[\"458\",\"static/chunks/3f731c04-273ad2ee657c8337.js\",\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"198\",\"static/chunks/198-cc20d3cf253a42cd.js\",\"177\",\"static/chunks/app/layout-b2e88dde541033dc.js\"],\"RunningTime\"]\n19:I[4266,[\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"974\",\"static/chunks/app/page-a1c4c6e71e886172.js\"],\"LastUpdateTime\"]\n1c:I[1236,[\"458\",\"static/chunks/3f731c04-273ad2ee657c8337.js\",\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd5241"])</script><script>self.__next_f.push([1,"23.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"198\",\"static/chunks/198-cc20d3cf253a42cd.js\",\"177\",\"static/chunks/app/layout-b2e88dde541033dc.js\"],\"ToTop\"]\n1a:T518,M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z1b:T5b8,M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7."])</script><script>self.__next_f.push([1,"91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z"])</script><script>self.__next_f.push([1,"2:[\"$\",\"$L13\",null,{\"children\":[[\"$\",\"$L14\",null,{\"data-host\":\"https://services.ddadaal.me\",\"data-dnt\":\"false\",\"src\":\"https://services.ddadaal.me/monitor/script.js\",\"id\":\"ZwSg9rf6GA\",\"async\":true,\"defer\":true}],[\"$\",\"$L15\",null,{\"resumeLangs\":[\"cn\",\"en\"]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"bg-base-200 text-base-content\",\"children\":[\"$\",\"div\",null,{\"className\":\"footer sm:footer-horizontal py-6 max-w-7xl mx-auto px-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-y-1\",\"children\":[[\"$\",\"p\",null,{\"children\":[\"👨🏼‍💻 \",[\"$\",\"$L16\",null,{\"id\":\"footer.codeBy\",\"args\":[[\"$\",\"$L17\",\"about/me\",{\"className\":\"link link-hover\",\"basePath\":\"/about/me\",\"children\":\"ddadaal\"}]]}]]}],[\"$\",\"p\",null,{\"children\":[\"📝\",[\"$\",\"$L16\",null,{\"id\":\"footer.license\",\"args\":[[\"$\",\"a\",\"license\",{\"rel\":\"licene noreferrer\",\"target\":\"_blank\",\"className\":\"link\",\"href\":\"https://creativecommons.org/licenses/by-sa/4.0/\",\"children\":\"CC BY-SA 4.0\"}]]}]]}],[\"$\",\"$L18\",null,{\"serverStartTime\":\"2025-08-07T16:08:23.892+00:00\"}],[\"$\",\"$L19\",null,{\"time\":\"2025-08-07T16:08:23.892+00:00\"}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"📲\",\" \",[\"$\",\"$L16\",null,{\"id\":\"footer.contacts\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex py-2 gap-2\",\"children\":[[\"$\",\"span\",\"http://wpa.qq.com/msgrd?v=3\u0026uin=540232834\u0026site=qq\u0026menu=yes\",{\"children\":[\"$\",\"a\",null,{\"href\":\"http://wpa.qq.com/msgrd?v=3\u0026uin=540232834\u0026site=qq\u0026menu=yes\",\"title\":\"QQ: 540232834\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 448 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z\",\"children\":[]}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"mailto://ddadaal.me@outlook.com\",{\"children\":[\"$\",\"a\",null,{\"href\":\"mailto://ddadaal.me@outlook.com\",\"title\":\"E-mail: ddadaal@outlook.com\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 576 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M160 448c-25.6 0-51.2-22.4-64-32-64-44.8-83.2-60.8-96-70.4V480c0 17.67 14.33 32 32 32h256c17.67 0 32-14.33 32-32V345.6c-12.8 9.6-32 25.6-96 70.4-12.8 9.6-38.4 32-64 32zm128-192H32c-17.67 0-32 14.33-32 32v16c25.6 19.2 22.4 19.2 115.2 86.4 9.6 6.4 28.8 25.6 44.8 25.6s35.2-19.2 44.8-22.4c92.8-67.2 89.6-67.2 115.2-86.4V288c0-17.67-14.33-32-32-32zm256-96H224c-17.67 0-32 14.33-32 32v32h96c33.21 0 60.59 25.42 63.71 57.82l.29-.22V416h192c17.67 0 32-14.33 32-32V192c0-17.67-14.33-32-32-32zm-32 128h-64v-64h64v64zm-352-96c0-35.29 28.71-64 64-64h224V32c0-17.67-14.33-32-32-32H96C78.33 0 64 14.33 64 32v192h96v-32z\",\"children\":[]}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://www.linkedin.com/in/chenjunda/\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/chenjunda/\",\"title\":\"LinkedIn: 陈俊达\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 448 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z\",\"children\":[]}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://github.com/ddadaal\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/ddadaal\",\"title\":\"GitHub: ddadaal\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 496 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$1a\",\"children\":[]}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://steamcommunity.com/profiles/76561198104889782\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://steamcommunity.com/profiles/76561198104889782\",\"title\":\"Steam: Victor Crubs\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 496 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M496 256c0 137-111.2 248-248.4 248-113.8 0-209.6-76.3-239-180.4l95.2 39.3c6.4 32.1 34.9 56.4 68.9 56.4 39.2 0 71.9-32.4 70.2-73.5l84.5-60.2c52.1 1.3 95.8-40.9 95.8-93.5 0-51.6-42-93.5-93.7-93.5s-93.7 42-93.7 93.5v1.2L176.6 279c-15.5-.9-30.7 3.4-43.5 12.1L0 236.1C10.2 108.4 117.1 8 247.6 8 384.8 8 496 119 496 256zM155.7 384.3l-30.5-12.6a52.79 52.79 0 0 0 27.2 25.8c26.9 11.2 57.8-1.6 69-28.4 5.4-13 5.5-27.3.1-40.3-5.4-13-15.5-23.2-28.5-28.6-12.9-5.4-26.7-5.2-38.9-.6l31.5 13c19.8 8.2 29.2 30.9 20.9 50.7-8.3 19.9-31 29.2-50.8 21zm173.8-129.9c-34.4 0-62.4-28-62.4-62.3s28-62.3 62.4-62.3 62.4 28 62.4 62.3-27.9 62.3-62.4 62.3zm.1-15.6c25.9 0 46.9-21 46.9-46.8 0-25.9-21-46.8-46.9-46.8s-46.9 21-46.9 46.8c.1 25.8 21.1 46.8 46.9 46.8z\",\"children\":[]}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://zhihu.com/people/VicCrubs\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://zhihu.com/people/VicCrubs\",\"title\":\"知乎：陈俊达\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 640 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$1b\",\"children\":[]}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://www.douban.com/people/183064260/\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.douban.com/people/183064260/\",\"title\":\"豆瓣: ddadaal\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"role\":\"img\",\"viewBox\":\"0 0 24 24\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M.51 3.06h22.98V.755H.51V3.06Zm20.976 2.537v9.608h-2.137l-1.669 5.76H24v2.28H0v-2.28h6.32l-1.67-5.76H2.515V5.597h18.972Zm-5.066 9.608H7.58l1.67 5.76h5.501l1.67-5.76ZM18.367 7.9H5.634v5.025h12.733V7.9Z\",\"children\":[]}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}]]}]]}],[\"$\",\"p\",null,{\"className\":\"text-center\",\"children\":[\"©\",\" \",2025,\" \",\"|\",\" \",[\"$\",\"$L16\",null,{\"id\":\"footer.madeWithLove\"}]]}]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"footer-title\",\"children\":[\"🚀\",\" \",[\"$\",\"$L16\",null,{\"id\":\"footer.poweredBy\"}]]}],[[\"$\",\"a\",\"React\",{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://reactjs.org/\",\"rel\":\"noreferrer\",\"children\":\"React\"}],[\"$\",\"a\",\"Next.js\",{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://nextjs.org/\",\"rel\":\"noreferrer\",\"children\":\"Next.js\"}],[\"$\",\"a\",\"GitHub Pages\",{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://pages.github.com/\",\"rel\":\"noreferrer\",\"children\":\"GitHub Pages\"}],[\"$\",\"a\",\"TypeScript\",{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://www.typescriptlang.org/\",\"rel\":\"noreferrer\",\"children\":\"TypeScript\"}]]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"footer-title\",\"children\":[\"🎨\",\" \",[\"$\",\"$L16\",null,{\"id\":\"footer.themedWith\"}]]}],[[\"$\",\"a\",\"daisyui\",{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://daisyui.com/\",\"rel\":\"noreferrer\",\"children\":\"daisyui\"}],[\"$\",\"a\",\"tailwind\",{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://tailwindcss.com/\",\"rel\":\"noreferrer\",\"children\":\"tailwind\"}]]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"footer-title\",\"children\":[\"🎓\",\" \",[\"$\",\"$L16\",null,{\"id\":\"footer.contacts\"}]]}],[[\"$\",\"a\",\"idealclover - 翠翠酱的个人网站\",{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://idealclover.top\",\"rel\":\"noreferrer\",\"children\":\"idealclover - 翠翠酱的个人网站\"}],[\"$\",\"a\",\"Sephidator - Sephidator的个人博客\",{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://sephidator.xyz\",\"rel\":\"noreferrer\",\"children\":\"Sephidator - Sephidator的个人博客\"}],[\"$\",\"a\",\"iznauy - 个人博客\",{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://iznauy.github.io/\",\"rel\":\"noreferrer\",\"children\":\"iznauy - 个人博客\"}],[\"$\",\"a\",\"Aironoria - 陈俊宇的个人博客\",{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://aironoria.github.io\",\"rel\":\"noreferrer\",\"children\":\"Aironoria - 陈俊宇的个人博客\"}],[\"$\",\"a\",\"forewing - 个人主页\",{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://jbesu.com/\",\"rel\":\"noreferrer\",\"children\":\"forewing - 个人主页\"}],[\"$\",\"a\",\"Weiser - 个人主页\",{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://weiser.fun\",\"rel\":\"noreferrer\",\"children\":\"Weiser - 个人主页\"}]]]}]]}]}],[\"$\",\"$L1c\",null,{}]]}]\n"])</script><script>self.__next_f.push([1,"1d:I[1657,[\"458\",\"static/chunks/3f731c04-273ad2ee657c8337.js\",\"452\",\"static/chunks/c99dd624-c70eb7fd833cb238.js\",\"478\",\"static/chunks/b767c4c5-8c8b588264c8b54b.js\",\"786\",\"static/chunks/1b3e99d6-bd6014aeea18f102.js\",\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"798\",\"static/chunks/798-4c46c2b09214eda1.js\",\"63\",\"static/chunks/63-a077f07cff7971c5.js\",\"971\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-b83f93f581d95258.js\"],\"ArticleFrontmatter\"]\n20:I[807,[\"458\",\"static/chunks/3f731c04-273ad2ee657c8337.js\",\"452\",\"static/chunks/c99dd624-c70eb7fd833cb238.js\",\"478\",\"static/chunks/b767c4c5-8c8b588264c8b54b.js\",\"786\",\"static/chunks/1b3e99d6-bd6014aeea18f102.js\",\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"798\",\"static/chunks/798-4c46c2b09214eda1.js\",\"63\",\"static/chunks/63-a077f07cff7971c5.js\",\"971\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-b83f93f581d95258.js\"],\"RelatedArticles\"]\n21:I[5438,[\"458\",\"static/chunks/3f731c04-273ad2ee657c8337.js\",\"452\",\"static/chunks/c99dd624-c70eb7fd833cb238.js\",\"478\",\"static/chunks/b767c4c5-8c8b588264c8b54b.js\",\"786\",\"static/chunks/1b3e99d6-bd6014aeea18f102.js\",\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"798\",\"static/chunks/798-4c46c2b09214eda1.js\",\"63\",\"static/chunks/63-a077f07cff7971c5.js\",\"971\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-b83f93f581d95258.js\"],\"CommentPanelWithCurrentLanguage\"]\n1e:T3bb1,"])</script><script>self.__next_f.push([1,"\n# 问题发现\n\n最近在一个项目中，我遇到了一个使用Node.js编写的请求转发服务的性能瓶颈问题。这个服务的主要工作看似非常简单：获取用户的请求，将请求体(body)转发到后端的服务器，然后将服务器的响应原样返回给客户端。\n\n然而，在进行压力测试时，我们发现当并发请求达到约2000时，系统表现出了明显的性能问题：\n\n1. 大约6%的请求出现错误\n2. 服务器资源利用率极不平衡 - 只有一个CPU核心达到了100%利用率，而其他核心几乎处于闲置状态\n\n大家都说Node.js的IO性能并不算差。这个现象引发了我的思考： **是什么限制了Node.js在这种场景下的性能表现？** 一个看似简单的请求转发工作，为何无法充分利用多核资源？\n\n带着这些疑问，我决定对Node.js代理服务的基准性能进行一次深入研究。我想了解在没有任何特殊优化的情况下，一个标准的Express服务究竟能够处理多少并发请求。这将帮助我确定问题是否出在Node.js本身的并发处理能力上，并在之后遇到类似性能问题或技术选项的时候，对Node本身所能达到的极限能力有个心理预期。\n\n# 实验设计\n\n为了进行这项研究，我采取了以下步骤：\n\n1. 编写两个简单的项目：\n   - 一个模拟AI后端服务的Express服务器\n   - 一个标准的Express代理服务，负责转发请求到模拟的AI后端\n\n2. 使用wrk作为性能测试工具，这是一个常用的HTTP基准测试工具，能够产生大量并发连接来测试服务器性能\n\n3. 在相同硬件条件下，测试不同并发级别下的性能表现，包括：\n   - 请求成功率、超时率\n   - 响应时间\n   - 各个核心的CPU利用率\n\n# 实验实现\n\n## 模拟后端服务\n\n这个项目是一个简单的Express服务器，它接收POST请求，并返回一个模拟的AI响应。\n\n为了模拟真实响应，这个服务器返回结果前可能会延迟一段时间。我同样会测试延迟不同的时间会对代理服务的性能表现的影响。\n\n## 代理服务\n\n代理服务同样使用Express实现，它的核心功能是：\n1. 接收来自客户端的请求\n2. 提取请求中的payload\n3. 将payload转发到后端AI服务\n4. 等待后端响应\n5. 将后端响应传回给客户端\n\n这个服务保持了最小化的实现，没有添加额外的错误处理、负载均衡或缓存等优化措施，以便我能够测试Node.js的基准性能。\n\n# 测试结果与分析\n\n测试运行于WSL2，CPU为5900X 12C24T @ 4.5 Ghz，Node版本22.14.0。\n\n## 后端服务直接返回\n\n使用6个线程和不同的连接数，超时时间设置为5s，使用wrk对两个服务分别进行压力测试。其中，运行在`5001`端口的是模拟后端服务，`5000`是代理服务。\n\n| Server | Connections | Requests/sec | Avg Latency | Max Latency | Total Requests | Timeouts | Timeout % | Total Errors | Error % |\n|--------|-------------|--------------|-------------|-------------|----------------|----------|-----------|--------------|---------|\n| 5001 | 50 | 9776.19 | 6.03ms | 291.00ms | 97839 | 0 | 0.00% | 0 | 0.00% |\n| 5001 | 100 | 9294.12 | 12.84ms | 537.33ms | 93006 | 0 | 0.00% | 0 | 0.00% |\n| 5001 | 150 | 9322.45 | 31.57ms | 1.31s | 93276 | 0 | 0.00% | 0 | 0.00% |\n| 5001 | 200 | 8688.89 | 63.29ms | 2.14s | 86951 | 0 | 0.00% | 0 | 0.00% |\n| 5001 | 500 | 8769.33 | 163.54ms | 4.99s | 87741 | 121 | 0.14% | 121 | 0.14% |\n| 5001 | 1000 | 8200.58 | 98.60ms | 4.96s | 82284 | 67 | 0.08% | 67 | 0.08% |\n| 5001 | 2000 | 8808.86 | 102.43ms | 4.95s | 88480 | 54 | 0.06% | 54 | 0.06% |\n| 5001 | 5000 | 7769.21 | 248.05ms | 314.09ms | 78333 | 25 | 0.03% | 1134 | 1.45% |\n| 5001 | 10000 | 7531.77 | 453.61ms | 592.39ms | 76076 | 13 | 0.02% | 6176 | 8.12% |\n| 5001 | 20000 | 6601.98 | 414.19ms | 582.31ms | 66423 | 15 | 0.02% | 15917 | 23.96% |\n| 5000 | 50 | 2673.49 | 74.76ms | 2.34s | 26763 | 0 | 0.00% | 0 | 0.00% |\n| 5000 | 100 | 2884.08 | 40.05ms | 909.96ms | 28860 | 0 | 0.00% | 0 | 0.00% |\n| 5000 | 150 | 2729.84 | 94.20ms | 2.16s | 27322 | 0 | 0.00% | 0 | 0.00% |\n| 5000 | 200 | 2586.36 | 176.31ms | 3.61s | 25887 | 0 | 0.00% | 0 | 0.00% |\n| 5000 | 500 | 2375.25 | 192.97ms | 4.96s | 23767 | 70 | 0.29% | 70 | 0.29% |\n| 5000 | 1000 | 2454.10 | 139.51ms | 5.00s | 24629 | 90 | 0.37% | 90 | 0.37% |\n| 5000 | 2000 | 2449.30 | 326.00ms | 4.85s | 24597 | 33 | 0.13% | 33 | 0.13% |\n| 5000 | 5000 | 1786.15 | 326.11ms | 5.00s | 18038 | 476 | 2.64% | 1768 | 9.80% |\n| 5000 | 10000 | 2016.64 | 78.55ms | 3.78s | 20313 | 10 | 0.05% | 6306 | 31.04% |\n| 5000 | 20000 | 1398.34 | 3.40ms | 639.14ms | 14072 | 0 | 0.00% | 16275 | 115.66% |\n\n数据比较多，值得关注的结论如下：\n\n对于后端服务：\n\n- 200-500连接数开始已经出现了5s内无法完成的超时请求\n- 2000-5000连接数开始出现并非超时的错误，说明此时node本身已经无法接受更多请求\n- 连接数打到5000后，错误率开始指数上升\n\n对于代理服务：\n\n- 几乎所有指标都大幅差于后端服务，在50连接时请求数就已经只有后端服务的1/3\n- 2000连接数开始错误率即开始指数上升\n- 把平均延迟和后台服务的平均延迟作差，可以发现代理本身逻辑执行在1.5-2s附近\n\n## CPU使用\n\n在所有实验中，我还记录了CPU各个核心的使用率，下面是测试后端、2000个连接数时其中一秒的CPU使用率，可以看到，只有一个核心（2）很忙，其他核心没有被充分利用。其他所有数据都具有类似的情况。\n\n```\n10:51:38 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle\n10:51:39 AM  all    5.93    0.00    1.52    0.00    0.00    4.97    0.00    0.00    0.00   87.58\n10:51:39 AM    0    1.75    0.00    0.88    0.00    0.00   11.40    0.00    0.00    0.00   85.96\n10:51:39 AM    1    0.00    0.00    1.00    0.00    0.00    1.00    0.00    0.00    0.00   98.00\n10:51:39 AM    2   84.00    0.00    6.00    0.00    0.00    0.00    0.00    0.00    0.00   10.00\n10:51:39 AM    3    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00\n10:51:39 AM    4   11.00    0.00    3.00    0.00    0.00    0.00    0.00    0.00    0.00   86.00\n10:51:39 AM    5   18.18    0.00    3.03    0.00    0.00    0.00    0.00    0.00    0.00   78.79\n10:51:39 AM    6    1.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00   98.00\n10:51:39 AM    7    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00\n10:51:39 AM    8    4.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00   95.00\n10:51:39 AM    9    2.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   98.00\n10:51:39 AM   10    2.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   98.00\n10:51:39 AM   11    0.00    0.00    1.98    0.00    0.00    0.00    0.00    0.00    0.00   98.02\n10:51:39 AM   12    3.96    0.00    4.95    0.00    0.00    0.00    0.00    0.00    0.00   91.09\n10:51:39 AM   13    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00\n10:51:39 AM   14    4.50    0.00    3.60    0.00    0.00   10.81    0.00    0.00    0.00   81.08\n10:51:39 AM   15    0.00    0.00    0.00    0.00    0.00    2.04    0.00    0.00    0.00   97.96\n10:51:39 AM   16    2.65    0.00    0.88    0.00    0.00   15.93    0.00    0.00    0.00   80.53\n10:51:39 AM   17    0.92    0.00    1.83    0.00    0.00   12.84    0.00    0.00    0.00   84.40\n10:51:39 AM   18    2.44    0.00    4.07    0.00    0.00   19.51    0.00    0.00    0.00   73.98\n10:51:39 AM   19    0.00    0.00    2.75    0.00    0.00   13.76    0.00    0.00    0.00   83.49\n10:51:39 AM   20    4.63    0.00    0.00    0.00    0.00   11.11    0.00    0.00    0.00   84.26\n10:51:39 AM   21    2.73    0.00    0.00    0.00    0.00   11.82    0.00    0.00    0.00   85.45\n10:51:39 AM   22    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00\n10:51:39 AM   23    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00\n```\n\n## 较慢的后端服务、打日志的差别\n\n在上述实验中，后端服务收到请求就直接返回。但是实际上后端服务可能需要一定时间处理。打印日志也是Node服务常见的实践。这两个场景到底对资源消耗有多大呢？\n\n为了更直观地对比不同场景下的性能表现，多设计两个场景\n\n1. 后端等到500ms后才返回结果\n2. 后端、代理端每收到请求和响应就将请求和响应的URL打印出来（`console.log`）\n\n我整理了以下对比表格，重点关注平均延迟（Avg Latency）、超时率（Timeout %）和错误率（Error %）这三个关键指标：\n\n| 连接数 | 服务器 | 直接返回-延迟 | 延迟-延迟 | 输出日志-延迟 | 直接返回-超时率 | 延迟-超时率 | 输出日志-超时率 | 直接返回-错误率 | 延迟-错误率 | 输出日志-错误率 |\n|--------|--------|--------------|------------|--------------|----------------|------------|----------------|---------------|-------------|---------------|\n| 50     | 后端   | 6.03ms       | 503.92ms   | 9.17ms       | 0.00%          | 0.00%      | 0.00%          | 0.00%         | 0.00%       | 0.00%         |\n| 500    | 后端   | 163.54ms     | 506.11ms   | 132.43ms     | 0.14%          | 0.00%      | 0.13%          | 0.14%         | 0.00%       | 0.13%         |\n| 2000   | 后端   | 102.43ms     | 533.43ms   | 105.53ms     | 0.06%          | 0.00%      | 0.08%          | 0.06%         | 0.00%       | 0.15%         |\n| 5000   | 后端   | 248.05ms     | 529.92ms   | 358.23ms     | 0.03%          | 0.00%      | 0.05%          | 1.45%         | 7.73%       | 2.23%         |\n| 10000  | 后端   | 453.61ms     | 607.15ms   | 641.06ms     | 0.02%          | 0.00%      | 0.00%          | 8.12%         | 9.89%       | 12.64%        |\n| 20000  | 后端   | 414.19ms     | 610.10ms   | 375.80ms     | 0.02%          | 0.00%      | 0.00%          | 23.96%        | 30.43%      | 35.20%        |\n| 50     | 代理   | 74.76ms      | 519.05ms   | 54.27ms      | 0.00%          | 0.00%      | 0.00%          | 0.00%         | 0.00%       | 0.00%         |\n| 500    | 代理   | 192.97ms     | 717.28ms   | 208.93ms     | 0.29%          | 0.00%      | 0.29%          | 0.29%         | 0.00%       | 0.29%         |\n| 2000   | 代理   | 326.00ms     | 726.51ms   | 417.52ms     | 0.13%          | 2.03%      | 0.21%          | 0.13%         | 2.03%       | 0.21%         |\n| 5000   | 代理   | 326.11ms     | 892.77ms   | 434.87ms     | 2.64%          | 1.35%      | 2.87%          | 9.80%         | 13.92%      | 10.33%        |\n| 10000  | 代理   | 78.55ms      | 788.52ms   | 89.68ms      | 0.05%          | 2.90%      | 0.01%          | 31.04%        | 36.76%      | 36.39%        |\n| 20000  | 代理   | 3.40ms       | 777.70ms   | 94.90ms      | 0.00%          | 0.00%      | 0.00%          | 115.66%       | 232.21%     | 107.78%       |\n\n从这个对比表格中，我们可以得出几个重要观察：\n\n1. **延迟500ms的影响**：当后端服务增加500ms延迟后，整体延迟有增加，连接数越多，平均延迟增加越少，但是增加的延迟仍然会使得错误率增加\n\n2. **超时情况分析**：在大多数连接数下，超时率都相对较低；但在代理服务的中等连接数(2000-5000)场景下，超时率明显上升，特别是在延迟返回的测试中，显示出代理服务在处理较长延迟请求时的瓶颈\n\n3. **日志输出的影响**：与直接返回相比，增加日志输出确实会增加延迟，但影响不是特别显著。在低并发情况下（50-500连接），日志对后端服务的影响较小；但在高并发时（10000+连接），日志输出会明显增加系统负担\n\n4. **错误率增长点**：无论哪种场景，代理服务的错误率普遍高于后端服务，且在5000连接数左右开始出现明显的错误率上升\n\n5. **极端高并发下的异常**：在20000连接的极端情况下，所有配置都表现出较高的错误率，但代理服务的延迟反而下降，这可能是因为大量请求被直接拒绝，导致成功请求的平均延迟降低\n\n# Go\n\n为了对比，我又准备了用Go使用标准库`net/http`编写的相同功能的两个程序，并在后端500ms延迟、不打log的情况下，测出go的成绩如下（未列出的连接数并未发生错误）：\n\n| Server | Connections | Requests/sec | Avg Latency | Max Latency | Total Requests | Timeouts | Timeout % | Total Errors | Error % |\n|--------|-------------|--------------|-------------|-------------|----------------|----------|-----------|--------------|---------|\n| 5001 | 5000 | 7310.92 | 501.39ms | 516.91ms | 73728 | 0 | 0.00% | 902 | 1.22% |\n| 5001 | 10000 | 7060.75 | 501.72ms | 517.20ms | 71154 | 0 | 0.00% | 5900 | 8.29% |\n| 5001 | 20000 | 6493.01 | 501.33ms | 512.36ms | 65536 | 0 | 0.00% | 15902 | 24.26% |\n| 5000 | 5000 | 5910.59 | 636.54ms | 3.46s | 59611 | 0 | 0.00% | 903 | 1.51% |\n| 5000 | 10000 | 5441.54 | 657.59ms | 1.25s | 54953 | 0 | 0.00% | 5900 | 10.74% |\n| 5000 | 20000 | 4857.47 | 663.12ms | 2.11s | 48912 | 0 | 0.00% | 15902 | 32.51% |\n\n二者的差距还是在预期的，go从来没有发生过超时，整体延迟、错误率数据也比node好很多。如在5000个连接下，代理程序出现1.51%的错误，node版本出现9.08%的错误，差距在6倍左右。但是需要注意的是，go可以利用全部CPU核心，而node的js线程只能利用一个核心，如果启动多个node并进行负载均衡，最终结果不一定有很大的差别。\n\n# 结论\n\n通过这些简单数据，我们发现\n\n- Node本身的单线程模型无法利用所有CPU的能力，即使在纯网络IO任务中也可能成为性能瓶颈\n- 在这次实验中，express在**2000**连接数是个门槛，在此之上，超时率、错误率会迅速增加\n  - 并且，我的测试机器是消费级CPU，而一般服务器CPU并不能达到如此的单核性能，所以在生产环境中的性能表现会更差\n\n要想解决这个问题，在代码中做出一定的优化，例如减少日志打印、简化Node中的逻辑等，也会有一定的效果。如果优化代码的效果不佳，唯一的办法是运行多个node进程，可以考虑的方法主要是启动多个node服务并增加负载均衡，或者使用node cluster让node可以启动多个worker process。\n\n本实验中的代码和结果均在 https://github.com/ddadaal/node-express-concurrency-baseline-test 中可用。\n\n# Acknowledgements\n\n整个测试项目、测试脚本甚至本篇文章基本都是直接使用Copilot + Claude 3.7 Sonnet模型生成的，不得不说，让AI生成大框架、自己再来完善细节的做法确实能提高不少效率。这种实验的大多数工作实际上是框架代码，代码本身逻辑简单，但是需要使用大量API、编写繁琐的测试逻辑、数据分析以及做表，手写非常耗费精力，让AI来做这些繁琐的工作实在是再合适不过了。写文章也可以让AI帮忙做，我之前写篇文章至少需要花一整天，这一次居然一个上午就搞定了。\n\n哦，上面这一句话不是AI写的😀\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"bg-neutral px-4 py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto min-h-[256px] flex justify-center text-center text-neutral-content\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col justify-center animate-slide-up\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl my-2\",\"children\":\"Node是并发性能的绊脚石吗？测试Express服务器的基准并发能力\"}],[\"$\",\"$L1d\",null,{\"className\":\"justify-center\",\"articleId\":\"node-express-concurrency-baseline\",\"info\":{\"content\":\"$1e\",\"title\":\"Node是并发性能的绊脚石吗？测试Express服务器的基准并发能力\",\"date\":\"2025-03-08 08:47\",\"id\":\"node-express-concurrency-baseline\",\"lang\":\"cn\",\"tags\":[\"web\",\"project\",\"node.js\",\"performance\",\"concurrency\"],\"related\":\"$undefined\",\"ignored_in_list\":\"$undefined\",\"hide_heading\":\"$undefined\",\"no_toc\":\"$undefined\",\"absolute_path\":\"$undefined\",\"last_updated\":\"$undefined\",\"wordCount\":3565,\"readingTime\":17.825,\"filePath\":\"contents/20250308-node-express-concurrency-baseline/cn.md\",\"summary\":{\"articleId\":\"node-express-concurrency-baseline\",\"lang\":\"cn\",\"hash\":\"00ac3911168de9709867b3afc5496b3ec2da2ade496a8934b6d075e970d9868f\",\"summaries\":[{\"summaries\":[\"作者在Node.js请求转发服务中发现高并发时出现性能瓶颈，6%请求出错且CPU单核满载。通过压力测试发现Express代理服务在2000并发时错误率上升，主因Node.js单线程模型无法利用多核资源。对比测试显示Go语言利用多核优势，错误率显著低于Node.js。解决方案建议优化代码逻辑、减少日志输出或采用多进程负载均衡。实验表明Node.js纯网络IO场景下单核性能受限，生产环境需考虑横向扩展或改用多线程语言。\"],\"metadata\":{\"summarizer\":\"azure-ai\",\"model\":\"deepseek-r1\"},\"endTime\":\"2025-03-08T08:38:51.053Z\",\"startTime\":\"2025-03-08T08:38:34.091Z\"},{\"summaries\":[\"这篇文章详细讨论了 Node.js 和 Express 在高并发场景下的性能表现，并通过与 Go 的对比展示了 Node.js 的潜在瓶颈。以下是文章的主要内容和结论：\\n\\n### 主要内容\\n\\n1. **测试背景**：\\n   - 作者进行了一个高并发测试，使用 Node.js 和 Express 构建一个简单的 HTTP 服务器，并在后端引入 500ms 延迟模拟。测试目的是评估 Node.js 在不同连接数下的性能表现。\\n   \\n2. **测试结果**：\\n   - **Node.js 的表现**：\\n     - 在 2000 个连接时，超时率和错误率开始显著增加。\\n     - 随着连接数的增加（如 5000 和 10000），超时率和错误率进一步升高，达到了 9.08% 左右的错误率。\\n   - **Go 的表现**：\\n     - Go 使用标准库 `net/http` 实现的服务器，在同样的测试条件下表现优于 Node.js。例如，在 5000 个连接时，Node.js 的错误率约为 1.51%，而 Go 的错误率更低。\\n   \\n3. **性能分析**：\\n   - Node.js 由于其单线程模型，无法充分利用 CPU 资源，这在高并发场景下表现出明显的性能瓶颈。\\n   - Express 在 2000 个连接以上时，超时率和错误率急剧增加，这可能与其单线程处理机制有关。\\n\\n4. **结论**：\\n   - Node.js 在高并发下的性能不如 Go 好，这主要归因于 Node.js 的单线程模型。\\n   - 如果需要在生产环境中实现更好的性能，可以考虑使用多个 Node.js 进程（如 `node cluster`）来分担负载，或者完全转向其他语言如 Go。\\n\\n### 总结\\n\\n这篇文章提出了一个重要的问题：Node.js 在高并发场景下的性能表现可能不如其他语言（如 Go），这在设计和优化网络应用时需要特别注意。对于希望构建高并发系统的开发者，了解这些性能差异是至关重要的。\\n\\n如果你对 Node.js 的性能瓶颈感兴趣，或者想了解如何优化你的 Node.js 应用，可以继续阅读相关的技术文档或文章。同时，对于需要处理大量连接的场景，Go 可能是一个更好的选择。\"],\"metadata\":{\"summarizer\":\"ollama\",\"model\":\"deepseek-r1:8b\"},\"endTime\":\"2025-03-08T08:40:00.694Z\",\"startTime\":\"2025-03-08T08:38:51.055Z\"},{\"summaries\":[\"# Conclusion\\n* Node is single-threaded, so it may become performance bottleneck for large amount of connections even with pure network I/O tasks.\\n* Express is a good framework but at 2000 connections becomes unstable. It will increase timeouts and errors rapidly if you have more than that connections on express.\\n* The above conclusion is that with node you should consider using multiple workers, like the cluster, this will help performance issue with high number of connections.\"],\"metadata\":{\"summarizer\":\"ollama\",\"model\":\"llamafamily/llama3-chinese-8b-instruct\"},\"endTime\":\"2025-03-08T08:40:08.458Z\",\"startTime\":\"2025-03-08T08:38:51.055Z\"}]}},\"langVersions\":[\"cn\"]}]]}]}]}],[\"$\",\"div\",null,{\"className\":\"animate-slide-up\",\"children\":[[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto p-4\",\"children\":\"$L1f\"}],[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto p-4\",\"children\":[\"$\",\"$L20\",null,{\"relatedArticles\":[]}]}],[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto p-4\",\"children\":[\"$\",\"$L21\",null,{\"articleId\":\"node-express-concurrency-baseline\",\"articleTitle\":\"Node是并发性能的绊脚石吗？测试Express服务器的基准并发能力\"}]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"22:I[4867,[\"458\",\"static/chunks/3f731c04-273ad2ee657c8337.js\",\"452\",\"static/chunks/c99dd624-c70eb7fd833cb238.js\",\"478\",\"static/chunks/b767c4c5-8c8b588264c8b54b.js\",\"786\",\"static/chunks/1b3e99d6-bd6014aeea18f102.js\",\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"798\",\"static/chunks/798-4c46c2b09214eda1.js\",\"63\",\"static/chunks/63-a077f07cff7971c5.js\",\"971\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-b83f93f581d95258.js\"],\"ArticleSummarization\"]\n23:I[4533,[\"458\",\"static/chunks/3f731c04-273ad2ee657c8337.js\",\"452\",\"static/chunks/c99dd624-c70eb7fd833cb238.js\",\"478\",\"static/chunks/b767c4c5-8c8b588264c8b54b.js\",\"786\",\"static/chunks/1b3e99d6-bd6014aeea18f102.js\",\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"798\",\"static/chunks/798-4c46c2b09214eda1.js\",\"63\",\"static/chunks/63-a077f07cff7971c5.js\",\"971\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-b83f93f581d95258.js\"],\"Gallery\"]\n31:I[7745,[\"458\",\"static/chunks/3f731c04-273ad2ee657c8337.js\",\"452\",\"static/chunks/c99dd624-c70eb7fd833cb238.js\",\"478\",\"static/chunks/b767c4c5-8c8b588264c8b54b.js\",\"786\",\"static/chunks/1b3e99d6-bd6014aeea18f102.js\",\"234\",\"static/chunks/234-c6103b572ad887ac.js\",\"762\",\"static/chunks/762-aa64ad1bdd524123.js\",\"207\",\"static/chunks/207-36fddfdfb38db117.js\",\"798\",\"static/chunks/798-4c46c2b09214eda1.js\",\"63\",\"static/chunks/63-a077f07cff7971c5.js\",\"971\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-b83f93f581d95258.js\"],\"ArticleToc\"]\n24:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 "])</script><script>self.__next_f.push([1,"0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z25:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c"])</script><script>self.__next_f.push([1,"59.271-59.259 59.271-155.699.001-214.959z26:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z27:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59"])</script><script>self.__next_f.push([1,"a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z28:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z29:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13"])</script><script>self.__next_f.push([1,".087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z2a:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13."])</script><script>self.__next_f.push([1,"087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z2b:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z2c:T9da,"])</script><script>self.__next_f.push([1,"10:51:38 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle\n10:51:39 AM  all    5.93    0.00    1.52    0.00    0.00    4.97    0.00    0.00    0.00   87.58\n10:51:39 AM    0    1.75    0.00    0.88    0.00    0.00   11.40    0.00    0.00    0.00   85.96\n10:51:39 AM    1    0.00    0.00    1.00    0.00    0.00    1.00    0.00    0.00    0.00   98.00\n10:51:39 AM    2   84.00    0.00    6.00    0.00    0.00    0.00    0.00    0.00    0.00   10.00\n10:51:39 AM    3    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00\n10:51:39 AM    4   11.00    0.00    3.00    0.00    0.00    0.00    0.00    0.00    0.00   86.00\n10:51:39 AM    5   18.18    0.00    3.03    0.00    0.00    0.00    0.00    0.00    0.00   78.79\n10:51:39 AM    6    1.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00   98.00\n10:51:39 AM    7    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00\n10:51:39 AM    8    4.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00   95.00\n10:51:39 AM    9    2.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   98.00\n10:51:39 AM   10    2.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   98.00\n10:51:39 AM   11    0.00    0.00    1.98    0.00    0.00    0.00    0.00    0.00    0.00   98.02\n10:51:39 AM   12    3.96    0.00    4.95    0.00    0.00    0.00    0.00    0.00    0.00   91.09\n10:51:39 AM   13    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00\n10:51:39 AM   14    4.50    0.00    3.60    0.00    0.00   10.81    0.00    0.00    0.00   81.08\n10:51:39 AM   15    0.00    0.00    0.00    0.00    0.00    2.04    0.00    0.00    0.00   97.96\n10:51:39 AM   16    2.65    0.00    0.88    0.00    0.00   15.93    0.00    0.00    0.00   80.53\n10:51:39 AM   17    0.92    0.00    1.83    0.00    0.00   12.84    0.00    0.00    0.00   84.40\n10:51:39 AM   18    2.44    0.00    4.07    0.00    0.00   19.51    0.00    0.00    0.00   73.98\n10:51:39 AM   19    0.00    0.00    2.75    0.00    0.00   13.76    0.00    0.00    0.00   83.49\n10:51:39 AM   20    4.63    0.00    0.00    0.00    0.00   11.11    0.00    0.00    0.00   84.26\n10:51:39 AM   21    2.73    0.00    0.00    0.00    0.00   11.82    0.00    0.00    0.00   85.45\n10:51:39 AM   22    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00\n10:51:39 AM   23    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00\n"])</script><script>self.__next_f.push([1,"2d:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z2e:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.40"])</script><script>self.__next_f.push([1,"2 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z2f:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z30:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1"])</script><script>self.__next_f.push([1,".155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"1f:[\"$\",\"div\",null,{\"className\":\"flex flex-row space-x-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"prose max-w-full lg:w-[75%]\",\"children\":[[\"$\",\"$L22\",null,{\"summaries\":[{\"metadata\":\"$5:props:children:0:props:children:props:children:props:children:1:props:info:summary:summaries:0:metadata\",\"children\":[[\"$\",\"p\",\"p-0\",{\"children\":\"作者在Node.js请求转发服务中发现高并发时出现性能瓶颈，6%请求出错且CPU单核满载。通过压力测试发现Express代理服务在2000并发时错误率上升，主因Node.js单线程模型无法利用多核资源。对比测试显示Go语言利用多核优势，错误率显著低于Node.js。解决方案建议优化代码逻辑、减少日志输出或采用多进程负载均衡。实验表明Node.js纯网络IO场景下单核性能受限，生产环境需考虑横向扩展或改用多线程语言。\"}]]},{\"metadata\":\"$5:props:children:0:props:children:props:children:props:children:1:props:info:summary:summaries:1:metadata\",\"children\":[[\"$\",\"p\",\"p-0\",{\"children\":\"这篇文章详细讨论了 Node.js 和 Express 在高并发场景下的性能表现，并通过与 Go 的对比展示了 Node.js 的潜在瓶颈。以下是文章的主要内容和结论：\"}],\"\\n\",[\"$\",\"h3\",\"h3-0\",{\"children\":\"主要内容\"}],\"\\n\",[\"$\",\"ol\",\"ol-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"测试背景\"}],\"：\"]}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"作者进行了一个高并发测试，使用 Node.js 和 Express 构建一个简单的 HTTP 服务器，并在后端引入 500ms 延迟模拟。测试目的是评估 Node.js 在不同连接数下的性能表现。\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"测试结果\"}],\"：\"]}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"Node.js 的表现\"}],\"：\",\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"在 2000 个连接时，超时率和错误率开始显著增加。\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"随着连接数的增加（如 5000 和 10000），超时率和错误率进一步升高，达到了 9.08% 左右的错误率。\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"Go 的表现\"}],\"：\",\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"Go 使用标准库 \",[\"$\",\"code\",\"code-0\",{\"children\":\"net/http\"}],\" 实现的服务器，在同样的测试条件下表现优于 Node.js。例如，在 5000 个连接时，Node.js 的错误率约为 1.51%，而 Go 的错误率更低。\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"性能分析\"}],\"：\"]}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"Node.js 由于其单线程模型，无法充分利用 CPU 资源，这在高并发场景下表现出明显的性能瓶颈。\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"Express 在 2000 个连接以上时，超时率和错误率急剧增加，这可能与其单线程处理机制有关。\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"li-3\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"结论\"}],\"：\"]}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"Node.js 在高并发下的性能不如 Go 好，这主要归因于 Node.js 的单线程模型。\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[\"如果需要在生产环境中实现更好的性能，可以考虑使用多个 Node.js 进程（如 \",[\"$\",\"code\",\"code-0\",{\"children\":\"node cluster\"}],\"）来分担负载，或者完全转向其他语言如 Go。\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",\"h3-1\",{\"children\":\"总结\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":\"这篇文章提出了一个重要的问题：Node.js 在高并发场景下的性能表现可能不如其他语言（如 Go），这在设计和优化网络应用时需要特别注意。对于希望构建高并发系统的开发者，了解这些性能差异是至关重要的。\"}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":\"如果你对 Node.js 的性能瓶颈感兴趣，或者想了解如何优化你的 Node.js 应用，可以继续阅读相关的技术文档或文章。同时，对于需要处理大量连接的场景，Go 可能是一个更好的选择。\"}]]},{\"metadata\":\"$5:props:children:0:props:children:props:children:props:children:1:props:info:summary:summaries:2:metadata\",\"children\":[[\"$\",\"h1\",\"h1-0\",{\"children\":\"Conclusion\"}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"Node is single-threaded, so it may become performance bottleneck for large amount of connections even with pure network I/O tasks.\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"Express is a good framework but at 2000 connections becomes unstable. It will increase timeouts and errors rapidly if you have more than that connections on express.\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"The above conclusion is that with node you should consider using multiple workers, like the cluster, this will help performance issue with high number of connections.\"}],\"\\n\"]}]]}]}],[\"$\",\"$L23\",null,{\"withCaption\":true,\"id\":\"node-express-concurrency-baseline\",\"children\":[[\"$\",\"h1\",\"h1-0\",{\"id\":\"问题发现\",\"children\":[[\"$\",\"a\",\"问题发现\",{\"href\":\"#问题发现\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$24\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"问题发现\"]}],\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"最近在一个项目中，我遇到了一个使用Node.js编写的请求转发服务的性能瓶颈问题。这个服务的主要工作看似非常简单：获取用户的请求，将请求体(body)转发到后端的服务器，然后将服务器的响应原样返回给客户端。\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":\"然而，在进行压力测试时，我们发现当并发请求达到约2000时，系统表现出了明显的性能问题：\"}],\"\\n\",[\"$\",\"ol\",\"ol-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"大约6%的请求出现错误\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"服务器资源利用率极不平衡 - 只有一个CPU核心达到了100%利用率，而其他核心几乎处于闲置状态\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":[\"大家都说Node.js的IO性能并不算差。这个现象引发了我的思考： \",[\"$\",\"strong\",\"strong-0\",{\"children\":\"是什么限制了Node.js在这种场景下的性能表现？\"}],\" 一个看似简单的请求转发工作，为何无法充分利用多核资源？\"]}],\"\\n\",[\"$\",\"p\",\"p-3\",{\"children\":\"带着这些疑问，我决定对Node.js代理服务的基准性能进行一次深入研究。我想了解在没有任何特殊优化的情况下，一个标准的Express服务究竟能够处理多少并发请求。这将帮助我确定问题是否出在Node.js本身的并发处理能力上，并在之后遇到类似性能问题或技术选项的时候，对Node本身所能达到的极限能力有个心理预期。\"}],\"\\n\",[\"$\",\"h1\",\"h1-1\",{\"id\":\"实验设计\",\"children\":[[\"$\",\"a\",\"实验设计\",{\"href\":\"#实验设计\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$25\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"实验设计\"]}],\"\\n\",[\"$\",\"p\",\"p-4\",{\"children\":\"为了进行这项研究，我采取了以下步骤：\"}],\"\\n\",[\"$\",\"ol\",\"ol-1\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"编写两个简单的项目：\"}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"一个模拟AI后端服务的Express服务器\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"一个标准的Express代理服务，负责转发请求到模拟的AI后端\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"使用wrk作为性能测试工具，这是一个常用的HTTP基准测试工具，能够产生大量并发连接来测试服务器性能\"}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"在相同硬件条件下，测试不同并发级别下的性能表现，包括：\"}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"请求成功率、超时率\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"响应时间\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"各个核心的CPU利用率\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",\"h1-2\",{\"id\":\"实验实现\",\"children\":[[\"$\",\"a\",\"实验实现\",{\"href\":\"#实验实现\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$26\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"实验实现\"]}],\"\\n\",[\"$\",\"h2\",\"h2-0\",{\"id\":\"模拟后端服务\",\"children\":[[\"$\",\"a\",\"模拟后端服务\",{\"href\":\"#模拟后端服务\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$27\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"模拟后端服务\"]}],\"\\n\",[\"$\",\"p\",\"p-5\",{\"children\":\"这个项目是一个简单的Express服务器，它接收POST请求，并返回一个模拟的AI响应。\"}],\"\\n\",[\"$\",\"p\",\"p-6\",{\"children\":\"为了模拟真实响应，这个服务器返回结果前可能会延迟一段时间。我同样会测试延迟不同的时间会对代理服务的性能表现的影响。\"}],\"\\n\",[\"$\",\"h2\",\"h2-1\",{\"id\":\"代理服务\",\"children\":[[\"$\",\"a\",\"代理服务\",{\"href\":\"#代理服务\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$28\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"代理服务\"]}],\"\\n\",[\"$\",\"p\",\"p-7\",{\"children\":\"代理服务同样使用Express实现，它的核心功能是：\"}],\"\\n\",[\"$\",\"ol\",\"ol-2\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"接收来自客户端的请求\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"提取请求中的payload\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"将payload转发到后端AI服务\"}],\"\\n\",[\"$\",\"li\",\"li-3\",{\"children\":\"等待后端响应\"}],\"\\n\",[\"$\",\"li\",\"li-4\",{\"children\":\"将后端响应传回给客户端\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-8\",{\"children\":\"这个服务保持了最小化的实现，没有添加额外的错误处理、负载均衡或缓存等优化措施，以便我能够测试Node.js的基准性能。\"}],\"\\n\",[\"$\",\"h1\",\"h1-3\",{\"id\":\"测试结果与分析\",\"children\":[[\"$\",\"a\",\"测试结果与分析\",{\"href\":\"#测试结果与分析\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$29\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"测试结果与分析\"]}],\"\\n\",[\"$\",\"p\",\"p-9\",{\"children\":\"测试运行于WSL2，CPU为5900X 12C24T @ 4.5 Ghz，Node版本22.14.0。\"}],\"\\n\",[\"$\",\"h2\",\"h2-2\",{\"id\":\"后端服务直接返回\",\"children\":[[\"$\",\"a\",\"后端服务直接返回\",{\"href\":\"#后端服务直接返回\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$2a\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"后端服务直接返回\"]}],\"\\n\",[\"$\",\"p\",\"p-10\",{\"children\":[\"使用6个线程和不同的连接数，超时时间设置为5s，使用wrk对两个服务分别进行压力测试。其中，运行在\",[\"$\",\"code\",\"code-0\",{\"children\":\"5001\"}],\"端口的是模拟后端服务，\",[\"$\",\"code\",\"code-1\",{\"children\":\"5000\"}],\"是代理服务。\"]}],\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\",[\"$\",\"table\",\"table-0\",{\"children\":[[\"$\",\"thead\",\"thead-0\",{\"children\":[\"$\",\"tr\",\"tr-0\",{\"children\":[[\"$\",\"th\",\"th-0\",{\"children\":\"Server\"}],[\"$\",\"th\",\"th-1\",{\"children\":\"Connections\"}],[\"$\",\"th\",\"th-2\",{\"children\":\"Requests/sec\"}],[\"$\",\"th\",\"th-3\",{\"children\":\"Avg Latency\"}],[\"$\",\"th\",\"th-4\",{\"children\":\"Max Latency\"}],[\"$\",\"th\",\"th-5\",{\"children\":\"Total Requests\"}],[\"$\",\"th\",\"th-6\",{\"children\":\"Timeouts\"}],[\"$\",\"th\",\"th-7\",{\"children\":\"Timeout %\"}],[\"$\",\"th\",\"th-8\",{\"children\":\"Total Errors\"}],[\"$\",\"th\",\"th-9\",{\"children\":\"Error %\"}]]}]}],[\"$\",\"tbody\",\"tbody-0\",{\"children\":[[\"$\",\"tr\",\"tr-0\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"50\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"9776.19\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"6.03ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"291.00ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"97839\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}]]}],[\"$\",\"tr\",\"tr-1\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"100\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"9294.12\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"12.84ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"537.33ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"93006\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}]]}],[\"$\",\"tr\",\"tr-2\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"150\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"9322.45\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"31.57ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"1.31s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"93276\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}]]}],[\"$\",\"tr\",\"tr-3\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"200\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"8688.89\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"63.29ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"2.14s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"86951\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}]]}],[\"$\",\"tr\",\"tr-4\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"500\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"8769.33\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"163.54ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"4.99s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"87741\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"121\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.14%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"121\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.14%\"}]]}],[\"$\",\"tr\",\"tr-5\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"1000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"8200.58\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"98.60ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"4.96s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"82284\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"67\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.08%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"67\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.08%\"}]]}],[\"$\",\"tr\",\"tr-6\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"2000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"8808.86\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"102.43ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"4.95s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"88480\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"54\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.06%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"54\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.06%\"}]]}],[\"$\",\"tr\",\"tr-7\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"7769.21\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"248.05ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"314.09ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"78333\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"25\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.03%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"1134\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"1.45%\"}]]}],[\"$\",\"tr\",\"tr-8\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"10000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"7531.77\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"453.61ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"592.39ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"76076\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"13\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.02%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"6176\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"8.12%\"}]]}],[\"$\",\"tr\",\"tr-9\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"20000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"6601.98\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"414.19ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"582.31ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"66423\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"15\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.02%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"15917\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"23.96%\"}]]}],[\"$\",\"tr\",\"tr-10\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"50\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"2673.49\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"74.76ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"2.34s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"26763\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}]]}],[\"$\",\"tr\",\"tr-11\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"100\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"2884.08\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"40.05ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"909.96ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"28860\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}]]}],[\"$\",\"tr\",\"tr-12\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"150\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"2729.84\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"94.20ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"2.16s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"27322\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}]]}],[\"$\",\"tr\",\"tr-13\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"200\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"2586.36\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"176.31ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"3.61s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"25887\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}]]}],[\"$\",\"tr\",\"tr-14\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"500\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"2375.25\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"192.97ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"4.96s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"23767\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"70\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.29%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"70\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.29%\"}]]}],[\"$\",\"tr\",\"tr-15\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"1000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"2454.10\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"139.51ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"5.00s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"24629\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"90\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.37%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"90\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.37%\"}]]}],[\"$\",\"tr\",\"tr-16\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"2000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"2449.30\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"326.00ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"4.85s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"24597\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"33\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.13%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"33\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.13%\"}]]}],[\"$\",\"tr\",\"tr-17\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"1786.15\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"326.11ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"5.00s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"18038\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"476\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"2.64%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"1768\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"9.80%\"}]]}],[\"$\",\"tr\",\"tr-18\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"10000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"2016.64\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"78.55ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"3.78s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"20313\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"10\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.05%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"6306\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"31.04%\"}]]}],[\"$\",\"tr\",\"tr-19\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"20000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"1398.34\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"3.40ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"639.14ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"14072\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"16275\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"115.66%\"}]]}]]}]]}],\"\\n\",[\"$\",\"p\",\"p-11\",{\"children\":\"数据比较多，值得关注的结论如下：\"}],\"\\n\",[\"$\",\"p\",\"p-12\",{\"children\":\"对于后端服务：\"}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"200-500连接数开始已经出现了5s内无法完成的超时请求\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"2000-5000连接数开始出现并非超时的错误，说明此时node本身已经无法接受更多请求\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"连接数打到5000后，错误率开始指数上升\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-13\",{\"children\":\"对于代理服务：\"}],\"\\n\",[\"$\",\"ul\",\"ul-1\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"几乎所有指标都大幅差于后端服务，在50连接时请求数就已经只有后端服务的1/3\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"2000连接数开始错误率即开始指数上升\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"把平均延迟和后台服务的平均延迟作差，可以发现代理本身逻辑执行在1.5-2s附近\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",\"h2-3\",{\"id\":\"cpu使用\",\"children\":[[\"$\",\"a\",\"cpu使用\",{\"href\":\"#cpu使用\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$2b\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"CPU使用\"]}],\"\\n\",[\"$\",\"p\",\"p-14\",{\"children\":\"在所有实验中，我还记录了CPU各个核心的使用率，下面是测试后端、2000个连接数时其中一秒的CPU使用率，可以看到，只有一个核心（2）很忙，其他核心没有被充分利用。其他所有数据都具有类似的情况。\"}],\"\\n\",[\"$\",\"pre\",\"pre-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"$2c\"}]}],\"\\n\",[\"$\",\"h2\",\"h2-4\",{\"id\":\"较慢的后端服务打日志的差别\",\"children\":[[\"$\",\"a\",\"较慢的后端服务打日志的差别\",{\"href\":\"#较慢的后端服务打日志的差别\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$2d\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"较慢的后端服务、打日志的差别\"]}],\"\\n\",[\"$\",\"p\",\"p-15\",{\"children\":\"在上述实验中，后端服务收到请求就直接返回。但是实际上后端服务可能需要一定时间处理。打印日志也是Node服务常见的实践。这两个场景到底对资源消耗有多大呢？\"}],\"\\n\",[\"$\",\"p\",\"p-16\",{\"children\":\"为了更直观地对比不同场景下的性能表现，多设计两个场景\"}],\"\\n\",[\"$\",\"ol\",\"ol-3\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"后端等到500ms后才返回结果\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[\"后端、代理端每收到请求和响应就将请求和响应的URL打印出来（\",[\"$\",\"code\",\"code-0\",{\"children\":\"console.log\"}],\"）\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-17\",{\"children\":\"我整理了以下对比表格，重点关注平均延迟（Avg Latency）、超时率（Timeout %）和错误率（Error %）这三个关键指标：\"}],\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\",[\"$\",\"table\",\"table-1\",{\"children\":[[\"$\",\"thead\",\"thead-0\",{\"children\":[\"$\",\"tr\",\"tr-0\",{\"children\":[[\"$\",\"th\",\"th-0\",{\"children\":\"连接数\"}],[\"$\",\"th\",\"th-1\",{\"children\":\"服务器\"}],[\"$\",\"th\",\"th-2\",{\"children\":\"直接返回-延迟\"}],[\"$\",\"th\",\"th-3\",{\"children\":\"延迟-延迟\"}],[\"$\",\"th\",\"th-4\",{\"children\":\"输出日志-延迟\"}],[\"$\",\"th\",\"th-5\",{\"children\":\"直接返回-超时率\"}],[\"$\",\"th\",\"th-6\",{\"children\":\"延迟-超时率\"}],[\"$\",\"th\",\"th-7\",{\"children\":\"输出日志-超时率\"}],[\"$\",\"th\",\"th-8\",{\"children\":\"直接返回-错误率\"}],[\"$\",\"th\",\"th-9\",{\"children\":\"延迟-错误率\"}],[\"$\",\"th\",\"th-10\",{\"children\":\"输出日志-错误率\"}]]}]}],[\"$\",\"tbody\",\"tbody-0\",{\"children\":[[\"$\",\"tr\",\"tr-0\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"50\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"后端\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"6.03ms\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"503.92ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"9.17ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-10\",{\"children\":\"0.00%\"}]]}],[\"$\",\"tr\",\"tr-1\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"500\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"后端\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"163.54ms\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"506.11ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"132.43ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"0.14%\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.13%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0.14%\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-10\",{\"children\":\"0.13%\"}]]}],[\"$\",\"tr\",\"tr-2\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"2000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"后端\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"102.43ms\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"533.43ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"105.53ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"0.06%\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.08%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0.06%\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-10\",{\"children\":\"0.15%\"}]]}],[\"$\",\"tr\",\"tr-3\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"后端\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"248.05ms\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"529.92ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"358.23ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"0.03%\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.05%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"1.45%\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"7.73%\"}],[\"$\",\"td\",\"td-10\",{\"children\":\"2.23%\"}]]}],[\"$\",\"tr\",\"tr-4\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"10000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"后端\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"453.61ms\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"607.15ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"641.06ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"0.02%\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"8.12%\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"9.89%\"}],[\"$\",\"td\",\"td-10\",{\"children\":\"12.64%\"}]]}],[\"$\",\"tr\",\"tr-5\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"20000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"后端\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"414.19ms\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"610.10ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"375.80ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"0.02%\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"23.96%\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"30.43%\"}],[\"$\",\"td\",\"td-10\",{\"children\":\"35.20%\"}]]}],[\"$\",\"tr\",\"tr-6\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"50\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"代理\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"74.76ms\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"519.05ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"54.27ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-10\",{\"children\":\"0.00%\"}]]}],[\"$\",\"tr\",\"tr-7\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"500\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"代理\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"192.97ms\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"717.28ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"208.93ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"0.29%\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.29%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0.29%\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-10\",{\"children\":\"0.29%\"}]]}],[\"$\",\"tr\",\"tr-8\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"2000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"代理\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"326.00ms\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"726.51ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"417.52ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"0.13%\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"2.03%\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.21%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"0.13%\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"2.03%\"}],[\"$\",\"td\",\"td-10\",{\"children\":\"0.21%\"}]]}],[\"$\",\"tr\",\"tr-9\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"代理\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"326.11ms\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"892.77ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"434.87ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"2.64%\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"1.35%\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"2.87%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"9.80%\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"13.92%\"}],[\"$\",\"td\",\"td-10\",{\"children\":\"10.33%\"}]]}],[\"$\",\"tr\",\"tr-10\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"10000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"代理\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"78.55ms\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"788.52ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"89.68ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"0.05%\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"2.90%\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.01%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"31.04%\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"36.76%\"}],[\"$\",\"td\",\"td-10\",{\"children\":\"36.39%\"}]]}],[\"$\",\"tr\",\"tr-11\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"20000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"代理\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"3.40ms\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"777.70ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"94.90ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"115.66%\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"232.21%\"}],[\"$\",\"td\",\"td-10\",{\"children\":\"107.78%\"}]]}]]}]]}],\"\\n\",[\"$\",\"p\",\"p-18\",{\"children\":\"从这个对比表格中，我们可以得出几个重要观察：\"}],\"\\n\",[\"$\",\"ol\",\"ol-4\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"延迟500ms的影响\"}],\"：当后端服务增加500ms延迟后，整体延迟有增加，连接数越多，平均延迟增加越少，但是增加的延迟仍然会使得错误率增加\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"超时情况分析\"}],\"：在大多数连接数下，超时率都相对较低；但在代理服务的中等连接数(2000-5000)场景下，超时率明显上升，特别是在延迟返回的测试中，显示出代理服务在处理较长延迟请求时的瓶颈\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"日志输出的影响\"}],\"：与直接返回相比，增加日志输出确实会增加延迟，但影响不是特别显著。在低并发情况下（50-500连接），日志对后端服务的影响较小；但在高并发时（10000+连接），日志输出会明显增加系统负担\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"li-3\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"错误率增长点\"}],\"：无论哪种场景，代理服务的错误率普遍高于后端服务，且在5000连接数左右开始出现明显的错误率上升\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"li-4\",{\"children\":[\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"极端高并发下的异常\"}],\"：在20000连接的极端情况下，所有配置都表现出较高的错误率，但代理服务的延迟反而下降，这可能是因为大量请求被直接拒绝，导致成功请求的平均延迟降低\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",\"h1-4\",{\"id\":\"go\",\"children\":[[\"$\",\"a\",\"go\",{\"href\":\"#go\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$2e\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"Go\"]}],\"\\n\",[\"$\",\"p\",\"p-19\",{\"children\":[\"为了对比，我又准备了用Go使用标准库\",[\"$\",\"code\",\"code-0\",{\"children\":\"net/http\"}],\"编写的相同功能的两个程序，并在后端500ms延迟、不打log的情况下，测出go的成绩如下（未列出的连接数并未发生错误）：\"]}],\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\",[\"$\",\"table\",\"table-2\",{\"children\":[[\"$\",\"thead\",\"thead-0\",{\"children\":[\"$\",\"tr\",\"tr-0\",{\"children\":[[\"$\",\"th\",\"th-0\",{\"children\":\"Server\"}],[\"$\",\"th\",\"th-1\",{\"children\":\"Connections\"}],[\"$\",\"th\",\"th-2\",{\"children\":\"Requests/sec\"}],[\"$\",\"th\",\"th-3\",{\"children\":\"Avg Latency\"}],[\"$\",\"th\",\"th-4\",{\"children\":\"Max Latency\"}],[\"$\",\"th\",\"th-5\",{\"children\":\"Total Requests\"}],[\"$\",\"th\",\"th-6\",{\"children\":\"Timeouts\"}],[\"$\",\"th\",\"th-7\",{\"children\":\"Timeout %\"}],[\"$\",\"th\",\"th-8\",{\"children\":\"Total Errors\"}],[\"$\",\"th\",\"th-9\",{\"children\":\"Error %\"}]]}]}],[\"$\",\"tbody\",\"tbody-0\",{\"children\":[[\"$\",\"tr\",\"tr-0\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"7310.92\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"501.39ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"516.91ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"73728\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"902\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"1.22%\"}]]}],[\"$\",\"tr\",\"tr-1\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"10000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"7060.75\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"501.72ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"517.20ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"71154\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"5900\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"8.29%\"}]]}],[\"$\",\"tr\",\"tr-2\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5001\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"20000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"6493.01\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"501.33ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"512.36ms\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"65536\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"15902\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"24.26%\"}]]}],[\"$\",\"tr\",\"tr-3\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"5910.59\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"636.54ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"3.46s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"59611\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"903\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"1.51%\"}]]}],[\"$\",\"tr\",\"tr-4\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"10000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"5441.54\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"657.59ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"1.25s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"54953\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"5900\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"10.74%\"}]]}],[\"$\",\"tr\",\"tr-5\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"5000\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"20000\"}],[\"$\",\"td\",\"td-2\",{\"children\":\"4857.47\"}],[\"$\",\"td\",\"td-3\",{\"children\":\"663.12ms\"}],[\"$\",\"td\",\"td-4\",{\"children\":\"2.11s\"}],[\"$\",\"td\",\"td-5\",{\"children\":\"48912\"}],[\"$\",\"td\",\"td-6\",{\"children\":\"0\"}],[\"$\",\"td\",\"td-7\",{\"children\":\"0.00%\"}],[\"$\",\"td\",\"td-8\",{\"children\":\"15902\"}],[\"$\",\"td\",\"td-9\",{\"children\":\"32.51%\"}]]}]]}]]}],\"\\n\",[\"$\",\"p\",\"p-20\",{\"children\":\"二者的差距还是在预期的，go从来没有发生过超时，整体延迟、错误率数据也比node好很多。如在5000个连接下，代理程序出现1.51%的错误，node版本出现9.08%的错误，差距在6倍左右。但是需要注意的是，go可以利用全部CPU核心，而node的js线程只能利用一个核心，如果启动多个node并进行负载均衡，最终结果不一定有很大的差别。\"}],\"\\n\",[\"$\",\"h1\",\"h1-5\",{\"id\":\"结论\",\"children\":[[\"$\",\"a\",\"结论\",{\"href\":\"#结论\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$2f\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"结论\"]}],\"\\n\",[\"$\",\"p\",\"p-21\",{\"children\":\"通过这些简单数据，我们发现\"}],\"\\n\",[\"$\",\"ul\",\"ul-2\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"Node本身的单线程模型无法利用所有CPU的能力，即使在纯网络IO任务中也可能成为性能瓶颈\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[\"在这次实验中，express在\",[\"$\",\"strong\",\"strong-0\",{\"children\":\"2000\"}],\"连接数是个门槛，在此之上，超时率、错误率会迅速增加\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"并且，我的测试机器是消费级CPU，而一般服务器CPU并不能达到如此的单核性能，所以在生产环境中的性能表现会更差\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-22\",{\"children\":\"要想解决这个问题，在代码中做出一定的优化，例如减少日志打印、简化Node中的逻辑等，也会有一定的效果。如果优化代码的效果不佳，唯一的办法是运行多个node进程，可以考虑的方法主要是启动多个node服务并增加负载均衡，或者使用node cluster让node可以启动多个worker process。\"}],\"\\n\",[\"$\",\"p\",\"p-23\",{\"children\":[\"本实验中的代码和结果均在 \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://github.com/ddadaal/node-express-concurrency-baseline-test\",\"children\":\"https://github.com/ddadaal/node-express-concurrency-baseline-test\"}],\" 中可用。\"]}],\"\\n\",[\"$\",\"h1\",\"h1-6\",{\"id\":\"acknowledgements\",\"children\":[[\"$\",\"a\",\"acknowledgements\",{\"href\":\"#acknowledgements\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$30\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"Acknowledgements\"]}],\"\\n\",[\"$\",\"p\",\"p-24\",{\"children\":\"整个测试项目、测试脚本甚至本篇文章基本都是直接使用Copilot + Claude 3.7 Sonnet模型生成的，不得不说，让AI生成大框架、自己再来完善细节的做法确实能提高不少效率。这种实验的大多数工作实际上是框架代码，代码本身逻辑简单，但是需要使用大量API、编写繁琐的测试逻辑、数据分析以及做表，手写非常耗费精力，让AI来做这些繁琐的工作实在是再合适不过了。写文章也可以让AI帮忙做，我之前写篇文章至少需要花一整天，这一次居然一个上午就搞定了。\"}],\"\\n\",[\"$\",\"p\",\"p-25\",{\"children\":\"哦，上面这一句话不是AI写的😀\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"hidden lg:block lg:w-[25%]\",\"children\":[\"$\",\"$L31\",null,{\"toc\":[{\"depth\":1,\"value\":\"问题发现\",\"id\":\"问题发现\"},{\"depth\":1,\"value\":\"实验设计\",\"id\":\"实验设计\"},{\"depth\":1,\"value\":\"实验实现\",\"id\":\"实验实现\",\"children\":[{\"depth\":2,\"value\":\"模拟后端服务\",\"id\":\"模拟后端服务\"},{\"depth\":2,\"value\":\"代理服务\",\"id\":\"代理服务\"}]},{\"depth\":1,\"value\":\"测试结果与分析\",\"id\":\"测试结果与分析\",\"children\":[{\"depth\":2,\"value\":\"后端服务直接返回\",\"id\":\"后端服务直接返回\"},{\"depth\":2,\"value\":\"CPU使用\",\"id\":\"cpu使用\"},{\"depth\":2,\"value\":\"较慢的后端服务、打日志的差别\",\"id\":\"较慢的后端服务打日志的差别\"}]},{\"depth\":1,\"value\":\"Go\",\"id\":\"go\"},{\"depth\":1,\"value\":\"结论\",\"id\":\"结论\"},{\"depth\":1,\"value\":\"Acknowledgements\",\"id\":\"acknowledgements\"}],\"hasSummary\":true}]}]]}]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"a:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Node是并发性能的绊脚石吗？测试Express服务器的基准并发能力 - ddadaal.me\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"ddadaal's personal website\"}],[\"$\",\"link\",\"2\",{\"rel\":\"manifest\",\"href\":\"/site.webmanifest\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/icon.svg?35be8e76be1c3618\",\"type\":\"image/svg+xml\",\"sizes\":\"any\"}],[\"$\",\"link\",\"5\",{\"rel\":\"apple-touch-icon\",\"href\":\"/apple-icon.png?5334a64f42000bb0\",\"type\":\"image/png\",\"sizes\":\"180x180\"}]],\"error\":null,\"digest\":\"$undefined\"}\n12:{\"metadata\":\"$a:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>