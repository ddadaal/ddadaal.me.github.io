1:"$Sreact.fragment"
3:I[6221,[],""]
4:I[5657,[],""]
6:I[8002,[],"OutletBoundary"]
8:I[8002,[],"MetadataBoundary"]
a:I[8002,[],"ViewportBoundary"]
c:I[4404,[],""]
:HL["/_next/static/css/ba0bc4b94db048c9.css","style"]
:HL["/_next/static/css/fe1e54f11bde7158.css","style"]
:HL["/_next/static/css/0e452e629ebb050b.css","style"]
:HL["/_next/static/css/550cc6711c036586.css","style"]
:HL["/_next/static/css/84af3e6cc7365e2a.css","style"]
0:{"P":null,"b":"HEee28mNRvYuS1mttpu5Q","p":"","c":["","articles","an-infinite-loop-caused-by-updating-a-Map-during-iteration","en"],"i":false,"f":[[["",{"children":["articles",{"children":[["params","an-infinite-loop-caused-by-updating-a-Map-during-iteration/en","oc"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/ba0bc4b94db048c9.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],"$L2"]}],{"children":["articles",["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","articles","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["params","an-infinite-loop-caused-by-updating-a-Map-during-iteration/en","oc"],["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","articles","children","$0:f:0:1:2:children:2:children:0","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L5",[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/fe1e54f11bde7158.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/0e452e629ebb050b.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","2",{"rel":"stylesheet","href":"/_next/static/css/550cc6711c036586.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","3",{"rel":"stylesheet","href":"/_next/static/css/84af3e6cc7365e2a.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$L6",null,{"children":"$L7"}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","2CjgsG0qjWJORbBakU8DP",{"children":[["$","$L8",null,{"children":"$L9"}],["$","$La",null,{"children":"$Lb"}],null]}]]}],false]],"m":"$undefined","G":["$c","$undefined"],"s":false,"S":true}
d:I[1574,["116","static/chunks/c556396d-49361b2e780d113c.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","325","static/chunks/325-924239ad7bda233c.js","177","static/chunks/app/layout-05c4faf2ec628c45.js"],"RootLayout"]
e:I[2061,["116","static/chunks/c556396d-49361b2e780d113c.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","325","static/chunks/325-924239ad7bda233c.js","177","static/chunks/app/layout-05c4faf2ec628c45.js"],""]
f:I[2725,["116","static/chunks/c556396d-49361b2e780d113c.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","325","static/chunks/325-924239ad7bda233c.js","177","static/chunks/app/layout-05c4faf2ec628c45.js"],"Header"]
10:I[7583,["116","static/chunks/c556396d-49361b2e780d113c.js","413","static/chunks/7a1bdfe6-8f7609c25899d936.js","994","static/chunks/c4aeae87-2a85323a0275cbf9.js","786","static/chunks/1b3e99d6-50521588821d44ca.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","826","static/chunks/826-c44bffd752ec02cd.js","971","static/chunks/app/articles/%5B%5B...params%5D%5D/page-8625a0107f5ea4bf.js"],"Localized"]
11:I[1453,["845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","974","static/chunks/app/page-6cd03741a79daf91.js"],"LocalizedArticleLink"]
12:I[8077,["116","static/chunks/c556396d-49361b2e780d113c.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","325","static/chunks/325-924239ad7bda233c.js","177","static/chunks/app/layout-05c4faf2ec628c45.js"],"RunningTime"]
13:I[665,["845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","974","static/chunks/app/page-6cd03741a79daf91.js"],"LastUpdateTime"]
16:I[7365,["116","static/chunks/c556396d-49361b2e780d113c.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","325","static/chunks/325-924239ad7bda233c.js","177","static/chunks/app/layout-05c4faf2ec628c45.js"],"ToTop"]
14:T518,M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z15:T5b8,M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z2:["$","$Ld",null,{"children":[["$","$Le",null,{"data-host":"https://services.ddadaal.me","data-dnt":"false","src":"https://services.ddadaal.me/monitor/script.js","id":"ZwSg9rf6GA","async":true,"defer":true}],["$","$Lf",null,{"resumeLangs":["cn","en"]}],["$","div",null,{"children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}]}],["$","footer",null,{"className":"bg-base-200 text-base-content","children":["$","div",null,{"className":"footer py-6 max-w-7xl mx-auto px-4","children":[["$","div",null,{"className":"space-y-1","children":[["$","p",null,{"children":["ðŸ‘¨ðŸ¼â€ðŸ’»Â ",["$","$L10",null,{"id":"footer.codeBy","args":[["$","$L11","about/me",{"className":"link link-hover","basePath":"/about/me","children":"ddadaal"}]]}]]}],["$","p",null,{"children":["ðŸ“",["$","$L10",null,{"id":"footer.license","args":[["$","a","license",{"rel":"licene noreferrer","target":"_blank","className":"link","href":"https://creativecommons.org/licenses/by-sa/4.0/","children":"CC BY-SA 4.0"}]]}]]}],["$","$L12",null,{"serverStartTime":"2025-02-15T02:55:26.352+00:00"}],["$","$L13",null,{"time":"2025-02-15T02:55:26.352+00:00"}],["$","div",null,{"children":[["$","p",null,{"children":["ðŸ“²"," ",["$","$L10",null,{"id":"footer.contacts"}]]}],["$","div",null,{"className":"flex py-2 gap-2","children":[["$","span","http://wpa.qq.com/msgrd?v=3&uin=540232834&site=qq&menu=yes",{"children":["$","a",null,{"href":"http://wpa.qq.com/msgrd?v=3&uin=540232834&site=qq&menu=yes","title":"QQ: 540232834","target":"_blank","className":"block transition hover:scale-125","rel":"noreferrer","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 448 512","children":["$undefined",[["$","path","0",{"d":"M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z","children":[]}]]],"className":"$undefined","style":{"color":"$undefined"},"height":22.400000000000002,"width":22.400000000000002,"xmlns":"http://www.w3.org/2000/svg"}]}]}],["$","span","mailto://ddadaal.me@outlook.com",{"children":["$","a",null,{"href":"mailto://ddadaal.me@outlook.com","title":"E-mail: ddadaal@outlook.com","target":"_blank","className":"block transition hover:scale-125","rel":"noreferrer","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 576 512","children":["$undefined",[["$","path","0",{"d":"M160 448c-25.6 0-51.2-22.4-64-32-64-44.8-83.2-60.8-96-70.4V480c0 17.67 14.33 32 32 32h256c17.67 0 32-14.33 32-32V345.6c-12.8 9.6-32 25.6-96 70.4-12.8 9.6-38.4 32-64 32zm128-192H32c-17.67 0-32 14.33-32 32v16c25.6 19.2 22.4 19.2 115.2 86.4 9.6 6.4 28.8 25.6 44.8 25.6s35.2-19.2 44.8-22.4c92.8-67.2 89.6-67.2 115.2-86.4V288c0-17.67-14.33-32-32-32zm256-96H224c-17.67 0-32 14.33-32 32v32h96c33.21 0 60.59 25.42 63.71 57.82l.29-.22V416h192c17.67 0 32-14.33 32-32V192c0-17.67-14.33-32-32-32zm-32 128h-64v-64h64v64zm-352-96c0-35.29 28.71-64 64-64h224V32c0-17.67-14.33-32-32-32H96C78.33 0 64 14.33 64 32v192h96v-32z","children":[]}]]],"className":"$undefined","style":{"color":"$undefined"},"height":22.400000000000002,"width":22.400000000000002,"xmlns":"http://www.w3.org/2000/svg"}]}]}],["$","span","https://www.linkedin.com/in/chenjunda/",{"children":["$","a",null,{"href":"https://www.linkedin.com/in/chenjunda/","title":"LinkedIn: é™ˆä¿Šè¾¾","target":"_blank","className":"block transition hover:scale-125","rel":"noreferrer","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 448 512","children":["$undefined",[["$","path","0",{"d":"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z","children":[]}]]],"className":"$undefined","style":{"color":"$undefined"},"height":22.400000000000002,"width":22.400000000000002,"xmlns":"http://www.w3.org/2000/svg"}]}]}],["$","span","https://github.com/ddadaal",{"children":["$","a",null,{"href":"https://github.com/ddadaal","title":"GitHub: ddadaal","target":"_blank","className":"block transition hover:scale-125","rel":"noreferrer","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 496 512","children":["$undefined",[["$","path","0",{"d":"$14","children":[]}]]],"className":"$undefined","style":{"color":"$undefined"},"height":22.400000000000002,"width":22.400000000000002,"xmlns":"http://www.w3.org/2000/svg"}]}]}],["$","span","https://steamcommunity.com/profiles/76561198104889782",{"children":["$","a",null,{"href":"https://steamcommunity.com/profiles/76561198104889782","title":"Steam: Victor Crubs","target":"_blank","className":"block transition hover:scale-125","rel":"noreferrer","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 496 512","children":["$undefined",[["$","path","0",{"d":"M496 256c0 137-111.2 248-248.4 248-113.8 0-209.6-76.3-239-180.4l95.2 39.3c6.4 32.1 34.9 56.4 68.9 56.4 39.2 0 71.9-32.4 70.2-73.5l84.5-60.2c52.1 1.3 95.8-40.9 95.8-93.5 0-51.6-42-93.5-93.7-93.5s-93.7 42-93.7 93.5v1.2L176.6 279c-15.5-.9-30.7 3.4-43.5 12.1L0 236.1C10.2 108.4 117.1 8 247.6 8 384.8 8 496 119 496 256zM155.7 384.3l-30.5-12.6a52.79 52.79 0 0 0 27.2 25.8c26.9 11.2 57.8-1.6 69-28.4 5.4-13 5.5-27.3.1-40.3-5.4-13-15.5-23.2-28.5-28.6-12.9-5.4-26.7-5.2-38.9-.6l31.5 13c19.8 8.2 29.2 30.9 20.9 50.7-8.3 19.9-31 29.2-50.8 21zm173.8-129.9c-34.4 0-62.4-28-62.4-62.3s28-62.3 62.4-62.3 62.4 28 62.4 62.3-27.9 62.3-62.4 62.3zm.1-15.6c25.9 0 46.9-21 46.9-46.8 0-25.9-21-46.8-46.9-46.8s-46.9 21-46.9 46.8c.1 25.8 21.1 46.8 46.9 46.8z","children":[]}]]],"className":"$undefined","style":{"color":"$undefined"},"height":22.400000000000002,"width":22.400000000000002,"xmlns":"http://www.w3.org/2000/svg"}]}]}],["$","span","https://zhihu.com/people/VicCrubs",{"children":["$","a",null,{"href":"https://zhihu.com/people/VicCrubs","title":"çŸ¥ä¹Žï¼šé™ˆä¿Šè¾¾","target":"_blank","className":"block transition hover:scale-125","rel":"noreferrer","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 640 512","children":["$undefined",[["$","path","0",{"d":"$15","children":[]}]]],"className":"$undefined","style":{"color":"$undefined"},"height":22.400000000000002,"width":22.400000000000002,"xmlns":"http://www.w3.org/2000/svg"}]}]}],["$","span","https://www.douban.com/people/183064260/",{"children":["$","a",null,{"href":"https://www.douban.com/people/183064260/","title":"è±†ç“£: ddadaal","target":"_blank","className":"block transition hover:scale-125","rel":"noreferrer","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","role":"img","viewBox":"0 0 24 24","children":["$undefined",[["$","path","0",{"d":"M.51 3.06h22.98V.755H.51V3.06Zm20.976 2.537v9.608h-2.137l-1.669 5.76H24v2.28H0v-2.28h6.32l-1.67-5.76H2.515V5.597h18.972Zm-5.066 9.608H7.58l1.67 5.76h5.501l1.67-5.76ZM18.367 7.9H5.634v5.025h12.733V7.9Z","children":[]}]]],"className":"$undefined","style":{"color":"$undefined"},"height":22.400000000000002,"width":22.400000000000002,"xmlns":"http://www.w3.org/2000/svg"}]}]}]]}]]}],["$","p",null,{"className":"text-center","children":["Â©"," ",2025," ","|"," ",["$","$L10",null,{"id":"footer.madeWithLove"}]]}]]}],["$","div",null,{"children":[["$","span",null,{"className":"footer-title","children":["ðŸš€"," ",["$","$L10",null,{"id":"footer.poweredBy"}]]}],[["$","a","React",{"className":"link link-hover","target":"_blank","href":"https://reactjs.org/","rel":"noreferrer","children":"React"}],["$","a","Next.js",{"className":"link link-hover","target":"_blank","href":"https://nextjs.org/","rel":"noreferrer","children":"Next.js"}],["$","a","GitHub Pages",{"className":"link link-hover","target":"_blank","href":"https://pages.github.com/","rel":"noreferrer","children":"GitHub Pages"}],["$","a","TypeScript",{"className":"link link-hover","target":"_blank","href":"https://www.typescriptlang.org/","rel":"noreferrer","children":"TypeScript"}]]]}],["$","div",null,{"children":[["$","span",null,{"className":"footer-title","children":["ðŸŽ¨"," ",["$","$L10",null,{"id":"footer.themedWith"}]]}],[["$","a","daisyui",{"className":"link link-hover","target":"_blank","href":"https://daisyui.com/","rel":"noreferrer","children":"daisyui"}],["$","a","tailwind",{"className":"link link-hover","target":"_blank","href":"https://tailwindcss.com/","rel":"noreferrer","children":"tailwind"}]]]}],["$","div",null,{"children":[["$","span",null,{"className":"footer-title","children":["ðŸŽ“"," ",["$","$L10",null,{"id":"footer.contacts"}]]}],[["$","a","idealclover - ç¿ ç¿ é…±çš„ä¸ªäººç½‘ç«™",{"className":"link link-hover","target":"_blank","href":"https://idealclover.top","rel":"noreferrer","children":"idealclover - ç¿ ç¿ é…±çš„ä¸ªäººç½‘ç«™"}],["$","a","Sephidator - Sephidatorçš„ä¸ªäººåšå®¢",{"className":"link link-hover","target":"_blank","href":"https://sephidator.xyz","rel":"noreferrer","children":"Sephidator - Sephidatorçš„ä¸ªäººåšå®¢"}],["$","a","iznauy - ä¸ªäººåšå®¢",{"className":"link link-hover","target":"_blank","href":"https://iznauy.github.io/","rel":"noreferrer","children":"iznauy - ä¸ªäººåšå®¢"}],["$","a","Aironoria - é™ˆä¿Šå®‡çš„ä¸ªäººåšå®¢",{"className":"link link-hover","target":"_blank","href":"https://aironoria.github.io","rel":"noreferrer","children":"Aironoria - é™ˆä¿Šå®‡çš„ä¸ªäººåšå®¢"}],["$","a","forewing - ä¸ªäººä¸»é¡µ",{"className":"link link-hover","target":"_blank","href":"https://jbesu.com/","rel":"noreferrer","children":"forewing - ä¸ªäººä¸»é¡µ"}],["$","a","Weiser - ä¸ªäººä¸»é¡µ",{"className":"link link-hover","target":"_blank","href":"https://weiser.fun","rel":"noreferrer","children":"Weiser - ä¸ªäººä¸»é¡µ"}]]]}]]}]}],["$","$L16",null,{}]]}]
17:I[4378,["116","static/chunks/c556396d-49361b2e780d113c.js","413","static/chunks/7a1bdfe6-8f7609c25899d936.js","994","static/chunks/c4aeae87-2a85323a0275cbf9.js","786","static/chunks/1b3e99d6-50521588821d44ca.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","826","static/chunks/826-c44bffd752ec02cd.js","971","static/chunks/app/articles/%5B%5B...params%5D%5D/page-8625a0107f5ea4bf.js"],"ArticleFrontmatter"]
1a:I[4674,["116","static/chunks/c556396d-49361b2e780d113c.js","413","static/chunks/7a1bdfe6-8f7609c25899d936.js","994","static/chunks/c4aeae87-2a85323a0275cbf9.js","786","static/chunks/1b3e99d6-50521588821d44ca.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","826","static/chunks/826-c44bffd752ec02cd.js","971","static/chunks/app/articles/%5B%5B...params%5D%5D/page-8625a0107f5ea4bf.js"],"RelatedArticles"]
1b:I[3373,["116","static/chunks/c556396d-49361b2e780d113c.js","413","static/chunks/7a1bdfe6-8f7609c25899d936.js","994","static/chunks/c4aeae87-2a85323a0275cbf9.js","786","static/chunks/1b3e99d6-50521588821d44ca.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","826","static/chunks/826-c44bffd752ec02cd.js","971","static/chunks/app/articles/%5B%5B...params%5D%5D/page-8625a0107f5ea4bf.js"],"CommentPanelWithCurrentLanguage"]
18:T119f,
# The Problem

I accidently encountered a problem during the development of the 2.0 version of [simstate](/articles/simstate-and-why): During an iteration of a set of `observers` stored in a ES6 Map, which contained only one element, an infinite loop occurred.

![Loop that never ends](./loop-that-never-ends.png)

# Investigation

This problem confused me quite a lot. It had been confirmed that this Map had only one element and the element remained unchanged between and inside loops, and the all elements in `promises` array were the same.

![Only one element in the map](./only-one-element.png)

My first thought was **data race**. It might be true for other languages with real multi-threading capability, but this is JavaScript: it is single thread only, and so there would be no such concurrent related problems.

Using a function as the key of Map seemed weird for other programming languages, since most Map-like data structure (like `HashMap` in Java, `Dictionary` in C# and `unordered_map` in C++) requires the key to be hashable, and functions are not, at least in the surface. However, MDN clearly states that [any value (both objects and primitive values) may be used as a key](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map). The following code works well, which proves that functions, too, can be used as keys in a Map.

```js
const data = [];
const map = new Map();
function a() { console.log("a"); }
map.set(a, "123");
map.forEach((value, key) => key()); // a
```

# The Root of the Problem

After some investigation, **the call to observer** caught my eyes.

`observer()` will trigger the re-render of observer component and make the updated state available for end-user. To simplify implementation, every time the component is re-rendered, the component will **unsubscribe (delete an entry from a Map) to the stores it subscribes to**, and **re-subscribe (set an entry in a Map) during the render**.

StoreConsumer.tsx omitting some unrelated code

```tsx
export default class StoreConsumer extends React.Component<Props, State> {
  // ...
  instances = new Set<Store<any>>();

  // ...
  private unsubscribeAll() {
    this.instances.forEach((store) => {
      // highlight-next-line
      store.unsubscribe(this.update);
    });
  }

  useStore = <ST extends StoreType<any>>(storeType: ST, dep?: Dependency<ST>): InstanceType<ST> => {
    // ...
    // highlight-next-line
    store.subscribe(this.update, dep);
    // ...
  }

  render() {
    return (
      <SimstateContext.Consumer>
        {(map) => {
          // ...
          // highlight-next-line
          this.unsubscribeAll();
          this.instances.clear();
          return this.props.children({ useStore: this.useStore });
        }}
      </SimstateContext.Consumer>
    );
  }
}
```

Store.ts omitting unrelated code

```ts
subscribe(observer: Observer, dep?: Dependency) {
  // highlight-next-line
  this.observers.set(observer, { dep, shouldUpdate: getChecker(dep) });
}

unsubscribe(observer: Observer) {
  // highlight-next-line
  this.observers.delete(observer);
}
```

**The call to observer (`observer()`), happened during the iteration of the Map, alters the Map itself!**

This is a dangerous action. It has become a common sense not to do so in most programming languages, since it might cause unexpected behaviors, which is exactly what happened here.

In this case, when deleting an entry and re-add an entry during the iteration, even if they are the equal, the item will be **considered as a new item**, which results in an infinite loop.

You may reproduce the case with the following code snippet. Note that since it runs indefinitely, consider running the script in a CLI environment (instead of browser) where you can kill the process to end the execution with ease.

```js
const map = new Map();
function obs() { map.delete(obs); map.set(obs, 1); console.log("obs called"); }
map.set(obs, 1);
map.forEach((value, key) => key());
// endless "obs called"
```

# Conclusion

This is quite a simple problem, and the cause is also easy to understand for most programmers. However, it still confused me for quite a while. After it, I realized that some *bugs* might seem strange and difficult to debug, but it doesn't mean the cause is complicated: sometimes it is the **indirections** on top of all the root that adds to the difficulty. During debugging, it is a good way to track down the code execution flow, and in this process the cause may just reveal itself.
5:["$","article",null,{"children":[["$","div",null,{"className":"bg-neutral px-4 py-8","children":["$","div",null,{"className":"max-w-7xl mx-auto min-h-[256px] flex justify-center text-center text-neutral-content","children":["$","div",null,{"className":"flex flex-col justify-center animate-slide-up","children":[["$","h1",null,{"className":"text-4xl my-2","children":"An Infinite Loop Caused by Updating a Map during Iteration"}],["$","$L17",null,{"className":"justify-center","articleId":"an-infinite-loop-caused-by-updating-a-Map-during-iteration","info":{"content":"$18","title":"An Infinite Loop Caused by Updating a Map during Iteration","date":"2019-02-25 15:30","id":"an-infinite-loop-caused-by-updating-a-Map-during-iteration","lang":"en","tags":["JavaScript","web-frontend","problem-investigation"],"related":["simstate-and-why"],"ignored_in_list":"$undefined","hide_heading":"$undefined","no_toc":"$undefined","absolute_path":"$undefined","last_updated":"$undefined","wordCount":639,"readingTime":3.195,"filePath":"contents/20190225-an-infinite-loop-caused-by-updating-a-Map-during-iteration/en.md","summary":{"articleId":"an-infinite-loop-caused-by-updating-a-Map-during-iteration","lang":"en","hash":"e79ef8687b5ba5291871116771ecd622d0e734075bd69714cda200405486decf","summaries":[{"metadata":{"summarizer":"azure-ai","model":"DeepSeek-R1"},"summaries":["The author encountered an infinite loop in a Map iteration during Simstate 2.0 development. The loop occurred when iterating a Map storing React component observers. The root cause was modifying the Map during iteration: calling an observer triggered component re-renders, which unsubscribed (deleted) and resubscribed (re-added) the same function key within the loop. Though the key (function) remained identical, reinsertion during iteration caused the Map to treat it as new, perpetuating the loop. This behavior, dangerous in most languages, arises in JavaScript when altering a Map mid-iteration. The solution involved recognizing indirection-induced complexity and avoiding such mutations during iteration."],"startTime":"2025-02-14T13:27:35.546Z","endTime":"2025-02-14T13:28:00.337Z"},{"metadata":{"summarizer":"ollama","model":"deepseek-r1:8b"},"summaries":["In JavaScript, using a function as a key in a Map can lead to unexpected behavior. During iteration, if the observer modifies the Map (by deleting and re-adding itself), it creates an infinite loop even when only one element is present. This highlights the risks of modifying data structures during iteration."]}]}},"langVersions":["en"]}]]}]}]}],["$","div",null,{"className":"animate-slide-up","children":[["$","div",null,{"className":"max-w-7xl mx-auto p-4","children":"$L19"}],["$","div",null,{"className":"max-w-7xl mx-auto p-4","children":["$","$L1a",null,{"relatedArticles":[{"id":"simstate-and-why","langVersions":[{"excerpt":"\n# What is it?\n\n[![npm](https://img.shields.io/npm/v/simstate.svg?style=flat-square)](https://www.np","lang":"en","time":"2019-02-14 23:50:00 UTC+8","title":"Simstate and Why","last_updated":"$undefined","absolute_path":"$undefined"}]}]}]}],["$","div",null,{"className":"max-w-7xl mx-auto p-4","children":["$","$L1b",null,{"articleId":"an-infinite-loop-caused-by-updating-a-Map-during-iteration","articleTitle":"An Infinite Loop Caused by Updating a Map during Iteration"}]}]]}]]}]
1d:I[7868,["116","static/chunks/c556396d-49361b2e780d113c.js","413","static/chunks/7a1bdfe6-8f7609c25899d936.js","994","static/chunks/c4aeae87-2a85323a0275cbf9.js","786","static/chunks/1b3e99d6-50521588821d44ca.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","826","static/chunks/826-c44bffd752ec02cd.js","971","static/chunks/app/articles/%5B%5B...params%5D%5D/page-8625a0107f5ea4bf.js"],"Gallery"]
24:I[2422,["116","static/chunks/c556396d-49361b2e780d113c.js","413","static/chunks/7a1bdfe6-8f7609c25899d936.js","994","static/chunks/c4aeae87-2a85323a0275cbf9.js","786","static/chunks/1b3e99d6-50521588821d44ca.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","826","static/chunks/826-c44bffd752ec02cd.js","971","static/chunks/app/articles/%5B%5B...params%5D%5D/page-8625a0107f5ea4bf.js"],"ArticleToc"]
1e:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z20:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z22:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z23:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z19:["$","div",null,{"className":"flex flex-row space-x-4","children":[["$","div",null,{"className":"prose max-w-full lg:w-[75%]","children":["$L1c",["$","$L1d",null,{"withCaption":true,"id":"an-infinite-loop-caused-by-updating-a-Map-during-iteration","children":[["$","h1","h1-0",{"id":"the-problem","children":[["$","a","the-problem",{"href":"#the-problem","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$1e","children":[]}]]],"style":{"color":"$undefined"},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"The Problem"]}],"\n",["$","p","p-0",{"children":["I accidently encountered a problem during the development of the 2.0 version of ",["$","a","a-0",{"href":"/articles/simstate-and-why","children":"simstate"}],": During an iteration of a set of ",["$","code","code-0",{"children":"observers"}]," stored in a ES6 Map, which contained only one element, an infinite loop occurred."]}],"\n",["$","p","p-1",{"children":"$L1f"}],"\n",["$","h1","h1-1",{"id":"investigation","children":[["$","a","investigation",{"href":"#investigation","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$20","children":[]}]]],"style":{"color":"$undefined"},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"Investigation"]}],"\n",["$","p","p-2",{"children":["This problem confused me quite a lot. It had been confirmed that this Map had only one element and the element remained unchanged between and inside loops, and the all elements in ",["$","code","code-0",{"children":"promises"}]," array were the same."]}],"\n",["$","p","p-3",{"children":"$L21"}],"\n",["$","p","p-4",{"children":["My first thought was ",["$","strong","strong-0",{"children":"data race"}],". It might be true for other languages with real multi-threading capability, but this is JavaScript: it is single thread only, and so there would be no such concurrent related problems."]}],"\n",["$","p","p-5",{"children":["Using a function as the key of Map seemed weird for other programming languages, since most Map-like data structure (like ",["$","code","code-0",{"children":"HashMap"}]," in Java, ",["$","code","code-1",{"children":"Dictionary"}]," in C# and ",["$","code","code-2",{"children":"unordered_map"}]," in C++) requires the key to be hashable, and functions are not, at least in the surface. However, MDN clearly states that ",["$","a","a-0",{"href":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map","children":"any value (both objects and primitive values) may be used as a key"}],". The following code works well, which proves that functions, too, can be used as keys in a Map."]}],"\n",["$","figure","figure-0",{"data-rehype-pretty-code-figure":"","children":["$","pre","pre-0",{"style":{"backgroundColor":"#282c34","color":"#abb2bf"},"tabIndex":0,"data-language":"js","data-theme":"one-dark-pro","children":["$","code","code-0",{"data-language":"js","data-theme":"one-dark-pro","style":{"display":"grid"},"children":[["$","span","span-0",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"const"}],["$","span","span-1",{"style":{"color":"#E5C07B"},"children":" data"}],["$","span","span-2",{"style":{"color":"#56B6C2"},"children":" ="}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":" [];"}]]}],"\n",["$","span","span-1",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"const"}],["$","span","span-1",{"style":{"color":"#E5C07B"},"children":" map"}],["$","span","span-2",{"style":{"color":"#56B6C2"},"children":" ="}],["$","span","span-3",{"style":{"color":"#C678DD"},"children":" new"}],["$","span","span-4",{"style":{"color":"#61AFEF"},"children":" Map"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":"();"}]]}],"\n",["$","span","span-2",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"function"}],["$","span","span-1",{"style":{"color":"#61AFEF"},"children":" a"}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":"() { "}],["$","span","span-3",{"style":{"color":"#E5C07B"},"children":"console"}],["$","span","span-4",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-5",{"style":{"color":"#61AFEF"},"children":"log"}],["$","span","span-6",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-7",{"style":{"color":"#98C379"},"children":"\"a\""}],["$","span","span-8",{"style":{"color":"#ABB2BF"},"children":"); }"}]]}],"\n",["$","span","span-3",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E5C07B"},"children":"map"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-2",{"style":{"color":"#61AFEF"},"children":"set"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-4",{"style":{"color":"#E06C75"},"children":"a"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-6",{"style":{"color":"#98C379"},"children":"\"123\""}],["$","span","span-7",{"style":{"color":"#ABB2BF"},"children":");"}]]}],"\n",["$","span","span-4",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E5C07B"},"children":"map"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-2",{"style":{"color":"#61AFEF"},"children":"forEach"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"(("}],["$","span","span-4",{"style":{"color":"#E06C75","fontStyle":"italic"},"children":"value"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-6",{"style":{"color":"#E06C75","fontStyle":"italic"},"children":"key"}],["$","span","span-7",{"style":{"color":"#ABB2BF"},"children":") "}],["$","span","span-8",{"style":{"color":"#C678DD"},"children":"=>"}],["$","span","span-9",{"style":{"color":"#61AFEF"},"children":" key"}],["$","span","span-10",{"style":{"color":"#ABB2BF"},"children":"()); "}],["$","span","span-11",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"// a"}]]}]]}]}]}],"\n",["$","h1","h1-2",{"id":"the-root-of-the-problem","children":[["$","a","the-root-of-the-problem",{"href":"#the-root-of-the-problem","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$22","children":[]}]]],"style":{"color":"$undefined"},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"The Root of the Problem"]}],"\n",["$","p","p-6",{"children":["After some investigation, ",["$","strong","strong-0",{"children":"the call to observer"}]," caught my eyes."]}],"\n",["$","p","p-7",{"children":[["$","code","code-0",{"children":"observer()"}]," will trigger the re-render of observer component and make the updated state available for end-user. To simplify implementation, every time the component is re-rendered, the component will ",["$","strong","strong-0",{"children":"unsubscribe (delete an entry from a Map) to the stores it subscribes to"}],", and ",["$","strong","strong-1",{"children":"re-subscribe (set an entry in a Map) during the render"}],"."]}],"\n",["$","p","p-8",{"children":"StoreConsumer.tsx omitting some unrelated code"}],"\n",["$","figure","figure-1",{"data-rehype-pretty-code-figure":"","children":["$","pre","pre-0",{"style":{"backgroundColor":"#282c34","color":"#abb2bf"},"tabIndex":0,"data-language":"tsx","data-theme":"one-dark-pro","children":["$","code","code-0",{"data-language":"tsx","data-theme":"one-dark-pro","style":{"display":"grid"},"children":[["$","span","span-0",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"export"}],["$","span","span-1",{"style":{"color":"#C678DD"},"children":" default"}],["$","span","span-2",{"style":{"color":"#C678DD"},"children":" class"}],["$","span","span-3",{"style":{"color":"#E5C07B"},"children":" StoreConsumer"}],["$","span","span-4",{"style":{"color":"#C678DD"},"children":" extends"}],["$","span","span-5",{"style":{"color":"#E5C07B"},"children":" React"}],["$","span","span-6",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-7",{"style":{"color":"#E5C07B"},"children":"Component"}],["$","span","span-8",{"style":{"color":"#ABB2BF"},"children":"<"}],["$","span","span-9",{"style":{"color":"#E5C07B"},"children":"Props"}],["$","span","span-10",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-11",{"style":{"color":"#E5C07B"},"children":"State"}],["$","span","span-12",{"style":{"color":"#ABB2BF"},"children":"> {"}]]}],"\n",["$","span","span-1",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"  // ..."}]}],"\n",["$","span","span-2",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E06C75"},"children":"  instances"}],["$","span","span-1",{"style":{"color":"#56B6C2"},"children":" ="}],["$","span","span-2",{"style":{"color":"#C678DD"},"children":" new"}],["$","span","span-3",{"style":{"color":"#61AFEF"},"children":" Set"}],["$","span","span-4",{"style":{"color":"#ABB2BF"},"children":"<"}],["$","span","span-5",{"style":{"color":"#E5C07B"},"children":"Store"}],["$","span","span-6",{"style":{"color":"#ABB2BF"},"children":"<"}],["$","span","span-7",{"style":{"color":"#E5C07B"},"children":"any"}],["$","span","span-8",{"style":{"color":"#ABB2BF"},"children":">>();"}]]}],"\n",["$","span","span-3",{"data-line":"","children":" "}],"\n",["$","span","span-4",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"  // ..."}]}],"\n",["$","span","span-5",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"  private"}],["$","span","span-1",{"style":{"color":"#61AFEF"},"children":" unsubscribeAll"}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":"() {"}]]}],"\n",["$","span","span-6",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E5C07B"},"children":"    this"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-2",{"style":{"color":"#E5C07B"},"children":"instances"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-4",{"style":{"color":"#61AFEF"},"children":"forEach"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":"(("}],["$","span","span-6",{"style":{"color":"#E06C75","fontStyle":"italic"},"children":"store"}],["$","span","span-7",{"style":{"color":"#ABB2BF"},"children":") "}],["$","span","span-8",{"style":{"color":"#C678DD"},"children":"=>"}],["$","span","span-9",{"style":{"color":"#ABB2BF"},"children":" {"}]]}],"\n",["$","span","span-7",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"      // highlight-next-line"}]}],"\n",["$","span","span-8",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E5C07B"},"children":"      store"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-2",{"style":{"color":"#61AFEF"},"children":"unsubscribe"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-4",{"style":{"color":"#E5C07B"},"children":"this"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-6",{"style":{"color":"#E06C75"},"children":"update"}],["$","span","span-7",{"style":{"color":"#ABB2BF"},"children":");"}]]}],"\n",["$","span","span-9",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"    });"}]}],"\n",["$","span","span-10",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"  }"}]}],"\n",["$","span","span-11",{"data-line":"","children":" "}],"\n",["$","span","span-12",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#61AFEF"},"children":"  useStore"}],["$","span","span-1",{"style":{"color":"#56B6C2"},"children":" ="}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":" <"}],["$","span","span-3",{"style":{"color":"#E5C07B"},"children":"ST"}],["$","span","span-4",{"style":{"color":"#C678DD"},"children":" extends"}],["$","span","span-5",{"style":{"color":"#E5C07B"},"children":" StoreType"}],["$","span","span-6",{"style":{"color":"#ABB2BF"},"children":"<"}],["$","span","span-7",{"style":{"color":"#E5C07B"},"children":"any"}],["$","span","span-8",{"style":{"color":"#ABB2BF"},"children":">>("}],["$","span","span-9",{"style":{"color":"#E06C75","fontStyle":"italic"},"children":"storeType"}],["$","span","span-10",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-11",{"style":{"color":"#E5C07B"},"children":"ST"}],["$","span","span-12",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-13",{"style":{"color":"#E06C75","fontStyle":"italic"},"children":"dep"}],["$","span","span-14",{"style":{"color":"#C678DD"},"children":"?"}],["$","span","span-15",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-16",{"style":{"color":"#E5C07B"},"children":"Dependency"}],["$","span","span-17",{"style":{"color":"#ABB2BF"},"children":"<"}],["$","span","span-18",{"style":{"color":"#E5C07B"},"children":"ST"}],["$","span","span-19",{"style":{"color":"#ABB2BF"},"children":">): "}],["$","span","span-20",{"style":{"color":"#E5C07B"},"children":"InstanceType"}],["$","span","span-21",{"style":{"color":"#ABB2BF"},"children":"<"}],["$","span","span-22",{"style":{"color":"#E5C07B"},"children":"ST"}],["$","span","span-23",{"style":{"color":"#ABB2BF"},"children":"> "}],["$","span","span-24",{"style":{"color":"#C678DD"},"children":"=>"}],["$","span","span-25",{"style":{"color":"#ABB2BF"},"children":" {"}]]}],"\n",["$","span","span-13",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"    // ..."}]}],"\n",["$","span","span-14",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"    // highlight-next-line"}]}],"\n",["$","span","span-15",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E5C07B"},"children":"    store"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-2",{"style":{"color":"#61AFEF"},"children":"subscribe"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-4",{"style":{"color":"#E5C07B"},"children":"this"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-6",{"style":{"color":"#E06C75"},"children":"update"}],["$","span","span-7",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-8",{"style":{"color":"#E06C75"},"children":"dep"}],["$","span","span-9",{"style":{"color":"#ABB2BF"},"children":");"}]]}],"\n",["$","span","span-16",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"    // ..."}]}],"\n",["$","span","span-17",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"  }"}]}],"\n",["$","span","span-18",{"data-line":"","children":" "}],"\n",["$","span","span-19",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#61AFEF"},"children":"  render"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"() {"}]]}],"\n",["$","span","span-20",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"    return"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":" ("}]]}],"\n",["$","span","span-21",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"      <"}],["$","span","span-1",{"style":{"color":"#E5C07B"},"children":"SimstateContext.Consumer"}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":">"}]]}],"\n",["$","span","span-22",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"        {"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-2",{"style":{"color":"#E06C75","fontStyle":"italic"},"children":"map"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":") "}],["$","span","span-4",{"style":{"color":"#C678DD"},"children":"=>"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":" {"}]]}],"\n",["$","span","span-23",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"          // ..."}]}],"\n",["$","span","span-24",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"          // highlight-next-line"}]}],"\n",["$","span","span-25",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E5C07B"},"children":"          this"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-2",{"style":{"color":"#61AFEF"},"children":"unsubscribeAll"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"();"}]]}],"\n",["$","span","span-26",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E5C07B"},"children":"          this"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-2",{"style":{"color":"#E5C07B"},"children":"instances"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-4",{"style":{"color":"#61AFEF"},"children":"clear"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":"();"}]]}],"\n",["$","span","span-27",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"          return"}],["$","span","span-1",{"style":{"color":"#E5C07B"},"children":" this"}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-3",{"style":{"color":"#E5C07B"},"children":"props"}],["$","span","span-4",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-5",{"style":{"color":"#61AFEF"},"children":"children"}],["$","span","span-6",{"style":{"color":"#ABB2BF"},"children":"({ "}],["$","span","span-7",{"style":{"color":"#E06C75"},"children":"useStore"}],["$","span","span-8",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-9",{"style":{"color":"#E5C07B"},"children":"this"}],["$","span","span-10",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-11",{"style":{"color":"#E06C75"},"children":"useStore"}],["$","span","span-12",{"style":{"color":"#ABB2BF"},"children":" });"}]]}],"\n",["$","span","span-28",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"        }"}],["$","span","span-1",{"style":{"color":"#C678DD"},"children":"}"}]]}],"\n",["$","span","span-29",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"      </"}],["$","span","span-1",{"style":{"color":"#E5C07B"},"children":"SimstateContext.Consumer"}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":">"}]]}],"\n",["$","span","span-30",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"    );"}]}],"\n",["$","span","span-31",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"  }"}]}],"\n",["$","span","span-32",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"}"}]}]]}]}]}],"\n",["$","p","p-9",{"children":"Store.ts omitting unrelated code"}],"\n",["$","figure","figure-2",{"data-rehype-pretty-code-figure":"","children":["$","pre","pre-0",{"style":{"backgroundColor":"#282c34","color":"#abb2bf"},"tabIndex":0,"data-language":"ts","data-theme":"one-dark-pro","children":["$","code","code-0",{"data-language":"ts","data-theme":"one-dark-pro","style":{"display":"grid"},"children":[["$","span","span-0",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#61AFEF"},"children":"subscribe"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-2",{"style":{"color":"#E06C75"},"children":"observer"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-4",{"style":{"color":"#E06C75"},"children":"Observer"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-6",{"style":{"color":"#E06C75"},"children":"dep"}],["$","span","span-7",{"style":{"color":"#C678DD"},"children":"?:"}],["$","span","span-8",{"style":{"color":"#E06C75"},"children":" Dependency"}],["$","span","span-9",{"style":{"color":"#ABB2BF"},"children":") {"}]]}],"\n",["$","span","span-1",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"  // highlight-next-line"}]}],"\n",["$","span","span-2",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E5C07B"},"children":"  this"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-2",{"style":{"color":"#E5C07B"},"children":"observers"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-4",{"style":{"color":"#61AFEF"},"children":"set"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-6",{"style":{"color":"#E06C75"},"children":"observer"}],["$","span","span-7",{"style":{"color":"#ABB2BF"},"children":", { "}],["$","span","span-8",{"style":{"color":"#E06C75"},"children":"dep"}],["$","span","span-9",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-10",{"style":{"color":"#E06C75"},"children":"shouldUpdate"}],["$","span","span-11",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-12",{"style":{"color":"#61AFEF"},"children":"getChecker"}],["$","span","span-13",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-14",{"style":{"color":"#E06C75"},"children":"dep"}],["$","span","span-15",{"style":{"color":"#ABB2BF"},"children":") });"}]]}],"\n",["$","span","span-3",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"}"}]}],"\n",["$","span","span-4",{"data-line":"","children":" "}],"\n",["$","span","span-5",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#61AFEF"},"children":"unsubscribe"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-2",{"style":{"color":"#E06C75"},"children":"observer"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-4",{"style":{"color":"#E06C75"},"children":"Observer"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":") {"}]]}],"\n",["$","span","span-6",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"  // highlight-next-line"}]}],"\n",["$","span","span-7",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E5C07B"},"children":"  this"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-2",{"style":{"color":"#E5C07B"},"children":"observers"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-4",{"style":{"color":"#61AFEF"},"children":"delete"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-6",{"style":{"color":"#E06C75"},"children":"observer"}],["$","span","span-7",{"style":{"color":"#ABB2BF"},"children":");"}]]}],"\n",["$","span","span-8",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"}"}]}]]}]}]}],"\n",["$","p","p-10",{"children":["$","strong","strong-0",{"children":["The call to observer (",["$","code","code-0",{"children":"observer()"}],"), happened during the iteration of the Map, alters the Map itself!"]}]}],"\n",["$","p","p-11",{"children":"This is a dangerous action. It has become a common sense not to do so in most programming languages, since it might cause unexpected behaviors, which is exactly what happened here."}],"\n",["$","p","p-12",{"children":["In this case, when deleting an entry and re-add an entry during the iteration, even if they are the equal, the item will be ",["$","strong","strong-0",{"children":"considered as a new item"}],", which results in an infinite loop."]}],"\n",["$","p","p-13",{"children":"You may reproduce the case with the following code snippet. Note that since it runs indefinitely, consider running the script in a CLI environment (instead of browser) where you can kill the process to end the execution with ease."}],"\n",["$","figure","figure-3",{"data-rehype-pretty-code-figure":"","children":["$","pre","pre-0",{"style":{"backgroundColor":"#282c34","color":"#abb2bf"},"tabIndex":0,"data-language":"js","data-theme":"one-dark-pro","children":["$","code","code-0",{"data-language":"js","data-theme":"one-dark-pro","style":{"display":"grid"},"children":[["$","span","span-0",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"const"}],["$","span","span-1",{"style":{"color":"#E5C07B"},"children":" map"}],["$","span","span-2",{"style":{"color":"#56B6C2"},"children":" ="}],["$","span","span-3",{"style":{"color":"#C678DD"},"children":" new"}],["$","span","span-4",{"style":{"color":"#61AFEF"},"children":" Map"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":"();"}]]}],"\n",["$","span","span-1",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"function"}],["$","span","span-1",{"style":{"color":"#61AFEF"},"children":" obs"}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":"() { "}],["$","span","span-3",{"style":{"color":"#E5C07B"},"children":"map"}],["$","span","span-4",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-5",{"style":{"color":"#61AFEF"},"children":"delete"}],["$","span","span-6",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-7",{"style":{"color":"#E06C75"},"children":"obs"}],["$","span","span-8",{"style":{"color":"#ABB2BF"},"children":"); "}],["$","span","span-9",{"style":{"color":"#E5C07B"},"children":"map"}],["$","span","span-10",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-11",{"style":{"color":"#61AFEF"},"children":"set"}],["$","span","span-12",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-13",{"style":{"color":"#E06C75"},"children":"obs"}],["$","span","span-14",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-15",{"style":{"color":"#D19A66"},"children":"1"}],["$","span","span-16",{"style":{"color":"#ABB2BF"},"children":"); "}],["$","span","span-17",{"style":{"color":"#E5C07B"},"children":"console"}],["$","span","span-18",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-19",{"style":{"color":"#61AFEF"},"children":"log"}],["$","span","span-20",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-21",{"style":{"color":"#98C379"},"children":"\"obs called\""}],["$","span","span-22",{"style":{"color":"#ABB2BF"},"children":"); }"}]]}],"\n",["$","span","span-2",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E5C07B"},"children":"map"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-2",{"style":{"color":"#61AFEF"},"children":"set"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-4",{"style":{"color":"#E06C75"},"children":"obs"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-6",{"style":{"color":"#D19A66"},"children":"1"}],["$","span","span-7",{"style":{"color":"#ABB2BF"},"children":");"}]]}],"\n",["$","span","span-3",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E5C07B"},"children":"map"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-2",{"style":{"color":"#61AFEF"},"children":"forEach"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"(("}],["$","span","span-4",{"style":{"color":"#E06C75","fontStyle":"italic"},"children":"value"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-6",{"style":{"color":"#E06C75","fontStyle":"italic"},"children":"key"}],["$","span","span-7",{"style":{"color":"#ABB2BF"},"children":") "}],["$","span","span-8",{"style":{"color":"#C678DD"},"children":"=>"}],["$","span","span-9",{"style":{"color":"#61AFEF"},"children":" key"}],["$","span","span-10",{"style":{"color":"#ABB2BF"},"children":"());"}]]}],"\n",["$","span","span-4",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"// endless \"obs called\""}]}]]}]}]}],"\n",["$","h1","h1-3",{"id":"conclusion","children":[["$","a","conclusion",{"href":"#conclusion","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$23","children":[]}]]],"style":{"color":"$undefined"},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"Conclusion"]}],"\n",["$","p","p-14",{"children":["This is quite a simple problem, and the cause is also easy to understand for most programmers. However, it still confused me for quite a while. After it, I realized that some ",["$","em","em-0",{"children":"bugs"}]," might seem strange and difficult to debug, but it doesn't mean the cause is complicated: sometimes it is the ",["$","strong","strong-0",{"children":"indirections"}]," on top of all the root that adds to the difficulty. During debugging, it is a good way to track down the code execution flow, and in this process the cause may just reveal itself."]}]]}]]}],["$","div",null,{"className":"hidden lg:block lg:w-[25%]","children":["$","$L24",null,{"toc":[{"depth":1,"value":"The Problem","id":"the-problem"},{"depth":1,"value":"Investigation","id":"investigation"},{"depth":1,"value":"The Root of the Problem","id":"the-root-of-the-problem"},{"depth":1,"value":"Conclusion","id":"conclusion"}],"hasSummary":true}]}]]}]
26:I[1968,["116","static/chunks/c556396d-49361b2e780d113c.js","413","static/chunks/7a1bdfe6-8f7609c25899d936.js","994","static/chunks/c4aeae87-2a85323a0275cbf9.js","786","static/chunks/1b3e99d6-50521588821d44ca.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","826","static/chunks/826-c44bffd752ec02cd.js","971","static/chunks/app/articles/%5B%5B...params%5D%5D/page-8625a0107f5ea4bf.js"],""]
25:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z1c:["$","div",null,{"className":"p-4 my-4 bg-neutral rounded shadow","children":[["$","h1",null,{"id":"summary","className":"text-neutral-content","children":[["$","a","summary",{"href":"#summary","className":"mr-1 text-neutral-content","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$25","children":[]}]]],"style":{"color":"$undefined"},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],["$","$L10","summaryTitle",{"id":"articlePage.summary.title"}]]}],["$","div",null,{"children":["$","div",null,{"role":"tablist","className":"tabs tabs-boxed","children":[[["$","input",null,{"type":"radio","name":"summaryTab","role":"tab","className":"tab text-base-content","id":"summaryTab-0","aria-label":"DeepSeek_R1","defaultChecked":true}],["$","div","0",{"role":"tabpanel","className":"tab-content bg-base-100 border-base-300 rounded-box p-3","children":[["$","div",null,{"className":"prose max-w-full prose-p:m-0 prose-li:m-0 prose-ul:m-0 prose-ol:m-0","children":[["$","p","p-0",{"children":"The author encountered an infinite loop in a Map iteration during Simstate 2.0 development. The loop occurred when iterating a Map storing React component observers. The root cause was modifying the Map during iteration: calling an observer triggered component re-renders, which unsubscribed (deleted) and resubscribed (re-added) the same function key within the loop. Though the key (function) remained identical, reinsertion during iteration caused the Map to treat it as new, perpetuating the loop. This behavior, dangerous in most languages, arises in JavaScript when altering a Map mid-iteration. The solution involved recognizing indirection-induced complexity and avoiding such mutations during iteration."}]]}],["$","p",null,{"className":"text-sm justify-end flex p-1","children":["$","$L10",null,{"id":"articlePage.summary.poweredBy.azureAi","args":[["$","$L26","azureAiUrl",{"target":"_blank","href":"https://ai.azure.com","children":"Azure AI"}],"DeepSeek-R1"]}]}]]}]],[["$","input",null,{"type":"radio","name":"summaryTab","role":"tab","className":"tab text-base-content","id":"summaryTab-1","aria-label":"DeepSeek_R1_8B","defaultChecked":false}],["$","div","1",{"role":"tabpanel","className":"tab-content bg-base-100 border-base-300 rounded-box p-3","children":[["$","div",null,{"className":"prose max-w-full prose-p:m-0 prose-li:m-0 prose-ul:m-0 prose-ol:m-0","children":[["$","p","p-0",{"children":"In JavaScript, using a function as a key in a Map can lead to unexpected behavior. During iteration, if the observer modifies the Map (by deleting and re-adding itself), it creates an infinite loop even when only one element is present. This highlights the risks of modifying data structures during iteration."}]]}],["$","p",null,{"className":"text-sm justify-end flex p-1","children":["$","$L10",null,{"id":"articlePage.summary.poweredBy.ollama","args":[["$","$L26","ollamaUrl",{"target":"_blank","href":"https://ollama.com/","children":"Ollama"}],"deepseek-r1:8b"]}]}]]}]]]}]}]]}]
b:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
9:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"An Infinite Loop Caused by Updating a Map during Iteration - ddadaal.me"}],["$","meta","2",{"name":"description","content":"ddadaal's personal website"}],["$","link","3",{"rel":"manifest","href":"/site.webmanifest","crossOrigin":"$undefined"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}],["$","link","5",{"rel":"icon","href":"/icon.svg?35be8e76be1c3618","type":"image/svg+xml","sizes":"any"}],["$","link","6",{"rel":"apple-touch-icon","href":"/apple-icon.png?5334a64f42000bb0","type":"image/png","sizes":"180x180"}]]
7:null
27:I[51,["116","static/chunks/c556396d-49361b2e780d113c.js","413","static/chunks/7a1bdfe6-8f7609c25899d936.js","994","static/chunks/c4aeae87-2a85323a0275cbf9.js","786","static/chunks/1b3e99d6-50521588821d44ca.js","845","static/chunks/845-a0203995fac91684.js","57","static/chunks/57-3951d65188499c8f.js","826","static/chunks/826-c44bffd752ec02cd.js","971","static/chunks/app/articles/%5B%5B...params%5D%5D/page-8625a0107f5ea4bf.js"],"ArticleImage"]
1f:["$","$L27","img-0",{"src":"/articles/asset/contents/20190225-an-infinite-loop-caused-by-updating-a-Map-during-iteration/loop-that-never-ends.png","imageSize":{"height":203,"width":823},"imageProps":{"src":"./loop-that-never-ends.png","alt":"Loop that never ends"}}]
21:["$","$L27","img-0",{"src":"/articles/asset/contents/20190225-an-infinite-loop-caused-by-updating-a-Map-during-iteration/only-one-element.png","imageSize":{"height":70,"width":287},"imageProps":{"src":"./only-one-element.png","alt":"Only one element in the map"}}]
