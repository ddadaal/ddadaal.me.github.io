1:"$Sreact.fragment"
2:I[28979,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"ArticleFrontmatter"]
c:I[21753,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"ArticleSummarization"]
d:I[79817,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"Gallery"]
f:I[72053,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"ArticleImage"]
2d:I[23491,["/_next/static/chunks/2caa33a942c5f527.js","/_next/static/chunks/59983278a34fd25c.js"],"OutletBoundary"]
2e:"$Sreact.suspense"
34:I[14620,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"ArticleToc"]
35:I[39182,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"RelatedArticles"]
36:I[42449,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"CommentPanelWithCurrentLanguage"]
:HL["/_next/static/chunks/44d2e091595b3eca.css","style"]
:HL["/_next/static/chunks/5e55d74f3211c796.css","style"]
:HL["/_next/static/chunks/b59bad6ea4f112f2.css","style"]
3:T13b6,
# 需求

虽然放假了，但是学校还有活要做，而且学校的活的代码仓库在学校内建的内网GitLab上，在外网需要VPN才能访问。但是，大家都知道连接VPN会让整个系统里的所有流量都走VPN，但是很多流量其实是不需要走VPN的，比如聊天、看视频网站等，VPN是有带宽限制的，把所有流量都走VPN会使得不需要走VPN的网络请求变慢。

![VPN方案下网络流量走向](vpn.png)

那么，有没有办法可以让需要访问内网资源的程序走VPN，不需要访问的程序不走VPN呢？

# 代理

> 代理服务器的基本行为就是接收客户端发送的请求后转发给其他服务器。代理不改变请求URI，並不会直接发送给前方持有资源的目标服务器。（[维基百科](https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8)）

简单的理解，代理服务器（proxy server）就是一个程序，它会将它收到的流量转发到其他服务器上。这个服务器有可能就是真正的目标服务器，也有可能是其他代理服务器。

当前大部分程序都支持设置代理服务器。如果一个程序设置了代理服务器，那么它发送的流量将**不会**直接发送到真正的目标服务器上的，而是发送到代理服务器，由代理服务器进行处理后发送到目标服务器上。

![代理服务器下网络流量走向](proxy.png)

# 如果有在内网的代理服务器……

如果我们有一台在内网的服务器，并且这个服务器可以从公网被访问，那么事情就很简单了：

我们将在这台服务器上开一个代理程序，这个代理程序就是简单地把收到的请求再转发到真正的目标服务器上。
然后在我们本机上，把需要内网资源的程序的代理服务器设置为这个服务器的地址。

这样设置之后，我们本地的需要内网资源的程序的流量将会被发送到这个内网的服务器上，内网服务器收到了，将会把请求转发到内网的服务器上。这样，我们的程序就可以访问内网的资源了。

![内网代理服务器方案下的网络流量走向](proxy-solution.png)

# 最终方案：把连接到VPN的服务器作为代理

那我们没有一台在内网的、可以被公网所访问的服务器怎么办呢？

这时，VPN的作用就出来了：连接了VPN的电脑的所有流量都会转发到内网去，那么这台电脑就可以被看作一个在内网的服务器。

我们可以在本机上起一个虚拟机或者docker容器，使这台虚拟机或者容器连接到VPN。同时，在这个虚拟机或者容器上起一个代理程序，工作就是简单地把收到的请求转发到真正的目标服务器上。

我们将需要走内网的程序的代理设置为这个虚拟机或容器，那么需要走内网的程序的流量将会首先发送到虚拟机或者容器。由于这个虚拟机或容器连接了VPN，那么由这个服务器发送的请求就会走隧道到内网，能够访问到我们需要的内网的服务。而没有设置这个虚拟机或容器为代理服务器的程序的流量将会不经过内网，直接连接到互联网服务。这样，我们的问题就解决了！

![VPN作为HTTP代理服务器的最终方案](vpn-as-proxy.png)

# 设置代理

最后一步，如何给一个程序设置代理呢？

这个需要根据程序而定，一般是如下的策略：

- 有的程序自己有设置代理的设置，需要看程序的帮助界面
  - 如`git`、`npm`等
- GUI程序一般会跟随系统代理设置
  - 去系统的设置菜单里寻找
- 一般命令行程序会使用`HTTP_PROXY`、`HTTPS_PROXY`、`http_proxy`和`https_proxy`环境变量的值作为代理服务器

在我们的原始需求中，我们使用的git。所以，我们可以在仓库中使用`git config http.proxy 代理地址`和`git config https.proxy 代理地址`来设置，使得这个仓库的pull和push操作都使用代理地址对应的代理服务器。我们只在仓库层面进行设置，只有这个仓库的操作会走这个代理服务器，其他仓库不会使用这个代理服务器。

![git使用代理访问内网仓库](git-proxy.png)

# 借助Docker的实现

根据这个原理，我编写了一套使用Docker容器来实现这个解决方案的脚本，可以在经过简单的设置之后，使用一条`docker-compose up`命令就可以简单地启动这样一个代理服务器，方便使用。由于使用了docker，所以Windows/*nix等支持docker的操作系统全部支持。

仓库地址为：https://github.com/ddadaal/vpn-as-http-proxy

感兴趣的同学可以进入仓库参考一下使用方法和实现原理。使用方法写在README文件中了。由于每个学校和组织的VPN地址、参数等都不相同，我也鼓励大家尝试找到连接自己学校的VPN的命令，并将命令模板通过PR方式贡献给本仓库，这样使得更多的同学能够更简单地使用这个解决方案。
0:{"buildId":"7dQlY40Cm-uDMIit5S5Jz","rsc":["$","$1","c",{"children":[["$","article",null,{"children":[["$","div",null,{"className":"bg-neutral px-4 py-8","children":["$","div",null,{"className":"max-w-7xl mx-auto min-h-[256px] flex justify-center text-center text-neutral-content","children":["$","div",null,{"className":"flex flex-col justify-center animate-slide-up","children":[["$","h1",null,{"className":"text-4xl my-2","children":"借助Docker，把VPN当作HTTP代理来用"}],["$","$L2",null,{"className":"justify-center","articleId":"vpn-as-http-proxy","info":{"content":"$3","title":"借助Docker，把VPN当作HTTP代理来用","date":"2021-02-08 10:13","id":"vpn-as-http-proxy","lang":"cn","tags":["project"],"wordCount":1450,"readingTime":7.25,"filePath":"contents/20210208-vpn-as-http-proxy/cn.md","summary":{"articleId":"vpn-as-http-proxy","lang":"cn","hash":"39836e374573e8b339ab4c804c048475300afe8a5683aa48c36fbe79741cf2f2","summaries":[{"metadata":{"summarizer":"azure-ai","model":"DeepSeek-R1"},"summaries":["学校内网资源需VPN访问，但全局VPN影响其他网络速度。文章建议通过代理服务器分离流量：在本地启动连接VPN的Docker容器或虚拟机作为代理，仅需内网访问的程序配置该代理。其他流量直连外网，避免带宽争用。具体可针对Git等工具设置代理，或通过环境变量配置。作者提供Docker脚本实现该方案，支持多系统，并开源代码库供自定义和扩展，方便不同VPN参数适配，从而优化网络访问效率。"],"startTime":"2025-02-14T13:38:20.434Z","endTime":"2025-02-14T13:38:55.383Z"},{"metadata":{"summarizer":"ollama","model":"deepseek-r1:8b"},"summaries":["这篇文章总结了一种方法，使用VPN作为HTTP代理来解决内网资源访问问题。主要内容包括：\n\n1. 当前直接连接VPN会导致所有流量走VPN，影响无需VPN的正常流量。\n2. 通过在本地启动一个虚拟机或容器连接VPN，并设置代理，使需要内网资源的程序通过该环境，而其他程序不使用 VPN。\n3. 使用Docker实现了一个简便的解决方案，仓库地址为https://github.com/ddadaal/vpn-as-http-proxy。"]}]}},"langVersions":["cn"]}]]}]}]}],"$L4"]}],["$L5","$L6","$L7","$L8","$L9","$La"],"$Lb"]}],"loading":null,"isPartial":false}
e:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z10:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z4:["$","div",null,{"className":"animate-slide-up","children":[["$","div",null,{"className":"max-w-7xl mx-auto p-4","children":["$","div",null,{"className":"flex flex-row space-x-4","children":[["$","div",null,{"className":"prose max-w-full lg:w-[75%]","children":[["$","$Lc",null,{"summaries":[{"metadata":{"summarizer":"azure-ai","model":"DeepSeek-R1"},"children":[["$","p","p-0",{"children":"学校内网资源需VPN访问，但全局VPN影响其他网络速度。文章建议通过代理服务器分离流量：在本地启动连接VPN的Docker容器或虚拟机作为代理，仅需内网访问的程序配置该代理。其他流量直连外网，避免带宽争用。具体可针对Git等工具设置代理，或通过环境变量配置。作者提供Docker脚本实现该方案，支持多系统，并开源代码库供自定义和扩展，方便不同VPN参数适配，从而优化网络访问效率。"}]]},{"metadata":{"summarizer":"ollama","model":"deepseek-r1:8b"},"children":[["$","p","p-0",{"children":"这篇文章总结了一种方法，使用VPN作为HTTP代理来解决内网资源访问问题。主要内容包括："}],"\n",["$","ol","ol-0",{"children":["\n",["$","li","li-0",{"children":"当前直接连接VPN会导致所有流量走VPN，影响无需VPN的正常流量。"}],"\n",["$","li","li-1",{"children":"通过在本地启动一个虚拟机或容器连接VPN，并设置代理，使需要内网资源的程序通过该环境，而其他程序不使用 VPN。"}],"\n",["$","li","li-2",{"children":["使用Docker实现了一个简便的解决方案，仓库地址为",["$","a","a-0",{"href":"https://github.com/ddadaal/vpn-as-http-proxy%E3%80%82","children":"https://github.com/ddadaal/vpn-as-http-proxy。"}]]}],"\n"]}]]}]}],["$","$Ld",null,{"withCaption":true,"id":"vpn-as-http-proxy","children":[["$","h1","h1-0",{"id":"需求","children":[["$","a","需求",{"href":"#需求","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$e","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"需求"]}],"\n",["$","p","p-0",{"children":"虽然放假了，但是学校还有活要做，而且学校的活的代码仓库在学校内建的内网GitLab上，在外网需要VPN才能访问。但是，大家都知道连接VPN会让整个系统里的所有流量都走VPN，但是很多流量其实是不需要走VPN的，比如聊天、看视频网站等，VPN是有带宽限制的，把所有流量都走VPN会使得不需要走VPN的网络请求变慢。"}],"\n",["$","p","p-1",{"children":["$","$Lf","img-0",{"src":"/articles/asset/contents/20210208-vpn-as-http-proxy/vpn.png","imageSize":{"height":608,"width":1484},"imageProps":{"src":"vpn.png","alt":"VPN方案下网络流量走向"}}]}],"\n",["$","p","p-2",{"children":"那么，有没有办法可以让需要访问内网资源的程序走VPN，不需要访问的程序不走VPN呢？"}],"\n",["$","h1","h1-1",{"id":"代理","children":[["$","a","代理",{"href":"#代理","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$10","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"代理"]}],"\n","$L11","\n","$L12","\n","$L13","\n","$L14","\n","$L15","\n","$L16","\n","$L17","\n","$L18","\n","$L19","\n","$L1a","\n","$L1b","\n","$L1c","\n","$L1d","\n","$L1e","\n","$L1f","\n","$L20","\n","$L21","\n","$L22","\n","$L23","\n","$L24","\n","$L25","\n","$L26","\n","$L27","\n","$L28","\n","$L29"]}]]}],"$L2a"]}]}],"$L2b","$L2c"]}]
5:["$","link","0",{"rel":"stylesheet","href":"/_next/static/chunks/44d2e091595b3eca.css","precedence":"next"}]
6:["$","link","1",{"rel":"stylesheet","href":"/_next/static/chunks/5e55d74f3211c796.css","precedence":"next"}]
7:["$","link","2",{"rel":"stylesheet","href":"/_next/static/chunks/b59bad6ea4f112f2.css","precedence":"next"}]
8:["$","script","script-0",{"src":"/_next/static/chunks/0a1497ca0a1721ad.js","async":true}]
9:["$","script","script-1",{"src":"/_next/static/chunks/4ec1bf7a32b70f87.js","async":true}]
a:["$","script","script-2",{"src":"/_next/static/chunks/276b22541034e0ea.js","async":true}]
b:["$","$L2d",null,{"children":["$","$2e",null,{"name":"Next.MetadataOutlet","children":"$@2f"}]}]
11:["$","blockquote","blockquote-0",{"children":["\n",["$","p","p-0",{"children":["代理服务器的基本行为就是接收客户端发送的请求后转发给其他服务器。代理不改变请求URI，並不会直接发送给前方持有资源的目标服务器。（",["$","a","a-0",{"href":"https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8","children":"维基百科"}],"）"]}],"\n"]}]
12:["$","p","p-3",{"children":"简单的理解，代理服务器（proxy server）就是一个程序，它会将它收到的流量转发到其他服务器上。这个服务器有可能就是真正的目标服务器，也有可能是其他代理服务器。"}]
13:["$","p","p-4",{"children":["当前大部分程序都支持设置代理服务器。如果一个程序设置了代理服务器，那么它发送的流量将",["$","strong","strong-0",{"children":"不会"}],"直接发送到真正的目标服务器上的，而是发送到代理服务器，由代理服务器进行处理后发送到目标服务器上。"]}]
14:["$","p","p-5",{"children":["$","$Lf","img-0",{"src":"/articles/asset/contents/20210208-vpn-as-http-proxy/proxy.png","imageSize":{"height":528,"width":1367},"imageProps":{"src":"proxy.png","alt":"代理服务器下网络流量走向"}}]}]
30:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z15:["$","h1","h1-2",{"id":"如果有在内网的代理服务器","children":[["$","a","如果有在内网的代理服务器",{"href":"#如果有在内网的代理服务器","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$30","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"如果有在内网的代理服务器……"]}]
16:["$","p","p-6",{"children":"如果我们有一台在内网的服务器，并且这个服务器可以从公网被访问，那么事情就很简单了："}]
17:["$","p","p-7",{"children":"我们将在这台服务器上开一个代理程序，这个代理程序就是简单地把收到的请求再转发到真正的目标服务器上。\n然后在我们本机上，把需要内网资源的程序的代理服务器设置为这个服务器的地址。"}]
18:["$","p","p-8",{"children":"这样设置之后，我们本地的需要内网资源的程序的流量将会被发送到这个内网的服务器上，内网服务器收到了，将会把请求转发到内网的服务器上。这样，我们的程序就可以访问内网的资源了。"}]
19:["$","p","p-9",{"children":["$","$Lf","img-0",{"src":"/articles/asset/contents/20210208-vpn-as-http-proxy/proxy-solution.png","imageSize":{"height":539,"width":1461},"imageProps":{"src":"proxy-solution.png","alt":"内网代理服务器方案下的网络流量走向"}}]}]
31:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z1a:["$","h1","h1-3",{"id":"最终方案把连接到vpn的服务器作为代理","children":[["$","a","最终方案把连接到vpn的服务器作为代理",{"href":"#最终方案把连接到vpn的服务器作为代理","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$31","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"最终方案：把连接到VPN的服务器作为代理"]}]
1b:["$","p","p-10",{"children":"那我们没有一台在内网的、可以被公网所访问的服务器怎么办呢？"}]
1c:["$","p","p-11",{"children":"这时，VPN的作用就出来了：连接了VPN的电脑的所有流量都会转发到内网去，那么这台电脑就可以被看作一个在内网的服务器。"}]
1d:["$","p","p-12",{"children":"我们可以在本机上起一个虚拟机或者docker容器，使这台虚拟机或者容器连接到VPN。同时，在这个虚拟机或者容器上起一个代理程序，工作就是简单地把收到的请求转发到真正的目标服务器上。"}]
1e:["$","p","p-13",{"children":"我们将需要走内网的程序的代理设置为这个虚拟机或容器，那么需要走内网的程序的流量将会首先发送到虚拟机或者容器。由于这个虚拟机或容器连接了VPN，那么由这个服务器发送的请求就会走隧道到内网，能够访问到我们需要的内网的服务。而没有设置这个虚拟机或容器为代理服务器的程序的流量将会不经过内网，直接连接到互联网服务。这样，我们的问题就解决了！"}]
1f:["$","p","p-14",{"children":["$","$Lf","img-0",{"src":"/articles/asset/contents/20210208-vpn-as-http-proxy/vpn-as-proxy.png","imageSize":{"height":545,"width":1608},"imageProps":{"src":"vpn-as-proxy.png","alt":"VPN作为HTTP代理服务器的最终方案"}}]}]
32:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z20:["$","h1","h1-4",{"id":"设置代理","children":[["$","a","设置代理",{"href":"#设置代理","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$32","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"设置代理"]}]
21:["$","p","p-15",{"children":"最后一步，如何给一个程序设置代理呢？"}]
22:["$","p","p-16",{"children":"这个需要根据程序而定，一般是如下的策略："}]
23:["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":["有的程序自己有设置代理的设置，需要看程序的帮助界面\n",["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":["如",["$","code","code-0",{"children":"git"}],"、",["$","code","code-1",{"children":"npm"}],"等"]}],"\n"]}],"\n"]}],"\n",["$","li","li-1",{"children":["GUI程序一般会跟随系统代理设置\n",["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":"去系统的设置菜单里寻找"}],"\n"]}],"\n"]}],"\n",["$","li","li-2",{"children":["一般命令行程序会使用",["$","code","code-0",{"children":"HTTP_PROXY"}],"、",["$","code","code-1",{"children":"HTTPS_PROXY"}],"、",["$","code","code-2",{"children":"http_proxy"}],"和",["$","code","code-3",{"children":"https_proxy"}],"环境变量的值作为代理服务器"]}],"\n"]}]
24:["$","p","p-17",{"children":["在我们的原始需求中，我们使用的git。所以，我们可以在仓库中使用",["$","code","code-0",{"children":"git config http.proxy 代理地址"}],"和",["$","code","code-1",{"children":"git config https.proxy 代理地址"}],"来设置，使得这个仓库的pull和push操作都使用代理地址对应的代理服务器。我们只在仓库层面进行设置，只有这个仓库的操作会走这个代理服务器，其他仓库不会使用这个代理服务器。"]}]
25:["$","p","p-18",{"children":["$","$Lf","img-0",{"src":"/articles/asset/contents/20210208-vpn-as-http-proxy/git-proxy.png","imageSize":{"height":274,"width":1013},"imageProps":{"src":"git-proxy.png","alt":"git使用代理访问内网仓库"}}]}]
33:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z26:["$","h1","h1-5",{"id":"借助docker的实现","children":[["$","a","借助docker的实现",{"href":"#借助docker的实现","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$33","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"借助Docker的实现"]}]
27:["$","p","p-19",{"children":["根据这个原理，我编写了一套使用Docker容器来实现这个解决方案的脚本，可以在经过简单的设置之后，使用一条",["$","code","code-0",{"children":"docker-compose up"}],"命令就可以简单地启动这样一个代理服务器，方便使用。由于使用了docker，所以Windows/*nix等支持docker的操作系统全部支持。"]}]
28:["$","p","p-20",{"children":["仓库地址为：",["$","a","a-0",{"href":"https://github.com/ddadaal/vpn-as-http-proxy","children":"https://github.com/ddadaal/vpn-as-http-proxy"}]]}]
29:["$","p","p-21",{"children":"感兴趣的同学可以进入仓库参考一下使用方法和实现原理。使用方法写在README文件中了。由于每个学校和组织的VPN地址、参数等都不相同，我也鼓励大家尝试找到连接自己学校的VPN的命令，并将命令模板通过PR方式贡献给本仓库，这样使得更多的同学能够更简单地使用这个解决方案。"}]
2a:["$","div",null,{"className":"hidden lg:block lg:w-[25%]","children":["$","$L34",null,{"toc":[{"depth":1,"value":"需求","id":"需求"},{"depth":1,"value":"代理","id":"代理"},{"depth":1,"value":"如果有在内网的代理服务器……","id":"如果有在内网的代理服务器"},{"depth":1,"value":"最终方案：把连接到VPN的服务器作为代理","id":"最终方案把连接到vpn的服务器作为代理"},{"depth":1,"value":"设置代理","id":"设置代理"},{"depth":1,"value":"借助Docker的实现","id":"借助docker的实现"}],"hasSummary":true}]}]
2b:["$","div",null,{"className":"max-w-7xl mx-auto p-4","children":["$","$L35",null,{"relatedArticles":[]}]}]
2c:["$","div",null,{"className":"max-w-7xl mx-auto p-4","children":["$","$L36",null,{"articleId":"vpn-as-http-proxy","articleTitle":"借助Docker，把VPN当作HTTP代理来用"}]}]
2f:null
