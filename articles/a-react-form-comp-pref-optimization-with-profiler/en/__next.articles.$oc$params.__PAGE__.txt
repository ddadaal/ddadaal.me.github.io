1:"$Sreact.fragment"
2:I[28979,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"ArticleFrontmatter"]
c:I[21753,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"ArticleSummarization"]
d:I[79817,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"Gallery"]
49:I[23491,["/_next/static/chunks/2caa33a942c5f527.js","/_next/static/chunks/59983278a34fd25c.js"],"OutletBoundary"]
4a:"$Sreact.suspense"
4c:I[72053,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"ArticleImage"]
70:I[14620,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"ArticleToc"]
71:I[39182,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"RelatedArticles"]
72:I[42449,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"CommentPanelWithCurrentLanguage"]
:HL["/_next/static/chunks/44d2e091595b3eca.css","style"]
:HL["/_next/static/chunks/5e55d74f3211c796.css","style"]
:HL["/_next/static/chunks/b59bad6ea4f112f2.css","style"]
3:T2a7c,
> Note: This code is from an internal project. Measurements apply to protect confidential information, but the problem and methods mentioned in the article are universal and not limited to specific projects.

# The Problem

I was working on a form that had very poor performance. To be specific, at every key stroke, the form responded pretty slowly. What's worse, the component and the whole website became completely unresponsive for **seconds** if several keys were stroked sequentially (like input a long number), which was, unfortunately, the normal use case for this field.

![bad performance, especially for the first input field](bad-pref.gif)

# Investigation

## Validations?

From the gif provided above, you may find some details that are worth taking notice of:

- The first field had the **worse performance**,
- The first field had some kinds of input validation (loading indicator when the first inputs were registered),
- The field below the first field had better performance than the first one, and it had no validation.

Hmm...It looks like **the validation** might be the cause.

However, the validation process was merely some format check, and a request which would be cancelled if next key stroke had come before it completed. It did increase the delay of input, but should not be so significant.

## Re-renders of the Whole Form?

### The Challenge of Forms in React

The **re-render of the whole form at every input** might be the problem as well.

React has been known as *not good at implementing forms* because of its famous **unidirectional data flow**.

![Source: https://gist.github.com/alexmingoia/4db967e5aeb31d84847c. See this page to get yourself familiarized if you haven't already.](unidirectiona-data-flow.png)

Unidirectional data flow simplifies the data flow and fits seeminglessly with the concept of React. However, since **each update to the state will trigger the component to re-render**, it might impact the performance of the app.

Form is one of such cases, because a form consists of multiple input fields, and **each input to any one of them** would update the state, and re-render the whole form and every other fields. Therefore, writing forms in React has always a challenge.

### Complicated Form

Looking at the code, the form was implemented in a very React way: the form contained all the fields, and handled every `onChange` event for each input fields.

![part of fields](fields.png)

The form was complicated with dozens of fields, several **sync/async and cross-field validations**, **dynamic placeholders** and some unnecessary **duplicate calculations** (which could be improved with constants and cache).

It seemed pretty evident that the **re-renders** and **the complicated calculations** during the render were the cause to the problem.

### No Easy Solutions

Having found the reason, what's left was to find a solution. However, the reason that form implementation is called a *challenge* in React is that it can not be solved easily. There are lots of React form library from the community (like [react-form](https://github.com/tannerlinsley/react-form), [formik](https://github.com/jaredpalmer/formik)) trying to solve the form as a whole by providing a complete solution to some common form challenges, including input management, async validations, and submission. They may be viable for many users and should be considered if you are having trouble building a form in your project, but I couldn't adopt them in this project because:

- hiding complexities usually means introducing other complexities
    - for example, when using the libraries, more problems are introduced, like **less flexibilities**, **less understandable code**, **interop with UI libraries** and **the cost of learning and adopting a new set of APIs**.
- The code is involved with several internal concepts and conventions, which I am not familiar enough. As a result, I don't have the confidence to rewrite the logic correctly in a short time;
- introducing a new library into this project is hard, for it is a internal project that has over 200K lines of TypeScript code, hundreds of authors and users, so the review for this project is strict.

## Maybe Not Re-renders?

Besides, my experiences told me that it was possibly not the **re-renders** that was to blame, since the updates of the form should not be so costly that would result in such a significant delay.

I have encountered situations where even **a whole page** re-rendered at every interaction, but React and modern JavaScript engines is more than capable to drive it smoothly without even a stutter. This form had several fields to be re-rendered at every input, but when taking the whole page into consideration, the number of re-renders inside this page was negligible.

## Profiling, Profiling, Profiling

After wasting days on *brainstorming* the source of problem, I decided to diagnose the issue in a scientific way -- **profiling**.

[React's official devtool of Chrome](https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi) has a built-in profiling tool. By recoding a sequence of user interactions, profiler can provide performance metrics on each commit during the record, like what components are re-rendered, how many time they take to re-render, with which the developer can locate the components that have biggest impact to the performance, and optimize them accordingly.

Start the recoding, repeat the operations of the gif above, and I had the following result:

![Ranked chart](profiling.png)
![Flamegraph chart](profiling-2.png)

The first chart (ranked chart) showed the time to re-render for each component that had re-rendered on this commit. The second chart (flamegraph chart) shoed the re-rendered components **hierarchically**: that is, the time to render the component itself, and each of its children.

As you could see, a **Dropdown** component took a significant time to re-render. In fact, all the graphes on all the last 10 commits had led me to the same component. By following the hierarchy provided by the flamegraph, it didn't take long to locate the component, which was the dropdown **on the right side** of the first field with slow responsiveness, and implemented as follows:

![The dropdown](dropdown.png)

It looked like a normal dropdown with the exception of a **duplicate calculations**: generating an options array at every render. **Providing different instances at every render** is a common source of performance problem in React, because it signals React that the props have changed and a re-render is required, even the objects between renders are **deep equal**. The solution is straightforward: instead of generating a different instance each time, provide a constant or a class field that only changes when it is modified.

But unfortunately, in this case, after replacing the call to `this.generateDropdown` to a constant, the problem persisted.

## Large Quantity of Options

The source of options of the dropdown came from a network request that was initiated when the page loaded. Another clue that I found during investigation was that when network errors happened, the input became very **responsive**, at which time **the dropdown had no option**. And after several intentional experiments, I found the correspondance between options and performance to be true (no option -> good performance, had options -> bad performace).

I was just a maintainer of the component, not the original authors, so I didn't take notice of the contents of dropdown during my previous investigation. Now, according to the correspondance, I checked out the options of the dropdown, only to find it had over 400 options.

![>400 options](large-number-of-options.png)

Rendering **so many options** at each render would definitely impact performance pretty hard, unless the component had thought of it and selectively re-rendered only the changed part.

This project used [React Wrapper of Semantic-UI](https://react.semantic-ui.com/) which was a famous component library and open source. By diving into the source code, I found that the dropdown did re-render every options every time without any memoing or caching.

https://github.com/Semantic-Org/Semantic-UI-React/blob/master/src/modules/Dropdown/Dropdown.js#L1275

```jsx
// omitted
renderOptions = () => {
  // omitted
  return _.map(options, (opt, i) =>
    DropdownItem.create({
      active: isActive(opt.value),
      onClick: this.handleItemClick,
      selected: selectedIndex === i,
      ...opt,
      key: getKeyOrValue(opt.key, opt.value),
      // Needed for handling click events on disabled items
      style: { ...opt.style, pointerEvents: 'all' },
    }),
  )
}

renderMenu = () => {
  // omitted
  return (
    <DropdownMenu {...ariaOptions} direction={direction} open={open}>
      {DropdownHeader.create(header, { autoGenerateKey: false })}
      {this.renderOptions()}
    </DropdownMenu>
  )
}

render() {
  // omitted
  return (
    // omitted
    {this.renderMenu()}
    // omitted
  )
}
```

# Solution

In this case, the options didn't update anymore after the request had completed. Therefore, there was no need to update and re-render the options every time the component had changed.

To stop the re-render, I extracted the dropdown out into a separate component, passed the options as a prop, and most importantly, made it a `PureComponent` which only re-rendered itself when the props had changed.

The dropdown was used in a **uncontrolled** way -- that is, not managing its `value` by the DOM instead of as a state of React component by not passing value to the `input` DOM field. I had to admit it was not the React way, but here, not passing value to it meant that the component would **never update**, which was exactly what I wanted.

![Optimized code](optimized-code.png)

The optimization worked like a charm: the render time of the whole form for each input had reduced from **~400ms** to **~22ms**, and there was no any unresponsiveness and delay at every key stroke.

![After](after.png)

# Verdict

Form is React is indeed a challenge. Without careful designing and implementation, problems may occur at any time, anywhere.

The issue here was ultimately the re-renders, but not the form I originally thought of, but the dropdown with large number of options. It is important to app performance to **understand React update strategy** and **control the component update** with lifecycle functions, property hook usage, memoing and caching, especially when the the number of component to render is too large.

The **profiler** was the key to finding the component to blame by providing the data of time to re-render for each component. Therefore, when a performance issue is detected, stop wasting guessing which compoenent causes it, and let profiler take you straight to it.
0:{"buildId":"7dQlY40Cm-uDMIit5S5Jz","rsc":["$","$1","c",{"children":[["$","article",null,{"children":[["$","div",null,{"className":"bg-neutral px-4 py-8","children":["$","div",null,{"className":"max-w-7xl mx-auto min-h-[256px] flex justify-center text-center text-neutral-content","children":["$","div",null,{"className":"flex flex-col justify-center animate-slide-up","children":[["$","h1",null,{"className":"text-4xl my-2","children":"A React Form Component Performance Optimization with Profiler"}],["$","$L2",null,{"className":"justify-center","articleId":"a-react-form-comp-pref-optimization-with-profiler","info":{"content":"$3","title":"A React Form Component Performance Optimization with Profiler","date":"2019-10-13 11:14","id":"a-react-form-comp-pref-optimization-with-profiler","lang":"en","tags":["problem-investigation","web-frontend","React"],"wordCount":1628,"readingTime":8.14,"filePath":"contents/20191012-a-react-form-comp-pref-optimization-with-profiler/en.md","summary":{"articleId":"a-react-form-comp-pref-optimization-with-profiler","lang":"en","hash":"58f148902a4372123c27b1aba8286d8b97e1fafda757d397bf96a3fada5e2e2e","summaries":[{"metadata":{"summarizer":"azure-ai","model":"DeepSeek-R1"},"summaries":["A developer addressed severe performance issues in a React form, where input lagged significantly, especially when entering sequential keystrokes. Initially suspecting validations or form-wide re-renders, profiling with React DevTools revealed a Dropdown component (Semantic-UI) rendering 400+ options as the culprit. Each keystroke triggered re-renders, generating new option instances. The uncontrolled Dropdown was extracted into a PureComponent, memoizing options to prevent redundant renders. This reduced per-input render time from ~400ms to ~22ms, eliminating lag. The solution highlighted the importance of profiling to identify bottlenecks, controlled re-renders via memoization, and optimizing third-party components in large-scale React applications to maintain responsiveness."],"startTime":"2025-02-14T13:31:36.293Z","endTime":"2025-02-14T13:31:59.423Z"},{"metadata":{"summarizer":"ollama","model":"deepseek-r1:8b"},"summaries":["为了解决下拉框组件性能问题，我们需要分析其导致因素，并实施必要的优化。以下是详细的步骤解释：\n\n1. **识别性能问题**：\n   - 使用 React Profiler 工具，发现下拉框组件在输入时花费大量时间。\n   \n2. **分析组件行为**：\n   - 检查下拉框组件代码，发现每次渲染都生成包含400多个选项的数组。\n   - 发现网络请求完成后，数据不会再变化，但组件仍频繁重复渲染。\n\n3. **实施优化措施**：\n   - **拆分组件**：将下拉框组件单独抽出来，以便独立控制和优化。\n   - **使用PureComponent**：确保子组件只在 props 变化时重新渲染。\n   - **缓存选项数据**：避免每次渲染都生成新数组，而是使用一个常量或缓存变量。\n   - **控制组件状态**：通过 React 组件管理状态，减少不必要的 DOM 更新。\n\n4. **验证和测试**：\n   - 测试优化后的组件，确认性能提升。\n   - 确保在网络请求失败时，下拉框仍能正常显示（空白或错误提示）。\n\n5. **部署改进代码**：\n   - 修改下拉框组件，使其接受外部的选项数据，并仅在必要时渲染。\n   - 确保 `generateDropdown` 函数被替换为一个不再生成新数组的优化版本。\n\n通过以上步骤，我们能够有效地解决下拉框的性能问题，提升应用整体运行速度和用户体验。"]}]}},"langVersions":["en"]}]]}]}]}],"$L4"]}],["$L5","$L6","$L7","$L8","$L9","$La"],"$Lb"]}],"loading":null,"isPartial":false}
e:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z4:["$","div",null,{"className":"animate-slide-up","children":[["$","div",null,{"className":"max-w-7xl mx-auto p-4","children":["$","div",null,{"className":"flex flex-row space-x-4","children":[["$","div",null,{"className":"prose max-w-full lg:w-[75%]","children":[["$","$Lc",null,{"summaries":[{"metadata":{"summarizer":"azure-ai","model":"DeepSeek-R1"},"children":[["$","p","p-0",{"children":"A developer addressed severe performance issues in a React form, where input lagged significantly, especially when entering sequential keystrokes. Initially suspecting validations or form-wide re-renders, profiling with React DevTools revealed a Dropdown component (Semantic-UI) rendering 400+ options as the culprit. Each keystroke triggered re-renders, generating new option instances. The uncontrolled Dropdown was extracted into a PureComponent, memoizing options to prevent redundant renders. This reduced per-input render time from ~400ms to ~22ms, eliminating lag. The solution highlighted the importance of profiling to identify bottlenecks, controlled re-renders via memoization, and optimizing third-party components in large-scale React applications to maintain responsiveness."}]]},{"metadata":{"summarizer":"ollama","model":"deepseek-r1:8b"},"children":[["$","p","p-0",{"children":"为了解决下拉框组件性能问题，我们需要分析其导致因素，并实施必要的优化。以下是详细的步骤解释："}],"\n",["$","ol","ol-0",{"children":["\n",["$","li","li-0",{"children":["\n",["$","p","p-0",{"children":[["$","strong","strong-0",{"children":"识别性能问题"}],"："]}],"\n",["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":"使用 React Profiler 工具，发现下拉框组件在输入时花费大量时间。"}],"\n"]}],"\n"]}],"\n",["$","li","li-1",{"children":["\n",["$","p","p-0",{"children":[["$","strong","strong-0",{"children":"分析组件行为"}],"："]}],"\n",["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":"检查下拉框组件代码，发现每次渲染都生成包含400多个选项的数组。"}],"\n",["$","li","li-1",{"children":"发现网络请求完成后，数据不会再变化，但组件仍频繁重复渲染。"}],"\n"]}],"\n"]}],"\n",["$","li","li-2",{"children":["\n",["$","p","p-0",{"children":[["$","strong","strong-0",{"children":"实施优化措施"}],"："]}],"\n",["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":[["$","strong","strong-0",{"children":"拆分组件"}],"：将下拉框组件单独抽出来，以便独立控制和优化。"]}],"\n",["$","li","li-1",{"children":[["$","strong","strong-0",{"children":"使用PureComponent"}],"：确保子组件只在 props 变化时重新渲染。"]}],"\n",["$","li","li-2",{"children":[["$","strong","strong-0",{"children":"缓存选项数据"}],"：避免每次渲染都生成新数组，而是使用一个常量或缓存变量。"]}],"\n",["$","li","li-3",{"children":[["$","strong","strong-0",{"children":"控制组件状态"}],"：通过 React 组件管理状态，减少不必要的 DOM 更新。"]}],"\n"]}],"\n"]}],"\n",["$","li","li-3",{"children":["\n",["$","p","p-0",{"children":[["$","strong","strong-0",{"children":"验证和测试"}],"："]}],"\n",["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":"测试优化后的组件，确认性能提升。"}],"\n",["$","li","li-1",{"children":"确保在网络请求失败时，下拉框仍能正常显示（空白或错误提示）。"}],"\n"]}],"\n"]}],"\n",["$","li","li-4",{"children":["\n",["$","p","p-0",{"children":[["$","strong","strong-0",{"children":"部署改进代码"}],"："]}],"\n",["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":"修改下拉框组件，使其接受外部的选项数据，并仅在必要时渲染。"}],"\n",["$","li","li-1",{"children":["确保 ",["$","code","code-0",{"children":"generateDropdown"}]," 函数被替换为一个不再生成新数组的优化版本。"]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","p","p-1",{"children":"通过以上步骤，我们能够有效地解决下拉框的性能问题，提升应用整体运行速度和用户体验。"}]]}]}],["$","$Ld",null,{"withCaption":true,"id":"a-react-form-comp-pref-optimization-with-profiler","children":[["$","blockquote","blockquote-0",{"children":["\n",["$","p","p-0",{"children":"Note: This code is from an internal project. Measurements apply to protect confidential information, but the problem and methods mentioned in the article are universal and not limited to specific projects."}],"\n"]}],"\n",["$","h1","h1-0",{"id":"the-problem","children":[["$","a","the-problem",{"href":"#the-problem","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$e","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"The Problem"]}],"\n","$Lf","\n","$L10","\n","$L11","\n","$L12","\n","$L13","\n","$L14","\n","$L15","\n","$L16","\n","$L17","\n","$L18","\n","$L19","\n","$L1a","\n","$L1b","\n","$L1c","\n","$L1d","\n","$L1e","\n","$L1f","\n","$L20","\n","$L21","\n","$L22","\n","$L23","\n","$L24","\n","$L25","\n","$L26","\n","$L27","\n","$L28","\n","$L29","\n","$L2a","\n","$L2b","\n","$L2c","\n","$L2d","\n","$L2e","\n","$L2f","\n","$L30","\n","$L31","\n","$L32","\n","$L33","\n","$L34","\n","$L35","\n","$L36","\n","$L37","\n","$L38","\n","$L39","\n","$L3a","\n","$L3b","\n","$L3c","\n","$L3d","\n","$L3e","\n","$L3f","\n","$L40","\n","$L41","\n","$L42","\n","$L43","\n","$L44","\n","$L45"]}]]}],"$L46"]}]}],"$L47","$L48"]}]
5:["$","link","0",{"rel":"stylesheet","href":"/_next/static/chunks/44d2e091595b3eca.css","precedence":"next"}]
6:["$","link","1",{"rel":"stylesheet","href":"/_next/static/chunks/5e55d74f3211c796.css","precedence":"next"}]
7:["$","link","2",{"rel":"stylesheet","href":"/_next/static/chunks/b59bad6ea4f112f2.css","precedence":"next"}]
8:["$","script","script-0",{"src":"/_next/static/chunks/0a1497ca0a1721ad.js","async":true}]
9:["$","script","script-1",{"src":"/_next/static/chunks/4ec1bf7a32b70f87.js","async":true}]
a:["$","script","script-2",{"src":"/_next/static/chunks/276b22541034e0ea.js","async":true}]
b:["$","$L49",null,{"children":["$","$4a",null,{"name":"Next.MetadataOutlet","children":"$@4b"}]}]
f:["$","p","p-0",{"children":["I was working on a form that had very poor performance. To be specific, at every key stroke, the form responded pretty slowly. What's worse, the component and the whole website became completely unresponsive for ",["$","strong","strong-0",{"children":"seconds"}]," if several keys were stroked sequentially (like input a long number), which was, unfortunately, the normal use case for this field."]}]
10:["$","p","p-1",{"children":["$","$L4c","img-0",{"src":"/articles/asset/contents/20191012-a-react-form-comp-pref-optimization-with-profiler/bad-pref.gif","imageSize":{"height":123,"width":534},"imageProps":{"src":"bad-pref.gif","alt":"bad performance, especially for the first input field"}}]}]
4d:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z11:["$","h1","h1-1",{"id":"investigation","children":[["$","a","investigation",{"href":"#investigation","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$4d","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"Investigation"]}]
4e:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z12:["$","h2","h2-0",{"id":"validations","children":[["$","a","validations",{"href":"#validations","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$4e","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"Validations?"]}]
13:["$","p","p-2",{"children":"From the gif provided above, you may find some details that are worth taking notice of:"}]
14:["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":["The first field had the ",["$","strong","strong-0",{"children":"worse performance"}],","]}],"\n",["$","li","li-1",{"children":"The first field had some kinds of input validation (loading indicator when the first inputs were registered),"}],"\n",["$","li","li-2",{"children":"The field below the first field had better performance than the first one, and it had no validation."}],"\n"]}]
15:["$","p","p-3",{"children":["Hmm...It looks like ",["$","strong","strong-0",{"children":"the validation"}]," might be the cause."]}]
16:["$","p","p-4",{"children":"However, the validation process was merely some format check, and a request which would be cancelled if next key stroke had come before it completed. It did increase the delay of input, but should not be so significant."}]
4f:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z17:["$","h2","h2-1",{"id":"re-renders-of-the-whole-form","children":[["$","a","re-renders-of-the-whole-form",{"href":"#re-renders-of-the-whole-form","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$4f","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"Re-renders of the Whole Form?"]}]
50:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z18:["$","h3","h3-0",{"id":"the-challenge-of-forms-in-react","children":[["$","a","the-challenge-of-forms-in-react",{"href":"#the-challenge-of-forms-in-react","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$50","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"The Challenge of Forms in React"]}]
19:["$","p","p-5",{"children":["The ",["$","strong","strong-0",{"children":"re-render of the whole form at every input"}]," might be the problem as well."]}]
1a:["$","p","p-6",{"children":["React has been known as ",["$","em","em-0",{"children":"not good at implementing forms"}]," because of its famous ",["$","strong","strong-0",{"children":"unidirectional data flow"}],"."]}]
1b:["$","p","p-7",{"children":["$","$L4c","img-0",{"src":"/articles/asset/contents/20191012-a-react-form-comp-pref-optimization-with-profiler/unidirectiona-data-flow.png","imageSize":{"height":720,"width":960},"imageProps":{"src":"unidirectiona-data-flow.png","alt":"Source: https://gist.github.com/alexmingoia/4db967e5aeb31d84847c. See this page to get yourself familiarized if you haven't already."}}]}]
1c:["$","p","p-8",{"children":["Unidirectional data flow simplifies the data flow and fits seeminglessly with the concept of React. However, since ",["$","strong","strong-0",{"children":"each update to the state will trigger the component to re-render"}],", it might impact the performance of the app."]}]
1d:["$","p","p-9",{"children":["Form is one of such cases, because a form consists of multiple input fields, and ",["$","strong","strong-0",{"children":"each input to any one of them"}]," would update the state, and re-render the whole form and every other fields. Therefore, writing forms in React has always a challenge."]}]
51:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z1e:["$","h3","h3-1",{"id":"complicated-form","children":[["$","a","complicated-form",{"href":"#complicated-form","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$51","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"Complicated Form"]}]
1f:["$","p","p-10",{"children":["Looking at the code, the form was implemented in a very React way: the form contained all the fields, and handled every ",["$","code","code-0",{"children":"onChange"}]," event for each input fields."]}]
20:["$","p","p-11",{"children":["$","$L4c","img-0",{"src":"/articles/asset/contents/20191012-a-react-form-comp-pref-optimization-with-profiler/fields.png","imageSize":{"height":248,"width":726},"imageProps":{"src":"fields.png","alt":"part of fields"}}]}]
21:["$","p","p-12",{"children":["The form was complicated with dozens of fields, several ",["$","strong","strong-0",{"children":"sync/async and cross-field validations"}],", ",["$","strong","strong-1",{"children":"dynamic placeholders"}]," and some unnecessary ",["$","strong","strong-2",{"children":"duplicate calculations"}]," (which could be improved with constants and cache)."]}]
22:["$","p","p-13",{"children":["It seemed pretty evident that the ",["$","strong","strong-0",{"children":"re-renders"}]," and ",["$","strong","strong-1",{"children":"the complicated calculations"}]," during the render were the cause to the problem."]}]
52:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z23:["$","h3","h3-2",{"id":"no-easy-solutions","children":[["$","a","no-easy-solutions",{"href":"#no-easy-solutions","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$52","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"No Easy Solutions"]}]
24:["$","p","p-14",{"children":["Having found the reason, what's left was to find a solution. However, the reason that form implementation is called a ",["$","em","em-0",{"children":"challenge"}]," in React is that it can not be solved easily. There are lots of React form library from the community (like ",["$","a","a-0",{"href":"https://github.com/tannerlinsley/react-form","children":"react-form"}],", ",["$","a","a-1",{"href":"https://github.com/jaredpalmer/formik","children":"formik"}],") trying to solve the form as a whole by providing a complete solution to some common form challenges, including input management, async validations, and submission. They may be viable for many users and should be considered if you are having trouble building a form in your project, but I couldn't adopt them in this project because:"]}]
25:["$","ul","ul-1",{"children":["\n",["$","li","li-0",{"children":["hiding complexities usually means introducing other complexities\n",["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":["for example, when using the libraries, more problems are introduced, like ",["$","strong","strong-0",{"children":"less flexibilities"}],", ",["$","strong","strong-1",{"children":"less understandable code"}],", ",["$","strong","strong-2",{"children":"interop with UI libraries"}]," and ",["$","strong","strong-3",{"children":"the cost of learning and adopting a new set of APIs"}],"."]}],"\n"]}],"\n"]}],"\n",["$","li","li-1",{"children":"The code is involved with several internal concepts and conventions, which I am not familiar enough. As a result, I don't have the confidence to rewrite the logic correctly in a short time;"}],"\n",["$","li","li-2",{"children":"introducing a new library into this project is hard, for it is a internal project that has over 200K lines of TypeScript code, hundreds of authors and users, so the review for this project is strict."}],"\n"]}]
53:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z26:["$","h2","h2-2",{"id":"maybe-not-re-renders","children":[["$","a","maybe-not-re-renders",{"href":"#maybe-not-re-renders","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$53","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"Maybe Not Re-renders?"]}]
27:["$","p","p-15",{"children":["Besides, my experiences told me that it was possibly not the ",["$","strong","strong-0",{"children":"re-renders"}]," that was to blame, since the updates of the form should not be so costly that would result in such a significant delay."]}]
28:["$","p","p-16",{"children":["I have encountered situations where even ",["$","strong","strong-0",{"children":"a whole page"}]," re-rendered at every interaction, but React and modern JavaScript engines is more than capable to drive it smoothly without even a stutter. This form had several fields to be re-rendered at every input, but when taking the whole page into consideration, the number of re-renders inside this page was negligible."]}]
54:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z29:["$","h2","h2-3",{"id":"profiling-profiling-profiling","children":[["$","a","profiling-profiling-profiling",{"href":"#profiling-profiling-profiling","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$54","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"Profiling, Profiling, Profiling"]}]
2a:["$","p","p-17",{"children":["After wasting days on ",["$","em","em-0",{"children":"brainstorming"}]," the source of problem, I decided to diagnose the issue in a scientific way -- ",["$","strong","strong-0",{"children":"profiling"}],"."]}]
2b:["$","p","p-18",{"children":[["$","a","a-0",{"href":"https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi","children":"React's official devtool of Chrome"}]," has a built-in profiling tool. By recoding a sequence of user interactions, profiler can provide performance metrics on each commit during the record, like what components are re-rendered, how many time they take to re-render, with which the developer can locate the components that have biggest impact to the performance, and optimize them accordingly."]}]
2c:["$","p","p-19",{"children":"Start the recoding, repeat the operations of the gif above, and I had the following result:"}]
2d:["$","p","p-20",{"children":[["$","$L4c","img-0",{"src":"/articles/asset/contents/20191012-a-react-form-comp-pref-optimization-with-profiler/profiling.png","imageSize":{"height":141,"width":780},"imageProps":{"src":"profiling.png","alt":"Ranked chart"}}],"\n",["$","$L4c","img-1",{"src":"/articles/asset/contents/20191012-a-react-form-comp-pref-optimization-with-profiler/profiling-2.png","imageSize":{"height":228,"width":414},"imageProps":{"src":"profiling-2.png","alt":"Flamegraph chart"}}]]}]
2e:["$","p","p-21",{"children":["The first chart (ranked chart) showed the time to re-render for each component that had re-rendered on this commit. The second chart (flamegraph chart) shoed the re-rendered components ",["$","strong","strong-0",{"children":"hierarchically"}],": that is, the time to render the component itself, and each of its children."]}]
2f:["$","p","p-22",{"children":["As you could see, a ",["$","strong","strong-0",{"children":"Dropdown"}]," component took a significant time to re-render. In fact, all the graphes on all the last 10 commits had led me to the same component. By following the hierarchy provided by the flamegraph, it didn't take long to locate the component, which was the dropdown ",["$","strong","strong-1",{"children":"on the right side"}]," of the first field with slow responsiveness, and implemented as follows:"]}]
30:["$","p","p-23",{"children":["$","$L4c","img-0",{"src":"/articles/asset/contents/20191012-a-react-form-comp-pref-optimization-with-profiler/dropdown.png","imageSize":{"height":174,"width":476},"imageProps":{"src":"dropdown.png","alt":"The dropdown"}}]}]
31:["$","p","p-24",{"children":["It looked like a normal dropdown with the exception of a ",["$","strong","strong-0",{"children":"duplicate calculations"}],": generating an options array at every render. ",["$","strong","strong-1",{"children":"Providing different instances at every render"}]," is a common source of performance problem in React, because it signals React that the props have changed and a re-render is required, even the objects between renders are ",["$","strong","strong-2",{"children":"deep equal"}],". The solution is straightforward: instead of generating a different instance each time, provide a constant or a class field that only changes when it is modified."]}]
32:["$","p","p-25",{"children":["But unfortunately, in this case, after replacing the call to ",["$","code","code-0",{"children":"this.generateDropdown"}]," to a constant, the problem persisted."]}]
55:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z33:["$","h2","h2-4",{"id":"large-quantity-of-options","children":[["$","a","large-quantity-of-options",{"href":"#large-quantity-of-options","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$55","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"Large Quantity of Options"]}]
34:["$","p","p-26",{"children":["The source of options of the dropdown came from a network request that was initiated when the page loaded. Another clue that I found during investigation was that when network errors happened, the input became very ",["$","strong","strong-0",{"children":"responsive"}],", at which time ",["$","strong","strong-1",{"children":"the dropdown had no option"}],". And after several intentional experiments, I found the correspondance between options and performance to be true (no option -> good performance, had options -> bad performace)."]}]
35:["$","p","p-27",{"children":"I was just a maintainer of the component, not the original authors, so I didn't take notice of the contents of dropdown during my previous investigation. Now, according to the correspondance, I checked out the options of the dropdown, only to find it had over 400 options."}]
36:["$","p","p-28",{"children":["$","$L4c","img-0",{"src":"/articles/asset/contents/20191012-a-react-form-comp-pref-optimization-with-profiler/large-number-of-options.png","imageSize":{"height":109,"width":123},"imageProps":{"src":"large-number-of-options.png","alt":">400 options"}}]}]
37:["$","p","p-29",{"children":["Rendering ",["$","strong","strong-0",{"children":"so many options"}]," at each render would definitely impact performance pretty hard, unless the component had thought of it and selectively re-rendered only the changed part."]}]
38:["$","p","p-30",{"children":["This project used ",["$","a","a-0",{"href":"https://react.semantic-ui.com/","children":"React Wrapper of Semantic-UI"}]," which was a famous component library and open source. By diving into the source code, I found that the dropdown did re-render every options every time without any memoing or caching."]}]
39:["$","p","p-31",{"children":["$","a","a-0",{"href":"https://github.com/Semantic-Org/Semantic-UI-React/blob/master/src/modules/Dropdown/Dropdown.js#L1275","children":"https://github.com/Semantic-Org/Semantic-UI-React/blob/master/src/modules/Dropdown/Dropdown.js#L1275"}]}]
3a:["$","figure","figure-0",{"data-rehype-pretty-code-figure":"","children":["$","pre","pre-0",{"style":{"backgroundColor":"#282c34","color":"#abb2bf"},"tabIndex":0,"data-language":"jsx","data-theme":"one-dark-pro","children":["$","code","code-0",{"data-language":"jsx","data-theme":"one-dark-pro","style":{"display":"grid"},"children":[["$","span","span-0",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"// omitted"}]}],"\n",["$","span","span-1",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#61AFEF"},"children":"renderOptions"}],["$","span","span-1",{"style":{"color":"#56B6C2"},"children":" ="}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":" () "}],["$","span","span-3",{"style":{"color":"#C678DD"},"children":"=>"}],["$","span","span-4",{"style":{"color":"#ABB2BF"},"children":" {"}]]}],"\n",["$","span","span-2",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"  // omitted"}]}],"\n",["$","span","span-3",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"  return"}],["$","span","span-1",{"style":{"color":"#E5C07B"},"children":" _"}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-3",{"style":{"color":"#61AFEF"},"children":"map"}],["$","span","span-4",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-5",{"style":{"color":"#E06C75"},"children":"options"}],["$","span","span-6",{"style":{"color":"#ABB2BF"},"children":", ("}],["$","span","span-7",{"style":{"color":"#E06C75","fontStyle":"italic"},"children":"opt"}],["$","span","span-8",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-9",{"style":{"color":"#E06C75","fontStyle":"italic"},"children":"i"}],["$","span","span-10",{"style":{"color":"#ABB2BF"},"children":") "}],["$","span","span-11",{"style":{"color":"#C678DD"},"children":"=>"}]]}],"\n",["$","span","span-4",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E5C07B"},"children":"    DropdownItem"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-2",{"style":{"color":"#61AFEF"},"children":"create"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"({"}]]}],"\n",["$","span","span-5",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E06C75"},"children":"      active"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-2",{"style":{"color":"#61AFEF"},"children":"isActive"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-4",{"style":{"color":"#E5C07B"},"children":"opt"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-6",{"style":{"color":"#E06C75"},"children":"value"}],["$","span","span-7",{"style":{"color":"#ABB2BF"},"children":"),"}]]}],"\n",["$","span","span-6",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E06C75"},"children":"      onClick"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-2",{"style":{"color":"#E5C07B"},"children":"this"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-4",{"style":{"color":"#E06C75"},"children":"handleItemClick"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":","}]]}],"\n",["$","span","span-7",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E06C75"},"children":"      selected"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-2",{"style":{"color":"#E06C75"},"children":"selectedIndex"}],["$","span","span-3",{"style":{"color":"#56B6C2"},"children":" ==="}],["$","span","span-4",{"style":{"color":"#E06C75"},"children":" i"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":","}]]}],"\n",["$","span","span-8",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"      ..."}],["$","span","span-1",{"style":{"color":"#E06C75"},"children":"opt"}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":","}]]}],"\n",["$","span","span-9",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E06C75"},"children":"      key"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-2",{"style":{"color":"#61AFEF"},"children":"getKeyOrValue"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-4",{"style":{"color":"#E5C07B"},"children":"opt"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-6",{"style":{"color":"#E06C75"},"children":"key"}],["$","span","span-7",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-8",{"style":{"color":"#E5C07B"},"children":"opt"}],["$","span","span-9",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-10",{"style":{"color":"#E06C75"},"children":"value"}],["$","span","span-11",{"style":{"color":"#ABB2BF"},"children":"),"}]]}],"\n","$L56","\n","$L57","\n","$L58","\n","$L59","\n","$L5a","\n","$L5b","\n","$L5c","\n","$L5d","\n","$L5e","\n","$L5f","\n","$L60","\n","$L61","\n","$L62","\n","$L63","\n","$L64","\n","$L65","\n","$L66","\n","$L67","\n","$L68","\n","$L69","\n","$L6a","\n","$L6b","\n","$L6c","\n","$L6d"]}]}]}]
6e:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z3b:["$","h1","h1-2",{"id":"solution","children":[["$","a","solution",{"href":"#solution","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$6e","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"Solution"]}]
3c:["$","p","p-32",{"children":"In this case, the options didn't update anymore after the request had completed. Therefore, there was no need to update and re-render the options every time the component had changed."}]
3d:["$","p","p-33",{"children":["To stop the re-render, I extracted the dropdown out into a separate component, passed the options as a prop, and most importantly, made it a ",["$","code","code-0",{"children":"PureComponent"}]," which only re-rendered itself when the props had changed."]}]
3e:["$","p","p-34",{"children":["The dropdown was used in a ",["$","strong","strong-0",{"children":"uncontrolled"}]," way -- that is, not managing its ",["$","code","code-0",{"children":"value"}]," by the DOM instead of as a state of React component by not passing value to the ",["$","code","code-1",{"children":"input"}]," DOM field. I had to admit it was not the React way, but here, not passing value to it meant that the component would ",["$","strong","strong-1",{"children":"never update"}],", which was exactly what I wanted."]}]
3f:["$","p","p-35",{"children":["$","$L4c","img-0",{"src":"/articles/asset/contents/20191012-a-react-form-comp-pref-optimization-with-profiler/optimized-code.png","imageSize":{"height":429,"width":609},"imageProps":{"src":"optimized-code.png","alt":"Optimized code"}}]}]
40:["$","p","p-36",{"children":["The optimization worked like a charm: the render time of the whole form for each input had reduced from ",["$","strong","strong-0",{"children":"~400ms"}]," to ",["$","strong","strong-1",{"children":"~22ms"}],", and there was no any unresponsiveness and delay at every key stroke."]}]
41:["$","p","p-37",{"children":["$","$L4c","img-0",{"src":"/articles/asset/contents/20191012-a-react-form-comp-pref-optimization-with-profiler/after.png","imageSize":{"height":169,"width":748},"imageProps":{"src":"after.png","alt":"After"}}]}]
6f:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z42:["$","h1","h1-3",{"id":"verdict","children":[["$","a","verdict",{"href":"#verdict","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$6f","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"Verdict"]}]
43:["$","p","p-38",{"children":"Form is React is indeed a challenge. Without careful designing and implementation, problems may occur at any time, anywhere."}]
44:["$","p","p-39",{"children":["The issue here was ultimately the re-renders, but not the form I originally thought of, but the dropdown with large number of options. It is important to app performance to ",["$","strong","strong-0",{"children":"understand React update strategy"}]," and ",["$","strong","strong-1",{"children":"control the component update"}]," with lifecycle functions, property hook usage, memoing and caching, especially when the the number of component to render is too large."]}]
45:["$","p","p-40",{"children":["The ",["$","strong","strong-0",{"children":"profiler"}]," was the key to finding the component to blame by providing the data of time to re-render for each component. Therefore, when a performance issue is detected, stop wasting guessing which compoenent causes it, and let profiler take you straight to it."]}]
46:["$","div",null,{"className":"hidden lg:block lg:w-[25%]","children":["$","$L70",null,{"toc":[{"depth":1,"value":"The Problem","id":"the-problem"},{"depth":1,"value":"Investigation","id":"investigation","children":[{"depth":2,"value":"Validations?","id":"validations"},{"depth":2,"value":"Re-renders of the Whole Form?","id":"re-renders-of-the-whole-form","children":[{"depth":3,"value":"The Challenge of Forms in React","id":"the-challenge-of-forms-in-react"},{"depth":3,"value":"Complicated Form","id":"complicated-form"},{"depth":3,"value":"No Easy Solutions","id":"no-easy-solutions"}]},{"depth":2,"value":"Maybe Not Re-renders?","id":"maybe-not-re-renders"},{"depth":2,"value":"Profiling, Profiling, Profiling","id":"profiling-profiling-profiling"},{"depth":2,"value":"Large Quantity of Options","id":"large-quantity-of-options"}]},{"depth":1,"value":"Solution","id":"solution"},{"depth":1,"value":"Verdict","id":"verdict"}],"hasSummary":true}]}]
47:["$","div",null,{"className":"max-w-7xl mx-auto p-4","children":["$","$L71",null,{"relatedArticles":[]}]}]
48:["$","div",null,{"className":"max-w-7xl mx-auto p-4","children":["$","$L72",null,{"articleId":"a-react-form-comp-pref-optimization-with-profiler","articleTitle":"A React Form Component Performance Optimization with Profiler"}]}]
4b:null
56:["$","span","span-10",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"      // Needed for handling click events on disabled items"}]}]
57:["$","span","span-11",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E06C75"},"children":"      style"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":": { ..."}],["$","span","span-2",{"style":{"color":"#E5C07B"},"children":"opt"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-4",{"style":{"color":"#E06C75"},"children":"style"}],["$","span","span-5",{"style":{"color":"#ABB2BF"},"children":", "}],["$","span","span-6",{"style":{"color":"#E06C75"},"children":"pointerEvents"}],["$","span","span-7",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-8",{"style":{"color":"#98C379"},"children":"'all'"}],["$","span","span-9",{"style":{"color":"#ABB2BF"},"children":" },"}]]}]
58:["$","span","span-12",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"    }),"}]}]
59:["$","span","span-13",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"  )"}]}]
5a:["$","span","span-14",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"}"}]}]
5b:["$","span","span-15",{"data-line":"","children":" "}]
5c:["$","span","span-16",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#61AFEF"},"children":"renderMenu"}],["$","span","span-1",{"style":{"color":"#56B6C2"},"children":" ="}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":" () "}],["$","span","span-3",{"style":{"color":"#C678DD"},"children":"=>"}],["$","span","span-4",{"style":{"color":"#ABB2BF"},"children":" {"}]]}]
5d:["$","span","span-17",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"  // omitted"}]}]
5e:["$","span","span-18",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"  return"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":" ("}]]}]
5f:["$","span","span-19",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"    <"}],["$","span","span-1",{"style":{"color":"#E5C07B"},"children":"DropdownMenu"}],["$","span","span-2",{"style":{"color":"#C678DD"},"children":" {"}],["$","span","span-3",{"style":{"color":"#ABB2BF"},"children":"..."}],["$","span","span-4",{"style":{"color":"#E06C75"},"children":"ariaOptions"}],["$","span","span-5",{"style":{"color":"#C678DD"},"children":"}"}],["$","span","span-6",{"style":{"color":"#D19A66","fontStyle":"italic"},"children":" direction"}],["$","span","span-7",{"style":{"color":"#56B6C2"},"children":"="}],["$","span","span-8",{"style":{"color":"#C678DD"},"children":"{"}],["$","span","span-9",{"style":{"color":"#E06C75"},"children":"direction"}],["$","span","span-10",{"style":{"color":"#C678DD"},"children":"}"}],["$","span","span-11",{"style":{"color":"#D19A66","fontStyle":"italic"},"children":" open"}],["$","span","span-12",{"style":{"color":"#56B6C2"},"children":"="}],["$","span","span-13",{"style":{"color":"#C678DD"},"children":"{"}],["$","span","span-14",{"style":{"color":"#E06C75"},"children":"open"}],["$","span","span-15",{"style":{"color":"#C678DD"},"children":"}"}],["$","span","span-16",{"style":{"color":"#ABB2BF"},"children":">"}]]}]
60:["$","span","span-20",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"      {"}],["$","span","span-1",{"style":{"color":"#E5C07B"},"children":"DropdownHeader"}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-3",{"style":{"color":"#61AFEF"},"children":"create"}],["$","span","span-4",{"style":{"color":"#ABB2BF"},"children":"("}],["$","span","span-5",{"style":{"color":"#E06C75"},"children":"header"}],["$","span","span-6",{"style":{"color":"#ABB2BF"},"children":", { "}],["$","span","span-7",{"style":{"color":"#E06C75"},"children":"autoGenerateKey"}],["$","span","span-8",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-9",{"style":{"color":"#D19A66"},"children":"false"}],["$","span","span-10",{"style":{"color":"#ABB2BF"},"children":" })"}],["$","span","span-11",{"style":{"color":"#C678DD"},"children":"}"}]]}]
61:["$","span","span-21",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"      {"}],["$","span","span-1",{"style":{"color":"#E5C07B"},"children":"this"}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-3",{"style":{"color":"#61AFEF"},"children":"renderOptions"}],["$","span","span-4",{"style":{"color":"#ABB2BF"},"children":"()"}],["$","span","span-5",{"style":{"color":"#C678DD"},"children":"}"}]]}]
62:["$","span","span-22",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"    </"}],["$","span","span-1",{"style":{"color":"#E5C07B"},"children":"DropdownMenu"}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":">"}]]}]
63:["$","span","span-23",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"  )"}]}]
64:["$","span","span-24",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"}"}]}]
65:["$","span","span-25",{"data-line":"","children":" "}]
66:["$","span","span-26",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#61AFEF"},"children":"render"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":"() {"}]]}]
67:["$","span","span-27",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"  // omitted"}]}]
68:["$","span","span-28",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#C678DD"},"children":"  return"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":" ("}]]}]
69:["$","span","span-29",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"    // omitted"}]}]
6a:["$","span","span-30",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"    {"}],["$","span","span-1",{"style":{"color":"#E06C75","fontStyle":"italic"},"children":"this"}],["$","span","span-2",{"style":{"color":"#ABB2BF"},"children":"."}],["$","span","span-3",{"style":{"color":"#E06C75","fontStyle":"italic"},"children":"renderMenu"}],["$","span","span-4",{"style":{"color":"#ABB2BF"},"children":"()}"}]]}]
6b:["$","span","span-31",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#7F848E","fontStyle":"italic"},"children":"    // omitted"}]}]
6c:["$","span","span-32",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"  )"}]}]
6d:["$","span","span-33",{"data-line":"","children":["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"}"}]}]
