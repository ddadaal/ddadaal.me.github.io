<!DOCTYPE html><html lang="zh-CN" class="scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/df9dc4ec439e9f96.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/550cc6711c036586.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/aa74b8ca7fffeadf.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-dd3227a94d309980.js" crossorigin=""/><script src="/_next/static/chunks/d16e89e2-6d1d20f746de25fb.js" async="" crossorigin=""></script><script src="/_next/static/chunks/543-3c94cb7805e8bcd5.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-6aac8b55b77ba400.js" async="" crossorigin=""></script><script src="/_next/static/chunks/8100ded3-8ce54c87b61c7265.js" async=""></script><script src="/_next/static/chunks/234-7d89acca921e7f65.js" async=""></script><script src="/_next/static/chunks/729-059eec2a014f5f62.js" async=""></script><script src="/_next/static/chunks/874-48b1b2f8f137fd6b.js" async=""></script><script src="/_next/static/chunks/app/layout-a85f49657d48d313.js" async=""></script><script src="/_next/static/chunks/bb1d9007-fdc4463f6b8d4248.js" async=""></script><script src="/_next/static/chunks/37144445-281a1eece1f23f91.js" async=""></script><script src="/_next/static/chunks/c145f854-c353ee343fa63f93.js" async=""></script><script src="/_next/static/chunks/602-9071b7ef50a964e6.js" async=""></script><script src="/_next/static/chunks/app/articles/%5B%5B...params%5D%5D/page-8f16d82c55e99bb9.js" async=""></script><script src="/_next/static/chunks/app/page-b6791deb8a823a9c.js" async=""></script><link rel="preload" href="https://services.ddadaal.me/monitor/script.js" as="script"/><title>我的第一个真实项目：总结和经验 - ddadaal.me</title><meta name="description" content="ddadaal&#x27;s personal website"/><link rel="manifest" href="/site.webmanifest"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><link rel="icon" href="/icon.svg?35be8e76be1c3618" type="image/svg+xml" sizes="any"/><link rel="apple-touch-icon" href="/apple-icon.png?5334a64f42000bb0" type="image/png" sizes="180x180"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="w-full"><div class="items-center sticky z-50 w-full h-13 transition -top-[1px] bg-base-200 text-base-content"><div class="flex justify-between items-center max-w-7xl mx-auto px-4"><a class="flex items-center justify-center space-x-1" href="/"><img alt="logo" loading="lazy" width="42" height="42" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/logo.8f2bd5ec.svg"/><h1 class="text-sm font-bold">ddadaal.me</h1></a><div class="flex items-center gap-1"><div class="hidden lg:flex"><ul class="menu menu-horizontal"><li><a class="" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg>主页</a></li><li><a class="active" href="/articles"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg>文章</a></li><li><details><summary class=""><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"></path></svg>简历</summary><ul class="shadow bg-base-200 text-base-content min-w-max"><li><a class="" href="/resume/cn">🇨🇳 <!-- -->简体中文</a></li><li><a class="" href="/resume/en">🇺🇸 <!-- -->English</a></li></ul></details></li><li><a class="" href="/slides"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M187.7 153.7c-34 0-61.7 25.7-61.7 57.7 0 31.7 27.7 57.7 61.7 57.7s61.7-26 61.7-57.7c0-32-27.7-57.7-61.7-57.7zm143.4 0c-34 0-61.7 25.7-61.7 57.7 0 31.7 27.7 57.7 61.7 57.7 34.3 0 61.7-26 61.7-57.7.1-32-27.4-57.7-61.7-57.7zm156.6 90l-6 4.3V49.7c0-27.4-20.6-49.7-46-49.7H76.6c-25.4 0-46 22.3-46 49.7V248c-2-1.4-4.3-2.9-6.3-4.3-15.1-10.6-25.1 4-16 17.7 18.3 22.6 53.1 50.3 106.3 72C58.3 525.1 252 555.7 248.9 457.5c0-.7.3-56.6.3-96.6 5.1 1.1 9.4 2.3 13.7 3.1 0 39.7.3 92.8.3 93.5-3.1 98.3 190.6 67.7 134.3-124 53.1-21.7 88-49.4 106.3-72 9.1-13.8-.9-28.3-16.1-17.8zm-30.5 19.2c-68.9 37.4-128.3 31.1-160.6 29.7-23.7-.9-32.6 9.1-33.7 24.9-10.3-7.7-18.6-15.5-20.3-17.1-5.1-5.4-13.7-8-27.1-7.7-31.7 1.1-89.7 7.4-157.4-28V72.3c0-34.9 8.9-45.7 40.6-45.7h317.7c30.3 0 40.9 12.9 40.9 45.7v190.6z"></path></svg>幻灯片</a></li><li><details><summary class=""><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></svg>关于</summary><ul class="shadow bg-base-200 text-base-content min-w-max"><li><a class="" href="/about/odyssey"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg>一个个人博客的史诗</a></li><li><a class="" href="/about/project"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></svg>关于网站</a></li><li><a class="" href="/about/me"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M96 0c35.346 0 64 28.654 64 64s-28.654 64-64 64-64-28.654-64-64S60.654 0 96 0m48 144h-11.36c-22.711 10.443-49.59 10.894-73.28 0H48c-26.51 0-48 21.49-48 48v136c0 13.255 10.745 24 24 24h16v136c0 13.255 10.745 24 24 24h64c13.255 0 24-10.745 24-24V352h16c13.255 0 24-10.745 24-24V192c0-26.51-21.49-48-48-48z"></path></svg>关于我</a></li></ul></details></li></ul></div><div class="dropdown dropdown-end"><label tabindex="0" class="btn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"></path></svg><span class="hidden sm:block">自动</span></label><ul tabindex="0" class="dropdown-content menu p-2 bg-base-200 text-base-content shadow rounded-box min-w-max"><li><a class="justify-between">自动</a></li><li><a class="justify-between">明亮</a></li><li><a class="justify-between">暗色</a></li><li><a class="justify-between">杯子蛋糕</a></li><li><a class="justify-between">大黄蜂</a></li><li><a class="justify-between">白色商务</a></li><li><a class="justify-between">黑色商务</a></li><li><a class="justify-between">金色奢华</a></li><li><a class="justify-between">夏日柠檬</a></li><li><a class="justify-between">绿野仙踪</a></li><li><a class="justify-between">复古</a></li><li><a class="justify-between">粉色浪漫</a></li><li><a class="justify-between">赛博朋克</a></li></ul></div><div class="dropdown dropdown-end"><label tabindex="0" class="btn">🇨🇳 <span class="hidden sm:block">简体中文</span></label><ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-200 rounded-box min-w-max text-base-content"><li><a class="justify-between">🇨🇳 <!-- -->简体中文</a></li><li><a class="justify-between">🇺🇸 <!-- -->English</a></li></ul></div><div class="dropdown dropdown-end lg:hidden"><label tabindex="0" class="btn btn-ghost"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"></path></svg></label><ul tabindex="0" class="menu menu-compact dropdown-content min-w-max mt-3 p-2 shadow rounded-box bg-base-200 text-base-content"><li><a class="" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg>主页</a></li><li><a class="active" href="/articles"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg>文章</a></li><li><a><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"></path></svg>简历</a><ul><li><a class="" href="/resume/cn">🇨🇳 <!-- -->简体中文</a></li><li><a class="" href="/resume/en">🇺🇸 <!-- -->English</a></li></ul></li><li><a class="" href="/slides"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M187.7 153.7c-34 0-61.7 25.7-61.7 57.7 0 31.7 27.7 57.7 61.7 57.7s61.7-26 61.7-57.7c0-32-27.7-57.7-61.7-57.7zm143.4 0c-34 0-61.7 25.7-61.7 57.7 0 31.7 27.7 57.7 61.7 57.7 34.3 0 61.7-26 61.7-57.7.1-32-27.4-57.7-61.7-57.7zm156.6 90l-6 4.3V49.7c0-27.4-20.6-49.7-46-49.7H76.6c-25.4 0-46 22.3-46 49.7V248c-2-1.4-4.3-2.9-6.3-4.3-15.1-10.6-25.1 4-16 17.7 18.3 22.6 53.1 50.3 106.3 72C58.3 525.1 252 555.7 248.9 457.5c0-.7.3-56.6.3-96.6 5.1 1.1 9.4 2.3 13.7 3.1 0 39.7.3 92.8.3 93.5-3.1 98.3 190.6 67.7 134.3-124 53.1-21.7 88-49.4 106.3-72 9.1-13.8-.9-28.3-16.1-17.8zm-30.5 19.2c-68.9 37.4-128.3 31.1-160.6 29.7-23.7-.9-32.6 9.1-33.7 24.9-10.3-7.7-18.6-15.5-20.3-17.1-5.1-5.4-13.7-8-27.1-7.7-31.7 1.1-89.7 7.4-157.4-28V72.3c0-34.9 8.9-45.7 40.6-45.7h317.7c30.3 0 40.9 12.9 40.9 45.7v190.6z"></path></svg>幻灯片</a></li><li><a><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></svg>关于</a><ul><li><a class="" href="/about/odyssey"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg>一个个人博客的史诗</a></li><li><a class="" href="/about/project"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></svg>关于网站</a></li><li><a class="" href="/about/me"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M96 0c35.346 0 64 28.654 64 64s-28.654 64-64 64-64-28.654-64-64S60.654 0 96 0m48 144h-11.36c-22.711 10.443-49.59 10.894-73.28 0H48c-26.51 0-48 21.49-48 48v136c0 13.255 10.745 24 24 24h16v136c0 13.255 10.745 24 24 24h64c13.255 0 24-10.745 24-24V352h16c13.255 0 24-10.745 24-24V192c0-26.51-21.49-48-48-48z"></path></svg>关于我</a></li></ul></li></ul></div></div></div></div><div><article><div class="bg-neutral px-4 py-8"><div class="max-w-7xl mx-auto min-h-[256px] flex justify-center text-center text-neutral-content"><div class="flex flex-col justify-center animate-slide-up"><h1 class="text-4xl my-2">我的第一个真实项目：总结和经验</h1><div class="flex flex-wrap gap-3 my-2 text-sm justify-center"><div class="flex flex-wrap gap-1 items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg><a class="badge badge-accent mx-0.5 text-accent-content" href="/articles/search?query=project">我的项目</a></div><div class="flex items-center" title="发表时间"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"></path></svg><span class="mx-0.5">2021-07-21 16:34:00 UTC+8</span></div><div class="flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm57.1 120H305c7.7 0 13.4 7.1 11.7 14.7l-38 168c-1.2 5.5-6.1 9.3-11.7 9.3h-38c-5.5 0-10.3-3.8-11.6-9.1-25.8-103.5-20.8-81.2-25.6-110.5h-.5c-1.1 14.3-2.4 17.4-25.6 110.5-1.3 5.3-6.1 9.1-11.6 9.1H117c-5.6 0-10.5-3.9-11.7-9.4l-37.8-168c-1.7-7.5 4-14.6 11.7-14.6h24.5c5.7 0 10.7 4 11.8 9.7 15.6 78 20.1 109.5 21 122.2 1.6-10.2 7.3-32.7 29.4-122.7 1.3-5.4 6.1-9.1 11.7-9.1h29.1c5.6 0 10.4 3.8 11.7 9.2 24 100.4 28.8 124 29.6 129.4-.2-11.2-2.6-17.8 21.6-129.2 1-5.6 5.9-9.5 11.5-9.5zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"></path></svg><span class="mx-0.5">6727 字</span></div><div class="flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></svg><span class="mx-0.5">34 分钟阅读</span></div><div class="flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></svg><span class="mx-0.5 space-x-1"><a class="link link-hover" href="/articles/summary-of-my-first-real-project/cn">简体中文</a></span></div></div></div></div></div><div class="animate-slide-up"><div class="max-w-7xl mx-auto p-4"><div class="flex flex-row space-x-4"><div class="prose max-w-full lg:w-[75%]"><div class="p-4 my-4 bg-neutral rounded shadow"><h1 id="summary" class="text-neutral-content"><a href="#summary" class="mr-1 text-neutral-content"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>✨AI全文总结</h1><p class="text-neutral-content">从3月15日开始,作者独立承担了一个完整的、真实的项目的开发和整个软件生命周期的维护工作:第三届全国高校数据驱动创新研究大赛的后台系统。 系统是一个做了SSR的前后端分离的TypeScript全栈项目。 每个部分都是使用容器运行,所有容器部署在一台2核2G内存的学校提供的虚拟机上。 为了减少接口层次的不一致,这次系统使用了作者在[yaarxiv]中采用**前后端共享API定义文件**的设计。 在项目中使用[mikro-orm]作为ORM库,也提供了内置的migration机制。 本项目写了不少后端的测试,行覆盖达到了94%,但是没有写前端测试。</p><p class="text-sm justify-end flex text-neutral-content">由<a target="_blank" class="text-neutral-content" href="https://learn.microsoft.com/en-us/azure/ai-services/language-service/summarization/overview?tabs=document-summarization">Azure AI Language Service</a>驱动</p></div><h1 id="我的第一个真实项目"><a href="#我的第一个真实项目" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>我的第一个真实项目</h1>
<p>终于，从3月15日开始，我自己独立承担了一个完整的、真实的项目的开发和整个软件生命周期的维护工作：<a href="https://data-competition.pku.edu.cn">https://data-competition.pku.edu.cn</a> ，第三届全国高校数据驱动创新研究大赛的后台系统（代码目前放在学校gitlab上，以后应该会把代码放到github上）。</p>
<p>虽然这还是一个常规的CRUD项目，但是毕竟是我第一个能够被真实用户使用的系统，我还是比较激动的。项目中途遇到了几次重构，最后出现了一次生产事故，其他的总体流程还是比较顺利的。</p>
<p>项目现在已经基本结束了，这里写一篇总结文，介绍一下项目的架构、演进、自己设置的一套前后端共用API的机制、以及在这个过程中的经验。</p>
<h1 id="系统功能架构规模"><a href="#系统功能架构规模" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>系统功能、架构、规模</h1>
<p>下面是系统的用例图，主要完成一个比赛报名系统的用户管理、团队管理和上传提交文件操作，还对管理员实现了查看用户和团队信息以及群发邮件功能。</p>
<p><figure><img alt="用例图" loading="lazy" width="880" height="725" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/usecase.png?width=1080 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/usecase.png?width=1920 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/usecase.png?width=1920"/><figcaption class="text-center">用例图</figcaption></figure></p>
<p>总的来说，系统是一个做了SSR的前后端分离的TypeScript全栈项目，下表为项目的技术栈。</p>













































<table><thead><tr><th>部分</th><th>技术栈</th></tr></thead><tbody><tr><td>编程语言</td><td>TypeScript</td></tr><tr><td>前端框架</td><td>Next.js</td></tr><tr><td>UI库</td><td>Ant Design</td></tr><tr><td>后端框架</td><td>fastify</td></tr><tr><td>反向代理</td><td>nginx</td></tr><tr><td>数据库</td><td>MySQL</td></tr><tr><td>部署</td><td>Docker + Docker Compose</td></tr><tr><td>监控</td><td>Prometheus + Loki + Grafana</td></tr><tr><td>外部服务</td><td>学校提供的SMTP服务器</td></tr></tbody></table>
<p>下图是系统各个部分的架构图，监控部分其他的各个小组件就没有画了。</p>
<p><figure><img alt="架构图" loading="lazy" width="958" height="816" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/architecture.png?width=1080 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/architecture.png?width=1920 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/architecture.png?width=1920"/><figcaption class="text-center">架构图</figcaption></figure></p>
<p>每个部分（包括nginx、数据库）都是使用容器运行，所有容器部署在一台2核2G内存的学校提供的虚拟机上。这个机器前面还有其他机器，负责SSL和开放到公网，所以这台机器本身是不能直接从公网访问的（连我上机器都需要使用VPN连接），这就带来了安全性：我可以使用最前面的nginx的来控制各个部分的可访问性。在我的配置中，nginx开放了80（前端）、5000（后端）和grafana的端口。grafana是否应该被公网访问我还不好说，但是由于grafana可以设置用户名和密码，应该安全性还好。</p>
<p>用docker运行的好处很显著：不管机器是什么样的，直接<code>docker-compose build</code>和<code>docker-compose up -d</code>就可以部署和更新了，以及loki也可以直接从Docker引擎中获取各个服务的日志。当然事实上没这么简单（数据库migration、volume mount等），后面要讲的生产事故也和docker直接相关。但是docker无疑是使得运维工作更简单的。</p>
<p>项目规模在12000行的TS代码左右。</p>
<pre><code>➜  cloc . --fullpath --not-match-d=&quot;(node_modules|.next)&quot;
     615 text files.
     610 unique files.
     296 files ignored.

github.com/AlDanial/cloc v 1.88  T=0.85 s (545.5 files/s, 92257.2 lines/s)
-------------------------------------------------------------------------------
Language                     files          blank        comment           code
-------------------------------------------------------------------------------
JSON                            22              1              0          41742
HTML                            96           1421              0          16873
TypeScript                     320           2470            440          12470
XML                              1              0              0           1390
CSS                              3             62             22            754
YAML                             6             26              3            260
JavaScript                       5             28             27            230
Bourne Shell                     1             12              6            164
Markdown                         6             76              0            162
SVG                              4              0              1            138
LESS                             1              2              0             14
PowerShell                       1              2              2              7
-------------------------------------------------------------------------------
SUM:                           466           4100            501          74204
-------------------------------------------------------------------------------
</code></pre>
<h1 id="几次重构"><a href="#几次重构" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>几次重构</h1>
<h2 id="create-react-app到nextjs"><a href="#create-react-app到nextjs" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>Create React App到Next.js</h2>
<p>项目开始得比较急，以及我一开始询问得知<strong>不需要做SEO</strong>，所以采用了CRA开发了系统的第一个版本。结果后面又说需要SEO，所以只好将项目迁移到<code>next.js</code>。但是现在虽然已经能够做到SSR（下图），但是搜索引擎似乎也不好搜索到网页中的内容（可能是流量太低，搜索引擎还没有索引？）。</p>
<p><figure><img alt="SSR" loading="lazy" width="1220" height="701" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/ssr.png?width=1920 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/ssr.png?width=3840 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/ssr.png?width=3840"/><figcaption class="text-center">SSR</figcaption></figure></p>
<h2 id="非响应式到响应式"><a href="#非响应式到响应式" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>非响应式到响应式</h2>
<p>和上面一样，一开始说系统并不需要考虑手机上访问，所以设计的时候就完全没有考虑手机端访问的情况。结果初版上线没多久就说需要支持手机上的访问，所以需要对网站做响应式的改造。</p>
<p>由于除了主页以外，之前本来就完全没有使用绝对坐标，所以其实很多元素已经能够自己适应了（例如网页的主内容部分），整体工作量比我想象的小。主要工作有两块：</p>
<ul>
<li>header</li>
<li>左右布局</li>
<li>主页</li>
</ul>
<p>header整体是左边logo右边menu，但是右边的menu需要根据屏幕大小切换不同的布局。为了简单，我直接就对大屏幕和小屏幕分别写了两个Menu，然后在运行时根据当前的屏幕大小进行切换。</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="tsx" data-theme="one-dark-pro"><code data-language="tsx" data-theme="one-dark-pro" style="display:grid"><span data-line=""><span style="color:#C678DD">import</span><span style="color:#E06C75"> useBreakpoint</span><span style="color:#C678DD"> from</span><span style="color:#98C379"> &quot;antd/lib/grid/hooks/useBreakpoint&quot;</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> { </span><span style="color:#E5C07B">md</span><span style="color:#ABB2BF"> } </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> useBreakpoint</span><span style="color:#ABB2BF">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#E06C75">md</span></span>
<span data-line=""><span style="color:#C678DD">  ?</span><span style="color:#ABB2BF"> (</span></span>
<span data-line=""><span style="color:#ABB2BF">    &lt;</span><span style="color:#E5C07B">BigScreenMenu</span></span>
<span data-line=""><span style="color:#D19A66;font-style:italic">      links</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#E06C75">renderedLinks</span><span style="color:#C678DD">}</span></span>
<span data-line=""><span style="color:#D19A66;font-style:italic">      pathname</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#E06C75">pathname</span><span style="color:#C678DD">}</span></span>
<span data-line=""><span style="color:#D19A66;font-style:italic">      userStore</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#E06C75">userStore</span><span style="color:#C678DD">}</span></span>
<span data-line=""><span style="color:#ABB2BF">    /&gt;</span></span>
<span data-line=""><span style="color:#ABB2BF">  ) </span><span style="color:#C678DD">:</span><span style="color:#ABB2BF"> (</span></span>
<span data-line=""><span style="color:#ABB2BF">    &lt;</span><span style="color:#E5C07B">SmallScreenMenu</span></span>
<span data-line=""><span style="color:#D19A66;font-style:italic">      links</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#E06C75">renderedLinks</span><span style="color:#C678DD">}</span></span>
<span data-line=""><span style="color:#D19A66;font-style:italic">      pathname</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#E06C75">pathname</span><span style="color:#C678DD">}</span></span>
<span data-line=""><span style="color:#D19A66;font-style:italic">      userStore</span><span style="color:#56B6C2">=</span><span style="color:#C678DD">{</span><span style="color:#E06C75">userStore</span><span style="color:#C678DD">}</span></span>
<span data-line=""><span style="color:#ABB2BF">    /&gt;</span></span>
<span data-line=""><span style="color:#ABB2BF">  )</span></span></code></pre></figure>
<p>左右布局借用了使用的Ant Design的<a href="https://ant.design/components/tabs-cn/">Tabs</a>组件可以显示在左边也可以在上面的功能，同样通过<code>useBreakpoint</code> hook获得现在屏幕的大小，然后通过大小判断Tabs的显示模式。</p>
<p>大屏幕下的界面：</p>
<p><figure><img alt="大屏幕界面" loading="lazy" width="1249" height="398" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/big-screen-ui.png?width=1920 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/big-screen-ui.png?width=3840 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/big-screen-ui.png?width=3840"/><figcaption class="text-center">大屏幕界面</figcaption></figure></p>
<p>小屏幕下的界面：</p>
<p><figure><img alt="小屏幕下的界面" loading="lazy" width="682" height="397" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/small-screen-ui.png?width=750 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/small-screen-ui.png?width=1920 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/small-screen-ui.png?width=1920"/><figcaption class="text-center">小屏幕下的界面</figcaption></figure></p>
<p>主页是比较麻烦的，因为主页有一些部分结构比较复杂，设计图的HTML里也主要是以1200px以上为基准，把一些复杂的结构使用绝对大小来表示。比如下图中的树状结构，就是通过绝对的margin值来确定位置的。</p>
<p><figure><img alt="结构复杂的部分" loading="lazy" width="952" height="944" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/homepage-big.png?width=1080 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/homepage-big.png?width=1920 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/homepage-big.png?width=1920"/><figcaption class="text-center">结构复杂的部分</figcaption></figure></p>
<p>这个我最后取了一个偷懒的做法，就是在屏幕宽度过小的情况下，把这些复杂的部分全部隐藏掉。由于原来是支持1200px以上的，所以最后在1200px以下就把这些部分直接隐藏掉。</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="css" data-theme="one-dark-pro"><code data-language="css" data-theme="one-dark-pro" style="display:grid"><span data-line=""><span style="color:#C678DD">@media</span><span style="color:#ABB2BF"> (max-width: </span><span style="color:#D19A66">1200</span><span style="color:#E06C75">px</span><span style="color:#ABB2BF">) {</span></span>
<span data-line=""><span style="color:#D19A66">  .part_04</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#ABB2BF">    display: </span><span style="color:#D19A66">none</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D19A66">  .part_05</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#ABB2BF">    display: </span><span style="color:#D19A66">none</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D19A66">  .part_06_01</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#ABB2BF">    display: </span><span style="color:#D19A66">none</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D19A66">  .part_06_02</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#ABB2BF">    display: </span><span style="color:#D19A66">none</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D19A66">  .part_07</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#ABB2BF">    display: </span><span style="color:#D19A66">none</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D19A66">  .part_03</span><span style="color:#D19A66"> .moreOnPC</span><span style="color:#E06C75"> p</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#ABB2BF">    display: </span><span style="color:#D19A66">block</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p><figure><img alt="小屏幕下提示" loading="lazy" width="682" height="397" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/small-screen-ui.png?width=750 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/small-screen-ui.png?width=1920 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/small-screen-ui.png?width=1920"/><figcaption class="text-center">小屏幕下提示</figcaption></figure></p>
<h2 id="部署prometheuslokigrafana"><a href="#部署prometheuslokigrafana" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>部署Prometheus/Loki/Grafana</h2>
<p>一开始系统并没有部署任何的监控系统和日志工具，日志全部直接打到stdout里，要查日志的时候通过<code>docker-compose logs {container name}</code>来查。这种方式有以下几个问题：</p>
<ul>
<li>容器重启后，之前的日志就丢失了</li>
<li>只能看到raw log，只能借助一些外部工具（比如grep）进行分析，灵活性受限</li>
</ul>
<p>另外在一开始，机器的硬盘很少（20G），由于我没有镜像仓库，docker镜像都是直接拉到机器现场build，产生了巨多storage layer，占用了不少空间，有一次部署因为硬盘不够直接build失败了。</p>
<p>所以我觉得需要部署一套监控和日志系统，用来在问题出现时更方便地寻找问题。后面选择了Prometheus和Loki和Grafana这一套组合。</p>
<p>网上抄了一些dashboard的配置，比如下面的<a href="https://grafana.com/grafana/dashboards/1860">Node Exporter Full</a>，nginx等，但是可能由于我这个系统比较简单，请求压力也不大，这些机器只是看着炫酷，实际没有起到什么作用。</p>
<p><figure><img alt="Grafana Noded Exporter Full" loading="lazy" width="1788" height="902" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/grafana-node-exporter.png?width=1920 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/grafana-node-exporter.png?width=3840 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/grafana-node-exporter.png?width=3840"/><figcaption class="text-center">Grafana Noded Exporter Full</figcaption></figure></p>
<p><figure><img alt="Grafana Nginx" loading="lazy" width="1788" height="902" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/grafana-nginx.png?width=1920 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/grafana-nginx.png?width=3840 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/grafana-nginx.png?width=3840"/><figcaption class="text-center">Grafana Nginx</figcaption></figure></p>
<p>真正起到作用的是loki，通过使用Loki的<a href="https://grafana.com/docs/loki/latest/clients/docker-driver/configuration/">Docker Driver</a>，loki可以直接收集容器产生的日志，并且支持在grafana中进行搜索和查询。这些日志在后面诊断生产事故时发挥了巨大的作用。</p>
<p><figure><img alt="通过Loki查看和搜索日志，右上角还可以修改时间" loading="lazy" width="1605" height="963" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/loki.png?width=1920 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/loki.png?width=3840 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/loki.png?width=3840"/><figcaption class="text-center">通过Loki查看和搜索日志，右上角还可以修改时间</figcaption></figure></p>
<h1 id="前后端共享api定义"><a href="#前后端共享api定义" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>前后端共享API定义</h1>
<p>前后端分离中，接口是非常重要的。为了减少接口层次的不一致，这次系统使用了我在<a href="https://github.com/ddadaal/yaarxiv">yaarxiv</a>中采用<strong>前后端共享API定义文件</strong>的设计。只需要在共享的<code>shared</code>项目中使用TypeScript写API相关的定义（request、response、权限等），前后端就可以使用同一份定义文件进行API的调用和实现。只要对每个接口写一个文件，以下所有工作都可以自动化：</p>
<ul>
<li>前端
<ul>
<li>调用接口时编译时检查参数，推断返回值类型</li>
<li>生成API Client</li>
</ul>
</li>
<li>后端
<ul>
<li>生成swagger</li>
<li>检查请求参数，对错误参数的请求返回400</li>
<li>编译时检查返回值类型</li>
</ul>
</li>
</ul>
<p>下面是一个真实的本项目中的API定义：更新团队成果信息来举例子，看看这个机制是怎么工作的。</p>
<h2 id="定义接口"><a href="#定义接口" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>定义接口</h2>
<p>用户定义一个<code>xxxSchema</code>的interface，通过<code>body</code>定义request body的类型，<code>responses</code>中定义各个状态码以及对应的返回值。在定义接口的时候可以随意使用TypeScript的各种高级类型来减少重复。</p>
<p>定义好接口后，使用<code>endpoint</code>定义这个API的方法和URL以及对应的Schema类型，再使用<code>props</code>指定API的一些属性，例如要求的权限（<code>requiredRoles</code>），可以被调用的时间段（<code>timeRange</code>）等。</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="ts" data-theme="one-dark-pro"><code data-language="ts" data-theme="one-dark-pro" style="display:grid"><span data-line=""><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">UserRole</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> &quot;../auth/login&quot;</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">ApiProps</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> &quot;../utils/apiProps&quot;</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">Endpoint</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> &quot;../utils/schema&quot;</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">TimeOutOfRangeError</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> &quot;../utils/serverError&quot;</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">Submission</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">submissionTimeRange</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> &quot;./models&quot;</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">export</span><span style="color:#C678DD"> type</span><span style="color:#E5C07B"> UpdateSubmissionModel</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> Omit</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Submission</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;teamId&quot;</span><span style="color:#ABB2BF"> | </span><span style="color:#98C379">&quot;leader&quot;</span><span style="color:#ABB2BF"> | </span><span style="color:#98C379">&quot;time&quot;</span><span style="color:#ABB2BF"> | </span><span style="color:#98C379">&quot;paper&quot;</span><span style="color:#ABB2BF">&gt;;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">export</span><span style="color:#C678DD"> interface</span><span style="color:#E5C07B"> UpdateSubmissionSchema</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#E06C75">  body</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    teamId</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">number</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#E06C75">    info</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">UpdateSubmissionModel</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#ABB2BF">  };</span></span>
<span data-line=""><span style="color:#E06C75">  responses</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">TimeOutOfRangeError</span><span style="color:#ABB2BF">&lt;{ </span><span style="color:#E06C75">reason</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;NotLeader&quot;</span><span style="color:#ABB2BF"> }&gt; &amp; {</span></span>
<span data-line=""><span style="color:#D19A66">    201</span><span style="color:#ABB2BF">: {};</span></span>
<span data-line=""><span style="color:#D19A66">    400</span><span style="color:#ABB2BF">: { </span><span style="color:#E06C75">reason</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;DataUrls&quot;</span><span style="color:#ABB2BF">};</span></span>
<span data-line=""><span style="color:#D19A66">    404</span><span style="color:#ABB2BF">: {}</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#E5C07B"> props</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">ApiProps</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#E06C75">  requiredRoles</span><span style="color:#ABB2BF">: [</span><span style="color:#E5C07B">UserRole</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">User</span><span style="color:#ABB2BF">],</span></span>
<span data-line=""><span style="color:#E06C75">  timeRange</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">submissionTimeRange</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">};</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#E5C07B"> endpoint</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#E06C75">  method</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;PATCH&quot;</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  url</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;/submissions&quot;</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">} </span><span style="color:#C678DD">as</span><span style="color:#E5C07B"> Endpoint</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">UpdateSubmissionSchema</span><span style="color:#ABB2BF">&gt;;</span></span></code></pre></figure>
<p>这些都定义好后，在<code>shared</code>项目中调用<code>npm run api</code>生成一个json schema文件。后端将会使用这个json schema自动生成参数和返回值验证，自动对传入参数不合要求的请求返回400。</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display:grid"><span data-line=""><span style="color:#98C379">&quot;UpdateSubmissionSchema&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">  &quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;object&quot;</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">  &quot;properties&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    &quot;body&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">      &quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;object&quot;</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">      &quot;properties&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">        &quot;teamId&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">          &quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;number&quot;</span></span>
<span data-line=""><span style="color:#ABB2BF">        },</span></span>
<span data-line=""><span style="color:#E06C75">        &quot;info&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">          &quot;$ref&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;#/definitions/UpdateSubmissionModel&quot;</span></span>
<span data-line=""><span style="color:#ABB2BF">        }</span></span>
<span data-line=""><span style="color:#ABB2BF">      },</span></span>
<span data-line=""><span style="color:#E06C75">      &quot;required&quot;</span><span style="color:#ABB2BF">: [</span></span>
<span data-line=""><span style="color:#98C379">        &quot;teamId&quot;</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#98C379">        &quot;info&quot;</span></span>
<span data-line=""><span style="color:#ABB2BF">      ],</span></span>
<span data-line=""><span style="color:#E06C75">      &quot;additionalProperties&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">false</span></span>
<span data-line=""><span style="color:#ABB2BF">    },</span></span>
<span data-line=""><span style="color:#E06C75">    &quot;responses&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">      &quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;object&quot;</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">      &quot;additionalProperties&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">false</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">      &quot;properties&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">        &quot;201&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">          &quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;object&quot;</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">          &quot;additionalProperties&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">false</span></span>
<span data-line=""><span style="color:#ABB2BF">        },</span></span>
<span data-line=""><span style="color:#E06C75">        &quot;400&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">          &quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;object&quot;</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">          &quot;properties&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">            &quot;reason&quot;</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">              &quot;type&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;string&quot;</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">              &quot;const&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;DataUrls&quot;</span></span>
<span data-line=""><span style="color:#ABB2BF">            }</span></span>
<span data-line=""><span style="color:#ABB2BF">          },</span></span>
<span data-line=""><span style="color:#E06C75">          &quot;required&quot;</span><span style="color:#ABB2BF">: [</span></span>
<span data-line=""><span style="color:#98C379">            &quot;reason&quot;</span></span>
<span data-line=""><span style="color:#ABB2BF">          ],</span></span>
<span data-line=""><span style="color:#E06C75">          &quot;additionalProperties&quot;</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">false</span></span>
<span data-line=""><span style="color:#ABB2BF">        },</span></span></code></pre></figure>
<h2 id="后端实现接口"><a href="#后端实现接口" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>后端实现接口</h2>
<p>后端对于每个这样的定义文件，提供一个实现。指定api的路径，传入api的Schema的名称，提供实现。通过<code>req.body</code>可以访问传入的参数，并且这些参数以及对应的类型都被自动推断出来的。响应使用<code>{ 状态码: 响应 }</code>的格式，如果状态码或者响应不对，编译器也会报错。</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="ts" data-theme="one-dark-pro"><code data-language="ts" data-theme="one-dark-pro" style="display:grid"><span data-line=""><span style="color:#C678DD">import</span><span style="color:#D19A66"> *</span><span style="color:#C678DD"> as</span><span style="color:#E06C75"> api</span><span style="color:#C678DD"> from</span><span style="color:#98C379"> &quot;dc-shared/api/submission/updateSubmission&quot;</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">export</span><span style="color:#C678DD"> const</span><span style="color:#E5C07B"> updateSubmissionRoute</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> route</span><span style="color:#ABB2BF">(</span></span>
<span data-line=""><span style="color:#E06C75">  api</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;UpdateSubmissionSchema&quot;</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#C678DD">  async</span><span style="color:#ABB2BF"> ({ </span><span style="color:#E06C75;font-style:italic">req</span><span style="color:#ABB2BF"> }) </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#C678DD">    const</span><span style="color:#ABB2BF"> { </span><span style="color:#E5C07B">info</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">teamId</span><span style="color:#ABB2BF"> } </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> req</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">body</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">    const</span><span style="color:#E5C07B"> team</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> await</span><span style="color:#E5C07B"> req</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">em</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">findOne</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Team</span><span style="color:#ABB2BF">, {</span></span>
<span data-line=""><span style="color:#E06C75">      id</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">teamId</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">    });</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">    if</span><span style="color:#ABB2BF"> (</span><span style="color:#56B6C2">!</span><span style="color:#E06C75">team</span><span style="color:#ABB2BF">) { </span><span style="color:#C678DD">return</span><span style="color:#ABB2BF"> { </span><span style="color:#D19A66">404</span><span style="color:#ABB2BF">: {} };}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">    if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">team</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">leader</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">id</span><span style="color:#56B6C2"> !==</span><span style="color:#E5C07B"> req</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">dbUserRef</span><span style="color:#ABB2BF">().</span><span style="color:#E06C75">id</span><span style="color:#ABB2BF">) {</span></span>
<span data-line=""><span style="color:#C678DD">      return</span><span style="color:#ABB2BF"> { </span><span style="color:#D19A66">403</span><span style="color:#ABB2BF">: { </span><span style="color:#E06C75">reason</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;NotLeader&quot;</span><span style="color:#C678DD"> as</span><span style="color:#C678DD"> const</span><span style="color:#ABB2BF"> } };</span></span>
<span data-line=""><span style="color:#ABB2BF">    }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#E5C07B">    team</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">abstract</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> info</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">abstract</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#E5C07B">    team</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">title</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> info</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">title</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#E5C07B">    team</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">subjectType</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> info</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">subjectType</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""><span style="color:#E5C07B">    team</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">subject</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> info</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">subject</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#E5C07B">    team</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">lastUpdateTime</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> Date</span><span style="color:#ABB2BF">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">    await</span><span style="color:#E5C07B"> req</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">em</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">flush</span><span style="color:#ABB2BF">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">    return</span><span style="color:#ABB2BF"> { </span><span style="color:#D19A66">201</span><span style="color:#ABB2BF">: {} }; </span><span style="color:#E06C75">b</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#ABB2BF">  });</span></span></code></pre></figure>
<p>另外在写集成测试的时候，也提供了一些辅助函数简化测试的编写。比如，由于框架会自动检查HTTP传入的参数是否合法，我在测试中基本就不需要再写模拟传入错误参数的测试用例了。并且，我写了一个<code>callRoute</code>函数来进行接口的调用，能够在编译时检查传入的参数是否合法并提供自动完成，还能自动推断不同状态码的响应类型。</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="ts" data-theme="one-dark-pro"><code data-language="ts" data-theme="one-dark-pro" style="display:grid"><span data-line=""><span style="color:#C678DD">const</span><span style="color:#E5C07B"> resp</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> await</span><span style="color:#61AFEF"> callRoute</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">server</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75">adminGetTeamsRoute</span><span style="color:#ABB2BF">, {</span></span>
<span data-line=""><span style="color:#E06C75">  query</span><span style="color:#ABB2BF">: { </span><span style="color:#E06C75">pageSize</span><span style="color:#ABB2BF">: </span><span style="color:#56B6C2">-</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> },</span></span>
<span data-line=""><span style="color:#ABB2BF">}, </span><span style="color:#E06C75">admin</span><span style="color:#ABB2BF">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#61AFEF">expect</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">resp</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">statusCode</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">toBe</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">200</span><span style="color:#ABB2BF">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#7F848E;font-style:italic">// 200的返回值</span></span>
<span data-line=""><span style="color:#C678DD">const</span><span style="color:#E5C07B"> json</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> resp</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">json</span><span style="color:#56B6C2">&lt;</span><span style="color:#D19A66">200</span><span style="color:#56B6C2">&gt;</span><span style="color:#ABB2BF">();</span></span></code></pre></figure>
<h2 id="前端调用接口"><a href="#前端调用接口" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>前端调用接口</h2>
<p>在<code>shared</code>项目中运行<code>npm run client</code>将会根据API的文件结构，在前端项目中生成一份具有相同架构的API调用对象。</p>
<p>下图是API的文件的结构：</p>
<p><figure><img alt="API" loading="lazy" width="268" height="289" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/api-structure.png?width=384 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/api-structure.png?width=640 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/api-structure.png?width=640"/><figcaption class="text-center">API</figcaption></figure></p>
<p>下图是生成的API对象的对应结构：</p>
<p><figure><img alt="API对象" loading="lazy" width="599" height="335" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/api-client.png?width=640 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/api-client.png?width=1200 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/api-client.png?width=1200"/><figcaption class="text-center">API对象</figcaption></figure></p>
<p>前端代码通过这个对象来访问API，不需要手动输入方法、URL等参数。编译器会自动检查传入的各个参数的类型是否正确，还能自动推断响应正确（<code>[200, 300)</code>）时的返回值类型。</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="ts" data-theme="one-dark-pro"><code data-language="ts" data-theme="one-dark-pro" style="display:grid"><span data-line=""><span style="color:#C678DD">await</span><span style="color:#E5C07B"> api</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">submission</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">updateSubmission</span><span style="color:#ABB2BF">({</span></span>
<span data-line=""><span style="color:#E06C75">  body</span><span style="color:#ABB2BF">: {</span></span>
<span data-line=""><span style="color:#E06C75">    teamId</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">s</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">teamId</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#E06C75">    info</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">info</span><span style="color:#ABB2BF">,</span></span>
<span data-line=""><span style="color:#ABB2BF">  },</span></span>
<span data-line=""><span style="color:#ABB2BF">})</span></span></code></pre></figure>
<h2 id="减少重复提高效率"><a href="#减少重复提高效率" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>减少重复，提高效率</h2>
<p>其实这也是我使用TS写全栈的原因：如果前后端采用不同的语言，那么在API层次肯定会有重复工作：两边重复定义接口数据结构、URL、HTTP方法，这很麻烦，而且维护不好还容易造成两方数据结构的不一致。</p>
<p>另外，如果要基于数据结构定义新的数据结构，传统的OO语言很难达到TypeScript的灵活性。例如上面出现过的<code>UpdateSubmissionModel</code>，就是在<code>Submission</code>类型的基础上删除<code>Omit</code>掉<code>teamId</code>等几个属性。TypeScript支持各种对类型的骚操作，很适合接口灵活多变的特性。</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="ts" data-theme="one-dark-pro"><code data-language="ts" data-theme="one-dark-pro" style="display:grid"><span data-line=""><span style="color:#C678DD">export</span><span style="color:#C678DD"> type</span><span style="color:#E5C07B"> UpdateSubmissionModel</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> Omit</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Submission</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;teamId&quot;</span><span style="color:#ABB2BF"> | </span><span style="color:#98C379">&quot;leader&quot;</span><span style="color:#ABB2BF"> | </span><span style="color:#98C379">&quot;time&quot;</span><span style="color:#ABB2BF"> | </span><span style="color:#98C379">&quot;paper&quot;</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></figure>
<p>另外虽然有<code>swagger/openapi</code>等标准，但是这些标准需要手写JSON Schema有点太过反人类……这套机制完全使用TypeScript写，不需要学习新的语法，还可以享受到编译器和IDE的支持。</p>
<h1 id="使用migration进行数据库初始化和更新"><a href="#使用migration进行数据库初始化和更新" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>使用migration进行数据库初始化和更新</h1>
<p>开发的时候，数据库的schema可以使用ORM框架自己产生，如果schema变了，直接删除原来的数据库重新创建就可以了。但是项目一旦在生产环境中开始使用了，就不能随便删除schema了。随便删schema不就变成删库跑路了嘛。</p>
<p>现在的ORM基本都提供了<code>Migration</code>机制进行数据库schema的更新。一个migration主要包含一个日期和一段更新的命令，有的框架还能提供撤销这次更新的命令。在执行时，ORM会根据日期判断当前数据库schema的版本，然后执行后续的数据库变更。</p>
<p>对于那些可以通过运行数据库命令就能完成的schema更新，通过migration机制能够有效地记录下对数据库的变更，并且能够在运行数据库变更之前检查变更是否是自己所需要的，防止破坏现有的数据。</p>
<p>当前的ORM框架也会常常提供很多方便的命令，例如</p>
<ul>
<li>根据Entity的变化和数据库的现状，自动生成migration代码</li>
<li>执行需要执行的migration</li>
<li>回退到某个migration</li>
</ul>
<p>很多维护工作都可以通过migration完成。</p>
<p>本项目使用<a href="https://mikro-orm.io/">mikro-orm</a>作为ORM库，也提供了内置的migration机制，下面是我的项目中所现有的migration。</p>
<pre><code>migrations
├── Migration20210331031030.ts
├── Migration20210402023841.ts
├── Migration20210414064450.ts
├── Migration20210424142314.ts
├── Migration20210426143345.ts
├── Migration20210428092351.ts
├── Migration20210715123945.ts
└── Migration20210719091704.ts
</code></pre>
<p>下面是一个migration的例子，<code>up</code>为执行这个migration所对应的SQL，<code>down</code>是撤销这个migration的命令。<code>up</code>是自动生成的，而<code>down</code>是自己写的。</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="ts" data-theme="one-dark-pro"><code data-language="ts" data-theme="one-dark-pro" style="display:grid"><span data-line=""><span style="color:#C678DD">import</span><span style="color:#ABB2BF"> { </span><span style="color:#E06C75">Migration</span><span style="color:#ABB2BF"> } </span><span style="color:#C678DD">from</span><span style="color:#98C379"> &#x27;@mikro-orm/migrations&#x27;</span><span style="color:#ABB2BF">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">export</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> Migration20210424142314</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> Migration</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">  async</span><span style="color:#61AFEF"> up</span><span style="color:#ABB2BF">(): </span><span style="color:#E5C07B">Promise</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">void</span><span style="color:#ABB2BF">&gt; {</span></span>
<span data-line=""><span style="color:#E5C07B">    this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addSql</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&#x27;alter table `team` change `file_relative_path` `filename` varchar(255) null;&#x27;</span><span style="color:#ABB2BF">);</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#C678DD">  async</span><span style="color:#61AFEF"> down</span><span style="color:#ABB2BF">(): </span><span style="color:#E5C07B">Promise</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">void</span><span style="color:#ABB2BF">&gt; {</span></span>
<span data-line=""><span style="color:#E5C07B">    this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addSql</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&#x27;alter table `team` change `filename` `file_relative_path` varchar(255) null;&#x27;</span><span style="color:#ABB2BF">);</span></span>
<span data-line=""><span style="color:#ABB2BF">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>我的工作流是这样的：</p>
<ol>
<li>在项目开发期间，仍然使用框架自动生成数据库schema的方法，让程序自己去更新数据库schema</li>
<li>在项目开始投用之前，使用<code>mikro-orm migration:create --initial</code>命令，创建第一个migration，并禁止程序自己操作数据库schema</li>
<li>项目部署后，使用<code>mikro-orm migration:up</code>执行第一个migration，程序开始运行</li>
<li>每次数据库更改后，使用<code>mikro-orm migration:create</code>命令，生成一个新的migration。打开新生成的migration文件检查SQL是否正确，并手写<code>down</code>方法</li>
<li>提交到生产机后，在<code>docker-compose up -d</code>前，使用<code>mikro-orm migration:up</code>执行migration</li>
</ol>
<p>当然migration也不能解决所有数据库变更的问题，migration也不能解决过于复杂的变更，所以在设计数据库schema时也需要谨慎、考虑到未来的可扩展性。</p>
<p>另外，前面说的记录尽可能多的信息在这里也有作用，记录尽可能多的信息也为以后增加使用新信息的新功能提供了可能。例如，我在实现群发邮件功能的时候，一开始没有在数据库中记录一次群发邮件的结束时间，只记录了开始时间。这时我已经群发了一次邮件了。而后续我又想增加记录和显示群发邮件的结束时间的功能，这时第一次群发邮件的信息就不能直接从数据库中获取了，丢失了信息。事实上，最后我是从log中获得第一个发送邮件的结束时间，然后手动修改数据库才填进去这个数据的。</p>
<h1 id="记录尽可能多的信息"><a href="#记录尽可能多的信息" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>记录尽可能多的信息</h1>
<p>在比赛临近结束、正在接受用户提交成果文件的时候，系统出了一场事故，丢失了一段时间内用户上传的文件。文章<a href="/articles/summary-of-a-file-lost-accident">一次生产环境的文件丢失事故：复盘和教训</a> 详细介绍了这个事故从发现到确定影响范围到确定原因的过程。在处理事故的过程中，后台程序记录的日志起到了巨大的作用。</p>
<p>同时，不仅是log，包括文件、数据库条目等保存的信息越多越好，能保存的信息尽可能保存，涉及到任何删除信息/文件等操作都应该谨慎。反正现在存储便宜，多用一点空间的成本和一旦发生事故造成的问题相比还是无关紧要的。</p>
<p>例如，在本项目中中为了节省磁盘空间和恶意上传文件，我设定了每个队伍只能上传一个文件，之后的上传会首先删除之前的文件。但是现在想起来，如果又有其他地方逻辑出错，把用户上传好的文件删除了怎么办？如果系统响应到一半被中断了，只删除了之前的文件，没有写入后面的文件怎么办？一切皆有可能，连字节跳动的实习生都能删掉机器学习模型，更何况我们这种没人审核代码的独立开发者？而至于防止恶意上传文件，也可以采用给团队能够使用的空间大小进行限额的方式来防止团队使用过多的空间，而不是一刀切地只能使用一个文件。</p>
<p>尽可能避免删除之前的信息，使得意外发生时，能够恢复到之前的状态，并且更方便去诊断问题。</p>
<h1 id="安全性"><a href="#安全性" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>安全性</h1>
<p>为了防止用户作恶，我针对系统的安全性做了一些有限的工作：</p>
<ul>
<li>验证API接口传入的参数（见下部分）</li>
<li>数据库中密文保存用户密码</li>
<li>数据库密码、JWT密钥等都是高强度的随机密码</li>
<li>没有必要公网公开的部分都没有公开（比如数据库等）</li>
<li>为了防止用户上传太多文件占满服务器存储，限制了一个用户只能有一个文件，后续上传文件会删除之前上传的文件</li>
<li>为了防止用户spam邮件，发送重置密码的邮件时，一个用户每30分钟才能发一条</li>
<li>为了防止用户下载其他团队的提交的文件
<ul>
<li>关闭了<code>fastify-static</code>和<code>nginx</code>的serve整个目录的功能</li>
<li>下载提交的文件也需要验证token，这使得前端也得需要通过手动实现下载，而不能直接让浏览器处理下载链接</li>
</ul>
</li>
<li>为了防止用户提交的文件名过长（Linux下文件块最长255），在上传文件时验证文件名长度，拒绝过长文件名的文件</li>
</ul>
<p>个人感觉这些措施应该是一些比较容易想到的措施了，但是当然，这些措施对一些真正的攻击也无能为力，比如注册和登录都可以随便请求，攻击者可以无限注册账号，可以无限猜测密码来登录，更别说什么DDOS攻击了。还好，目前据我所知还没有遇到恶意的使用者。</p>
<h1 id="准备应对外部系统出的问题"><a href="#准备应对外部系统出的问题" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>准备应对外部系统出的问题</h1>
<p>后端和数据库之间的交互已经被做透了，一般也不会出问题，出了问题也有各种方案进行恢复。但是一个非玩具系统肯定会支持处理数据库之外的其他功能，而实现这些功能往往会使用到外部服务。这些外部服务总可能会遇到的一些问题，所以在功能实现的时候就需要考虑到外部服务器的稳定性，并做好外部服务出问题的准备，例如采用上面提到的记录尽可能多的信息的方法。</p>
<p>举个本系统的群发邮件相关的例子。系统需要支持向参赛人员群发邮件的功能，而学校提供了SMTP服务器。我当时考虑到发送邮件可能失败，就记录下发送失败的用户的用户名（下图中<code>failedUserId</code>）。当时前面发了几次邮件都没有失败，看起来学校的服务还挺稳定，当时也有点忙，就没有实现失败重发的功能，这个字段就一直没用上。</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="ts" data-theme="one-dark-pro"><code data-language="ts" data-theme="one-dark-pro" style="display:grid"><span data-line=""><span style="color:#ABB2BF">@</span><span style="color:#61AFEF">Entity</span><span style="color:#ABB2BF">()</span></span>
<span data-line=""><span style="color:#C678DD">export</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> GroupEmailDelivery</span><span style="color:#ABB2BF"> {</span></span>
<span data-line=""><span style="color:#7F848E;font-style:italic">  // ...</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#ABB2BF">  @</span><span style="color:#61AFEF">Property</span><span style="color:#ABB2BF">({ </span><span style="color:#E06C75">type</span><span style="color:#ABB2BF">: </span><span style="color:#C678DD">new</span><span style="color:#61AFEF"> ArrayType</span><span style="color:#ABB2BF">((</span><span style="color:#E06C75;font-style:italic">x</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=&gt;</span><span style="color:#56B6C2"> +</span><span style="color:#E06C75">x</span><span style="color:#ABB2BF">) })</span></span>
<span data-line=""><span style="color:#E06C75">  failedUsersId</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">number</span><span style="color:#ABB2BF">[] </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> [];</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#7F848E;font-style:italic">  // ...</span></span>
<span data-line=""><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>结果在16日的一次发送邮件中，系统突然报了不少的错误，一看都是邮件服务器报的错误。</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#282c34;color:#abb2bf" tabindex="0" data-language="json" data-theme="one-dark-pro"><code data-language="json" data-theme="one-dark-pro" style="display:grid"><span data-line=""><span style="color:#D19A66">2021-07-16</span><span style="color:#D19A66"> 15</span><span style="color:#ABB2BF">:</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">:</span><span style="color:#D19A66">13</span></span>
<span data-line=""><span style="color:#ABB2BF">{</span><span style="color:#E06C75">&quot;level&quot;</span><span style="color:#ABB2BF">:</span><span style="color:#D19A66">50</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;time&quot;</span><span style="color:#ABB2BF">:</span><span style="color:#D19A66">1626419413258</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;pid&quot;</span><span style="color:#ABB2BF">:</span><span style="color:#D19A66">33</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;hostname&quot;</span><span style="color:#ABB2BF">:</span><span style="color:#98C379">&quot;7534d898d7e5&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;code&quot;</span><span style="color:#ABB2BF">:</span><span style="color:#98C379">&quot;EAUTH&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;response&quot;</span><span style="color:#ABB2BF">:</span><span style="color:#98C379">&quot;550 User suspended&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;responseCode&quot;</span><span style="color:#ABB2BF">:</span><span style="color:#D19A66">550</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;command&quot;</span><span style="color:#ABB2BF">:</span><span style="color:#98C379">&quot;AUTH PLAIN&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;stack&quot;</span><span style="color:#ABB2BF">:</span><span style="color:#98C379">&quot;Error: Invalid login: 550 User suspended</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">    at SMTPConnection._formatError (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:774:19)</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">    at SMTPConnection._actionAUTHComplete (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:1513:34)</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">    at SMTPConnection.&lt;anonymous&gt; (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:540:26)</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">    at SMTPConnection._processResponse (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:932:20)</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">    at SMTPConnection._onData (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:739:14)</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">    at TLSSocket.SMTPConnection._onSocketData (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:189:44)</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">    at TLSSocket.emit (events.js:315:20)</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">    at TLSSocket.EventEmitter.emit (domain.js:467:12)</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">    at addChunk (internal/streams/readable.js:309:12)</span><span style="color:#56B6C2">\n</span><span style="color:#98C379">    at readableAddChunk (internal/streams/readable.js:284:9)&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;type&quot;</span><span style="color:#ABB2BF">:</span><span style="color:#98C379">&quot;Error&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75">&quot;msg&quot;</span><span style="color:#ABB2BF">:</span><span style="color:#98C379">&quot;Invalid login: 550 User suspended&quot;</span><span style="color:#ABB2BF">}</span></span></code></pre></figure>
<p>马上去找提供SMTP服务器的老师请求解决这个问题，在此期间做了重发邮件的功能，因为有了<code>failedUserId</code>字段，我可以直接从数据库中获得需要重发的邮件，实现这个功能就很简单了。</p>
<pre><code>commit d4366a3c45261ead399940552bfc67b3547eb7e6
Author: Chen Junda &lt;ddadaal@outlook.com&gt;
Date:   Fri Jul 16 15:44:39 2021 +0800

    add retry failed email
</code></pre>
<p>当SMTP服务器的问题解决后，这个新功能也做好了，直接上线，点一个键，就能重发邮件了。</p>
<p><figure><img alt="失败和重发" loading="lazy" width="1020" height="203" decoding="async" data-nimg="1" class="cursor-zoom-in mx-auto" style="color:transparent" srcSet="/articles/asset/contents/20210721-summary-of-my-first-real-project/resend-email.png?width=1080 1x, /articles/asset/contents/20210721-summary-of-my-first-real-project/resend-email.png?width=2048 2x" src="/articles/asset/contents/20210721-summary-of-my-first-real-project/resend-email.png?width=2048"/><figcaption class="text-center">失败和重发</figcaption></figure></p>
<p>试想要是当时没有存<code>failedUsersId</code>，我还得又去从log中获得失败的用户ID，过程非常的繁琐和复杂。</p>
<h1 id="还可以改进的点"><a href="#还可以改进的点" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>还可以改进的点</h1>
<ul>
<li><strong>CI/CD</strong></li>
</ul>
<p>这次偷懒没有做CI/CD，使得每次部署完之后我都得去服务器上跑一下<code>docker-compose build &amp;&amp; docker-compose up -d</code>，由于机器只能通过校园网，没有校园网的时候还必须接个VPN才能进去，比较麻烦。</p>
<ul>
<li><strong>预生产环境</strong></li>
</ul>
<p>我理解的预生产环境，就是一个和生产环境完全相同的机器，使用生产环境的数据的某个历史快照，对新的代码进行测试，测试通过后，再将代码放到生产环境中运行</p>
<p>这次部署没有预生产环境，代码在本地测试通过之后直接就扔到生产服务器上构建和部署了，没有使用实际测试数据进行测试</p>
<p>这其实也是后面生产事故的一大原因，有缺陷的代码没有真实测过就扔到生产环境，造成了问题</p>
<ul>
<li><strong>graceful shutdown和不中断服务的更新</strong></li>
</ul>
<p>这次项目的部署都是直接重启容器，如果此时有响应正在处理，可能会造成响应做到一半被强制中断。一个好的策略是graceful shutdown，在退出之前的服务时，停止接受新的请求并处理完正在进行的请求，这样可以避免运行到一半的服务（数据库操作有事务保护，但是处理请求可没有事务）。</p>
<p>另外，<code>docker-compose up -d</code>虽然启动速度较快，但是仍然有一定的downtime，如果对服务质量有要求，0 downtime的不中断服务的更新还是非常有必要的</p>
<ul>
<li><strong>前端测试</strong></li>
</ul>
<p>本项目写了不少后端的测试，行覆盖达到了94%，但是没有写前端测试，这造成每次改前端之后，部署后都心惊胆战的，不知道在真实环境中会不会出现问题。</p>
<p>但是写测试也有它的问题：<strong>花时间</strong>。</p>
<p>现在项目中后端的测试代码比业务逻辑代码要多，写测试代码花的时间也比写真实业务逻辑代码更多。而且由于测试代码也是代码，也会出问题（而且常常会出问题），有时候测试通不过，调试半天测试代码之后发现业务代码没有错，是测试代码的错……</p>
<p>而前端就更复杂了。前端的测试可不是1+1=2正确、=3就错误那么简单。定位UI元素、操作UI元素、等待UI元素的响应、判断UI元素的响应是否合需求，每一部都有一大堆API需要学校。另外，尤其是对于业务项目，很多前端其实并没有一个完整详细的设计文档，什么样的UI是正确的根本就不确定。目前，除了自己的两个前端库，我从来没写过正经的完整项目的前端测试。</p>
<p>我当前的想法是只针对一些复杂一点的业务操作写测试，具体什么样的业务算复杂，只能看实际情况了。</p>
<h1 id="总结"><a href="#总结" class="mr-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="inline-block opacity-20 hover:opacity-60" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg></a>总结</h1>
<p>这个项目比较简单，规模也比较小（12000行左右），用户量也比较小，什么优行操作都没有做，一个简单的前后端结构就能满足需求，但是中途还是犯了很多错误，最后丢失文件的事故也带来了比较多的麻烦。不管怎样，这个项目至少也让我自己完整走了一次一个项目从开发到上线的流程，学到了一些写玩具项目永远都不会用上的技能（比如grafana）。我终于有一个不是玩具的项目了！</p>
<p>现在纯业务的工作确实做得比较腻了，简单的CRUD做来做去也就那些东西。以后希望能够做点更偏架构上的工作，能够支持规模更大、要求更高的项目，也通过更大的项目去接触更高级的项目和流程。我也希望能够带团队或者加入一个能够参与项目全程的已有团队，挑战一下复杂度更高的项目，并从中练习一下团队合作和领导能力。</p></div><div class="hidden lg:block lg:w-[25%]"><div class="px-1 sticky top-24 max-h-[60vh] overflow-auto"><div class="flex space-x-1 items-center py-2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"></path></svg><span>目录</span></div><ul class="pl-2 border-l border-neutral"><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="summary" href="#summary"><span class="font-bold">✨AI全文总结</span></a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="我的第一个真实项目" href="#我的第一个真实项目">我的第一个真实项目</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="系统功能架构规模" href="#系统功能架构规模">系统功能、架构、规模</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="几次重构" href="#几次重构">几次重构</a><ul class="pl-2 border-l border-neutral"><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="create-react-app到nextjs" href="#create-react-app到nextjs">Create React App到Next.js</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="非响应式到响应式" href="#非响应式到响应式">非响应式到响应式</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="部署prometheuslokigrafana" href="#部署prometheuslokigrafana">部署Prometheus/Loki/Grafana</a></li></ul></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="前后端共享api定义" href="#前后端共享api定义">前后端共享API定义</a><ul class="pl-2 border-l border-neutral"><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="定义接口" href="#定义接口">定义接口</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="后端实现接口" href="#后端实现接口">后端实现接口</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="前端调用接口" href="#前端调用接口">前端调用接口</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="减少重复提高效率" href="#减少重复提高效率">减少重复，提高效率</a></li></ul></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="使用migration进行数据库初始化和更新" href="#使用migration进行数据库初始化和更新">使用migration进行数据库初始化和更新</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="记录尽可能多的信息" href="#记录尽可能多的信息">记录尽可能多的信息</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="安全性" href="#安全性">安全性</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="准备应对外部系统出的问题" href="#准备应对外部系统出的问题">准备应对外部系统出的问题</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="还可以改进的点" href="#还可以改进的点">还可以改进的点</a></li><li class="w-full text-sm"><a class="transition hover:bg-base-300 rounded w-full flex p-1" data-tocid="总结" href="#总结">总结</a></li></ul></div></div></div></div><div class="max-w-7xl mx-auto p-4"><div><h2 class="text-2xl font-bold mb-2 flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg><span class="mx-2">相关文章</span></h2><div class="flex flex-wrap gap-2"><div class="card w-96 bg-base-100 shadow-lg hover:shadow-xl transition"><div class="card-body"><span class="text-sm">2021-07-21 13:13:00 UTC+8</span><a href="/articles/summary-of-a-file-lost-accident/cn"><h2 class="card-title">一次生产环境的文件丢失事故：复盘和教训</h2></a><p>
# 生产事故

我最近负责了一个比赛后台网站的开发和维护，在比赛临近结束、正在接受用户提交成果文件的时候出了一场生产事故，造成了丢失了一段时间内用户上传的文件。本文主要讲讲生产事故从发现到确定影响范</p></div></div></div></div></div><div class="max-w-7xl mx-auto p-4"><div><h2 class="text-2xl font-bold mb-2 flex items-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"></path></svg><span class="mx-2"> 评论</span></h2></div></div></div></article></div><footer class="bg-base-200 text-base-content"><div class="footer py-6 max-w-7xl mx-auto px-4"><div class="space-y-1"><p>👨🏼‍💻 <!-- -->本网站由<a class="link link-hover" href="/about/me/cn">ddadaal</a>自豪地编写</p><p>📝<!-- -->本站文章在<a rel="licene noreferrer" target="_blank" class="link" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>协议下授权</p><div class="tooltip" data-tip="2018-11-17 06:51:00 UTC+0"><p>📅 <!-- -->博客已经运行 <span class="countdown"><span style="--value:5"></span></span> 年 <span class="countdown"><span style="--value:2"></span></span> 月 <span class="countdown"><span style="--value:17"></span></span> 天 <span class="countdown"><span style="--value:7"></span></span> 时 <span class="countdown"><span style="--value:54"></span></span> 分 <span class="countdown"><span style="--value:0"></span></span> 秒</p></div><p>⏲️ <!-- -->最后更新<!-- -->:  <!-- -->2024-01-07 14:45:00 UTC+0</p><div><p>📲 <!-- -->联系我</p><div class="flex py-2 gap-2"><span><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=540232834&amp;site=qq&amp;menu=yes" title="QQ: 540232834" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"></path></svg></a></span><span><a href="mailto://ddadaal.me@outlook.com" title="E-mail: ddadaal@outlook.com" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M160 448c-25.6 0-51.2-22.4-64-32-64-44.8-83.2-60.8-96-70.4V480c0 17.67 14.33 32 32 32h256c17.67 0 32-14.33 32-32V345.6c-12.8 9.6-32 25.6-96 70.4-12.8 9.6-38.4 32-64 32zm128-192H32c-17.67 0-32 14.33-32 32v16c25.6 19.2 22.4 19.2 115.2 86.4 9.6 6.4 28.8 25.6 44.8 25.6s35.2-19.2 44.8-22.4c92.8-67.2 89.6-67.2 115.2-86.4V288c0-17.67-14.33-32-32-32zm256-96H224c-17.67 0-32 14.33-32 32v32h96c33.21 0 60.59 25.42 63.71 57.82l.29-.22V416h192c17.67 0 32-14.33 32-32V192c0-17.67-14.33-32-32-32zm-32 128h-64v-64h64v64zm-352-96c0-35.29 28.71-64 64-64h224V32c0-17.67-14.33-32-32-32H96C78.33 0 64 14.33 64 32v192h96v-32z"></path></svg></a></span><span><a href="https://www.linkedin.com/in/chenjunda/" title="LinkedIn: 陈俊达" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></span><span><a href="https://github.com/ddadaal" title="GitHub: ddadaal" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></span><span><a href="https://steamcommunity.com/profiles/76561198104889782" title="Steam: Victor Crubs" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M496 256c0 137-111.2 248-248.4 248-113.8 0-209.6-76.3-239-180.4l95.2 39.3c6.4 32.1 34.9 56.4 68.9 56.4 39.2 0 71.9-32.4 70.2-73.5l84.5-60.2c52.1 1.3 95.8-40.9 95.8-93.5 0-51.6-42-93.5-93.7-93.5s-93.7 42-93.7 93.5v1.2L176.6 279c-15.5-.9-30.7 3.4-43.5 12.1L0 236.1C10.2 108.4 117.1 8 247.6 8 384.8 8 496 119 496 256zM155.7 384.3l-30.5-12.6a52.79 52.79 0 0 0 27.2 25.8c26.9 11.2 57.8-1.6 69-28.4 5.4-13 5.5-27.3.1-40.3-5.4-13-15.5-23.2-28.5-28.6-12.9-5.4-26.7-5.2-38.9-.6l31.5 13c19.8 8.2 29.2 30.9 20.9 50.7-8.3 19.9-31 29.2-50.8 21zm173.8-129.9c-34.4 0-62.4-28-62.4-62.3s28-62.3 62.4-62.3 62.4 28 62.4 62.3-27.9 62.3-62.4 62.3zm.1-15.6c25.9 0 46.9-21 46.9-46.8 0-25.9-21-46.8-46.9-46.8s-46.9 21-46.9 46.8c.1 25.8 21.1 46.8 46.9 46.8z"></path></svg></a></span><span><a href="https://zhihu.com/people/VicCrubs" title="知乎：陈俊达" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><path d="M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z"></path></svg></a></span><span><a href="https://www.douban.com/people/183064260/" title="豆瓣: ddadaal" target="_blank" class="block transition hover:scale-125" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="22.400000000000002" width="22.400000000000002" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M.51 3.06h22.98V.755H.51V3.06Zm20.976 2.537v9.608h-2.137l-1.669 5.76H24v2.28H0v-2.28h6.32l-1.67-5.76H2.515V5.597h18.972Zm-5.066 9.608H7.58l1.67 5.76h5.501l1.67-5.76ZM18.367 7.9H5.634v5.025h12.733V7.9Z"></path></svg></a></span></div></div><p class="text-center">© <!-- -->2024<!-- --> | <!-- -->用 ❤ 制作</p></div><div><span class="footer-title">🚀 <!-- -->强力驱动</span><a class="link link-hover" target="_blank" href="https://reactjs.org/" rel="noreferrer">React</a><a class="link link-hover" target="_blank" href="https://nextjs.org/" rel="noreferrer">Next.js</a><a class="link link-hover" target="_blank" href="https://pages.github.com/" rel="noreferrer">GitHub Pages</a><a class="link link-hover" target="_blank" href="https://www.typescriptlang.org/" rel="noreferrer">TypeScript</a></div><div><span class="footer-title">🎨 <!-- -->描绘主题</span><a class="link link-hover" target="_blank" href="https://daisyui.com/" rel="noreferrer">daisyui</a><a class="link link-hover" target="_blank" href="https://tailwindcss.com/" rel="noreferrer">tailwind</a></div><div><span class="footer-title">🎓 <!-- -->联系我</span><a class="link link-hover" target="_blank" href="https://idealclover.top" rel="noreferrer">idealclover - 翠翠酱的个人网站</a><a class="link link-hover" target="_blank" href="https://sephidator.xyz" rel="noreferrer">Sephidator - Sephidator的个人博客</a><a class="link link-hover" target="_blank" href="https://iznauy.github.io/" rel="noreferrer">iznauy - 个人博客</a><a class="link link-hover" target="_blank" href="https://aironoria.github.io" rel="noreferrer">Aironoria - 陈俊宇的个人博客</a><a class="link link-hover" target="_blank" href="https://jbesu.com/" rel="noreferrer">forewing - 个人主页</a><a class="link link-hover" target="_blank" href="https://weiser.fun" rel="noreferrer">Weiser - 个人主页</a></div></div></footer><button class="fixed animate-slide-up bottom-8 right-8 z-50 p-3 rounded-full bg-base-300 text-base-content shadow" title="To top"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="w-6 h-6" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></svg></button><script src="/_next/static/chunks/webpack-dd3227a94d309980.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/df9dc4ec439e9f96.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/550cc6711c036586.css\",\"style\",{\"crossOrigin\":\"\"}]\n4:HL[\"/_next/static/css/aa74b8ca7fffeadf.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[8546,[],\"\"]\n8:I[1949,[],\"\"]\na:I[881,[],\"\"]\nd:I[3076,[],\"\"]\n9:[\"params\",\"summary-of-my-first-real-project/cn\",\"oc\"]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/df9dc4ec439e9f96.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"MLZo4SaIYXDI7v6NBe4Cn\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/articles/summary-of-my-first-real-project/cn\",\"initialTree\":[\"\",{\"children\":[\"articles\",{\"children\":[[\"params\",\"summary-of-my-first-real-project/cn\",\"oc\"],{\"children\":[\"__PAGE__?{\\\"params\\\":[\\\"summary-of-my-first-real-project\\\",\\\"cn\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"articles\",{\"children\":[[\"params\",\"summary-of-my-first-real-project/cn\",\"oc\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"articles\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/550cc6711c036586.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/aa74b8ca7fffeadf.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"articles\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,\"$Lb\",null]],\"initialHead\":[false,\"$Lc\"],\"globalErrorComponent\":\"$d\"}]]\n"])</script><script>self.__next_f.push([1,"f:I[7765,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c7265.js\",\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"874\",\"static/chunks/874-48b1b2f8f137fd6b.js\",\"185\",\"static/chunks/app/layout-a85f49657d48d313.js\"],\"RootLayout\"]\n10:I[2235,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c7265.js\",\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"874\",\"static/chunks/874-48b1b2f8f137fd6b.js\",\"185\",\"static/chunks/app/layout-a85f49657d48d"])</script><script>self.__next_f.push([1,"313.js\"],\"\"]\n11:I[6834,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c7265.js\",\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"874\",\"static/chunks/874-48b1b2f8f137fd6b.js\",\"185\",\"static/chunks/app/layout-a85f49657d48d313.js\"],\"Header\"]\n12:I[4307,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c7265.js\",\"318\",\"static/chunks/bb1d9007-fdc4463f6b8d4248.js\",\"691\",\"static/chunks/37144445-281a1eece1f23f91.js\",\"93\",\"static/chunks/c145f854-c353ee343fa63f93.js\",\"234\",\"static/chunks/"])</script><script>self.__next_f.push([1,"234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"602\",\"static/chunks/602-9071b7ef50a964e6.js\",\"464\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-8f16d82c55e99bb9.js\"],\"Localized\"]\n13:I[9586,[\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"931\",\"static/chunks/app/page-b6791deb8a823a9c.js\"],\"LocalizedArticleLink\"]\n14:I[820,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c7265.js\",\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static"])</script><script>self.__next_f.push([1,"/chunks/729-059eec2a014f5f62.js\",\"874\",\"static/chunks/874-48b1b2f8f137fd6b.js\",\"185\",\"static/chunks/app/layout-a85f49657d48d313.js\"],\"RunningTime\"]\n15:I[7688,[\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"931\",\"static/chunks/app/page-b6791deb8a823a9c.js\"],\"LastUpdateTime\"]\n18:I[555,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c7265.js\",\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"874\",\"static/chunks/874-48b1b2f8f137f"])</script><script>self.__next_f.push([1,"d6b.js\",\"185\",\"static/chunks/app/layout-a85f49657d48d313.js\"],\"ToTop\"]\n7:\"$Le\"\n16:T518,"])</script><script>self.__next_f.push([1,"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"])</script><script>self.__next_f.push([1,"17:T5b8,"])</script><script>self.__next_f.push([1,"M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z"])</script><script>self.__next_f.push([1,"b:[\"$\",\"$Lf\",null,{\"children\":[[\"$\",\"$L10\",null,{\"data-host\":\"https://services.ddadaal.me\",\"data-dnt\":\"false\",\"src\":\"https://services.ddadaal.me/monitor/script.js\",\"id\":\"ZwSg9rf6GA\",\"async\":true,\"defer\":true}],[\"$\",\"$L11\",null,{\"resumeLangs\":[\"cn\",\"en\"]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}],[\"$\",\"footer\",null,{\"className\":\"bg-base-200 text-base-content\",\"children\":[\"$\",\"div\",null,{\"className\":\"footer py-6 max-w-7xl mx-auto px-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-y-1\",\"children\":[[\"$\",\"p\",null,{\"children\":[\"👨🏼‍💻 \",[\"$\",\"$L12\",null,{\"id\":\"footer.codeBy\",\"args\":[[\"$\",\"$L13\",\"about/me\",{\"className\":\"link link-hover\",\"basePath\":\"/about/me\",\"children\":\"ddadaal\"}]]}]]}],[\"$\",\"p\",null,{\"children\":[\"📝\",[\"$\",\"$L12\",null,{\"id\":\"footer.license\",\"args\":[[\"$\",\"a\",\"license\",{\"rel\":\"licene noreferrer\",\"target\":\"_blank\",\"className\":\"link\",\"href\":\"https://creativecommons.org/licenses/by-sa/4.0/\",\"children\":\"CC BY-SA 4.0\"}]]}]]}],[\"$\",\"$L14\",null,{\"serverStartTime\":\"2024-01-07T14:45:00.251+00:00\"}],[\"$\",\"$L15\",null,{\"time\":\"2024-01-07T14:45:00.251+00:00\"}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"📲 \",[\"$\",\"$L12\",null,{\"id\":\"footer.contacts\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex py-2 gap-2\",\"children\":[[\"$\",\"span\",\"http://wpa.qq.com/msgrd?v=3\u0026uin=540232834\u0026site=qq\u0026menu=yes\",{\"children\":[\"$\",\"a\",null,{\"href\":\"http://wpa.qq.com/msgrd?v=3\u0026uin=540232834\u0026site=qq\u0026menu=yes\",\"title\":\"QQ: 540232834\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 448 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"mailto://ddadaal.me@outlook.com\",{\"children\":[\"$\",\"a\",null,{\"href\":\"mailto://ddadaal.me@outlook.com\",\"title\":\"E-mail: ddadaal@outlook.com\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 576 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M160 448c-25.6 0-51.2-22.4-64-32-64-44.8-83.2-60.8-96-70.4V480c0 17.67 14.33 32 32 32h256c17.67 0 32-14.33 32-32V345.6c-12.8 9.6-32 25.6-96 70.4-12.8 9.6-38.4 32-64 32zm128-192H32c-17.67 0-32 14.33-32 32v16c25.6 19.2 22.4 19.2 115.2 86.4 9.6 6.4 28.8 25.6 44.8 25.6s35.2-19.2 44.8-22.4c92.8-67.2 89.6-67.2 115.2-86.4V288c0-17.67-14.33-32-32-32zm256-96H224c-17.67 0-32 14.33-32 32v32h96c33.21 0 60.59 25.42 63.71 57.82l.29-.22V416h192c17.67 0 32-14.33 32-32V192c0-17.67-14.33-32-32-32zm-32 128h-64v-64h64v64zm-352-96c0-35.29 28.71-64 64-64h224V32c0-17.67-14.33-32-32-32H96C78.33 0 64 14.33 64 32v192h96v-32z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://www.linkedin.com/in/chenjunda/\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/chenjunda/\",\"title\":\"LinkedIn: 陈俊达\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 448 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://github.com/ddadaal\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/ddadaal\",\"title\":\"GitHub: ddadaal\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 496 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$16\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://steamcommunity.com/profiles/76561198104889782\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://steamcommunity.com/profiles/76561198104889782\",\"title\":\"Steam: Victor Crubs\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 496 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M496 256c0 137-111.2 248-248.4 248-113.8 0-209.6-76.3-239-180.4l95.2 39.3c6.4 32.1 34.9 56.4 68.9 56.4 39.2 0 71.9-32.4 70.2-73.5l84.5-60.2c52.1 1.3 95.8-40.9 95.8-93.5 0-51.6-42-93.5-93.7-93.5s-93.7 42-93.7 93.5v1.2L176.6 279c-15.5-.9-30.7 3.4-43.5 12.1L0 236.1C10.2 108.4 117.1 8 247.6 8 384.8 8 496 119 496 256zM155.7 384.3l-30.5-12.6a52.79 52.79 0 0 0 27.2 25.8c26.9 11.2 57.8-1.6 69-28.4 5.4-13 5.5-27.3.1-40.3-5.4-13-15.5-23.2-28.5-28.6-12.9-5.4-26.7-5.2-38.9-.6l31.5 13c19.8 8.2 29.2 30.9 20.9 50.7-8.3 19.9-31 29.2-50.8 21zm173.8-129.9c-34.4 0-62.4-28-62.4-62.3s28-62.3 62.4-62.3 62.4 28 62.4 62.3-27.9 62.3-62.4 62.3zm.1-15.6c25.9 0 46.9-21 46.9-46.8 0-25.9-21-46.8-46.9-46.8s-46.9 21-46.9 46.8c.1 25.8 21.1 46.8 46.9 46.8z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://zhihu.com/people/VicCrubs\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://zhihu.com/people/VicCrubs\",\"title\":\"知乎：陈俊达\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 640 512\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$17\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}],[\"$\",\"span\",\"https://www.douban.com/people/183064260/\",{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.douban.com/people/183064260/\",\"title\":\"豆瓣: ddadaal\",\"target\":\"_blank\",\"className\":\"block transition hover:scale-125\",\"rel\":\"noreferrer\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"role\":\"img\",\"viewBox\":\"0 0 24 24\",\"children\":[\"$undefined\",[[\"$\",\"title\",\"0\",{\"children\":[]}],[\"$\",\"path\",\"1\",{\"d\":\"M.51 3.06h22.98V.755H.51V3.06Zm20.976 2.537v9.608h-2.137l-1.669 5.76H24v2.28H0v-2.28h6.32l-1.67-5.76H2.515V5.597h18.972Zm-5.066 9.608H7.58l1.67 5.76h5.501l1.67-5.76ZM18.367 7.9H5.634v5.025h12.733V7.9Z\",\"children\":\"$undefined\"}]]],\"className\":\"$undefined\",\"style\":{\"color\":\"$undefined\"},\"height\":22.400000000000002,\"width\":22.400000000000002,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}]}]]}]]}],[\"$\",\"p\",null,{\"className\":\"text-center\",\"children\":[\"© \",2024,\" | \",[\"$\",\"$L12\",null,{\"id\":\"footer.madeWithLove\"}]]}]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"footer-title\",\"children\":[\"🚀 \",[\"$\",\"$L12\",null,{\"id\":\"footer.poweredBy\"}]]}],[[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://reactjs.org/\",\"rel\":\"noreferrer\",\"children\":\"React\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://nextjs.org/\",\"rel\":\"noreferrer\",\"children\":\"Next.js\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://pages.github.com/\",\"rel\":\"noreferrer\",\"children\":\"GitHub Pages\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://www.typescriptlang.org/\",\"rel\":\"noreferrer\",\"children\":\"TypeScript\"}]]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"footer-title\",\"children\":[\"🎨 \",[\"$\",\"$L12\",null,{\"id\":\"footer.themedWith\"}]]}],[[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://daisyui.com/\",\"rel\":\"noreferrer\",\"children\":\"daisyui\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://tailwindcss.com/\",\"rel\":\"noreferrer\",\"children\":\"tailwind\"}]]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"footer-title\",\"children\":[\"🎓 \",[\"$\",\"$L12\",null,{\"id\":\"footer.contacts\"}]]}],[[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://idealclover.top\",\"rel\":\"noreferrer\",\"children\":\"idealclover - 翠翠酱的个人网站\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://sephidator.xyz\",\"rel\":\"noreferrer\",\"children\":\"Sephidator - Sephidator的个人博客\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://iznauy.github.io/\",\"rel\":\"noreferrer\",\"children\":\"iznauy - 个人博客\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://aironoria.github.io\",\"rel\":\"noreferrer\",\"children\":\"Aironoria - 陈俊宇的个人博客\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://jbesu.com/\",\"rel\":\"noreferrer\",\"children\":\"forewing - 个人主页\"}],[\"$\",\"a\",null,{\"className\":\"link link-hover\",\"target\":\"_blank\",\"href\":\"https://weiser.fun\",\"rel\":\"noreferrer\",\"children\":\"Weiser - 个人主页\"}]]]}]]}]}],[\"$\",\"$L18\",null,{}]]}]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"我的第一个真实项目：总结和经验 - ddadaal.me\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"ddadaal's personal website\"}],[\"$\",\"link\",\"4\",{\"rel\":\"manifest\",\"href\":\"/site.webmanifest\"}],[\"$\",\"link\",\"5\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"link\",\"6\",{\"rel\":\"icon\",\"href\":\"/icon.svg?35be8e76be1c3618\",\"type\":\"image/svg+xml\",\"sizes\":\"any\"}],[\"$\",\"link\",\"7\",{\"rel\":\"apple-touch-icon\",\"href\":\"/apple-icon.png?5334a64f42000bb0\",\"type\":\"image/png\",\"sizes\":\"180x180\"}]]\n"])</script><script>self.__next_f.push([1,"6:null\n"])</script><script>self.__next_f.push([1,"19:I[2853,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c7265.js\",\"318\",\"static/chunks/bb1d9007-fdc4463f6b8d4248.js\",\"691\",\"static/chunks/37144445-281a1eece1f23f91.js\",\"93\",\"static/chunks/c145f854-c353ee343fa63f93.js\",\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"602\",\"static/chunks/602-9071b7ef50a964e6.js\",\"464\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-8f16d82c55e99bb9.js\"],\"ArticleFrontmatter\"]\n1c:I[5917,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c72"])</script><script>self.__next_f.push([1,"65.js\",\"318\",\"static/chunks/bb1d9007-fdc4463f6b8d4248.js\",\"691\",\"static/chunks/37144445-281a1eece1f23f91.js\",\"93\",\"static/chunks/c145f854-c353ee343fa63f93.js\",\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"602\",\"static/chunks/602-9071b7ef50a964e6.js\",\"464\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-8f16d82c55e99bb9.js\"],\"RelatedArticles\"]\n1d:I[9875,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c7265.js\",\"318\",\"static/chunks/bb1d9007-fdc4463f6b8d4248.js\","])</script><script>self.__next_f.push([1,"\"691\",\"static/chunks/37144445-281a1eece1f23f91.js\",\"93\",\"static/chunks/c145f854-c353ee343fa63f93.js\",\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"602\",\"static/chunks/602-9071b7ef50a964e6.js\",\"464\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-8f16d82c55e99bb9.js\"],\"CommentPanelWithCurrentLanguage\"]\n1a:T71c8,"])</script><script>self.__next_f.push([1,"\n# 我的第一个真实项目\n\n终于，从3月15日开始，我自己独立承担了一个完整的、真实的项目的开发和整个软件生命周期的维护工作：https://data-competition.pku.edu.cn ，第三届全国高校数据驱动创新研究大赛的后台系统（代码目前放在学校gitlab上，以后应该会把代码放到github上）。\n\n虽然这还是一个常规的CRUD项目，但是毕竟是我第一个能够被真实用户使用的系统，我还是比较激动的。项目中途遇到了几次重构，最后出现了一次生产事故，其他的总体流程还是比较顺利的。\n\n项目现在已经基本结束了，这里写一篇总结文，介绍一下项目的架构、演进、自己设置的一套前后端共用API的机制、以及在这个过程中的经验。\n\n# 系统功能、架构、规模\n\n下面是系统的用例图，主要完成一个比赛报名系统的用户管理、团队管理和上传提交文件操作，还对管理员实现了查看用户和团队信息以及群发邮件功能。\n\n![用例图](usecase.png)\n\n总的来说，系统是一个做了SSR的前后端分离的TypeScript全栈项目，下表为项目的技术栈。\n\n| 部分     | 技术栈                      |\n| -------- | --------------------------- |\n| 编程语言 | TypeScript                  |\n| 前端框架 | Next.js                     |\n| UI库     | Ant Design                  |\n| 后端框架 | fastify                     |\n| 反向代理 | nginx                       |\n| 数据库   | MySQL                       |\n| 部署     | Docker + Docker Compose     |\n| 监控     | Prometheus + Loki + Grafana |\n| 外部服务 | 学校提供的SMTP服务器        |\n\n下图是系统各个部分的架构图，监控部分其他的各个小组件就没有画了。\n\n![架构图](architecture.png)\n\n每个部分（包括nginx、数据库）都是使用容器运行，所有容器部署在一台2核2G内存的学校提供的虚拟机上。这个机器前面还有其他机器，负责SSL和开放到公网，所以这台机器本身是不能直接从公网访问的（连我上机器都需要使用VPN连接），这就带来了安全性：我可以使用最前面的nginx的来控制各个部分的可访问性。在我的配置中，nginx开放了80（前端）、5000（后端）和grafana的端口。grafana是否应该被公网访问我还不好说，但是由于grafana可以设置用户名和密码，应该安全性还好。\n\n用docker运行的好处很显著：不管机器是什么样的，直接`docker-compose build`和`docker-compose up -d`就可以部署和更新了，以及loki也可以直接从Docker引擎中获取各个服务的日志。当然事实上没这么简单（数据库migration、volume mount等），后面要讲的生产事故也和docker直接相关。但是docker无疑是使得运维工作更简单的。\n\n项目规模在12000行的TS代码左右。\n\n```\n➜  cloc . --fullpath --not-match-d=\"(node_modules|.next)\"\n     615 text files.\n     610 unique files.\n     296 files ignored.\n\ngithub.com/AlDanial/cloc v 1.88  T=0.85 s (545.5 files/s, 92257.2 lines/s)\n-------------------------------------------------------------------------------\nLanguage                     files          blank        comment           code\n-------------------------------------------------------------------------------\nJSON                            22              1              0          41742\nHTML                            96           1421              0          16873\nTypeScript                     320           2470            440          12470\nXML                              1              0              0           1390\nCSS                              3             62             22            754\nYAML                             6             26              3            260\nJavaScript                       5             28             27            230\nBourne Shell                     1             12              6            164\nMarkdown                         6             76              0            162\nSVG                              4              0              1            138\nLESS                             1              2              0             14\nPowerShell                       1              2              2              7\n-------------------------------------------------------------------------------\nSUM:                           466           4100            501          74204\n-------------------------------------------------------------------------------\n```\n\n# 几次重构\n\n## Create React App到Next.js\n\n项目开始得比较急，以及我一开始询问得知**不需要做SEO**，所以采用了CRA开发了系统的第一个版本。结果后面又说需要SEO，所以只好将项目迁移到`next.js`。但是现在虽然已经能够做到SSR（下图），但是搜索引擎似乎也不好搜索到网页中的内容（可能是流量太低，搜索引擎还没有索引？）。\n\n![SSR](ssr.png)\n\n## 非响应式到响应式\n\n和上面一样，一开始说系统并不需要考虑手机上访问，所以设计的时候就完全没有考虑手机端访问的情况。结果初版上线没多久就说需要支持手机上的访问，所以需要对网站做响应式的改造。\n\n由于除了主页以外，之前本来就完全没有使用绝对坐标，所以其实很多元素已经能够自己适应了（例如网页的主内容部分），整体工作量比我想象的小。主要工作有两块：\n\n- header\n- 左右布局\n- 主页\n\nheader整体是左边logo右边menu，但是右边的menu需要根据屏幕大小切换不同的布局。为了简单，我直接就对大屏幕和小屏幕分别写了两个Menu，然后在运行时根据当前的屏幕大小进行切换。\n\n```tsx\nimport useBreakpoint from \"antd/lib/grid/hooks/useBreakpoint\";\n\nconst { md } = useBreakpoint();\n\nmd\n  ? (\n    \u003cBigScreenMenu\n      links={renderedLinks}\n      pathname={pathname}\n      userStore={userStore}\n    /\u003e\n  ) : (\n    \u003cSmallScreenMenu\n      links={renderedLinks}\n      pathname={pathname}\n      userStore={userStore}\n    /\u003e\n  )\n```\n\n左右布局借用了使用的Ant Design的[Tabs](https://ant.design/components/tabs-cn/)组件可以显示在左边也可以在上面的功能，同样通过`useBreakpoint` hook获得现在屏幕的大小，然后通过大小判断Tabs的显示模式。\n\n大屏幕下的界面：\n\n![大屏幕界面](big-screen-ui.png)\n\n小屏幕下的界面：\n\n![小屏幕下的界面](small-screen-ui.png)\n\n主页是比较麻烦的，因为主页有一些部分结构比较复杂，设计图的HTML里也主要是以1200px以上为基准，把一些复杂的结构使用绝对大小来表示。比如下图中的树状结构，就是通过绝对的margin值来确定位置的。\n\n![结构复杂的部分](homepage-big.png)\n\n这个我最后取了一个偷懒的做法，就是在屏幕宽度过小的情况下，把这些复杂的部分全部隐藏掉。由于原来是支持1200px以上的，所以最后在1200px以下就把这些部分直接隐藏掉。\n\n```css\n@media (max-width: 1200px) {\n  .part_04 {\n    display: none;\n  }\n\n  .part_05 {\n    display: none;\n  }\n\n  .part_06_01 {\n    display: none;\n  }\n\n  .part_06_02 {\n    display: none;\n  }\n\n  .part_07 {\n    display: none;\n  }\n\n  .part_03 .moreOnPC p {\n    display: block;\n  }\n}\n```\n\n![小屏幕下提示](small-screen-ui.png)\n\n## 部署Prometheus/Loki/Grafana\n\n一开始系统并没有部署任何的监控系统和日志工具，日志全部直接打到stdout里，要查日志的时候通过`docker-compose logs {container name}`来查。这种方式有以下几个问题：\n\n- 容器重启后，之前的日志就丢失了\n- 只能看到raw log，只能借助一些外部工具（比如grep）进行分析，灵活性受限\n\n另外在一开始，机器的硬盘很少（20G），由于我没有镜像仓库，docker镜像都是直接拉到机器现场build，产生了巨多storage layer，占用了不少空间，有一次部署因为硬盘不够直接build失败了。\n\n所以我觉得需要部署一套监控和日志系统，用来在问题出现时更方便地寻找问题。后面选择了Prometheus和Loki和Grafana这一套组合。\n\n网上抄了一些dashboard的配置，比如下面的[Node Exporter Full](https://grafana.com/grafana/dashboards/1860)，nginx等，但是可能由于我这个系统比较简单，请求压力也不大，这些机器只是看着炫酷，实际没有起到什么作用。\n\n![Grafana Noded Exporter Full](grafana-node-exporter.png)\n\n![Grafana Nginx](grafana-nginx.png)\n\n真正起到作用的是loki，通过使用Loki的[Docker Driver](https://grafana.com/docs/loki/latest/clients/docker-driver/configuration/)，loki可以直接收集容器产生的日志，并且支持在grafana中进行搜索和查询。这些日志在后面诊断生产事故时发挥了巨大的作用。\n\n![通过Loki查看和搜索日志，右上角还可以修改时间](loki.png)\n\n# 前后端共享API定义\n\n前后端分离中，接口是非常重要的。为了减少接口层次的不一致，这次系统使用了我在[yaarxiv](https://github.com/ddadaal/yaarxiv)中采用**前后端共享API定义文件**的设计。只需要在共享的`shared`项目中使用TypeScript写API相关的定义（request、response、权限等），前后端就可以使用同一份定义文件进行API的调用和实现。只要对每个接口写一个文件，以下所有工作都可以自动化：\n\n- 前端\n  - 调用接口时编译时检查参数，推断返回值类型\n  - 生成API Client\n- 后端\n  - 生成swagger\n  - 检查请求参数，对错误参数的请求返回400\n  - 编译时检查返回值类型\n\n下面是一个真实的本项目中的API定义：更新团队成果信息来举例子，看看这个机制是怎么工作的。\n\n## 定义接口\n\n用户定义一个`xxxSchema`的interface，通过`body`定义request body的类型，`responses`中定义各个状态码以及对应的返回值。在定义接口的时候可以随意使用TypeScript的各种高级类型来减少重复。\n\n定义好接口后，使用`endpoint`定义这个API的方法和URL以及对应的Schema类型，再使用`props`指定API的一些属性，例如要求的权限（`requiredRoles`），可以被调用的时间段（`timeRange`）等。\n\n```ts\nimport { UserRole } from \"../auth/login\";\nimport { ApiProps } from \"../utils/apiProps\";\nimport { Endpoint } from \"../utils/schema\";\nimport { TimeOutOfRangeError } from \"../utils/serverError\";\nimport { Submission, submissionTimeRange } from \"./models\";\n\nexport type UpdateSubmissionModel = Omit\u003cSubmission, \"teamId\" | \"leader\" | \"time\" | \"paper\"\u003e;\n\nexport interface UpdateSubmissionSchema {\n  body: {\n    teamId: number;\n    info: UpdateSubmissionModel;\n  };\n  responses: TimeOutOfRangeError\u003c{ reason: \"NotLeader\" }\u003e \u0026 {\n    201: {};\n    400: { reason: \"DataUrls\"};\n    404: {}\n  }\n}\n\nexport const props: ApiProps = {\n  requiredRoles: [UserRole.User],\n  timeRange: submissionTimeRange,\n};\n\nexport const endpoint = {\n  method: \"PATCH\",\n  url: \"/submissions\",\n} as Endpoint\u003cUpdateSubmissionSchema\u003e;\n```\n\n这些都定义好后，在`shared`项目中调用`npm run api`生成一个json schema文件。后端将会使用这个json schema自动生成参数和返回值验证，自动对传入参数不合要求的请求返回400。\n\n```json\n\"UpdateSubmissionSchema\": {\n  \"type\": \"object\",\n  \"properties\": {\n    \"body\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"teamId\": {\n          \"type\": \"number\"\n        },\n        \"info\": {\n          \"$ref\": \"#/definitions/UpdateSubmissionModel\"\n        }\n      },\n      \"required\": [\n        \"teamId\",\n        \"info\"\n      ],\n      \"additionalProperties\": false\n    },\n    \"responses\": {\n      \"type\": \"object\",\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"201\": {\n          \"type\": \"object\",\n          \"additionalProperties\": false\n        },\n        \"400\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"reason\": {\n              \"type\": \"string\",\n              \"const\": \"DataUrls\"\n            }\n          },\n          \"required\": [\n            \"reason\"\n          ],\n          \"additionalProperties\": false\n        },\n```\n\n## 后端实现接口\n\n后端对于每个这样的定义文件，提供一个实现。指定api的路径，传入api的Schema的名称，提供实现。通过`req.body`可以访问传入的参数，并且这些参数以及对应的类型都被自动推断出来的。响应使用`{ 状态码: 响应 }`的格式，如果状态码或者响应不对，编译器也会报错。\n\n```ts\nimport * as api from \"dc-shared/api/submission/updateSubmission\";\n\nexport const updateSubmissionRoute = route(\n  api, \"UpdateSubmissionSchema\",\n  async ({ req }) =\u003e {\n    const { info, teamId } = req.body;\n\n    const team = await req.em.findOne(Team, {\n      id: teamId,\n    });\n\n    if (!team) { return { 404: {} };}\n\n    if (team.leader.id !== req.dbUserRef().id) {\n      return { 403: { reason: \"NotLeader\" as const } };\n    }\n\n    team.abstract = info.abstract;\n    team.title = info.title;\n    team.subjectType = info.subjectType;\n    team.subject = info.subject;\n\n    team.lastUpdateTime = new Date();\n\n    await req.em.flush();\n\n    return { 201: {} }; b\n\n  });\n```\n\n另外在写集成测试的时候，也提供了一些辅助函数简化测试的编写。比如，由于框架会自动检查HTTP传入的参数是否合法，我在测试中基本就不需要再写模拟传入错误参数的测试用例了。并且，我写了一个`callRoute`函数来进行接口的调用，能够在编译时检查传入的参数是否合法并提供自动完成，还能自动推断不同状态码的响应类型。\n\n```ts\nconst resp = await callRoute(server, adminGetTeamsRoute, {\n  query: { pageSize: -1 },\n}, admin);\n\nexpect(resp.statusCode).toBe(200);\n\n// 200的返回值\nconst json = resp.json\u003c200\u003e();\n```\n\n## 前端调用接口\n\n在`shared`项目中运行`npm run client`将会根据API的文件结构，在前端项目中生成一份具有相同架构的API调用对象。\n\n下图是API的文件的结构：\n\n![API](api-structure.png)\n\n下图是生成的API对象的对应结构：\n\n![API对象](api-client.png)\n\n前端代码通过这个对象来访问API，不需要手动输入方法、URL等参数。编译器会自动检查传入的各个参数的类型是否正确，还能自动推断响应正确（`[200, 300)`）时的返回值类型。\n\n```ts\nawait api.submission.updateSubmission({\n  body: {\n    teamId: s.teamId,\n    info: info,\n  },\n})\n```\n\n## 减少重复，提高效率\n\n其实这也是我使用TS写全栈的原因：如果前后端采用不同的语言，那么在API层次肯定会有重复工作：两边重复定义接口数据结构、URL、HTTP方法，这很麻烦，而且维护不好还容易造成两方数据结构的不一致。\n\n另外，如果要基于数据结构定义新的数据结构，传统的OO语言很难达到TypeScript的灵活性。例如上面出现过的`UpdateSubmissionModel`，就是在`Submission`类型的基础上删除`Omit`掉`teamId`等几个属性。TypeScript支持各种对类型的骚操作，很适合接口灵活多变的特性。\n\n```ts\nexport type UpdateSubmissionModel = Omit\u003cSubmission, \"teamId\" | \"leader\" | \"time\" | \"paper\"\u003e\n```\n\n另外虽然有`swagger/openapi`等标准，但是这些标准需要手写JSON Schema有点太过反人类……这套机制完全使用TypeScript写，不需要学习新的语法，还可以享受到编译器和IDE的支持。\n\n# 使用migration进行数据库初始化和更新\n\n开发的时候，数据库的schema可以使用ORM框架自己产生，如果schema变了，直接删除原来的数据库重新创建就可以了。但是项目一旦在生产环境中开始使用了，就不能随便删除schema了。随便删schema不就变成删库跑路了嘛。\n\n现在的ORM基本都提供了`Migration`机制进行数据库schema的更新。一个migration主要包含一个日期和一段更新的命令，有的框架还能提供撤销这次更新的命令。在执行时，ORM会根据日期判断当前数据库schema的版本，然后执行后续的数据库变更。\n\n对于那些可以通过运行数据库命令就能完成的schema更新，通过migration机制能够有效地记录下对数据库的变更，并且能够在运行数据库变更之前检查变更是否是自己所需要的，防止破坏现有的数据。\n\n当前的ORM框架也会常常提供很多方便的命令，例如\n\n- 根据Entity的变化和数据库的现状，自动生成migration代码\n- 执行需要执行的migration\n- 回退到某个migration\n\n很多维护工作都可以通过migration完成。\n\n本项目使用[mikro-orm](https://mikro-orm.io/)作为ORM库，也提供了内置的migration机制，下面是我的项目中所现有的migration。\n\n```\nmigrations\n├── Migration20210331031030.ts\n├── Migration20210402023841.ts\n├── Migration20210414064450.ts\n├── Migration20210424142314.ts\n├── Migration20210426143345.ts\n├── Migration20210428092351.ts\n├── Migration20210715123945.ts\n└── Migration20210719091704.ts\n```\n\n下面是一个migration的例子，`up`为执行这个migration所对应的SQL，`down`是撤销这个migration的命令。`up`是自动生成的，而`down`是自己写的。\n\n```ts\nimport { Migration } from '@mikro-orm/migrations';\n\nexport class Migration20210424142314 extends Migration {\n\n  async up(): Promise\u003cvoid\u003e {\n    this.addSql('alter table `team` change `file_relative_path` `filename` varchar(255) null;');\n  }\n\n  async down(): Promise\u003cvoid\u003e {\n    this.addSql('alter table `team` change `filename` `file_relative_path` varchar(255) null;');\n  }\n\n}\n```\n\n我的工作流是这样的：\n\n1. 在项目开发期间，仍然使用框架自动生成数据库schema的方法，让程序自己去更新数据库schema\n2. 在项目开始投用之前，使用`mikro-orm migration:create --initial`命令，创建第一个migration，并禁止程序自己操作数据库schema\n3. 项目部署后，使用`mikro-orm migration:up`执行第一个migration，程序开始运行\n4. 每次数据库更改后，使用`mikro-orm migration:create`命令，生成一个新的migration。打开新生成的migration文件检查SQL是否正确，并手写`down`方法\n5. 提交到生产机后，在`docker-compose up -d`前，使用`mikro-orm migration:up`执行migration\n\n当然migration也不能解决所有数据库变更的问题，migration也不能解决过于复杂的变更，所以在设计数据库schema时也需要谨慎、考虑到未来的可扩展性。\n\n另外，前面说的记录尽可能多的信息在这里也有作用，记录尽可能多的信息也为以后增加使用新信息的新功能提供了可能。例如，我在实现群发邮件功能的时候，一开始没有在数据库中记录一次群发邮件的结束时间，只记录了开始时间。这时我已经群发了一次邮件了。而后续我又想增加记录和显示群发邮件的结束时间的功能，这时第一次群发邮件的信息就不能直接从数据库中获取了，丢失了信息。事实上，最后我是从log中获得第一个发送邮件的结束时间，然后手动修改数据库才填进去这个数据的。\n\n# 记录尽可能多的信息\n\n在比赛临近结束、正在接受用户提交成果文件的时候，系统出了一场事故，丢失了一段时间内用户上传的文件。文章[一次生产环境的文件丢失事故：复盘和教训](/articles/summary-of-a-file-lost-accident) 详细介绍了这个事故从发现到确定影响范围到确定原因的过程。在处理事故的过程中，后台程序记录的日志起到了巨大的作用。\n\n同时，不仅是log，包括文件、数据库条目等保存的信息越多越好，能保存的信息尽可能保存，涉及到任何删除信息/文件等操作都应该谨慎。反正现在存储便宜，多用一点空间的成本和一旦发生事故造成的问题相比还是无关紧要的。\n\n例如，在本项目中中为了节省磁盘空间和恶意上传文件，我设定了每个队伍只能上传一个文件，之后的上传会首先删除之前的文件。但是现在想起来，如果又有其他地方逻辑出错，把用户上传好的文件删除了怎么办？如果系统响应到一半被中断了，只删除了之前的文件，没有写入后面的文件怎么办？一切皆有可能，连字节跳动的实习生都能删掉机器学习模型，更何况我们这种没人审核代码的独立开发者？而至于防止恶意上传文件，也可以采用给团队能够使用的空间大小进行限额的方式来防止团队使用过多的空间，而不是一刀切地只能使用一个文件。\n\n尽可能避免删除之前的信息，使得意外发生时，能够恢复到之前的状态，并且更方便去诊断问题。\n\n# 安全性\n\n为了防止用户作恶，我针对系统的安全性做了一些有限的工作：\n\n- 验证API接口传入的参数（见下部分）\n- 数据库中密文保存用户密码\n- 数据库密码、JWT密钥等都是高强度的随机密码\n- 没有必要公网公开的部分都没有公开（比如数据库等）\n- 为了防止用户上传太多文件占满服务器存储，限制了一个用户只能有一个文件，后续上传文件会删除之前上传的文件\n- 为了防止用户spam邮件，发送重置密码的邮件时，一个用户每30分钟才能发一条\n- 为了防止用户下载其他团队的提交的文件\n  - 关闭了`fastify-static`和`nginx`的serve整个目录的功能\n  - 下载提交的文件也需要验证token，这使得前端也得需要通过手动实现下载，而不能直接让浏览器处理下载链接\n- 为了防止用户提交的文件名过长（Linux下文件块最长255），在上传文件时验证文件名长度，拒绝过长文件名的文件\n\n个人感觉这些措施应该是一些比较容易想到的措施了，但是当然，这些措施对一些真正的攻击也无能为力，比如注册和登录都可以随便请求，攻击者可以无限注册账号，可以无限猜测密码来登录，更别说什么DDOS攻击了。还好，目前据我所知还没有遇到恶意的使用者。\n\n# 准备应对外部系统出的问题\n\n后端和数据库之间的交互已经被做透了，一般也不会出问题，出了问题也有各种方案进行恢复。但是一个非玩具系统肯定会支持处理数据库之外的其他功能，而实现这些功能往往会使用到外部服务。这些外部服务总可能会遇到的一些问题，所以在功能实现的时候就需要考虑到外部服务器的稳定性，并做好外部服务出问题的准备，例如采用上面提到的记录尽可能多的信息的方法。\n\n举个本系统的群发邮件相关的例子。系统需要支持向参赛人员群发邮件的功能，而学校提供了SMTP服务器。我当时考虑到发送邮件可能失败，就记录下发送失败的用户的用户名（下图中`failedUserId`）。当时前面发了几次邮件都没有失败，看起来学校的服务还挺稳定，当时也有点忙，就没有实现失败重发的功能，这个字段就一直没用上。\n\n```ts\n@Entity()\nexport class GroupEmailDelivery {\n  // ...\n\n  @Property({ type: new ArrayType((x) =\u003e +x) })\n  failedUsersId: number[] = [];\n\n  // ...\n}\n```\n\n结果在16日的一次发送邮件中，系统突然报了不少的错误，一看都是邮件服务器报的错误。\n\n```json\n2021-07-16 15:10:13\n{\"level\":50,\"time\":1626419413258,\"pid\":33,\"hostname\":\"7534d898d7e5\",\"code\":\"EAUTH\",\"response\":\"550 User suspended\",\"responseCode\":550,\"command\":\"AUTH PLAIN\",\"stack\":\"Error: Invalid login: 550 User suspended\\n    at SMTPConnection._formatError (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:774:19)\\n    at SMTPConnection._actionAUTHComplete (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:1513:34)\\n    at SMTPConnection.\u003canonymous\u003e (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:540:26)\\n    at SMTPConnection._processResponse (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:932:20)\\n    at SMTPConnection._onData (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:739:14)\\n    at TLSSocket.SMTPConnection._onSocketData (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:189:44)\\n    at TLSSocket.emit (events.js:315:20)\\n    at TLSSocket.EventEmitter.emit (domain.js:467:12)\\n    at addChunk (internal/streams/readable.js:309:12)\\n    at readableAddChunk (internal/streams/readable.js:284:9)\",\"type\":\"Error\",\"msg\":\"Invalid login: 550 User suspended\"}\n```\n\n马上去找提供SMTP服务器的老师请求解决这个问题，在此期间做了重发邮件的功能，因为有了`failedUserId`字段，我可以直接从数据库中获得需要重发的邮件，实现这个功能就很简单了。\n\n```\ncommit d4366a3c45261ead399940552bfc67b3547eb7e6\nAuthor: Chen Junda \u003cddadaal@outlook.com\u003e\nDate:   Fri Jul 16 15:44:39 2021 +0800\n\n    add retry failed email\n```\n\n当SMTP服务器的问题解决后，这个新功能也做好了，直接上线，点一个键，就能重发邮件了。\n\n![失败和重发](resend-email.png)\n\n试想要是当时没有存`failedUsersId`，我还得又去从log中获得失败的用户ID，过程非常的繁琐和复杂。\n\n# 还可以改进的点\n\n- **CI/CD**\n\n这次偷懒没有做CI/CD，使得每次部署完之后我都得去服务器上跑一下`docker-compose build \u0026\u0026 docker-compose up -d`，由于机器只能通过校园网，没有校园网的时候还必须接个VPN才能进去，比较麻烦。\n\n- **预生产环境**\n\n我理解的预生产环境，就是一个和生产环境完全相同的机器，使用生产环境的数据的某个历史快照，对新的代码进行测试，测试通过后，再将代码放到生产环境中运行\n\n这次部署没有预生产环境，代码在本地测试通过之后直接就扔到生产服务器上构建和部署了，没有使用实际测试数据进行测试\n\n这其实也是后面生产事故的一大原因，有缺陷的代码没有真实测过就扔到生产环境，造成了问题\n\n- **graceful shutdown和不中断服务的更新**\n\n这次项目的部署都是直接重启容器，如果此时有响应正在处理，可能会造成响应做到一半被强制中断。一个好的策略是graceful shutdown，在退出之前的服务时，停止接受新的请求并处理完正在进行的请求，这样可以避免运行到一半的服务（数据库操作有事务保护，但是处理请求可没有事务）。\n\n另外，`docker-compose up -d`虽然启动速度较快，但是仍然有一定的downtime，如果对服务质量有要求，0 downtime的不中断服务的更新还是非常有必要的\n\n- **前端测试**\n\n本项目写了不少后端的测试，行覆盖达到了94%，但是没有写前端测试，这造成每次改前端之后，部署后都心惊胆战的，不知道在真实环境中会不会出现问题。\n\n但是写测试也有它的问题：**花时间**。\n\n现在项目中后端的测试代码比业务逻辑代码要多，写测试代码花的时间也比写真实业务逻辑代码更多。而且由于测试代码也是代码，也会出问题（而且常常会出问题），有时候测试通不过，调试半天测试代码之后发现业务代码没有错，是测试代码的错……\n\n而前端就更复杂了。前端的测试可不是1+1=2正确、=3就错误那么简单。定位UI元素、操作UI元素、等待UI元素的响应、判断UI元素的响应是否合需求，每一部都有一大堆API需要学校。另外，尤其是对于业务项目，很多前端其实并没有一个完整详细的设计文档，什么样的UI是正确的根本就不确定。目前，除了自己的两个前端库，我从来没写过正经的完整项目的前端测试。\n\n我当前的想法是只针对一些复杂一点的业务操作写测试，具体什么样的业务算复杂，只能看实际情况了。\n\n# 总结\n\n这个项目比较简单，规模也比较小（12000行左右），用户量也比较小，什么优行操作都没有做，一个简单的前后端结构就能满足需求，但是中途还是犯了很多错误，最后丢失文件的事故也带来了比较多的麻烦。不管怎样，这个项目至少也让我自己完整走了一次一个项目从开发到上线的流程，学到了一些写玩具项目永远都不会用上的技能（比如grafana）。我终于有一个不是玩具的项目了！\n\n现在纯业务的工作确实做得比较腻了，简单的CRUD做来做去也就那些东西。以后希望能够做点更偏架构上的工作，能够支持规模更大、要求更高的项目，也通过更大的项目去接触更高级的项目和流程。我也希望能够带团队或者加入一个能够参与项目全程的已有团队，挑战一下复杂度更高的项目，并从中练习一下团队合作和领导能力。\n"])</script><script>self.__next_f.push([1,"e:[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"bg-neutral px-4 py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto min-h-[256px] flex justify-center text-center text-neutral-content\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col justify-center animate-slide-up\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl my-2\",\"children\":\"我的第一个真实项目：总结和经验\"}],[\"$\",\"$L19\",null,{\"className\":\"justify-center\",\"articleId\":\"summary-of-my-first-real-project\",\"info\":{\"content\":\"$1a\",\"title\":\"我的第一个真实项目：总结和经验\",\"date\":\"2021-07-21 16:34\",\"id\":\"summary-of-my-first-real-project\",\"lang\":\"cn\",\"tags\":[\"project\"],\"related\":[\"summary-of-a-file-lost-accident\"],\"ignored_in_list\":\"$undefined\",\"hide_heading\":\"$undefined\",\"no_toc\":\"$undefined\",\"absolute_path\":\"$undefined\",\"last_updated\":\"$undefined\",\"wordCount\":6727,\"readingTime\":33.635,\"filePath\":\"contents/20210721-summary-of-my-first-real-project/cn.md\",\"summaries\":[\"从3月15日开始,作者独立承担了一个完整的、真实的项目的开发和整个软件生命周期的维护工作:第三届全国高校数据驱动创新研究大赛的后台系统。 系统是一个做了SSR的前后端分离的TypeScript全栈项目。 每个部分都是使用容器运行,所有容器部署在一台2核2G内存的学校提供的虚拟机上。 为了减少接口层次的不一致,这次系统使用了作者在[yaarxiv]中采用**前后端共享API定义文件**的设计。 在项目中使用[mikro-orm]作为ORM库,也提供了内置的migration机制。 本项目写了不少后端的测试,行覆盖达到了94%,但是没有写前端测试。\"]},\"langVersions\":[\"cn\"]}]]}]}]}],[\"$\",\"div\",null,{\"className\":\"animate-slide-up\",\"children\":[[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto p-4\",\"children\":\"$L1b\"}],[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto p-4\",\"children\":[\"$\",\"$L1c\",null,{\"relatedArticles\":[{\"id\":\"summary-of-a-file-lost-accident\",\"langVersions\":[{\"excerpt\":\"\\n# 生产事故\\n\\n我最近负责了一个比赛后台网站的开发和维护，在比赛临近结束、正在接受用户提交成果文件的时候出了一场生产事故，造成了丢失了一段时间内用户上传的文件。本文主要讲讲生产事故从发现到确定影响范\",\"lang\":\"cn\",\"time\":\"2021-07-21 13:13:00 UTC+8\",\"title\":\"一次生产环境的文件丢失事故：复盘和教训\",\"last_updated\":\"$undefined\",\"absolute_path\":\"$undefined\"}]}]}]}],[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto p-4\",\"children\":[\"$\",\"$L1d\",null,{\"articleId\":\"summary-of-my-first-real-project\",\"articleTitle\":\"我的第一个真实项目：总结和经验\"}]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1f:I[1954,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c7265.js\",\"318\",\"static/chunks/bb1d9007-fdc4463f6b8d4248.js\",\"691\",\"static/chunks/37144445-281a1eece1f23f91.js\",\"93\",\"static/chunks/c145f854-c353ee343fa63f93.js\",\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"602\",\"static/chunks/602-9071b7ef50a964e6.js\",\"464\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-8f16d82c55e99bb9.js\"],\"\"]\n20:I[4631,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c7265.js\",\"318\",\"stat"])</script><script>self.__next_f.push([1,"ic/chunks/bb1d9007-fdc4463f6b8d4248.js\",\"691\",\"static/chunks/37144445-281a1eece1f23f91.js\",\"93\",\"static/chunks/c145f854-c353ee343fa63f93.js\",\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"602\",\"static/chunks/602-9071b7ef50a964e6.js\",\"464\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-8f16d82c55e99bb9.js\"],\"Gallery\"]\n40:I[7141,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c7265.js\",\"318\",\"static/chunks/bb1d9007-fdc4463f6b8d4248.js\",\"691\",\"static/chunks/37144"])</script><script>self.__next_f.push([1,"445-281a1eece1f23f91.js\",\"93\",\"static/chunks/c145f854-c353ee343fa63f93.js\",\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"602\",\"static/chunks/602-9071b7ef50a964e6.js\",\"464\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-8f16d82c55e99bb9.js\"],\"ArticleToc\"]\n1e:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"21:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"22:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"25:T66c,"])</script><script>self.__next_f.push([1,"➜  cloc . --fullpath --not-match-d=\"(node_modules|.next)\"\n     615 text files.\n     610 unique files.\n     296 files ignored.\n\ngithub.com/AlDanial/cloc v 1.88  T=0.85 s (545.5 files/s, 92257.2 lines/s)\n-------------------------------------------------------------------------------\nLanguage                     files          blank        comment           code\n-------------------------------------------------------------------------------\nJSON                            22              1              0          41742\nHTML                            96           1421              0          16873\nTypeScript                     320           2470            440          12470\nXML                              1              0              0           1390\nCSS                              3             62             22            754\nYAML                             6             26              3            260\nJavaScript                       5             28             27            230\nBourne Shell                     1             12              6            164\nMarkdown                         6             76              0            162\nSVG                              4              0              1            138\nLESS                             1              2              0             14\nPowerShell                       1              2              2              7\n-------------------------------------------------------------------------------\nSUM:                           466           4100            501          74204\n-------------------------------------------------------------------------------\n"])</script><script>self.__next_f.push([1,"26:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"27:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"29:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"2e:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"32:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"33:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"34:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"35:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"38:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"39:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"3a:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"3b:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"3c:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"3e:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"3f:T4df,"])</script><script>self.__next_f.push([1,"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"])</script><script>self.__next_f.push([1,"1b:[\"$\",\"div\",null,{\"className\":\"flex flex-row space-x-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"prose max-w-full lg:w-[75%]\",\"children\":[[\"$\",\"div\",null,{\"className\":\"p-4 my-4 bg-neutral rounded shadow\",\"children\":[[\"$\",\"h1\",null,{\"id\":\"summary\",\"className\":\"text-neutral-content\",\"children\":[[\"$\",\"a\",\"summary\",{\"href\":\"#summary\",\"className\":\"mr-1 text-neutral-content\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$1e\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],[\"$\",\"$L12\",\"summaryTitle\",{\"id\":\"articlePage.summary.title\"}]]}],[[\"$\",\"p\",\"0\",{\"className\":\"text-neutral-content\",\"children\":\"从3月15日开始,作者独立承担了一个完整的、真实的项目的开发和整个软件生命周期的维护工作:第三届全国高校数据驱动创新研究大赛的后台系统。 系统是一个做了SSR的前后端分离的TypeScript全栈项目。 每个部分都是使用容器运行,所有容器部署在一台2核2G内存的学校提供的虚拟机上。 为了减少接口层次的不一致,这次系统使用了作者在[yaarxiv]中采用**前后端共享API定义文件**的设计。 在项目中使用[mikro-orm]作为ORM库,也提供了内置的migration机制。 本项目写了不少后端的测试,行覆盖达到了94%,但是没有写前端测试。\"}]],[\"$\",\"p\",null,{\"className\":\"text-sm justify-end flex text-neutral-content\",\"children\":[\"$\",\"$L12\",null,{\"id\":\"articlePage.summary.poweredBy\",\"args\":[[\"$\",\"$L1f\",\"docUrl\",{\"target\":\"_blank\",\"className\":\"text-neutral-content\",\"href\":\"https://learn.microsoft.com/en-us/azure/ai-services/language-service/summarization/overview?tabs=document-summarization\",\"children\":\"Azure AI Language Service\"}]]}]}]]}],[\"$\",\"$L20\",null,{\"withCaption\":true,\"id\":\"summary-of-my-first-real-project\",\"children\":[[\"$\",\"h1\",null,{\"id\":\"我的第一个真实项目\",\"children\":[[\"$\",\"a\",\"我的第一个真实项目\",{\"href\":\"#我的第一个真实项目\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$21\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"我的第一个真实项目\"]}],\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":[\"终于，从3月15日开始，我自己独立承担了一个完整的、真实的项目的开发和整个软件生命周期的维护工作：\",[\"$\",\"a\",\"a-0\",{\"href\":\"https://data-competition.pku.edu.cn\",\"children\":\"https://data-competition.pku.edu.cn\"}],\" ，第三届全国高校数据驱动创新研究大赛的后台系统（代码目前放在学校gitlab上，以后应该会把代码放到github上）。\"]}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":\"虽然这还是一个常规的CRUD项目，但是毕竟是我第一个能够被真实用户使用的系统，我还是比较激动的。项目中途遇到了几次重构，最后出现了一次生产事故，其他的总体流程还是比较顺利的。\"}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":\"项目现在已经基本结束了，这里写一篇总结文，介绍一下项目的架构、演进、自己设置的一套前后端共用API的机制、以及在这个过程中的经验。\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"系统功能架构规模\",\"children\":[[\"$\",\"a\",\"系统功能架构规模\",{\"href\":\"#系统功能架构规模\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$22\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"系统功能、架构、规模\"]}],\"\\n\",[\"$\",\"p\",\"p-3\",{\"children\":\"下面是系统的用例图，主要完成一个比赛报名系统的用户管理、团队管理和上传提交文件操作，还对管理员实现了查看用户和团队信息以及群发邮件功能。\"}],\"\\n\",[\"$\",\"p\",\"p-4\",{\"children\":\"$L23\"}],\"\\n\",[\"$\",\"p\",\"p-5\",{\"children\":\"总的来说，系统是一个做了SSR的前后端分离的TypeScript全栈项目，下表为项目的技术栈。\"}],\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\",[\"$\",\"table\",\"table-0\",{\"children\":[[\"$\",\"thead\",\"thead-0\",{\"children\":[\"$\",\"tr\",\"tr-0\",{\"children\":[[\"$\",\"th\",\"th-0\",{\"children\":\"部分\"}],[\"$\",\"th\",\"th-1\",{\"children\":\"技术栈\"}]]}]}],[\"$\",\"tbody\",\"tbody-0\",{\"children\":[[\"$\",\"tr\",\"tr-0\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"编程语言\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"TypeScript\"}]]}],[\"$\",\"tr\",\"tr-1\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"前端框架\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"Next.js\"}]]}],[\"$\",\"tr\",\"tr-2\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"UI库\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"Ant Design\"}]]}],[\"$\",\"tr\",\"tr-3\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"后端框架\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"fastify\"}]]}],[\"$\",\"tr\",\"tr-4\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"反向代理\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"nginx\"}]]}],[\"$\",\"tr\",\"tr-5\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"数据库\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"MySQL\"}]]}],[\"$\",\"tr\",\"tr-6\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"部署\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"Docker + Docker Compose\"}]]}],[\"$\",\"tr\",\"tr-7\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"监控\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"Prometheus + Loki + Grafana\"}]]}],[\"$\",\"tr\",\"tr-8\",{\"children\":[[\"$\",\"td\",\"td-0\",{\"children\":\"外部服务\"}],[\"$\",\"td\",\"td-1\",{\"children\":\"学校提供的SMTP服务器\"}]]}]]}]]}],\"\\n\",[\"$\",\"p\",\"p-6\",{\"children\":\"下图是系统各个部分的架构图，监控部分其他的各个小组件就没有画了。\"}],\"\\n\",[\"$\",\"p\",\"p-7\",{\"children\":\"$L24\"}],\"\\n\",[\"$\",\"p\",\"p-8\",{\"children\":\"每个部分（包括nginx、数据库）都是使用容器运行，所有容器部署在一台2核2G内存的学校提供的虚拟机上。这个机器前面还有其他机器，负责SSL和开放到公网，所以这台机器本身是不能直接从公网访问的（连我上机器都需要使用VPN连接），这就带来了安全性：我可以使用最前面的nginx的来控制各个部分的可访问性。在我的配置中，nginx开放了80（前端）、5000（后端）和grafana的端口。grafana是否应该被公网访问我还不好说，但是由于grafana可以设置用户名和密码，应该安全性还好。\"}],\"\\n\",[\"$\",\"p\",\"p-9\",{\"children\":[\"用docker运行的好处很显著：不管机器是什么样的，直接\",[\"$\",\"code\",\"code-0\",{\"children\":\"docker-compose build\"}],\"和\",[\"$\",\"code\",\"code-1\",{\"children\":\"docker-compose up -d\"}],\"就可以部署和更新了，以及loki也可以直接从Docker引擎中获取各个服务的日志。当然事实上没这么简单（数据库migration、volume mount等），后面要讲的生产事故也和docker直接相关。但是docker无疑是使得运维工作更简单的。\"]}],\"\\n\",[\"$\",\"p\",\"p-10\",{\"children\":\"项目规模在12000行的TS代码左右。\"}],\"\\n\",[\"$\",\"pre\",\"pre-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"$25\"}]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"几次重构\",\"children\":[[\"$\",\"a\",\"几次重构\",{\"href\":\"#几次重构\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$26\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"几次重构\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"create-react-app到nextjs\",\"children\":[[\"$\",\"a\",\"create-react-app到nextjs\",{\"href\":\"#create-react-app到nextjs\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$27\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"Create React App到Next.js\"]}],\"\\n\",[\"$\",\"p\",\"p-11\",{\"children\":[\"项目开始得比较急，以及我一开始询问得知\",[\"$\",\"strong\",\"strong-0\",{\"children\":\"不需要做SEO\"}],\"，所以采用了CRA开发了系统的第一个版本。结果后面又说需要SEO，所以只好将项目迁移到\",[\"$\",\"code\",\"code-0\",{\"children\":\"next.js\"}],\"。但是现在虽然已经能够做到SSR（下图），但是搜索引擎似乎也不好搜索到网页中的内容（可能是流量太低，搜索引擎还没有索引？）。\"]}],\"\\n\",[\"$\",\"p\",\"p-12\",{\"children\":\"$L28\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"非响应式到响应式\",\"children\":[[\"$\",\"a\",\"非响应式到响应式\",{\"href\":\"#非响应式到响应式\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$29\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"非响应式到响应式\"]}],\"\\n\",[\"$\",\"p\",\"p-13\",{\"children\":\"和上面一样，一开始说系统并不需要考虑手机上访问，所以设计的时候就完全没有考虑手机端访问的情况。结果初版上线没多久就说需要支持手机上的访问，所以需要对网站做响应式的改造。\"}],\"\\n\",[\"$\",\"p\",\"p-14\",{\"children\":\"由于除了主页以外，之前本来就完全没有使用绝对坐标，所以其实很多元素已经能够自己适应了（例如网页的主内容部分），整体工作量比我想象的小。主要工作有两块：\"}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"header\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"左右布局\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"主页\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-15\",{\"children\":\"header整体是左边logo右边menu，但是右边的menu需要根据屏幕大小切换不同的布局。为了简单，我直接就对大屏幕和小屏幕分别写了两个Menu，然后在运行时根据当前的屏幕大小进行切换。\"}],\"\\n\",[\"$\",\"figure\",\"figure-0\",{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",\"pre-0\",{\"style\":{\"backgroundColor\":\"#282c34\",\"color\":\"#abb2bf\"},\"tabIndex\":0,\"data-language\":\"tsx\",\"data-theme\":\"one-dark-pro\",\"children\":[\"$\",\"code\",\"code-0\",{\"data-language\":\"tsx\",\"data-theme\":\"one-dark-pro\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",\"span-0\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"import\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\" useBreakpoint\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" from\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#98C379\"},\"children\":\" \\\"antd/lib/grid/hooks/useBreakpoint\\\"\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-1\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-2\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"const\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" { \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"md\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" } \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"=\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\" useBreakpoint\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",\"span-3\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-4\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"md\"}]}],\"\\n\",[\"$\",\"span\",\"span-5\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"  ?\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" (\"}]]}],\"\\n\",[\"$\",\"span\",\"span-6\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    \u003c\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"BigScreenMenu\"}]]}],\"\\n\",[\"$\",\"span\",\"span-7\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\",\"fontStyle\":\"italic\"},\"children\":\"      links\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"=\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"{\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"renderedLinks\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",\"span-8\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\",\"fontStyle\":\"italic\"},\"children\":\"      pathname\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"=\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"{\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"pathname\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",\"span-9\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\",\"fontStyle\":\"italic\"},\"children\":\"      userStore\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"=\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"{\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"userStore\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",\"span-10\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    /\u003e\"}]}],\"\\n\",[\"$\",\"span\",\"span-11\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  ) \"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\":\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" (\"}]]}],\"\\n\",[\"$\",\"span\",\"span-12\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    \u003c\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"SmallScreenMenu\"}]]}],\"\\n\",[\"$\",\"span\",\"span-13\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\",\"fontStyle\":\"italic\"},\"children\":\"      links\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"=\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"{\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"renderedLinks\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",\"span-14\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\",\"fontStyle\":\"italic\"},\"children\":\"      pathname\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"=\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"{\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"pathname\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",\"span-15\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\",\"fontStyle\":\"italic\"},\"children\":\"      userStore\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"=\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"{\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"userStore\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",\"span-16\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    /\u003e\"}]}],\"\\n\",[\"$\",\"span\",\"span-17\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  )\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-16\",{\"children\":[\"左右布局借用了使用的Ant Design的\",[\"$\",\"a\",\"a-0\",{\"href\":\"https://ant.design/components/tabs-cn/\",\"children\":\"Tabs\"}],\"组件可以显示在左边也可以在上面的功能，同样通过\",[\"$\",\"code\",\"code-0\",{\"children\":\"useBreakpoint\"}],\" hook获得现在屏幕的大小，然后通过大小判断Tabs的显示模式。\"]}],\"\\n\",[\"$\",\"p\",\"p-17\",{\"children\":\"大屏幕下的界面：\"}],\"\\n\",[\"$\",\"p\",\"p-18\",{\"children\":\"$L2a\"}],\"\\n\",[\"$\",\"p\",\"p-19\",{\"children\":\"小屏幕下的界面：\"}],\"\\n\",[\"$\",\"p\",\"p-20\",{\"children\":\"$L2b\"}],\"\\n\",[\"$\",\"p\",\"p-21\",{\"children\":\"主页是比较麻烦的，因为主页有一些部分结构比较复杂，设计图的HTML里也主要是以1200px以上为基准，把一些复杂的结构使用绝对大小来表示。比如下图中的树状结构，就是通过绝对的margin值来确定位置的。\"}],\"\\n\",[\"$\",\"p\",\"p-22\",{\"children\":\"$L2c\"}],\"\\n\",[\"$\",\"p\",\"p-23\",{\"children\":\"这个我最后取了一个偷懒的做法，就是在屏幕宽度过小的情况下，把这些复杂的部分全部隐藏掉。由于原来是支持1200px以上的，所以最后在1200px以下就把这些部分直接隐藏掉。\"}],\"\\n\",[\"$\",\"figure\",\"figure-1\",{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",\"pre-0\",{\"style\":{\"backgroundColor\":\"#282c34\",\"color\":\"#abb2bf\"},\"tabIndex\":0,\"data-language\":\"css\",\"data-theme\":\"one-dark-pro\",\"children\":[\"$\",\"code\",\"code-0\",{\"data-language\":\"css\",\"data-theme\":\"one-dark-pro\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",\"span-0\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"@media\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" (max-width: \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"1200\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"px\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-1\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"  .part_04\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-2\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    display: \"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"none\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-3\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",\"span-4\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-5\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"  .part_05\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-6\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    display: \"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"none\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-7\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",\"span-8\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-9\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"  .part_06_01\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-10\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    display: \"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"none\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-11\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",\"span-12\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-13\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"  .part_06_02\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-14\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    display: \"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"none\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-15\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",\"span-16\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-17\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"  .part_07\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-18\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    display: \"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"none\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-19\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",\"span-20\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-21\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"  .part_03\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\" .moreOnPC\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\" p\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-22\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    display: \"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"block\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-23\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",\"span-24\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-24\",{\"children\":\"$L2d\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"部署prometheuslokigrafana\",\"children\":[[\"$\",\"a\",\"部署prometheuslokigrafana\",{\"href\":\"#部署prometheuslokigrafana\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$2e\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"部署Prometheus/Loki/Grafana\"]}],\"\\n\",[\"$\",\"p\",\"p-25\",{\"children\":[\"一开始系统并没有部署任何的监控系统和日志工具，日志全部直接打到stdout里，要查日志的时候通过\",[\"$\",\"code\",\"code-0\",{\"children\":\"docker-compose logs {container name}\"}],\"来查。这种方式有以下几个问题：\"]}],\"\\n\",[\"$\",\"ul\",\"ul-1\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"容器重启后，之前的日志就丢失了\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"只能看到raw log，只能借助一些外部工具（比如grep）进行分析，灵活性受限\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-26\",{\"children\":\"另外在一开始，机器的硬盘很少（20G），由于我没有镜像仓库，docker镜像都是直接拉到机器现场build，产生了巨多storage layer，占用了不少空间，有一次部署因为硬盘不够直接build失败了。\"}],\"\\n\",[\"$\",\"p\",\"p-27\",{\"children\":\"所以我觉得需要部署一套监控和日志系统，用来在问题出现时更方便地寻找问题。后面选择了Prometheus和Loki和Grafana这一套组合。\"}],\"\\n\",[\"$\",\"p\",\"p-28\",{\"children\":[\"网上抄了一些dashboard的配置，比如下面的\",[\"$\",\"a\",\"a-0\",{\"href\":\"https://grafana.com/grafana/dashboards/1860\",\"children\":\"Node Exporter Full\"}],\"，nginx等，但是可能由于我这个系统比较简单，请求压力也不大，这些机器只是看着炫酷，实际没有起到什么作用。\"]}],\"\\n\",[\"$\",\"p\",\"p-29\",{\"children\":\"$L2f\"}],\"\\n\",[\"$\",\"p\",\"p-30\",{\"children\":\"$L30\"}],\"\\n\",[\"$\",\"p\",\"p-31\",{\"children\":[\"真正起到作用的是loki，通过使用Loki的\",[\"$\",\"a\",\"a-0\",{\"href\":\"https://grafana.com/docs/loki/latest/clients/docker-driver/configuration/\",\"children\":\"Docker Driver\"}],\"，loki可以直接收集容器产生的日志，并且支持在grafana中进行搜索和查询。这些日志在后面诊断生产事故时发挥了巨大的作用。\"]}],\"\\n\",[\"$\",\"p\",\"p-32\",{\"children\":\"$L31\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"前后端共享api定义\",\"children\":[[\"$\",\"a\",\"前后端共享api定义\",{\"href\":\"#前后端共享api定义\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$32\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"前后端共享API定义\"]}],\"\\n\",[\"$\",\"p\",\"p-33\",{\"children\":[\"前后端分离中，接口是非常重要的。为了减少接口层次的不一致，这次系统使用了我在\",[\"$\",\"a\",\"a-0\",{\"href\":\"https://github.com/ddadaal/yaarxiv\",\"children\":\"yaarxiv\"}],\"中采用\",[\"$\",\"strong\",\"strong-0\",{\"children\":\"前后端共享API定义文件\"}],\"的设计。只需要在共享的\",[\"$\",\"code\",\"code-0\",{\"children\":\"shared\"}],\"项目中使用TypeScript写API相关的定义（request、response、权限等），前后端就可以使用同一份定义文件进行API的调用和实现。只要对每个接口写一个文件，以下所有工作都可以自动化：\"]}],\"\\n\",[\"$\",\"ul\",\"ul-2\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"前端\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"调用接口时编译时检查参数，推断返回值类型\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"生成API Client\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[\"后端\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"生成swagger\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"检查请求参数，对错误参数的请求返回400\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"编译时检查返回值类型\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-34\",{\"children\":\"下面是一个真实的本项目中的API定义：更新团队成果信息来举例子，看看这个机制是怎么工作的。\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"定义接口\",\"children\":[[\"$\",\"a\",\"定义接口\",{\"href\":\"#定义接口\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$33\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"定义接口\"]}],\"\\n\",[\"$\",\"p\",\"p-35\",{\"children\":[\"用户定义一个\",[\"$\",\"code\",\"code-0\",{\"children\":\"xxxSchema\"}],\"的interface，通过\",[\"$\",\"code\",\"code-1\",{\"children\":\"body\"}],\"定义request body的类型，\",[\"$\",\"code\",\"code-2\",{\"children\":\"responses\"}],\"中定义各个状态码以及对应的返回值。在定义接口的时候可以随意使用TypeScript的各种高级类型来减少重复。\"]}],\"\\n\",[\"$\",\"p\",\"p-36\",{\"children\":[\"定义好接口后，使用\",[\"$\",\"code\",\"code-0\",{\"children\":\"endpoint\"}],\"定义这个API的方法和URL以及对应的Schema类型，再使用\",[\"$\",\"code\",\"code-1\",{\"children\":\"props\"}],\"指定API的一些属性，例如要求的权限（\",[\"$\",\"code\",\"code-2\",{\"children\":\"requiredRoles\"}],\"），可以被调用的时间段（\",[\"$\",\"code\",\"code-3\",{\"children\":\"timeRange\"}],\"）等。\"]}],\"\\n\",[\"$\",\"figure\",\"figure-2\",{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",\"pre-0\",{\"style\":{\"backgroundColor\":\"#282c34\",\"color\":\"#abb2bf\"},\"tabIndex\":0,\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"children\":[\"$\",\"code\",\"code-0\",{\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",\"span-0\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"import\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" { \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"UserRole\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" } \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"from\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#98C379\"},\"children\":\" \\\"../auth/login\\\"\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-1\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"import\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" { \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"ApiProps\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" } \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"from\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#98C379\"},\"children\":\" \\\"../utils/apiProps\\\"\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-2\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"import\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" { \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"Endpoint\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" } \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"from\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#98C379\"},\"children\":\" \\\"../utils/schema\\\"\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-3\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"import\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" { \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"TimeOutOfRangeError\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" } \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"from\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#98C379\"},\"children\":\" \\\"../utils/serverError\\\"\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-4\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"import\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" { \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"Submission\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\", \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"submissionTimeRange\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" } \"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"from\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#98C379\"},\"children\":\" \\\"./models\\\"\"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-5\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-6\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"export\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" type\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" UpdateSubmissionModel\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" Omit\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"\u003c\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"Submission\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\", \"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"teamId\\\"\"}],[\"$\",\"span\",\"span-9\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" | \"}],[\"$\",\"span\",\"span-10\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"leader\\\"\"}],[\"$\",\"span\",\"span-11\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" | \"}],[\"$\",\"span\",\"span-12\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"time\\\"\"}],[\"$\",\"span\",\"span-13\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" | \"}],[\"$\",\"span\",\"span-14\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"paper\\\"\"}],[\"$\",\"span\",\"span-15\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"\u003e;\"}]]}],\"\\n\",[\"$\",\"span\",\"span-7\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-8\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"export\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" interface\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" UpdateSubmissionSchema\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-9\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"  body\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-10\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"    teamId\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"number\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-11\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"    info\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"UpdateSubmissionModel\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-12\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  };\"}]}],\"\\n\",[\"$\",\"span\",\"span-13\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"  responses\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"TimeOutOfRangeError\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"\u003c{ \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"reason\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"NotLeader\\\"\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" }\u003e \u0026 {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-14\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"    201\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {};\"}]]}],\"\\n\",[\"$\",\"span\",\"span-15\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"    400\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": { \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"reason\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"DataUrls\\\"\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"};\"}]]}],\"\\n\",[\"$\",\"span\",\"span-16\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"    404\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {}\"}]]}],\"\\n\",[\"$\",\"span\",\"span-17\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",\"span-18\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",\"span-19\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-20\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"export\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" const\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" props\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"ApiProps\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-21\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"  requiredRoles\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": [\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"UserRole\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"User\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"],\"}]]}],\"\\n\",[\"$\",\"span\",\"span-22\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"  timeRange\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"submissionTimeRange\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-23\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"};\"}]}],\"\\n\",[\"$\",\"span\",\"span-24\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-25\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"export\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" const\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" endpoint\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-26\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"  method\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"PATCH\\\"\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-27\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"  url\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"/submissions\\\"\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-28\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"} \"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"as\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" Endpoint\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"\u003c\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"UpdateSubmissionSchema\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"\u003e;\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-37\",{\"children\":[\"这些都定义好后，在\",[\"$\",\"code\",\"code-0\",{\"children\":\"shared\"}],\"项目中调用\",[\"$\",\"code\",\"code-1\",{\"children\":\"npm run api\"}],\"生成一个json schema文件。后端将会使用这个json schema自动生成参数和返回值验证，自动对传入参数不合要求的请求返回400。\"]}],\"\\n\",[\"$\",\"figure\",\"figure-3\",{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",\"pre-0\",{\"style\":{\"backgroundColor\":\"#282c34\",\"color\":\"#abb2bf\"},\"tabIndex\":0,\"data-language\":\"json\",\"data-theme\":\"one-dark-pro\",\"children\":[\"$\",\"code\",\"code-0\",{\"data-language\":\"json\",\"data-theme\":\"one-dark-pro\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",\"span-0\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"UpdateSubmissionSchema\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-1\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"  \\\"type\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"object\\\"\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-2\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"  \\\"properties\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-3\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"    \\\"body\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-4\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"      \\\"type\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"object\\\"\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-5\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"      \\\"properties\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-6\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"        \\\"teamId\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-7\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"          \\\"type\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"number\\\"\"}]]}],\"\\n\",[\"$\",\"span\",\"span-8\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"        },\"}]}],\"\\n\",[\"$\",\"span\",\"span-9\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"        \\\"info\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-10\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"          \\\"$ref\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"#/definitions/UpdateSubmissionModel\\\"\"}]]}],\"\\n\",[\"$\",\"span\",\"span-11\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"        }\"}]}],\"\\n\",[\"$\",\"span\",\"span-12\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"      },\"}]}],\"\\n\",[\"$\",\"span\",\"span-13\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"      \\\"required\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": [\"}]]}],\"\\n\",[\"$\",\"span\",\"span-14\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"        \\\"teamId\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-15\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"        \\\"info\\\"\"}]}],\"\\n\",[\"$\",\"span\",\"span-16\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"      ],\"}]}],\"\\n\",[\"$\",\"span\",\"span-17\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"      \\\"additionalProperties\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"false\"}]]}],\"\\n\",[\"$\",\"span\",\"span-18\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    },\"}]}],\"\\n\",[\"$\",\"span\",\"span-19\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"    \\\"responses\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-20\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"      \\\"type\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"object\\\"\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-21\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"      \\\"additionalProperties\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"false\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-22\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"      \\\"properties\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-23\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"        \\\"201\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-24\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"          \\\"type\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"object\\\"\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-25\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"          \\\"additionalProperties\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"false\"}]]}],\"\\n\",[\"$\",\"span\",\"span-26\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"        },\"}]}],\"\\n\",[\"$\",\"span\",\"span-27\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"        \\\"400\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-28\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"          \\\"type\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"object\\\"\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-29\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"          \\\"properties\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-30\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"            \\\"reason\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-31\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"              \\\"type\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"string\\\"\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-32\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"              \\\"const\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"DataUrls\\\"\"}]]}],\"\\n\",[\"$\",\"span\",\"span-33\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"            }\"}]}],\"\\n\",[\"$\",\"span\",\"span-34\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"          },\"}]}],\"\\n\",[\"$\",\"span\",\"span-35\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"          \\\"required\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": [\"}]]}],\"\\n\",[\"$\",\"span\",\"span-36\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"            \\\"reason\\\"\"}]}],\"\\n\",[\"$\",\"span\",\"span-37\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"          ],\"}]}],\"\\n\",[\"$\",\"span\",\"span-38\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"          \\\"additionalProperties\\\"\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"false\"}]]}],\"\\n\",[\"$\",\"span\",\"span-39\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"        },\"}]}]]}]}]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"后端实现接口\",\"children\":[[\"$\",\"a\",\"后端实现接口\",{\"href\":\"#后端实现接口\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$34\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"后端实现接口\"]}],\"\\n\",[\"$\",\"p\",\"p-38\",{\"children\":[\"后端对于每个这样的定义文件，提供一个实现。指定api的路径，传入api的Schema的名称，提供实现。通过\",[\"$\",\"code\",\"code-0\",{\"children\":\"req.body\"}],\"可以访问传入的参数，并且这些参数以及对应的类型都被自动推断出来的。响应使用\",[\"$\",\"code\",\"code-1\",{\"children\":\"{ 状态码: 响应 }\"}],\"的格式，如果状态码或者响应不对，编译器也会报错。\"]}],\"\\n\",[\"$\",\"figure\",\"figure-4\",{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",\"pre-0\",{\"style\":{\"backgroundColor\":\"#282c34\",\"color\":\"#abb2bf\"},\"tabIndex\":0,\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"children\":[\"$\",\"code\",\"code-0\",{\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",\"span-0\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"import\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\" *\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" as\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\" api\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" from\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#98C379\"},\"children\":\" \\\"dc-shared/api/submission/updateSubmission\\\"\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-1\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-2\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"export\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" const\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" updateSubmissionRoute\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\" route\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",\"span-3\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"  api\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\", \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"UpdateSubmissionSchema\\\"\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-4\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"  async\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" ({ \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\",\"fontStyle\":\"italic\"},\"children\":\"req\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" }) \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-5\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"    const\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" { \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"info\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\", \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"teamId\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" } \"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"=\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" req\"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-9\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"body\"}],[\"$\",\"span\",\"span-10\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-6\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-7\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"    const\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" team\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" await\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" req\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"em\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\"findOne\"}],[\"$\",\"span\",\"span-9\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"(\"}],[\"$\",\"span\",\"span-10\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"Team\"}],[\"$\",\"span\",\"span-11\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\", {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-8\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"      id\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"teamId\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-9\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    });\"}]}],\"\\n\",[\"$\",\"span\",\"span-10\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-11\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"    if\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" (\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"!\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"team\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\") { \"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"return\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" { \"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"404\"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {} };}\"}]]}],\"\\n\",[\"$\",\"span\",\"span-12\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-13\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"    if\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" (\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"team\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"leader\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"id\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" !==\"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" req\"}],[\"$\",\"span\",\"span-9\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-10\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\"dbUserRef\"}],[\"$\",\"span\",\"span-11\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"().\"}],[\"$\",\"span\",\"span-12\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"id\"}],[\"$\",\"span\",\"span-13\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-14\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"      return\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" { \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"403\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": { \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"reason\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"NotLeader\\\"\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" as\"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" const\"}],[\"$\",\"span\",\"span-9\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" } };\"}]]}],\"\\n\",[\"$\",\"span\",\"span-15\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",\"span-16\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-17\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"    team\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"abstract\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" info\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"abstract\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-18\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"    team\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"title\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" info\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"title\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-19\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"    team\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"subjectType\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" info\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"subjectType\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-20\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"    team\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"subject\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" info\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"subject\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-21\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-22\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"    team\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"lastUpdateTime\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" new\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\" Date\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",\"span-23\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-24\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"    await\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" req\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"em\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\"flush\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",\"span-25\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-26\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"    return\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" { \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"201\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {} }; \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"b\"}]]}],\"\\n\",[\"$\",\"span\",\"span-27\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-28\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  });\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-39\",{\"children\":[\"另外在写集成测试的时候，也提供了一些辅助函数简化测试的编写。比如，由于框架会自动检查HTTP传入的参数是否合法，我在测试中基本就不需要再写模拟传入错误参数的测试用例了。并且，我写了一个\",[\"$\",\"code\",\"code-0\",{\"children\":\"callRoute\"}],\"函数来进行接口的调用，能够在编译时检查传入的参数是否合法并提供自动完成，还能自动推断不同状态码的响应类型。\"]}],\"\\n\",[\"$\",\"figure\",\"figure-5\",{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",\"pre-0\",{\"style\":{\"backgroundColor\":\"#282c34\",\"color\":\"#abb2bf\"},\"tabIndex\":0,\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"children\":[\"$\",\"code\",\"code-0\",{\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",\"span-0\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"const\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" resp\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" await\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\" callRoute\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"(\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"server\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\", \"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"adminGetTeamsRoute\"}],[\"$\",\"span\",\"span-9\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\", {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-1\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"  query\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": { \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"pageSize\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"-\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"1\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" },\"}]]}],\"\\n\",[\"$\",\"span\",\"span-2\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"}, \"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"admin\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",\"span-3\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-4\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\"expect\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"(\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"resp\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"statusCode\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\").\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\"toBe\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"(\"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"200\"}],[\"$\",\"span\",\"span-9\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",\"span-5\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-6\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#7F848E\",\"fontStyle\":\"italic\"},\"children\":\"// 200的返回值\"}]}],\"\\n\",[\"$\",\"span\",\"span-7\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"const\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" json\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" resp\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"json\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"\u003c\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"200\"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"\u003e\"}],[\"$\",\"span\",\"span-9\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"();\"}]]}]]}]}]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"前端调用接口\",\"children\":[[\"$\",\"a\",\"前端调用接口\",{\"href\":\"#前端调用接口\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$35\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"前端调用接口\"]}],\"\\n\",[\"$\",\"p\",\"p-40\",{\"children\":[\"在\",[\"$\",\"code\",\"code-0\",{\"children\":\"shared\"}],\"项目中运行\",[\"$\",\"code\",\"code-1\",{\"children\":\"npm run client\"}],\"将会根据API的文件结构，在前端项目中生成一份具有相同架构的API调用对象。\"]}],\"\\n\",[\"$\",\"p\",\"p-41\",{\"children\":\"下图是API的文件的结构：\"}],\"\\n\",[\"$\",\"p\",\"p-42\",{\"children\":\"$L36\"}],\"\\n\",[\"$\",\"p\",\"p-43\",{\"children\":\"下图是生成的API对象的对应结构：\"}],\"\\n\",[\"$\",\"p\",\"p-44\",{\"children\":\"$L37\"}],\"\\n\",[\"$\",\"p\",\"p-45\",{\"children\":[\"前端代码通过这个对象来访问API，不需要手动输入方法、URL等参数。编译器会自动检查传入的各个参数的类型是否正确，还能自动推断响应正确（\",[\"$\",\"code\",\"code-0\",{\"children\":\"[200, 300)\"}],\"）时的返回值类型。\"]}],\"\\n\",[\"$\",\"figure\",\"figure-6\",{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",\"pre-0\",{\"style\":{\"backgroundColor\":\"#282c34\",\"color\":\"#abb2bf\"},\"tabIndex\":0,\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"children\":[\"$\",\"code\",\"code-0\",{\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",\"span-0\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"await\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" api\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"submission\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\"updateSubmission\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"({\"}]]}],\"\\n\",[\"$\",\"span\",\"span-1\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"  body\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-2\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"    teamId\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"s\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"teamId\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-3\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"    info\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"info\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",\"span-4\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  },\"}]}],\"\\n\",[\"$\",\"span\",\"span-5\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"})\"}]}]]}]}]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"减少重复提高效率\",\"children\":[[\"$\",\"a\",\"减少重复提高效率\",{\"href\":\"#减少重复提高效率\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$38\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"减少重复，提高效率\"]}],\"\\n\",[\"$\",\"p\",\"p-46\",{\"children\":\"其实这也是我使用TS写全栈的原因：如果前后端采用不同的语言，那么在API层次肯定会有重复工作：两边重复定义接口数据结构、URL、HTTP方法，这很麻烦，而且维护不好还容易造成两方数据结构的不一致。\"}],\"\\n\",[\"$\",\"p\",\"p-47\",{\"children\":[\"另外，如果要基于数据结构定义新的数据结构，传统的OO语言很难达到TypeScript的灵活性。例如上面出现过的\",[\"$\",\"code\",\"code-0\",{\"children\":\"UpdateSubmissionModel\"}],\"，就是在\",[\"$\",\"code\",\"code-1\",{\"children\":\"Submission\"}],\"类型的基础上删除\",[\"$\",\"code\",\"code-2\",{\"children\":\"Omit\"}],\"掉\",[\"$\",\"code\",\"code-3\",{\"children\":\"teamId\"}],\"等几个属性。TypeScript支持各种对类型的骚操作，很适合接口灵活多变的特性。\"]}],\"\\n\",[\"$\",\"figure\",\"figure-7\",{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",\"pre-0\",{\"style\":{\"backgroundColor\":\"#282c34\",\"color\":\"#abb2bf\"},\"tabIndex\":0,\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"children\":[\"$\",\"code\",\"code-0\",{\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",\"span-0\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"export\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" type\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" UpdateSubmissionModel\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" =\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" Omit\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"\u003c\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"Submission\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\", \"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"teamId\\\"\"}],[\"$\",\"span\",\"span-9\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" | \"}],[\"$\",\"span\",\"span-10\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"leader\\\"\"}],[\"$\",\"span\",\"span-11\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" | \"}],[\"$\",\"span\",\"span-12\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"time\\\"\"}],[\"$\",\"span\",\"span-13\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" | \"}],[\"$\",\"span\",\"span-14\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"paper\\\"\"}],[\"$\",\"span\",\"span-15\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"\u003e\"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",\"p-48\",{\"children\":[\"另外虽然有\",[\"$\",\"code\",\"code-0\",{\"children\":\"swagger/openapi\"}],\"等标准，但是这些标准需要手写JSON Schema有点太过反人类……这套机制完全使用TypeScript写，不需要学习新的语法，还可以享受到编译器和IDE的支持。\"]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"使用migration进行数据库初始化和更新\",\"children\":[[\"$\",\"a\",\"使用migration进行数据库初始化和更新\",{\"href\":\"#使用migration进行数据库初始化和更新\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$39\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"使用migration进行数据库初始化和更新\"]}],\"\\n\",[\"$\",\"p\",\"p-49\",{\"children\":\"开发的时候，数据库的schema可以使用ORM框架自己产生，如果schema变了，直接删除原来的数据库重新创建就可以了。但是项目一旦在生产环境中开始使用了，就不能随便删除schema了。随便删schema不就变成删库跑路了嘛。\"}],\"\\n\",[\"$\",\"p\",\"p-50\",{\"children\":[\"现在的ORM基本都提供了\",[\"$\",\"code\",\"code-0\",{\"children\":\"Migration\"}],\"机制进行数据库schema的更新。一个migration主要包含一个日期和一段更新的命令，有的框架还能提供撤销这次更新的命令。在执行时，ORM会根据日期判断当前数据库schema的版本，然后执行后续的数据库变更。\"]}],\"\\n\",[\"$\",\"p\",\"p-51\",{\"children\":\"对于那些可以通过运行数据库命令就能完成的schema更新，通过migration机制能够有效地记录下对数据库的变更，并且能够在运行数据库变更之前检查变更是否是自己所需要的，防止破坏现有的数据。\"}],\"\\n\",[\"$\",\"p\",\"p-52\",{\"children\":\"当前的ORM框架也会常常提供很多方便的命令，例如\"}],\"\\n\",[\"$\",\"ul\",\"ul-3\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"根据Entity的变化和数据库的现状，自动生成migration代码\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"执行需要执行的migration\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"回退到某个migration\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-53\",{\"children\":\"很多维护工作都可以通过migration完成。\"}],\"\\n\",[\"$\",\"p\",\"p-54\",{\"children\":[\"本项目使用\",[\"$\",\"a\",\"a-0\",{\"href\":\"https://mikro-orm.io/\",\"children\":\"mikro-orm\"}],\"作为ORM库，也提供了内置的migration机制，下面是我的项目中所现有的migration。\"]}],\"\\n\",[\"$\",\"pre\",\"pre-1\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"migrations\\n├── Migration20210331031030.ts\\n├── Migration20210402023841.ts\\n├── Migration20210414064450.ts\\n├── Migration20210424142314.ts\\n├── Migration20210426143345.ts\\n├── Migration20210428092351.ts\\n├── Migration20210715123945.ts\\n└── Migration20210719091704.ts\\n\"}]}],\"\\n\",[\"$\",\"p\",\"p-55\",{\"children\":[\"下面是一个migration的例子，\",[\"$\",\"code\",\"code-0\",{\"children\":\"up\"}],\"为执行这个migration所对应的SQL，\",[\"$\",\"code\",\"code-1\",{\"children\":\"down\"}],\"是撤销这个migration的命令。\",[\"$\",\"code\",\"code-2\",{\"children\":\"up\"}],\"是自动生成的，而\",[\"$\",\"code\",\"code-3\",{\"children\":\"down\"}],\"是自己写的。\"]}],\"\\n\",[\"$\",\"figure\",\"figure-8\",{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",\"pre-0\",{\"style\":{\"backgroundColor\":\"#282c34\",\"color\":\"#abb2bf\"},\"tabIndex\":0,\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"children\":[\"$\",\"code\",\"code-0\",{\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",\"span-0\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"import\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" { \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"Migration\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" } \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"from\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#98C379\"},\"children\":\" '@mikro-orm/migrations'\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",\"span-1\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-2\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"export\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" class\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" Migration20210424142314\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" extends\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" Migration\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-3\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-4\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"  async\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\" up\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"(): \"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"Promise\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"\u003c\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"void\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"\u003e {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-5\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"    this\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\"addSql\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"(\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"'alter table `team` change `file_relative_path` `filename` varchar(255) null;'\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",\"span-6\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",\"span-7\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-8\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"  async\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\" down\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"(): \"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"Promise\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"\u003c\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"void\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"\u003e {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-9\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"    this\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\".\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\"addSql\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"(\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"'alter table `team` change `filename` `file_relative_path` varchar(255) null;'\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",\"span-10\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",\"span-11\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-12\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-56\",{\"children\":\"我的工作流是这样的：\"}],\"\\n\",[\"$\",\"ol\",\"ol-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"在项目开发期间，仍然使用框架自动生成数据库schema的方法，让程序自己去更新数据库schema\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[\"在项目开始投用之前，使用\",[\"$\",\"code\",\"code-0\",{\"children\":\"mikro-orm migration:create --initial\"}],\"命令，创建第一个migration，并禁止程序自己操作数据库schema\"]}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":[\"项目部署后，使用\",[\"$\",\"code\",\"code-0\",{\"children\":\"mikro-orm migration:up\"}],\"执行第一个migration，程序开始运行\"]}],\"\\n\",[\"$\",\"li\",\"li-3\",{\"children\":[\"每次数据库更改后，使用\",[\"$\",\"code\",\"code-0\",{\"children\":\"mikro-orm migration:create\"}],\"命令，生成一个新的migration。打开新生成的migration文件检查SQL是否正确，并手写\",[\"$\",\"code\",\"code-1\",{\"children\":\"down\"}],\"方法\"]}],\"\\n\",[\"$\",\"li\",\"li-4\",{\"children\":[\"提交到生产机后，在\",[\"$\",\"code\",\"code-0\",{\"children\":\"docker-compose up -d\"}],\"前，使用\",[\"$\",\"code\",\"code-1\",{\"children\":\"mikro-orm migration:up\"}],\"执行migration\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-57\",{\"children\":\"当然migration也不能解决所有数据库变更的问题，migration也不能解决过于复杂的变更，所以在设计数据库schema时也需要谨慎、考虑到未来的可扩展性。\"}],\"\\n\",[\"$\",\"p\",\"p-58\",{\"children\":\"另外，前面说的记录尽可能多的信息在这里也有作用，记录尽可能多的信息也为以后增加使用新信息的新功能提供了可能。例如，我在实现群发邮件功能的时候，一开始没有在数据库中记录一次群发邮件的结束时间，只记录了开始时间。这时我已经群发了一次邮件了。而后续我又想增加记录和显示群发邮件的结束时间的功能，这时第一次群发邮件的信息就不能直接从数据库中获取了，丢失了信息。事实上，最后我是从log中获得第一个发送邮件的结束时间，然后手动修改数据库才填进去这个数据的。\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"记录尽可能多的信息\",\"children\":[[\"$\",\"a\",\"记录尽可能多的信息\",{\"href\":\"#记录尽可能多的信息\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$3a\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"记录尽可能多的信息\"]}],\"\\n\",[\"$\",\"p\",\"p-59\",{\"children\":[\"在比赛临近结束、正在接受用户提交成果文件的时候，系统出了一场事故，丢失了一段时间内用户上传的文件。文章\",[\"$\",\"a\",\"a-0\",{\"href\":\"/articles/summary-of-a-file-lost-accident\",\"children\":\"一次生产环境的文件丢失事故：复盘和教训\"}],\" 详细介绍了这个事故从发现到确定影响范围到确定原因的过程。在处理事故的过程中，后台程序记录的日志起到了巨大的作用。\"]}],\"\\n\",[\"$\",\"p\",\"p-60\",{\"children\":\"同时，不仅是log，包括文件、数据库条目等保存的信息越多越好，能保存的信息尽可能保存，涉及到任何删除信息/文件等操作都应该谨慎。反正现在存储便宜，多用一点空间的成本和一旦发生事故造成的问题相比还是无关紧要的。\"}],\"\\n\",[\"$\",\"p\",\"p-61\",{\"children\":\"例如，在本项目中中为了节省磁盘空间和恶意上传文件，我设定了每个队伍只能上传一个文件，之后的上传会首先删除之前的文件。但是现在想起来，如果又有其他地方逻辑出错，把用户上传好的文件删除了怎么办？如果系统响应到一半被中断了，只删除了之前的文件，没有写入后面的文件怎么办？一切皆有可能，连字节跳动的实习生都能删掉机器学习模型，更何况我们这种没人审核代码的独立开发者？而至于防止恶意上传文件，也可以采用给团队能够使用的空间大小进行限额的方式来防止团队使用过多的空间，而不是一刀切地只能使用一个文件。\"}],\"\\n\",[\"$\",\"p\",\"p-62\",{\"children\":\"尽可能避免删除之前的信息，使得意外发生时，能够恢复到之前的状态，并且更方便去诊断问题。\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"安全性\",\"children\":[[\"$\",\"a\",\"安全性\",{\"href\":\"#安全性\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$3b\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"安全性\"]}],\"\\n\",[\"$\",\"p\",\"p-63\",{\"children\":\"为了防止用户作恶，我针对系统的安全性做了一些有限的工作：\"}],\"\\n\",[\"$\",\"ul\",\"ul-4\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"验证API接口传入的参数（见下部分）\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"数据库中密文保存用户密码\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"数据库密码、JWT密钥等都是高强度的随机密码\"}],\"\\n\",[\"$\",\"li\",\"li-3\",{\"children\":\"没有必要公网公开的部分都没有公开（比如数据库等）\"}],\"\\n\",[\"$\",\"li\",\"li-4\",{\"children\":\"为了防止用户上传太多文件占满服务器存储，限制了一个用户只能有一个文件，后续上传文件会删除之前上传的文件\"}],\"\\n\",[\"$\",\"li\",\"li-5\",{\"children\":\"为了防止用户spam邮件，发送重置密码的邮件时，一个用户每30分钟才能发一条\"}],\"\\n\",[\"$\",\"li\",\"li-6\",{\"children\":[\"为了防止用户下载其他团队的提交的文件\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"关闭了\",[\"$\",\"code\",\"code-0\",{\"children\":\"fastify-static\"}],\"和\",[\"$\",\"code\",\"code-1\",{\"children\":\"nginx\"}],\"的serve整个目录的功能\"]}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"下载提交的文件也需要验证token，这使得前端也得需要通过手动实现下载，而不能直接让浏览器处理下载链接\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",\"li-7\",{\"children\":\"为了防止用户提交的文件名过长（Linux下文件块最长255），在上传文件时验证文件名长度，拒绝过长文件名的文件\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-64\",{\"children\":\"个人感觉这些措施应该是一些比较容易想到的措施了，但是当然，这些措施对一些真正的攻击也无能为力，比如注册和登录都可以随便请求，攻击者可以无限注册账号，可以无限猜测密码来登录，更别说什么DDOS攻击了。还好，目前据我所知还没有遇到恶意的使用者。\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"准备应对外部系统出的问题\",\"children\":[[\"$\",\"a\",\"准备应对外部系统出的问题\",{\"href\":\"#准备应对外部系统出的问题\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$3c\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"准备应对外部系统出的问题\"]}],\"\\n\",[\"$\",\"p\",\"p-65\",{\"children\":\"后端和数据库之间的交互已经被做透了，一般也不会出问题，出了问题也有各种方案进行恢复。但是一个非玩具系统肯定会支持处理数据库之外的其他功能，而实现这些功能往往会使用到外部服务。这些外部服务总可能会遇到的一些问题，所以在功能实现的时候就需要考虑到外部服务器的稳定性，并做好外部服务出问题的准备，例如采用上面提到的记录尽可能多的信息的方法。\"}],\"\\n\",[\"$\",\"p\",\"p-66\",{\"children\":[\"举个本系统的群发邮件相关的例子。系统需要支持向参赛人员群发邮件的功能，而学校提供了SMTP服务器。我当时考虑到发送邮件可能失败，就记录下发送失败的用户的用户名（下图中\",[\"$\",\"code\",\"code-0\",{\"children\":\"failedUserId\"}],\"）。当时前面发了几次邮件都没有失败，看起来学校的服务还挺稳定，当时也有点忙，就没有实现失败重发的功能，这个字段就一直没用上。\"]}],\"\\n\",[\"$\",\"figure\",\"figure-9\",{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",\"pre-0\",{\"style\":{\"backgroundColor\":\"#282c34\",\"color\":\"#abb2bf\"},\"tabIndex\":0,\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"children\":[\"$\",\"code\",\"code-0\",{\"data-language\":\"ts\",\"data-theme\":\"one-dark-pro\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",\"span-0\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"@\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\"Entity\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",\"span-1\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"export\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\" class\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\" GroupEmailDelivery\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",\"span-2\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#7F848E\",\"fontStyle\":\"italic\"},\"children\":\"  // ...\"}]}],\"\\n\",[\"$\",\"span\",\"span-3\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-4\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"  @\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\"Property\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"({ \"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"type\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"new\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#61AFEF\"},\"children\":\" ArrayType\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"((\"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#E06C75\",\"fontStyle\":\"italic\"},\"children\":\"x\"}],[\"$\",\"span\",\"span-9\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\") \"}],[\"$\",\"span\",\"span-10\",{\"style\":{\"color\":\"#C678DD\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",\"span-11\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\" +\"}],[\"$\",\"span\",\"span-12\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"x\"}],[\"$\",\"span\",\"span-13\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\") })\"}]]}],\"\\n\",[\"$\",\"span\",\"span-5\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"  failedUsersId\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\": \"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#E5C07B\"},\"children\":\"number\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"[] \"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"=\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\" [];\"}]]}],\"\\n\",[\"$\",\"span\",\"span-6\",{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",\"span-7\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#7F848E\",\"fontStyle\":\"italic\"},\"children\":\"  // ...\"}]}],\"\\n\",[\"$\",\"span\",\"span-8\",{\"data-line\":\"\",\"children\":[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-67\",{\"children\":\"结果在16日的一次发送邮件中，系统突然报了不少的错误，一看都是邮件服务器报的错误。\"}],\"\\n\",[\"$\",\"figure\",\"figure-10\",{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",\"pre-0\",{\"style\":{\"backgroundColor\":\"#282c34\",\"color\":\"#abb2bf\"},\"tabIndex\":0,\"data-language\":\"json\",\"data-theme\":\"one-dark-pro\",\"children\":[\"$\",\"code\",\"code-0\",{\"data-language\":\"json\",\"data-theme\":\"one-dark-pro\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",\"span-0\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"2021-07-16\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\" 15\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"10\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"13\"}]]}],\"\\n\",[\"$\",\"span\",\"span-1\",{\"data-line\":\"\",\"children\":[[\"$\",\"span\",\"span-0\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"{\"}],[\"$\",\"span\",\"span-1\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"\\\"level\\\"\"}],[\"$\",\"span\",\"span-2\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-3\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"50\"}],[\"$\",\"span\",\"span-4\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}],[\"$\",\"span\",\"span-5\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"\\\"time\\\"\"}],[\"$\",\"span\",\"span-6\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-7\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"1626419413258\"}],[\"$\",\"span\",\"span-8\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}],[\"$\",\"span\",\"span-9\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"\\\"pid\\\"\"}],[\"$\",\"span\",\"span-10\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-11\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"33\"}],[\"$\",\"span\",\"span-12\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}],[\"$\",\"span\",\"span-13\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"\\\"hostname\\\"\"}],[\"$\",\"span\",\"span-14\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-15\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"7534d898d7e5\\\"\"}],[\"$\",\"span\",\"span-16\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}],[\"$\",\"span\",\"span-17\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"\\\"code\\\"\"}],[\"$\",\"span\",\"span-18\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-19\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"EAUTH\\\"\"}],[\"$\",\"span\",\"span-20\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}],[\"$\",\"span\",\"span-21\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"\\\"response\\\"\"}],[\"$\",\"span\",\"span-22\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-23\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"550 User suspended\\\"\"}],[\"$\",\"span\",\"span-24\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}],[\"$\",\"span\",\"span-25\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"\\\"responseCode\\\"\"}],[\"$\",\"span\",\"span-26\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-27\",{\"style\":{\"color\":\"#D19A66\"},\"children\":\"550\"}],[\"$\",\"span\",\"span-28\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}],[\"$\",\"span\",\"span-29\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"\\\"command\\\"\"}],[\"$\",\"span\",\"span-30\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-31\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"AUTH PLAIN\\\"\"}],[\"$\",\"span\",\"span-32\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}],[\"$\",\"span\",\"span-33\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"\\\"stack\\\"\"}],[\"$\",\"span\",\"span-34\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-35\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"Error: Invalid login: 550 User suspended\"}],[\"$\",\"span\",\"span-36\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"\\\\n\"}],[\"$\",\"span\",\"span-37\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"    at SMTPConnection._formatError (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:774:19)\"}],[\"$\",\"span\",\"span-38\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"\\\\n\"}],[\"$\",\"span\",\"span-39\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"    at SMTPConnection._actionAUTHComplete (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:1513:34)\"}],[\"$\",\"span\",\"span-40\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"\\\\n\"}],[\"$\",\"span\",\"span-41\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"    at SMTPConnection.\u003canonymous\u003e (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:540:26)\"}],[\"$\",\"span\",\"span-42\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"\\\\n\"}],[\"$\",\"span\",\"span-43\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"    at SMTPConnection._processResponse (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:932:20)\"}],[\"$\",\"span\",\"span-44\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"\\\\n\"}],[\"$\",\"span\",\"span-45\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"    at SMTPConnection._onData (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:739:14)\"}],[\"$\",\"span\",\"span-46\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"\\\\n\"}],[\"$\",\"span\",\"span-47\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"    at TLSSocket.SMTPConnection._onSocketData (/dist/node_modules/nodemailer/lib/smtp-connection/index.js:189:44)\"}],[\"$\",\"span\",\"span-48\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"\\\\n\"}],[\"$\",\"span\",\"span-49\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"    at TLSSocket.emit (events.js:315:20)\"}],[\"$\",\"span\",\"span-50\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"\\\\n\"}],[\"$\",\"span\",\"span-51\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"    at TLSSocket.EventEmitter.emit (domain.js:467:12)\"}],[\"$\",\"span\",\"span-52\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"\\\\n\"}],[\"$\",\"span\",\"span-53\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"    at addChunk (internal/streams/readable.js:309:12)\"}],[\"$\",\"span\",\"span-54\",{\"style\":{\"color\":\"#56B6C2\"},\"children\":\"\\\\n\"}],[\"$\",\"span\",\"span-55\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"    at readableAddChunk (internal/streams/readable.js:284:9)\\\"\"}],[\"$\",\"span\",\"span-56\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}],[\"$\",\"span\",\"span-57\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"\\\"type\\\"\"}],[\"$\",\"span\",\"span-58\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-59\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"Error\\\"\"}],[\"$\",\"span\",\"span-60\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\",\"}],[\"$\",\"span\",\"span-61\",{\"style\":{\"color\":\"#E06C75\"},\"children\":\"\\\"msg\\\"\"}],[\"$\",\"span\",\"span-62\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\":\"}],[\"$\",\"span\",\"span-63\",{\"style\":{\"color\":\"#98C379\"},\"children\":\"\\\"Invalid login: 550 User suspended\\\"\"}],[\"$\",\"span\",\"span-64\",{\"style\":{\"color\":\"#ABB2BF\"},\"children\":\"}\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-68\",{\"children\":[\"马上去找提供SMTP服务器的老师请求解决这个问题，在此期间做了重发邮件的功能，因为有了\",[\"$\",\"code\",\"code-0\",{\"children\":\"failedUserId\"}],\"字段，我可以直接从数据库中获得需要重发的邮件，实现这个功能就很简单了。\"]}],\"\\n\",[\"$\",\"pre\",\"pre-2\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"commit d4366a3c45261ead399940552bfc67b3547eb7e6\\nAuthor: Chen Junda \u003cddadaal@outlook.com\u003e\\nDate:   Fri Jul 16 15:44:39 2021 +0800\\n\\n    add retry failed email\\n\"}]}],\"\\n\",[\"$\",\"p\",\"p-69\",{\"children\":\"当SMTP服务器的问题解决后，这个新功能也做好了，直接上线，点一个键，就能重发邮件了。\"}],\"\\n\",[\"$\",\"p\",\"p-70\",{\"children\":\"$L3d\"}],\"\\n\",[\"$\",\"p\",\"p-71\",{\"children\":[\"试想要是当时没有存\",[\"$\",\"code\",\"code-0\",{\"children\":\"failedUsersId\"}],\"，我还得又去从log中获得失败的用户ID，过程非常的繁琐和复杂。\"]}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"还可以改进的点\",\"children\":[[\"$\",\"a\",\"还可以改进的点\",{\"href\":\"#还可以改进的点\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$3e\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"还可以改进的点\"]}],\"\\n\",[\"$\",\"ul\",\"ul-5\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"CI/CD\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-72\",{\"children\":[\"这次偷懒没有做CI/CD，使得每次部署完之后我都得去服务器上跑一下\",[\"$\",\"code\",\"code-0\",{\"children\":\"docker-compose build \u0026\u0026 docker-compose up -d\"}],\"，由于机器只能通过校园网，没有校园网的时候还必须接个VPN才能进去，比较麻烦。\"]}],\"\\n\",[\"$\",\"ul\",\"ul-6\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"预生产环境\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-73\",{\"children\":\"我理解的预生产环境，就是一个和生产环境完全相同的机器，使用生产环境的数据的某个历史快照，对新的代码进行测试，测试通过后，再将代码放到生产环境中运行\"}],\"\\n\",[\"$\",\"p\",\"p-74\",{\"children\":\"这次部署没有预生产环境，代码在本地测试通过之后直接就扔到生产服务器上构建和部署了，没有使用实际测试数据进行测试\"}],\"\\n\",[\"$\",\"p\",\"p-75\",{\"children\":\"这其实也是后面生产事故的一大原因，有缺陷的代码没有真实测过就扔到生产环境，造成了问题\"}],\"\\n\",[\"$\",\"ul\",\"ul-7\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"graceful shutdown和不中断服务的更新\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-76\",{\"children\":\"这次项目的部署都是直接重启容器，如果此时有响应正在处理，可能会造成响应做到一半被强制中断。一个好的策略是graceful shutdown，在退出之前的服务时，停止接受新的请求并处理完正在进行的请求，这样可以避免运行到一半的服务（数据库操作有事务保护，但是处理请求可没有事务）。\"}],\"\\n\",[\"$\",\"p\",\"p-77\",{\"children\":[\"另外，\",[\"$\",\"code\",\"code-0\",{\"children\":\"docker-compose up -d\"}],\"虽然启动速度较快，但是仍然有一定的downtime，如果对服务质量有要求，0 downtime的不中断服务的更新还是非常有必要的\"]}],\"\\n\",[\"$\",\"ul\",\"ul-8\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"前端测试\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-78\",{\"children\":\"本项目写了不少后端的测试，行覆盖达到了94%，但是没有写前端测试，这造成每次改前端之后，部署后都心惊胆战的，不知道在真实环境中会不会出现问题。\"}],\"\\n\",[\"$\",\"p\",\"p-79\",{\"children\":[\"但是写测试也有它的问题：\",[\"$\",\"strong\",\"strong-0\",{\"children\":\"花时间\"}],\"。\"]}],\"\\n\",[\"$\",\"p\",\"p-80\",{\"children\":\"现在项目中后端的测试代码比业务逻辑代码要多，写测试代码花的时间也比写真实业务逻辑代码更多。而且由于测试代码也是代码，也会出问题（而且常常会出问题），有时候测试通不过，调试半天测试代码之后发现业务代码没有错，是测试代码的错……\"}],\"\\n\",[\"$\",\"p\",\"p-81\",{\"children\":\"而前端就更复杂了。前端的测试可不是1+1=2正确、=3就错误那么简单。定位UI元素、操作UI元素、等待UI元素的响应、判断UI元素的响应是否合需求，每一部都有一大堆API需要学校。另外，尤其是对于业务项目，很多前端其实并没有一个完整详细的设计文档，什么样的UI是正确的根本就不确定。目前，除了自己的两个前端库，我从来没写过正经的完整项目的前端测试。\"}],\"\\n\",[\"$\",\"p\",\"p-82\",{\"children\":\"我当前的想法是只针对一些复杂一点的业务操作写测试，具体什么样的业务算复杂，只能看实际情况了。\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"总结\",\"children\":[[\"$\",\"a\",\"总结\",{\"href\":\"#总结\",\"className\":\"mr-1\",\"children\":[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"currentColor\",\"strokeWidth\":\"0\",\"viewBox\":\"0 0 512 512\",\"className\":\"inline-block opacity-20 hover:opacity-60\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"$3f\",\"children\":\"$undefined\"}]]],\"style\":{\"color\":\"$undefined\"},\"height\":16,\"width\":16,\"xmlns\":\"http://www.w3.org/2000/svg\"}]}],\"总结\"]}],\"\\n\",[\"$\",\"p\",\"p-83\",{\"children\":\"这个项目比较简单，规模也比较小（12000行左右），用户量也比较小，什么优行操作都没有做，一个简单的前后端结构就能满足需求，但是中途还是犯了很多错误，最后丢失文件的事故也带来了比较多的麻烦。不管怎样，这个项目至少也让我自己完整走了一次一个项目从开发到上线的流程，学到了一些写玩具项目永远都不会用上的技能（比如grafana）。我终于有一个不是玩具的项目了！\"}],\"\\n\",[\"$\",\"p\",\"p-84\",{\"children\":\"现在纯业务的工作确实做得比较腻了，简单的CRUD做来做去也就那些东西。以后希望能够做点更偏架构上的工作，能够支持规模更大、要求更高的项目，也通过更大的项目去接触更高级的项目和流程。我也希望能够带团队或者加入一个能够参与项目全程的已有团队，挑战一下复杂度更高的项目，并从中练习一下团队合作和领导能力。\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"hidden lg:block lg:w-[25%]\",\"children\":[\"$\",\"$L40\",null,{\"toc\":[{\"depth\":1,\"value\":\"我的第一个真实项目\",\"id\":\"我的第一个真实项目\"},{\"depth\":1,\"value\":\"系统功能、架构、规模\",\"id\":\"系统功能架构规模\"},{\"depth\":1,\"value\":\"几次重构\",\"id\":\"几次重构\",\"children\":[{\"depth\":2,\"value\":\"Create React App到Next.js\",\"id\":\"create-react-app到nextjs\"},{\"depth\":2,\"value\":\"非响应式到响应式\",\"id\":\"非响应式到响应式\"},{\"depth\":2,\"value\":\"部署Prometheus/Loki/Grafana\",\"id\":\"部署prometheuslokigrafana\"}]},{\"depth\":1,\"value\":\"前后端共享API定义\",\"id\":\"前后端共享api定义\",\"children\":[{\"depth\":2,\"value\":\"定义接口\",\"id\":\"定义接口\"},{\"depth\":2,\"value\":\"后端实现接口\",\"id\":\"后端实现接口\"},{\"depth\":2,\"value\":\"前端调用接口\",\"id\":\"前端调用接口\"},{\"depth\":2,\"value\":\"减少重复，提高效率\",\"id\":\"减少重复提高效率\"}]},{\"depth\":1,\"value\":\"使用migration进行数据库初始化和更新\",\"id\":\"使用migration进行数据库初始化和更新\"},{\"depth\":1,\"value\":\"记录尽可能多的信息\",\"id\":\"记录尽可能多的信息\"},{\"depth\":1,\"value\":\"安全性\",\"id\":\"安全性\"},{\"depth\":1,\"value\":\"准备应对外部系统出的问题\",\"id\":\"准备应对外部系统出的问题\"},{\"depth\":1,\"value\":\"还可以改进的点\",\"id\":\"还可以改进的点\"},{\"depth\":1,\"value\":\"总结\",\"id\":\"总结\"}],\"hasSummary\":true}]}]]}]\n"])</script><script>self.__next_f.push([1,"41:I[9454,[\"492\",\"static/chunks/8100ded3-8ce54c87b61c7265.js\",\"318\",\"static/chunks/bb1d9007-fdc4463f6b8d4248.js\",\"691\",\"static/chunks/37144445-281a1eece1f23f91.js\",\"93\",\"static/chunks/c145f854-c353ee343fa63f93.js\",\"234\",\"static/chunks/234-7d89acca921e7f65.js\",\"729\",\"static/chunks/729-059eec2a014f5f62.js\",\"602\",\"static/chunks/602-9071b7ef50a964e6.js\",\"464\",\"static/chunks/app/articles/%5B%5B...params%5D%5D/page-8f16d82c55e99bb9.js\"],\"ArticleImage\"]\n23:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/"])</script><script>self.__next_f.push([1,"articles/asset/contents/20210721-summary-of-my-first-real-project/usecase.png\",\"imageSize\":{\"height\":725,\"width\":880},\"imageProps\":{\"src\":\"usecase.png\",\"alt\":\"用例图\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"用例图\"}]]}]\n24:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/articles/asset/contents/20210721-summary-of-my-first-real-project/architecture.png\",\"imageSize\":{\"height\":816,\"width\":958},\"imageProps\":{\"src\":\"architecture.png\",\"alt\":\"架构图\"}}],[\"$\",\"figcaption\""])</script><script>self.__next_f.push([1,",null,{\"className\":\"text-center\",\"children\":\"架构图\"}]]}]\n28:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/articles/asset/contents/20210721-summary-of-my-first-real-project/ssr.png\",\"imageSize\":{\"height\":701,\"width\":1220},\"imageProps\":{\"src\":\"ssr.png\",\"alt\":\"SSR\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"SSR\"}]]}]\n2a:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/articles/asset/contents/20210721-summary-of-my-first-real-project/big-screen-ui.png\",\"imageSize\":"])</script><script>self.__next_f.push([1,"{\"height\":398,\"width\":1249},\"imageProps\":{\"src\":\"big-screen-ui.png\",\"alt\":\"大屏幕界面\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"大屏幕界面\"}]]}]\n2b:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/articles/asset/contents/20210721-summary-of-my-first-real-project/small-screen-ui.png\",\"imageSize\":{\"height\":397,\"width\":682},\"imageProps\":{\"src\":\"small-screen-ui.png\",\"alt\":\"小屏幕下的界面\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"小屏幕"])</script><script>self.__next_f.push([1,"下的界面\"}]]}]\n2c:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/articles/asset/contents/20210721-summary-of-my-first-real-project/homepage-big.png\",\"imageSize\":{\"height\":944,\"width\":952},\"imageProps\":{\"src\":\"homepage-big.png\",\"alt\":\"结构复杂的部分\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"结构复杂的部分\"}]]}]\n2d:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/articles/asset/contents/20210721-summary-of-my-first-real-project/small-screen-ui.png\""])</script><script>self.__next_f.push([1,",\"imageSize\":{\"height\":397,\"width\":682},\"imageProps\":{\"src\":\"small-screen-ui.png\",\"alt\":\"小屏幕下提示\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"小屏幕下提示\"}]]}]\n2f:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/articles/asset/contents/20210721-summary-of-my-first-real-project/grafana-node-exporter.png\",\"imageSize\":{\"height\":902,\"width\":1788},\"imageProps\":{\"src\":\"grafana-node-exporter.png\",\"alt\":\"Grafana Noded Exporter Full\"}}],[\"$\",\"figcaption\",null,{\"classNa"])</script><script>self.__next_f.push([1,"me\":\"text-center\",\"children\":\"Grafana Noded Exporter Full\"}]]}]\n30:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/articles/asset/contents/20210721-summary-of-my-first-real-project/grafana-nginx.png\",\"imageSize\":{\"height\":902,\"width\":1788},\"imageProps\":{\"src\":\"grafana-nginx.png\",\"alt\":\"Grafana Nginx\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"Grafana Nginx\"}]]}]\n31:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/articles/asset/contents/20210721-summary-of-my-first-r"])</script><script>self.__next_f.push([1,"eal-project/loki.png\",\"imageSize\":{\"height\":963,\"width\":1605},\"imageProps\":{\"src\":\"loki.png\",\"alt\":\"通过Loki查看和搜索日志，右上角还可以修改时间\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"通过Loki查看和搜索日志，右上角还可以修改时间\"}]]}]\n36:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/articles/asset/contents/20210721-summary-of-my-first-real-project/api-structure.png\",\"imageSize\":{\"height\":289,\"width\":268},\"imageProps\":{\"src\":\"api-"])</script><script>self.__next_f.push([1,"structure.png\",\"alt\":\"API\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"API\"}]]}]\n37:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/articles/asset/contents/20210721-summary-of-my-first-real-project/api-client.png\",\"imageSize\":{\"height\":335,\"width\":599},\"imageProps\":{\"src\":\"api-client.png\",\"alt\":\"API对象\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"API对象\"}]]}]\n3d:[\"$\",\"figure\",null,{\"children\":[[\"$\",\"$L41\",null,{\"src\":\"/articles/asset/contents/2021072"])</script><script>self.__next_f.push([1,"1-summary-of-my-first-real-project/resend-email.png\",\"imageSize\":{\"height\":203,\"width\":1020},\"imageProps\":{\"src\":\"resend-email.png\",\"alt\":\"失败和重发\"}}],[\"$\",\"figcaption\",null,{\"className\":\"text-center\",\"children\":\"失败和重发\"}]]}]\n"])</script><script>self.__next_f.push([1,""])</script></body></html>