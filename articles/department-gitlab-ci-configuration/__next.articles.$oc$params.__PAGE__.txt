1:"$Sreact.fragment"
2:I[28979,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"ArticleFrontmatter"]
c:I[21753,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"ArticleSummarization"]
d:I[79817,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"Gallery"]
f:I[72053,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"ArticleImage"]
2e:I[23491,["/_next/static/chunks/2caa33a942c5f527.js","/_next/static/chunks/59983278a34fd25c.js"],"OutletBoundary"]
2f:"$Sreact.suspense"
36:I[14620,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"ArticleToc"]
37:I[39182,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"RelatedArticles"]
38:I[42449,["/_next/static/chunks/8d29a04bcfe27c24.js","/_next/static/chunks/3dff3d4c63cf346e.js","/_next/static/chunks/b3af52d5d180873a.js","/_next/static/chunks/86b442c1397f7351.js","/_next/static/chunks/0a1497ca0a1721ad.js","/_next/static/chunks/4ec1bf7a32b70f87.js","/_next/static/chunks/276b22541034e0ea.js"],"CommentPanelWithCurrentLanguage"]
:HL["/_next/static/chunks/44d2e091595b3eca.css","style"]
:HL["/_next/static/chunks/5e55d74f3211c796.css","style"]
:HL["/_next/static/chunks/b59bad6ea4f112f2.css","style"]
3:Teb7,
# 动机

因为~~作业要求~~想尝试持续集成的效果，又因为很多开源CI平台不支持自建平台（例如Travis CI），院的GitLab也不开放Shared Runner，所以只能手动配置Runner。在整个配置的过程中，遇到了很多让人很无语的坑。在这里记下来，以让大家参考。同时也记下来折腾的过程。

先放一张效果图。

![](./buildsuccess.png)

项目地址：
http://101.37.19.32:10080/161250010/gitlabcitest

## GitLab版本过老，需要使用老版本的runner

院的GitLab版本是

![](./gitlabversion.png)

。截止当前（2017/11/6）GitLab CE已经更新到了大版本10，这个8.10版本官方早就已经放弃治疗，甚至在gitlab-runner的[兼容性页面](https://docs.gitlab.com/runner/index.html#compatibility-chart)上都找不到这个版本的信息。~~看来你院使用过时技术的传统看来还要继续延续多年。~~

所以现在在官网的[GitLab Runner安装教程](https://docs.gitlab.com/runner/install/linux-repository.html)已经不适合。

如果使用新版本的gitlab runner运行的话，会提示**405（Method Not Allowed）**错误。这是由于新版本的Runner会使用GitLab从9.0开始换用的新的GitLab API v4，而8.x版本仍然使用老版本的API。这就造成了错误。

同时，Runner从10版本从`gitlab-ci-multi-runner`更名为`gitlab-runner`，但是配置方法大致一样。配置可以参考这个[链接](https://docs.gitlab.com/runner/register/index.html)。

GitLab正确的安装和配置方法方法如下（以Ubuntu 16.04 x64通过apt-get举例）：

1. 根据[这个](https://docs.gitlab.com/runner/install/old.html)设置老版本的apt源;
2. 运行安装命令：`sudo apt-get install gitlab-ci-multi-runner=1.9.5`
3. 配置时使用命令：`sudo gitlab-ci-multi-runner register`

配置好了后，runner页面应该能看到提示的可用的runner。


# Ubuntu官方源Node版本太低

配置好了runner，我首先使用了我的博客前端的程序用来做测试。为了简化，使用了shell executor。这就需要配置runner机器的环境。

先写一份`.gitlab-ci.yml`文件。我使用的文件如下：
```yaml
stages:
  - build

buildjob:
  stage: build
  script:
    - npm install
    - python cleanup.py
    - set NODE_ENV=production
    - webpack -p --color
  cache:
    paths:
      - ./node_modules/
```
直接敲`sudo apt-get install nodejs`，然后就开始build。结果在build的时候才发现node版本很低……


![](./lownodeversion.png)

只能自己设置apt源了。Node官方提供的源说明[参照这个链接](https://nodejs.org/en/download/package-manager/)。


# 构建时内存提示不足


上传后，pipeline自动开始build。然而虽然想到了Node非常耗费内存，但是没想到512M内存都不够吃……跑`npm install`的时候被bash无情杀掉。

![](./notenoughmem.png)

后来把内存加到2G才够npm install使用。

为了简化工程，后来使用了[Mobx官方提供的boilderplate项目](https://github.com/mobxjs/mobx-react-typescript-boilerplate.git)作为测试。这也就是现在的项目。

# 你正在成功！

成功了！折腾了这些后，终于成功build了一次。
![](./buildstatus.png)

还给README.md加上了badge（题图）[(教程)](https://docs.gitlab.com/ee/ci/pipelines.html#badges)，这样看上去就非常像是一个非常好的开源项目。

# 结语

GitLab CI确实是非常好用的工具，它能和GitLab无缝集成，而且非常的简单易用（这些坑都不是GitLab的）。这几天我会把整个软工2项目的CI环境搭建好，需要学习控制台下gradle相关命令以及Linux下的一些配置，这样真正开始开发的时候才能更高效。
0:{"buildId":"7dQlY40Cm-uDMIit5S5Jz","rsc":["$","$1","c",{"children":[["$","article",null,{"children":[["$","div",null,{"className":"bg-neutral px-4 py-8","children":["$","div",null,{"className":"max-w-7xl mx-auto min-h-[256px] flex justify-center text-center text-neutral-content","children":["$","div",null,{"className":"flex flex-col justify-center animate-slide-up","children":[["$","h1",null,{"className":"text-4xl my-2","children":"院自建GitLab CI配置实录"}],["$","$L2",null,{"className":"justify-center","articleId":"department-gitlab-ci-configuration","info":{"content":"$3","title":"院自建GitLab CI配置实录","date":"2017-11-06 23:55","id":"department-gitlab-ci-configuration","lang":"cn","tags":["hands-on"],"wordCount":827,"readingTime":4.135,"filePath":"contents/20171106-院自建GitLab CI配置实录/index.md","summary":{"articleId":"department-gitlab-ci-configuration","lang":"cn","hash":"e0e38c47f17de8752d630e0e96e3299462970aec6f586204750c4c7795fa2337","summaries":[{"metadata":{"summarizer":"azure-ai","model":"DeepSeek-R1"},"summaries":["作者因学院GitLab版本过旧（8.10），无法使用新版GitLab Runner，通过降级安装1.9.5版本Runner并注册解决API兼容性问题。配置过程中遭遇Ubuntu官方源Node.js版本过低，手动更新源解决；构建时内存不足导致进程崩溃，将内存扩容至2G并通过简化测试项目完成部署。最终成功搭建CI环境，实现自动化构建，并为项目添加构建状态徽章。文章总结了GitLab CI与传统开源平台的优势，强调其与GitLab生态的无缝衔接，为后续项目持续集成奠定基础。"],"startTime":"2025-02-14T13:22:15.824Z","endTime":"2025-02-14T13:22:35.522Z"},{"metadata":{"summarizer":"ollama","model":"deepseek-r1:8b"},"summaries":["这篇文章讲述了作者在搭建GitLab持续集成（CI）环境时遇到的各种问题及解决过程。作者主要描述了以下几个关键点：\n\n1. **GitLab版本过旧**：院的GitLab版本较旧，无法直接使用最新版本的Runner，只能依赖老版本的兼容性配置。\n2. **Node版本不足**：在构建前端项目时，发现节点版本过低，需要自行设置适当的apt源来升级Node版本。\n3. **内存不足提示**：在运行npm install时，因服务器内存不足导致进程被终止，最终通过增加内存空间解决了问题。\n4. **工具选择简化流程**：为了简化开发流程，作者选择使用Mobx官方的boilderplate项目作为测试用例。\n\n作者最终成功配置了CI环境，并在README.md中添加了badges，使项目看起来更加专业。结语部分强调了GitLab CI的便利性，但搭建过程中的各种坑点也提醒用户需要注意兼容性、依赖管理及资源分配等问题。"]}]}},"langVersions":["cn"]}]]}]}]}],"$L4"]}],["$L5","$L6","$L7","$L8","$L9","$La"],"$Lb"]}],"loading":null,"isPartial":false}
e:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z4:["$","div",null,{"className":"animate-slide-up","children":[["$","div",null,{"className":"max-w-7xl mx-auto p-4","children":["$","div",null,{"className":"flex flex-row space-x-4","children":[["$","div",null,{"className":"prose max-w-full lg:w-[75%]","children":[["$","$Lc",null,{"summaries":[{"metadata":{"summarizer":"azure-ai","model":"DeepSeek-R1"},"children":[["$","p","p-0",{"children":"作者因学院GitLab版本过旧（8.10），无法使用新版GitLab Runner，通过降级安装1.9.5版本Runner并注册解决API兼容性问题。配置过程中遭遇Ubuntu官方源Node.js版本过低，手动更新源解决；构建时内存不足导致进程崩溃，将内存扩容至2G并通过简化测试项目完成部署。最终成功搭建CI环境，实现自动化构建，并为项目添加构建状态徽章。文章总结了GitLab CI与传统开源平台的优势，强调其与GitLab生态的无缝衔接，为后续项目持续集成奠定基础。"}]]},{"metadata":{"summarizer":"ollama","model":"deepseek-r1:8b"},"children":[["$","p","p-0",{"children":"这篇文章讲述了作者在搭建GitLab持续集成（CI）环境时遇到的各种问题及解决过程。作者主要描述了以下几个关键点："}],"\n",["$","ol","ol-0",{"children":["\n",["$","li","li-0",{"children":[["$","strong","strong-0",{"children":"GitLab版本过旧"}],"：院的GitLab版本较旧，无法直接使用最新版本的Runner，只能依赖老版本的兼容性配置。"]}],"\n",["$","li","li-1",{"children":[["$","strong","strong-0",{"children":"Node版本不足"}],"：在构建前端项目时，发现节点版本过低，需要自行设置适当的apt源来升级Node版本。"]}],"\n",["$","li","li-2",{"children":[["$","strong","strong-0",{"children":"内存不足提示"}],"：在运行npm install时，因服务器内存不足导致进程被终止，最终通过增加内存空间解决了问题。"]}],"\n",["$","li","li-3",{"children":[["$","strong","strong-0",{"children":"工具选择简化流程"}],"：为了简化开发流程，作者选择使用Mobx官方的boilderplate项目作为测试用例。"]}],"\n"]}],"\n",["$","p","p-1",{"children":"作者最终成功配置了CI环境，并在README.md中添加了badges，使项目看起来更加专业。结语部分强调了GitLab CI的便利性，但搭建过程中的各种坑点也提醒用户需要注意兼容性、依赖管理及资源分配等问题。"}]]}]}],["$","$Ld",null,{"withCaption":true,"id":"department-gitlab-ci-configuration","children":[["$","h1","h1-0",{"id":"动机","children":[["$","a","动机",{"href":"#动机","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$e","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"动机"]}],"\n",["$","p","p-0",{"children":["因为",["$","del","del-0",{"children":"作业要求"}],"想尝试持续集成的效果，又因为很多开源CI平台不支持自建平台（例如Travis CI），院的GitLab也不开放Shared Runner，所以只能手动配置Runner。在整个配置的过程中，遇到了很多让人很无语的坑。在这里记下来，以让大家参考。同时也记下来折腾的过程。"]}],"\n",["$","p","p-1",{"children":"先放一张效果图。"}],"\n",["$","p","p-2",{"children":["$","$Lf","img-0",{"src":"/articles/asset/contents/20171106-院自建GitLab CI配置实录/buildsuccess.png","imageSize":{"height":252,"width":866},"imageProps":{"src":"./buildsuccess.png","alt":""}}]}],"\n",["$","p","p-3",{"children":["项目地址：\n",["$","a","a-0",{"href":"http://101.37.19.32:10080/161250010/gitlabcitest","children":"http://101.37.19.32:10080/161250010/gitlabcitest"}]]}],"\n","$L10","\n","$L11","\n","$L12","\n","$L13","\n","$L14","\n","$L15","\n","$L16","\n","$L17","\n","$L18","\n","$L19","\n","$L1a","\n","$L1b","\n","$L1c","\n","$L1d","\n","$L1e","\n","$L1f","\n","$L20","\n","$L21","\n","$L22","\n","$L23","\n","$L24","\n","$L25","\n","$L26","\n","$L27","\n","$L28","\n","$L29","\n","$L2a"]}]]}],"$L2b"]}]}],"$L2c","$L2d"]}]
5:["$","link","0",{"rel":"stylesheet","href":"/_next/static/chunks/44d2e091595b3eca.css","precedence":"next"}]
6:["$","link","1",{"rel":"stylesheet","href":"/_next/static/chunks/5e55d74f3211c796.css","precedence":"next"}]
7:["$","link","2",{"rel":"stylesheet","href":"/_next/static/chunks/b59bad6ea4f112f2.css","precedence":"next"}]
8:["$","script","script-0",{"src":"/_next/static/chunks/0a1497ca0a1721ad.js","async":true}]
9:["$","script","script-1",{"src":"/_next/static/chunks/4ec1bf7a32b70f87.js","async":true}]
a:["$","script","script-2",{"src":"/_next/static/chunks/276b22541034e0ea.js","async":true}]
b:["$","$L2e",null,{"children":["$","$2f",null,{"name":"Next.MetadataOutlet","children":"$@30"}]}]
31:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z10:["$","h2","h2-0",{"id":"gitlab版本过老需要使用老版本的runner","children":[["$","a","gitlab版本过老需要使用老版本的runner",{"href":"#gitlab版本过老需要使用老版本的runner","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$31","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"GitLab版本过老，需要使用老版本的runner"]}]
11:["$","p","p-4",{"children":"院的GitLab版本是"}]
12:["$","p","p-5",{"children":["$","$Lf","img-0",{"src":"/articles/asset/contents/20171106-院自建GitLab CI配置实录/gitlabversion.png","imageSize":{"height":93,"width":1475},"imageProps":{"src":"./gitlabversion.png","alt":""}}]}]
13:["$","p","p-6",{"children":["。截止当前（2017/11/6）GitLab CE已经更新到了大版本10，这个8.10版本官方早就已经放弃治疗，甚至在gitlab-runner的",["$","a","a-0",{"href":"https://docs.gitlab.com/runner/index.html#compatibility-chart","children":"兼容性页面"}],"上都找不到这个版本的信息。",["$","del","del-0",{"children":"看来你院使用过时技术的传统看来还要继续延续多年。"}]]}]
14:["$","p","p-7",{"children":["所以现在在官网的",["$","a","a-0",{"href":"https://docs.gitlab.com/runner/install/linux-repository.html","children":"GitLab Runner安装教程"}],"已经不适合。"]}]
15:["$","p","p-8",{"children":"如果使用新版本的gitlab runner运行的话，会提示**405（Method Not Allowed）**错误。这是由于新版本的Runner会使用GitLab从9.0开始换用的新的GitLab API v4，而8.x版本仍然使用老版本的API。这就造成了错误。"}]
16:["$","p","p-9",{"children":["同时，Runner从10版本从",["$","code","code-0",{"children":"gitlab-ci-multi-runner"}],"更名为",["$","code","code-1",{"children":"gitlab-runner"}],"，但是配置方法大致一样。配置可以参考这个",["$","a","a-0",{"href":"https://docs.gitlab.com/runner/register/index.html","children":"链接"}],"。"]}]
17:["$","p","p-10",{"children":"GitLab正确的安装和配置方法方法如下（以Ubuntu 16.04 x64通过apt-get举例）："}]
18:["$","ol","ol-0",{"children":["\n",["$","li","li-0",{"children":["根据",["$","a","a-0",{"href":"https://docs.gitlab.com/runner/install/old.html","children":"这个"}],"设置老版本的apt源;"]}],"\n",["$","li","li-1",{"children":["运行安装命令：",["$","code","code-0",{"children":"sudo apt-get install gitlab-ci-multi-runner=1.9.5"}]]}],"\n",["$","li","li-2",{"children":["配置时使用命令：",["$","code","code-0",{"children":"sudo gitlab-ci-multi-runner register"}]]}],"\n"]}]
19:["$","p","p-11",{"children":"配置好了后，runner页面应该能看到提示的可用的runner。"}]
32:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z1a:["$","h1","h1-1",{"id":"ubuntu官方源node版本太低","children":[["$","a","ubuntu官方源node版本太低",{"href":"#ubuntu官方源node版本太低","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$32","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"Ubuntu官方源Node版本太低"]}]
1b:["$","p","p-12",{"children":"配置好了runner，我首先使用了我的博客前端的程序用来做测试。为了简化，使用了shell executor。这就需要配置runner机器的环境。"}]
1c:["$","p","p-13",{"children":["先写一份",["$","code","code-0",{"children":".gitlab-ci.yml"}],"文件。我使用的文件如下："]}]
1d:["$","figure","figure-0",{"data-rehype-pretty-code-figure":"","children":["$","pre","pre-0",{"style":{"backgroundColor":"#282c34","color":"#abb2bf"},"tabIndex":0,"data-language":"yaml","data-theme":"one-dark-pro","children":["$","code","code-0",{"data-language":"yaml","data-theme":"one-dark-pro","style":{"display":"grid"},"children":[["$","span","span-0",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E06C75"},"children":"stages"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":":"}]]}],"\n",["$","span","span-1",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"  - "}],["$","span","span-1",{"style":{"color":"#98C379"},"children":"build"}]]}],"\n",["$","span","span-2",{"data-line":"","children":" "}],"\n",["$","span","span-3",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E06C75"},"children":"buildjob"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":":"}]]}],"\n",["$","span","span-4",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E06C75"},"children":"  stage"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":": "}],["$","span","span-2",{"style":{"color":"#98C379"},"children":"build"}]]}],"\n",["$","span","span-5",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E06C75"},"children":"  script"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":":"}]]}],"\n",["$","span","span-6",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"    - "}],["$","span","span-1",{"style":{"color":"#98C379"},"children":"npm install"}]]}],"\n",["$","span","span-7",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"    - "}],["$","span","span-1",{"style":{"color":"#98C379"},"children":"python cleanup.py"}]]}],"\n",["$","span","span-8",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"    - "}],["$","span","span-1",{"style":{"color":"#98C379"},"children":"set NODE_ENV=production"}]]}],"\n",["$","span","span-9",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"    - "}],["$","span","span-1",{"style":{"color":"#98C379"},"children":"webpack -p --color"}]]}],"\n",["$","span","span-10",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E06C75"},"children":"  cache"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":":"}]]}],"\n",["$","span","span-11",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#E06C75"},"children":"    paths"}],["$","span","span-1",{"style":{"color":"#ABB2BF"},"children":":"}]]}],"\n",["$","span","span-12",{"data-line":"","children":[["$","span","span-0",{"style":{"color":"#ABB2BF"},"children":"      - "}],["$","span","span-1",{"style":{"color":"#98C379"},"children":"./node_modules/"}]]}]]}]}]}]
1e:["$","p","p-14",{"children":["直接敲",["$","code","code-0",{"children":"sudo apt-get install nodejs"}],"，然后就开始build。结果在build的时候才发现node版本很低……"]}]
1f:["$","p","p-15",{"children":["$","$Lf","img-0",{"src":"/articles/asset/contents/20171106-院自建GitLab CI配置实录/lownodeversion.png","imageSize":{"height":628,"width":1948},"imageProps":{"src":"./lownodeversion.png","alt":""}}]}]
20:["$","p","p-16",{"children":["只能自己设置apt源了。Node官方提供的源说明",["$","a","a-0",{"href":"https://nodejs.org/en/download/package-manager/","children":"参照这个链接"}],"。"]}]
33:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z21:["$","h1","h1-2",{"id":"构建时内存提示不足","children":[["$","a","构建时内存提示不足",{"href":"#构建时内存提示不足","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$33","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"构建时内存提示不足"]}]
22:["$","p","p-17",{"children":["上传后，pipeline自动开始build。然而虽然想到了Node非常耗费内存，但是没想到512M内存都不够吃……跑",["$","code","code-0",{"children":"npm install"}],"的时候被bash无情杀掉。"]}]
23:["$","p","p-18",{"children":["$","$Lf","img-0",{"src":"/articles/asset/contents/20171106-院自建GitLab CI配置实录/notenoughmem.png","imageSize":{"height":112,"width":1576},"imageProps":{"src":"./notenoughmem.png","alt":""}}]}]
24:["$","p","p-19",{"children":"后来把内存加到2G才够npm install使用。"}]
25:["$","p","p-20",{"children":["为了简化工程，后来使用了",["$","a","a-0",{"href":"https://github.com/mobxjs/mobx-react-typescript-boilerplate.git","children":"Mobx官方提供的boilderplate项目"}],"作为测试。这也就是现在的项目。"]}]
34:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z26:["$","h1","h1-3",{"id":"你正在成功","children":[["$","a","你正在成功",{"href":"#你正在成功","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$34","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"你正在成功！"]}]
27:["$","p","p-21",{"children":["成功了！折腾了这些后，终于成功build了一次。\n",["$","$Lf","img-0",{"src":"/articles/asset/contents/20171106-院自建GitLab CI配置实录/buildstatus.png","imageSize":{"height":407,"width":1431},"imageProps":{"src":"./buildstatus.png","alt":""}}]]}]
28:["$","p","p-22",{"children":["还给README.md加上了badge（题图）",["$","a","a-0",{"href":"https://docs.gitlab.com/ee/ci/pipelines.html#badges","children":"(教程)"}],"，这样看上去就非常像是一个非常好的开源项目。"]}]
35:T4df,M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z29:["$","h1","h1-4",{"id":"结语","children":[["$","a","结语",{"href":"#结语","className":"mr-1","children":["$","svg",null,{"stroke":"currentColor","fill":"currentColor","strokeWidth":"0","viewBox":"0 0 512 512","className":"inline-block opacity-20 hover:opacity-60","children":["$undefined",[["$","path","0",{"d":"$35","children":[]}]]],"style":{},"height":16,"width":16,"xmlns":"http://www.w3.org/2000/svg"}]}],"结语"]}]
2a:["$","p","p-23",{"children":"GitLab CI确实是非常好用的工具，它能和GitLab无缝集成，而且非常的简单易用（这些坑都不是GitLab的）。这几天我会把整个软工2项目的CI环境搭建好，需要学习控制台下gradle相关命令以及Linux下的一些配置，这样真正开始开发的时候才能更高效。"}]
2b:["$","div",null,{"className":"hidden lg:block lg:w-[25%]","children":["$","$L36",null,{"toc":[{"depth":1,"value":"动机","id":"动机","children":[{"depth":2,"value":"GitLab版本过老，需要使用老版本的runner","id":"gitlab版本过老需要使用老版本的runner"}]},{"depth":1,"value":"Ubuntu官方源Node版本太低","id":"ubuntu官方源node版本太低"},{"depth":1,"value":"构建时内存提示不足","id":"构建时内存提示不足"},{"depth":1,"value":"你正在成功！","id":"你正在成功"},{"depth":1,"value":"结语","id":"结语"}],"hasSummary":true}]}]
2c:["$","div",null,{"className":"max-w-7xl mx-auto p-4","children":["$","$L37",null,{"relatedArticles":[]}]}]
2d:["$","div",null,{"className":"max-w-7xl mx-auto p-4","children":["$","$L38",null,{"articleId":"department-gitlab-ci-configuration","articleTitle":"院自建GitLab CI配置实录"}]}]
30:null
